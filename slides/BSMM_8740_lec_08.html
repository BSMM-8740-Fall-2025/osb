<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.39">

  <meta name="author" content="L.L. Odette">
  <title>BSMM-8740 - Fall 2024 – Causality Part 2</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-a8986e45384d4e2047f3d84b21c5a23c.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<meta property="og:title" content="Causality Part 2 – BSMM-8740 - Fall 2024">
<meta property="og:description" content="BSMM8740-2-R-2024F [WEEK - 8]">
<meta property="og:site_name" content="BSMM-8740 - Fall 2024">
<meta name="twitter:title" content="Causality Part 2 – BSMM-8740 - Fall 2024">
<meta name="twitter:description" content="BSMM8740-2-R-2024F [WEEK - 8]">
<meta name="twitter:image" content="https://bsmm-8740-fall-2024.github.io/osb/slides/images/twitter-card.png">
<meta name="twitter:creator" content="@lodette">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Causality Part 2</h1>
  <p class="subtitle">BSMM8740-2-R-2024F [WEEK - 8]</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
L.L. Odette 
</div>
</div>
</div>

</section>
<section id="recap-of-last-week" class="slide level2">
<h2>Recap of last week</h2>
<ul>
<li>Last week we introduced DAGs as a method to represent our causal assumptions and infer how we might estimate the causal effects of interest.</li>
<li>We worked through a method to estimate causal effects using IPW.</li>
</ul>
</section>
<section id="this-week" class="slide level2">
<h2>This week</h2>
<p>We will look at other methods used to estimate causal effects, along with methods used for special situations, including:</p>
<ul>
<li>regression adjustment</li>
<li>doubly robust estimation</li>
<li>matching</li>
<li>difference in differences</li>
<li>fixed effects and methods for panel data</li>
</ul>
</section>
<section>
<section id="causal-effect-estimation" class="title-slide slide level1 center">
<h1>Causal Effect Estimation</h1>

</section>
<section id="inverse-probability-weighting" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<p>Last week we used IPW to create a pseudopopulation where, for every confounder level, the numbers of treated and untreated were balanced.</p>
<p>IPW requires us to build a model to predict the treatment, depending on the confounders (assuming we have data for all the confounders).</p>
</section>
<section id="inverse-probability-weighting-1" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<p>Repeating our prior process, first we calculate the ipw weights and estimate the ATE using the weights.</p>
<div class="cell">
<details class="code-fold">
<summary>ATE estimate by IPW</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>dat_ <span class="ot">&lt;-</span> causalworkshop<span class="sc">::</span>net_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">net =</span> <span class="fu">as.numeric</span>(net))</span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a>propensity_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb1-4"><a></a>  net <span class="sc">~</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature</span>
<span id="cb1-5"><a></a>  , <span class="at">data =</span> dat_, <span class="at">family =</span> <span class="fu">binomial</span>()</span>
<span id="cb1-6"><a></a>)</span>
<span id="cb1-7"><a></a></span>
<span id="cb1-8"><a></a>net_data_wts <span class="ot">&lt;-</span> propensity_model <span class="sc">|&gt;</span></span>
<span id="cb1-9"><a></a>  broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">newdata =</span> dat_, <span class="at">type.predict =</span> <span class="st">"response"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-10"><a></a>  <span class="co"># .fitted is the value predicted by the model</span></span>
<span id="cb1-11"><a></a>  <span class="co"># for a given observation</span></span>
<span id="cb1-12"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">wts =</span> propensity<span class="sc">::</span><span class="fu">wt_ate</span>(.fitted, <span class="at">.exposure =</span> net))</span>
<span id="cb1-13"><a></a></span>
<span id="cb1-14"><a></a>net_data_wts <span class="sc">|&gt;</span></span>
<span id="cb1-15"><a></a>  <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net, <span class="at">data =</span> _, <span class="at">weights =</span> wts) <span class="sc">|&gt;</span></span>
<span id="cb1-16"><a></a>  broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="esbdapfpep" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#esbdapfpep table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#esbdapfpep thead, #esbdapfpep tbody, #esbdapfpep tfoot, #esbdapfpep tr, #esbdapfpep td, #esbdapfpep th {
  border-style: none;
}

#esbdapfpep p {
  margin: 0;
  padding: 0;
}

#esbdapfpep .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#esbdapfpep .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#esbdapfpep .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#esbdapfpep .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#esbdapfpep .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#esbdapfpep .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#esbdapfpep .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#esbdapfpep .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#esbdapfpep .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#esbdapfpep .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#esbdapfpep .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#esbdapfpep .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#esbdapfpep .gt_spanner_row {
  border-bottom-style: hidden;
}

#esbdapfpep .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#esbdapfpep .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#esbdapfpep .gt_from_md > :first-child {
  margin-top: 0;
}

#esbdapfpep .gt_from_md > :last-child {
  margin-bottom: 0;
}

#esbdapfpep .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#esbdapfpep .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#esbdapfpep .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#esbdapfpep .gt_row_group_first td {
  border-top-width: 2px;
}

#esbdapfpep .gt_row_group_first th {
  border-top-width: 2px;
}

#esbdapfpep .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#esbdapfpep .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#esbdapfpep .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#esbdapfpep .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#esbdapfpep .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#esbdapfpep .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#esbdapfpep .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#esbdapfpep .gt_striped {
  background-color: #FAFAFA;
}

#esbdapfpep .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#esbdapfpep .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#esbdapfpep .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#esbdapfpep .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#esbdapfpep .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#esbdapfpep .gt_left {
  text-align: left;
}

#esbdapfpep .gt_center {
  text-align: center;
}

#esbdapfpep .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#esbdapfpep .gt_font_normal {
  font-weight: normal;
}

#esbdapfpep .gt_font_bold {
  font-weight: bold;
}

#esbdapfpep .gt_font_italic {
  font-style: italic;
}

#esbdapfpep .gt_super {
  font-size: 65%;
}

#esbdapfpep .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#esbdapfpep .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#esbdapfpep .gt_indent_1 {
  text-indent: 5px;
}

#esbdapfpep .gt_indent_2 {
  text-indent: 10px;
}

#esbdapfpep .gt_indent_3 {
  text-indent: 15px;
}

#esbdapfpep .gt_indent_4 {
  text-indent: 20px;
}

#esbdapfpep .gt_indent_5 {
  text-indent: 25px;
}

#esbdapfpep .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#esbdapfpep div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="term" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">term</th>
<th id="estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">estimate</th>
<th id="std.error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">std.error</th>
<th id="statistic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">statistic</th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">p.value</th>
<th id="conf.low" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">conf.low</th>
<th id="conf.high" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">conf.high</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="term">(Intercept)</td>
<td class="gt_row gt_right" headers="estimate">42.74</td>
<td class="gt_row gt_right" headers="std.error">0.4420</td>
<td class="gt_row gt_right" headers="statistic">96.69</td>
<td class="gt_row gt_right" headers="p.value">0.000e+00</td>
<td class="gt_row gt_right" headers="conf.low">41.87</td>
<td class="gt_row gt_right" headers="conf.high">43.61</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="term">net</td>
<td class="gt_row gt_right gt_striped" headers="estimate">-12.54</td>
<td class="gt_row gt_right gt_striped" headers="std.error">0.6243</td>
<td class="gt_row gt_right gt_striped" headers="statistic">-20.10</td>
<td class="gt_row gt_right gt_striped" headers="p.value">5.498e-81</td>
<td class="gt_row gt_right gt_striped" headers="conf.low">-13.77</td>
<td class="gt_row gt_right gt_striped" headers="conf.high">-11.32</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="inverse-probability-weighting-2" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<div style="font-size: large">
<p>The function <sup>1</sup><code>propensity::wt_ate</code> calculates <strong>unstabilized</strong> weights by default. In the last lecture we looked at the distribution of weights and decided they were stable enough, because none of the weights were too big or too small.</p>
<p>Let’s explore the question of IPW stabilization a bit more.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ate-density-net-data" class="quarto-float quarto-figure quarto-figure-center" width="960">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-ate-density-net-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="BSMM_8740_lec_08_files/figure-revealjs/fig-ate-density-net-data-1.png" id="fig-ate-density-net-data" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ate-density-net-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>tables created with functions from the package <code>gtsummary</code>.</p></li></ol></aside></section>
<section id="inverse-probability-weighting-3" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<h3 id="stabilized-weights">Stabilized weights</h3>
<ul>
<li><p>The IP weights (given covariate set <span class="math inline">\(L\)</span>) are <span class="math inline">\(W^A=1/\mathbb{E}[D|L]\)</span>. Because the denominator can be very close to <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span> the estimates using these weights can be unstable.</p></li>
<li><p>Stabilized weights are often used to address this, e.g.&nbsp;the function <code>propensity::wt_ate</code> with stabilize = TRUE multiplies the weights by the mean of the treatment so in this case <span class="math inline">\(SW^A=\mathbb{E}[D]/\mathbb{E}[D|L]\)</span>.</p></li>
</ul>
</section>
<section id="inverse-probability-weighting-4" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<h3 id="v-stabilized-weights">V-Stabilized weights</h3>
<p>Baseline covariates (<span class="math inline">\(V\subset L\)</span>) are also used to stabilize IP weights: <span class="math inline">\(SW^A(V)=\mathbb{E}[D|V]/\mathbb{E}[D|L]\)</span>.</p>
<ul>
<li>Note the the variables <span class="math inline">\(V\)</span> need to be included in the numerator and the denominator (as part of <span class="math inline">\(L\)</span>)</li>
<li>V-stabilization results in IP weights that are more stabilized than the ones without V.</li>
</ul>
</section>
<section id="inverse-probability-weighting-5" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<div style="font-size: x-large">
<p>We know that IPW weighting should create a pseudo-population that make the covariates more balanced by treatment. In the last lecture we checked this using histograms. Here we check this via the statistics of the data:</p>
</div>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">unweighted</a></li><li><a href="#tabset-1-2">weighted</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(</span>
<span id="cb2-2"><a></a>  net_data_wts </span>
<span id="cb2-3"><a></a>  , <span class="at">by =</span> net</span>
<span id="cb2-4"><a></a>  , <span class="at">include =</span> <span class="fu">c</span>(net,income,health,temperature,malaria_risk)</span>
<span id="cb2-5"><a></a>) <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a></a>  <span class="co"># add an overall column to the table</span></span>
<span id="cb2-7"><a></a>  gtsummary<span class="sc">::</span><span class="fu">add_overall</span>(<span class="at">last =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fzrjollzub" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fzrjollzub table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fzrjollzub thead, #fzrjollzub tbody, #fzrjollzub tfoot, #fzrjollzub tr, #fzrjollzub td, #fzrjollzub th {
  border-style: none;
}

#fzrjollzub p {
  margin: 0;
  padding: 0;
}

#fzrjollzub .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fzrjollzub .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fzrjollzub .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fzrjollzub .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fzrjollzub .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fzrjollzub .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fzrjollzub .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fzrjollzub .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fzrjollzub .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fzrjollzub .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fzrjollzub .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fzrjollzub .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fzrjollzub .gt_spanner_row {
  border-bottom-style: hidden;
}

#fzrjollzub .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fzrjollzub .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fzrjollzub .gt_from_md > :first-child {
  margin-top: 0;
}

#fzrjollzub .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fzrjollzub .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fzrjollzub .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fzrjollzub .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fzrjollzub .gt_row_group_first td {
  border-top-width: 2px;
}

#fzrjollzub .gt_row_group_first th {
  border-top-width: 2px;
}

#fzrjollzub .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fzrjollzub .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fzrjollzub .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fzrjollzub .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fzrjollzub .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fzrjollzub .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fzrjollzub .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fzrjollzub .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fzrjollzub .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fzrjollzub .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fzrjollzub .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fzrjollzub .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fzrjollzub .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fzrjollzub .gt_left {
  text-align: left;
}

#fzrjollzub .gt_center {
  text-align: center;
}

#fzrjollzub .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fzrjollzub .gt_font_normal {
  font-weight: normal;
}

#fzrjollzub .gt_font_bold {
  font-weight: bold;
}

#fzrjollzub .gt_font_italic {
  font-style: italic;
}

#fzrjollzub .gt_super {
  font-size: 65%;
}

#fzrjollzub .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fzrjollzub .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fzrjollzub .gt_indent_1 {
  text-indent: 5px;
}

#fzrjollzub .gt_indent_2 {
  text-indent: 10px;
}

#fzrjollzub .gt_indent_3 {
  text-indent: 15px;
}

#fzrjollzub .gt_indent_4 {
  text-indent: 20px;
}

#fzrjollzub .gt_indent_5 {
  text-indent: 25px;
}

#fzrjollzub .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#fzrjollzub div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="<div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;><div class='gt_from_md'><p><strong>Characteristic</strong></p>
</div></div>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><p><strong>Characteristic</strong></p></th>
<th id="<div data-qmd-base64=&quot;KiowKiogIApOID0gMSwyOTg=&quot;><div class='gt_from_md'><p><strong>0</strong><br />
N = 1,298</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>0</strong><br>
N = 1,298</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KioxKiogIApOID0gNDU0&quot;><div class='gt_from_md'><p><strong>1</strong><br />
N = 454</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>1</strong><br>
N = 454</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KipPdmVyYWxsKiogIApOID0gMSw3NTI=&quot;><div class='gt_from_md'><p><strong>Overall</strong><br />
N = 1,752</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>Overall</strong><br>
N = 1,752</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">income</td>
<td class="gt_row gt_center" headers="stat_1">880 (751, 1,010)</td>
<td class="gt_row gt_center" headers="stat_2">954 (806, 1,081)</td>
<td class="gt_row gt_center" headers="stat_0">893 (765, 1,031)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">health</td>
<td class="gt_row gt_center" headers="stat_1">49 (35, 61)</td>
<td class="gt_row gt_center" headers="stat_2">54 (40, 68)</td>
<td class="gt_row gt_center" headers="stat_0">50 (37, 64)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">temperature</td>
<td class="gt_row gt_center" headers="stat_1">23.9 (21.0, 27.1)</td>
<td class="gt_row gt_center" headers="stat_2">23.5 (20.6, 26.9)</td>
<td class="gt_row gt_center" headers="stat_0">23.8 (20.9, 27.1)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">malaria_risk</td>
<td class="gt_row gt_center" headers="stat_1">41 (32, 54)</td>
<td class="gt_row gt_center" headers="stat_2">26 (20, 32)</td>
<td class="gt_row gt_center" headers="stat_0">36 (28, 50)</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span>
<p>Median (Q1, Q3)</p></td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>net_svy <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svydesign</span>(</span>
<span id="cb3-2"><a></a>  <span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb3-3"><a></a>  <span class="at">data =</span> net_data_wts,</span>
<span id="cb3-4"><a></a>  <span class="at">weights =</span> <span class="sc">~</span>wts</span>
<span id="cb3-5"><a></a>)</span>
<span id="cb3-6"><a></a></span>
<span id="cb3-7"><a></a>gtsummary<span class="sc">::</span><span class="fu">tbl_svysummary</span>(</span>
<span id="cb3-8"><a></a>  net_svy,</span>
<span id="cb3-9"><a></a>  <span class="at">by =</span> net,</span>
<span id="cb3-10"><a></a>  <span class="at">include =</span> <span class="fu">c</span>(net,income,health,temperature,malaria_risk)</span>
<span id="cb3-11"><a></a>) <span class="sc">|&gt;</span></span>
<span id="cb3-12"><a></a>  gtsummary<span class="sc">::</span><span class="fu">add_overall</span>(<span class="at">last =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="durfmahlwe" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#durfmahlwe table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#durfmahlwe thead, #durfmahlwe tbody, #durfmahlwe tfoot, #durfmahlwe tr, #durfmahlwe td, #durfmahlwe th {
  border-style: none;
}

#durfmahlwe p {
  margin: 0;
  padding: 0;
}

#durfmahlwe .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#durfmahlwe .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#durfmahlwe .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#durfmahlwe .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#durfmahlwe .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#durfmahlwe .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#durfmahlwe .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#durfmahlwe .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#durfmahlwe .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#durfmahlwe .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#durfmahlwe .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#durfmahlwe .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#durfmahlwe .gt_spanner_row {
  border-bottom-style: hidden;
}

#durfmahlwe .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#durfmahlwe .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#durfmahlwe .gt_from_md > :first-child {
  margin-top: 0;
}

#durfmahlwe .gt_from_md > :last-child {
  margin-bottom: 0;
}

#durfmahlwe .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#durfmahlwe .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#durfmahlwe .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#durfmahlwe .gt_row_group_first td {
  border-top-width: 2px;
}

#durfmahlwe .gt_row_group_first th {
  border-top-width: 2px;
}

#durfmahlwe .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#durfmahlwe .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#durfmahlwe .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#durfmahlwe .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#durfmahlwe .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#durfmahlwe .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#durfmahlwe .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#durfmahlwe .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#durfmahlwe .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#durfmahlwe .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#durfmahlwe .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#durfmahlwe .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#durfmahlwe .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#durfmahlwe .gt_left {
  text-align: left;
}

#durfmahlwe .gt_center {
  text-align: center;
}

#durfmahlwe .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#durfmahlwe .gt_font_normal {
  font-weight: normal;
}

#durfmahlwe .gt_font_bold {
  font-weight: bold;
}

#durfmahlwe .gt_font_italic {
  font-style: italic;
}

#durfmahlwe .gt_super {
  font-size: 65%;
}

#durfmahlwe .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#durfmahlwe .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#durfmahlwe .gt_indent_1 {
  text-indent: 5px;
}

#durfmahlwe .gt_indent_2 {
  text-indent: 10px;
}

#durfmahlwe .gt_indent_3 {
  text-indent: 15px;
}

#durfmahlwe .gt_indent_4 {
  text-indent: 20px;
}

#durfmahlwe .gt_indent_5 {
  text-indent: 25px;
}

#durfmahlwe .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#durfmahlwe div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="<div data-qmd-base64=&quot;KipDaGFyYWN0ZXJpc3RpYyoq&quot;><div class='gt_from_md'><p><strong>Characteristic</strong></p>
</div></div>" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><p><strong>Characteristic</strong></p></th>
<th id="<div data-qmd-base64=&quot;KiowKiogIApOID0gMSw3NTE=&quot;><div class='gt_from_md'><p><strong>0</strong><br />
N = 1,751</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>0</strong><br>
N = 1,751</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KioxKiogIApOID0gMSw3NjA=&quot;><div class='gt_from_md'><p><strong>1</strong><br />
N = 1,760</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>1</strong><br>
N = 1,760</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
<th id="<div data-qmd-base64=&quot;KipPdmVyYWxsKiogIApOID0gMyw1MTE=&quot;><div class='gt_from_md'><p><strong>Overall</strong><br />
N = 3,511</p>
</div></div><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><p><strong>Overall</strong><br>
N = 3,511</p>
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">income</td>
<td class="gt_row gt_center" headers="stat_1">892 (767, 1,025)</td>
<td class="gt_row gt_center" headers="stat_2">892 (755, 1,039)</td>
<td class="gt_row gt_center" headers="stat_0">892 (761, 1,031)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">health</td>
<td class="gt_row gt_center" headers="stat_1">50 (36, 63)</td>
<td class="gt_row gt_center" headers="stat_2">49 (37, 64)</td>
<td class="gt_row gt_center" headers="stat_0">50 (37, 64)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">temperature</td>
<td class="gt_row gt_center" headers="stat_1">23.9 (20.9, 27.1)</td>
<td class="gt_row gt_center" headers="stat_2">23.8 (20.8, 27.3)</td>
<td class="gt_row gt_center" headers="stat_0">23.8 (20.8, 27.2)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">malaria_risk</td>
<td class="gt_row gt_center" headers="stat_1">40 (31, 53)</td>
<td class="gt_row gt_center" headers="stat_2">28 (23, 34)</td>
<td class="gt_row gt_center" headers="stat_0">33 (26, 45)</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height: 0;"><sup>1</sup></span>
<p>Median (Q1, Q3)</p></td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="inverse-probability-weighting-6" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<div style="font-size: x-large">
<p>Next we use bootstrapping to generate proper confidence intervals for the effect, first by creating a function to generate (unstabilized) ipw effect estimates for each bootstrap split:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>fit_ipw <span class="ot">&lt;-</span> <span class="cf">function</span>(split, ...) {</span>
<span id="cb4-2"><a></a>  <span class="co"># get bootstrapped data sample with `rsample::analysis()`</span></span>
<span id="cb4-3"><a></a>  <span class="cf">if</span>(<span class="st">"rsplit"</span> <span class="sc">%in%</span> <span class="fu">class</span>(split)){</span>
<span id="cb4-4"><a></a>    .df <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">analysis</span>(split)</span>
<span id="cb4-5"><a></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="st">"data.frame"</span> <span class="sc">%in%</span> <span class="fu">class</span>(split)){</span>
<span id="cb4-6"><a></a>    .df <span class="ot">&lt;-</span> split</span>
<span id="cb4-7"><a></a>  }</span>
<span id="cb4-8"><a></a></span>
<span id="cb4-9"><a></a>  <span class="co"># fit propensity score model</span></span>
<span id="cb4-10"><a></a>  propensity_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb4-11"><a></a>    net <span class="sc">~</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature,</span>
<span id="cb4-12"><a></a>    <span class="at">data =</span> .df,</span>
<span id="cb4-13"><a></a>    <span class="at">family =</span> <span class="fu">binomial</span>()</span>
<span id="cb4-14"><a></a>  )</span>
<span id="cb4-15"><a></a></span>
<span id="cb4-16"><a></a>  <span class="co"># calculate inverse probability weights</span></span>
<span id="cb4-17"><a></a>  .df <span class="ot">&lt;-</span> propensity_model <span class="sc">|&gt;</span></span>
<span id="cb4-18"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">data =</span> .df) <span class="sc">|&gt;</span></span>
<span id="cb4-19"><a></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">wts =</span> propensity<span class="sc">::</span><span class="fu">wt_ate</span>(.fitted, net))</span>
<span id="cb4-20"><a></a></span>
<span id="cb4-21"><a></a>  <span class="co"># fit correctly bootstrapped ipw model</span></span>
<span id="cb4-22"><a></a>  <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net, <span class="at">data =</span> .df, <span class="at">weights =</span> wts) <span class="sc">|&gt;</span></span>
<span id="cb4-23"><a></a>    broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb4-24"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="inverse-probability-weighting-7" class="slide level2">
<h2>Inverse Probability Weighting</h2>
<div style="font-size: x-large">
<p>Next we use our function to bootstrap proper confidence intervals:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="co"># create bootstrap samples</span></span>
<span id="cb5-2"><a></a>bootstrapped_net_data <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">bootstraps</span>(</span>
<span id="cb5-3"><a></a>  dat_,</span>
<span id="cb5-4"><a></a>  <span class="at">times =</span> <span class="dv">1000</span>,</span>
<span id="cb5-5"><a></a>  <span class="co"># required to calculate CIs later</span></span>
<span id="cb5-6"><a></a>  <span class="at">apparent =</span> <span class="cn">TRUE</span></span>
<span id="cb5-7"><a></a>)</span>
<span id="cb5-8"><a></a></span>
<span id="cb5-9"><a></a><span class="co"># create ipw and fit each bootstrap sample</span></span>
<span id="cb5-10"><a></a>results <span class="ot">&lt;-</span> bootstrapped_net_data <span class="sc">|&gt;</span></span>
<span id="cb5-11"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb5-12"><a></a>    <span class="at">ipw_fits =</span> purrr<span class="sc">::</span><span class="fu">map</span>(splits, fit_ipw))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="regression-adjustment" class="slide level2">
<h2>Regression Adjustment</h2>
<div style="font-size: x-large">
<p>IPW estimates rely on a model to predict the treatment using covariate/confounder values. We know that we can also predict the effect of treatment by building a model to predict the outcome using a regression model, regressing the effect on the treatment and covariate/confounder values.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>regression adjustment</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>outcome_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb6-2"><a></a>  malaria_risk <span class="sc">~</span> net <span class="sc">+</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature <span class="sc">+</span> insecticide_resistance <span class="sc">+</span></span>
<span id="cb6-3"><a></a>    <span class="fu">I</span>(health<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(temperature<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(income<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb6-4"><a></a>  <span class="at">data =</span> dat_</span>
<span id="cb6-5"><a></a>)</span>
<span id="cb6-6"><a></a></span>
<span id="cb6-7"><a></a>outcome_model <span class="sc">|&gt;</span> broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 7
  term  estimate std.error statistic   p.value conf.low
  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Int…  1.08e+2   3.55e+0    30.5   1.89e-164  1.01e+2
2 net   -1.24e+1   2.30e-1   -53.8   0         -1.28e+1
3 inco… -1.65e-1   4.58e-3   -36.1   3.48e-213 -1.74e-1
4 heal…  2.01e-1   2.82e-2     7.13  1.44e- 12  1.46e-1
5 temp…  7.69e-1   2.62e-1     2.93  3.42e-  3  2.55e-1
6 inse…  2.19e-1   6.89e-3    31.8   4.97e-175  2.05e-1
7 I(he… -6.60e-4   2.65e-4    -2.49  1.28e-  2 -1.18e-3
8 I(te…  5.01e-3   5.46e-3     0.919 3.58e-  1 -5.68e-3
9 I(in…  5.02e-5   2.50e-6    20.1   1.04e- 80  4.53e-5
# ℹ 1 more variable: conf.high &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="regression-adjustment-1" class="slide level2">
<h2>Regression Adjustment</h2>
<div style="font-size: x-large">
<p>And we can also bootstrap the regression adjustment estimates to get confidence intervals, first by creating the estimation function, then generating bootstrapped estimates, like we did with IPWs:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>fit_reg <span class="ot">&lt;-</span> <span class="cf">function</span>(split, ...) {</span>
<span id="cb8-2"><a></a>  <span class="co"># get bootstrapped data sample with `rsample::analysis()`</span></span>
<span id="cb8-3"><a></a>  <span class="cf">if</span>(<span class="st">"rsplit"</span> <span class="sc">%in%</span> <span class="fu">class</span>(split)){</span>
<span id="cb8-4"><a></a>    .df <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">analysis</span>(split)</span>
<span id="cb8-5"><a></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="st">"data.frame"</span> <span class="sc">%in%</span> <span class="fu">class</span>(split)){</span>
<span id="cb8-6"><a></a>    .df <span class="ot">&lt;-</span> split</span>
<span id="cb8-7"><a></a>  }</span>
<span id="cb8-8"><a></a></span>
<span id="cb8-9"><a></a>  <span class="co"># fit outcome model</span></span>
<span id="cb8-10"><a></a>  <span class="fu">glm</span>(malaria_risk <span class="sc">~</span> net <span class="sc">+</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature <span class="sc">+</span> insecticide_resistance <span class="sc">+</span></span>
<span id="cb8-11"><a></a>      <span class="fu">I</span>(health<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(temperature<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(income<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> .df</span>
<span id="cb8-12"><a></a>    )<span class="sc">|&gt;</span></span>
<span id="cb8-13"><a></a>    broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb8-14"><a></a>}</span>
<span id="cb8-15"><a></a></span>
<span id="cb8-16"><a></a>both_results <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span></span>
<span id="cb8-17"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb8-18"><a></a>    <span class="at">reg_fits =</span> purrr<span class="sc">::</span><span class="fu">map</span>(splits, fit_reg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ipw-vs-regression-adjustment" class="slide level2">
<h2>IPW vs Regression Adjustment</h2>
<div style="font-size: x-large">
<p>We can compare the results:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>both_results_dat <span class="ot">&lt;-</span> both_results <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb9-3"><a></a>    <span class="at">reg_estimate =</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(</span>
<span id="cb9-4"><a></a>      reg_fits,</span>
<span id="cb9-5"><a></a>      <span class="co"># pull the `estimate` for net for each fit</span></span>
<span id="cb9-6"><a></a>      \(.fit) .fit <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"net"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a></a>        dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate)</span>
<span id="cb9-9"><a></a>    )</span>
<span id="cb9-10"><a></a>    , <span class="at">ipw_estimate =</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(</span>
<span id="cb9-11"><a></a>      ipw_fits,</span>
<span id="cb9-12"><a></a>      <span class="co"># pull the `estimate` for net for each fit</span></span>
<span id="cb9-13"><a></a>      \(.fit) .fit <span class="sc">|&gt;</span></span>
<span id="cb9-14"><a></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"net"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-15"><a></a>        dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate)</span>
<span id="cb9-16"><a></a>    )</span>
<span id="cb9-17"><a></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ipw-vs-regression-adjustment-1" class="slide level2">
<h2>IPW vs Regression Adjustment</h2>
<div style="font-size: x-large">
<p>We can plot the results:</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a>dat <span class="ot">&lt;-</span> both_results_dat <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(reg_estimate, ipw_estimate) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"method"</span>, <span class="at">values_to =</span> <span class="st">"effect estimate"</span>)</span>
<span id="cb10-4"><a></a></span>
<span id="cb10-5"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb10-6"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method=</span><span class="fu">factor</span>(method)) <span class="sc">|&gt;</span></span>
<span id="cb10-7"><a></a>  <span class="fu">ggplot</span>( <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb10-8"><a></a>    , <span class="fu">aes</span>(</span>
<span id="cb10-9"><a></a>      <span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fu">after_stat</span>(density) , <span class="at">colour =</span> method, <span class="at">fill =</span> method</span>
<span id="cb10-10"><a></a>      )</span>
<span id="cb10-11"><a></a>  ) <span class="sc">+</span></span>
<span id="cb10-12"><a></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb10-13"><a></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb10-14"><a></a>  <span class="fu">theme</span>(<span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="BSMM_8740_lec_08_files/figure-revealjs/combined reg &amp; ipw plot-1.png" width="960" class="r-stretch"></section>
<section id="ipw-vs-regression-adjustment-2" class="slide level2">
<h2>IPW vs Regression Adjustment</h2>
<div style="font-size: x-large">
<p>We can compare the means and the confidence intervals of the regression adjustment and IPW effect estimates:</p>
<div class="cell">
<details class="code-fold">
<summary>compare IPW and regression effect estimates</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(method) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb11-4"><a></a>  <span class="at">mean =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>)</span>
<span id="cb11-5"><a></a>  , <span class="at">lower_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.025</span>)</span>
<span id="cb11-6"><a></a>  , <span class="at">upper_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.975</span>)</span>
<span id="cb11-7"><a></a>) <span class="sc">|&gt;</span> gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="wnxtxbaqxr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#wnxtxbaqxr table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wnxtxbaqxr thead, #wnxtxbaqxr tbody, #wnxtxbaqxr tfoot, #wnxtxbaqxr tr, #wnxtxbaqxr td, #wnxtxbaqxr th {
  border-style: none;
}

#wnxtxbaqxr p {
  margin: 0;
  padding: 0;
}

#wnxtxbaqxr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wnxtxbaqxr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wnxtxbaqxr .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wnxtxbaqxr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wnxtxbaqxr .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wnxtxbaqxr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wnxtxbaqxr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wnxtxbaqxr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wnxtxbaqxr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wnxtxbaqxr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wnxtxbaqxr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wnxtxbaqxr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wnxtxbaqxr .gt_spanner_row {
  border-bottom-style: hidden;
}

#wnxtxbaqxr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wnxtxbaqxr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wnxtxbaqxr .gt_from_md > :first-child {
  margin-top: 0;
}

#wnxtxbaqxr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wnxtxbaqxr .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wnxtxbaqxr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wnxtxbaqxr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wnxtxbaqxr .gt_row_group_first td {
  border-top-width: 2px;
}

#wnxtxbaqxr .gt_row_group_first th {
  border-top-width: 2px;
}

#wnxtxbaqxr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wnxtxbaqxr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wnxtxbaqxr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wnxtxbaqxr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wnxtxbaqxr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wnxtxbaqxr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wnxtxbaqxr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wnxtxbaqxr .gt_striped {
  background-color: #FAFAFA;
}

#wnxtxbaqxr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wnxtxbaqxr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wnxtxbaqxr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wnxtxbaqxr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wnxtxbaqxr .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wnxtxbaqxr .gt_left {
  text-align: left;
}

#wnxtxbaqxr .gt_center {
  text-align: center;
}

#wnxtxbaqxr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wnxtxbaqxr .gt_font_normal {
  font-weight: normal;
}

#wnxtxbaqxr .gt_font_bold {
  font-weight: bold;
}

#wnxtxbaqxr .gt_font_italic {
  font-style: italic;
}

#wnxtxbaqxr .gt_super {
  font-size: 65%;
}

#wnxtxbaqxr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wnxtxbaqxr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wnxtxbaqxr .gt_indent_1 {
  text-indent: 5px;
}

#wnxtxbaqxr .gt_indent_2 {
  text-indent: 10px;
}

#wnxtxbaqxr .gt_indent_3 {
  text-indent: 15px;
}

#wnxtxbaqxr .gt_indent_4 {
  text-indent: 20px;
}

#wnxtxbaqxr .gt_indent_5 {
  text-indent: 25px;
}

#wnxtxbaqxr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wnxtxbaqxr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="method" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">method</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="lower_ci" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">lower_ci</th>
<th id="upper_ci" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">upper_ci</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="method">ipw_estimate</td>
<td class="gt_row gt_right" headers="mean">-12.56</td>
<td class="gt_row gt_right" headers="lower_ci">-13.42</td>
<td class="gt_row gt_right" headers="upper_ci">-11.66</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="method">reg_estimate</td>
<td class="gt_row gt_right gt_striped" headers="mean">-12.39</td>
<td class="gt_row gt_right gt_striped" headers="lower_ci">-12.98</td>
<td class="gt_row gt_right gt_striped" headers="upper_ci">-11.83</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that each mean ATE estimate is within the CIs of the other ATE mean estimate.</p>
</div>
</section>
<section id="ipw-vs-regression-adjustment-3" class="slide level2">
<h2>IPW vs Regression Adjustment</h2>
<div style="font-size: x-large">
<p>There is a package (<code>boot</code>) that performs cross-validation and CI estimation at the same time:</p>
<div class="cell">
<details class="code-fold">
<summary>use the boot package for CI estimation of regression adjustment</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="co"># bootstrap (1000 times) using the fit_reg function</span></span>
<span id="cb12-2"><a></a>boot_out_reg <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot</span>(</span>
<span id="cb12-3"><a></a>  <span class="at">data =</span> causalworkshop<span class="sc">::</span>net_data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">net =</span> <span class="fu">as.numeric</span>(net))</span>
<span id="cb12-4"><a></a>  , <span class="at">R =</span> <span class="dv">1000</span></span>
<span id="cb12-5"><a></a>  , <span class="at">sim =</span> <span class="st">"ordinary"</span></span>
<span id="cb12-6"><a></a>  , <span class="at">statistic =</span></span>
<span id="cb12-7"><a></a>    (\(x,y){ <span class="co"># x is the data, y is a vector of row numbers for the bootstrap sample</span></span>
<span id="cb12-8"><a></a>      <span class="fu">fit_reg</span>(x[y,]) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"net"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a></a>        dplyr<span class="sc">::</span><span class="fu">pull</span>(estimate)</span>
<span id="cb12-11"><a></a>    })</span>
<span id="cb12-12"><a></a>)</span>
<span id="cb12-13"><a></a><span class="co"># calculate the CIs</span></span>
<span id="cb12-14"><a></a>CIs <span class="ot">&lt;-</span> boot_out_reg <span class="sc">|&gt;</span></span>
<span id="cb12-15"><a></a>  boot<span class="sc">::</span><span class="fu">boot.ci</span>(<span class="at">L =</span> boot<span class="sc">::</span><span class="fu">empinf</span>(boot_out_reg, <span class="at">index=</span><span class="dv">1</span>L, <span class="at">type=</span><span class="st">"jack"</span>))</span>
<span id="cb12-16"><a></a></span>
<span id="cb12-17"><a></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">CI =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"upper"</span>), <span class="at">normal =</span> CIs<span class="sc">$</span>normal[<span class="sc">-</span><span class="dv">1</span>], <span class="at">basic =</span> CIs<span class="sc">$</span>basic[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)]</span>
<span id="cb12-18"><a></a>               , <span class="at">percent =</span> CIs<span class="sc">$</span>percent[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)]) <span class="sc">|&gt;</span> gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="jmxabfxaii" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#jmxabfxaii table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jmxabfxaii thead, #jmxabfxaii tbody, #jmxabfxaii tfoot, #jmxabfxaii tr, #jmxabfxaii td, #jmxabfxaii th {
  border-style: none;
}

#jmxabfxaii p {
  margin: 0;
  padding: 0;
}

#jmxabfxaii .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jmxabfxaii .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jmxabfxaii .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jmxabfxaii .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jmxabfxaii .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jmxabfxaii .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jmxabfxaii .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jmxabfxaii .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jmxabfxaii .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jmxabfxaii .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jmxabfxaii .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jmxabfxaii .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jmxabfxaii .gt_spanner_row {
  border-bottom-style: hidden;
}

#jmxabfxaii .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jmxabfxaii .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jmxabfxaii .gt_from_md > :first-child {
  margin-top: 0;
}

#jmxabfxaii .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jmxabfxaii .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jmxabfxaii .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jmxabfxaii .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jmxabfxaii .gt_row_group_first td {
  border-top-width: 2px;
}

#jmxabfxaii .gt_row_group_first th {
  border-top-width: 2px;
}

#jmxabfxaii .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jmxabfxaii .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jmxabfxaii .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jmxabfxaii .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jmxabfxaii .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jmxabfxaii .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jmxabfxaii .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#jmxabfxaii .gt_striped {
  background-color: #FAFAFA;
}

#jmxabfxaii .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jmxabfxaii .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jmxabfxaii .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jmxabfxaii .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jmxabfxaii .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jmxabfxaii .gt_left {
  text-align: left;
}

#jmxabfxaii .gt_center {
  text-align: center;
}

#jmxabfxaii .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jmxabfxaii .gt_font_normal {
  font-weight: normal;
}

#jmxabfxaii .gt_font_bold {
  font-weight: bold;
}

#jmxabfxaii .gt_font_italic {
  font-style: italic;
}

#jmxabfxaii .gt_super {
  font-size: 65%;
}

#jmxabfxaii .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jmxabfxaii .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jmxabfxaii .gt_indent_1 {
  text-indent: 5px;
}

#jmxabfxaii .gt_indent_2 {
  text-indent: 10px;
}

#jmxabfxaii .gt_indent_3 {
  text-indent: 15px;
}

#jmxabfxaii .gt_indent_4 {
  text-indent: 20px;
}

#jmxabfxaii .gt_indent_5 {
  text-indent: 25px;
}

#jmxabfxaii .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#jmxabfxaii div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="CI" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">CI</th>
<th id="normal" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">normal</th>
<th id="basic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">basic</th>
<th id="percent" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percent</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="CI">lower</td>
<td class="gt_row gt_right" headers="normal">-12.89</td>
<td class="gt_row gt_right" headers="basic">-12.88</td>
<td class="gt_row gt_right" headers="percent">-12.93</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="CI">upper</td>
<td class="gt_row gt_right gt_striped" headers="normal">-11.83</td>
<td class="gt_row gt_right gt_striped" headers="basic">-11.82</td>
<td class="gt_row gt_right gt_striped" headers="percent">-11.87</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="doubly-robust-estimation" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<h4 id="dont-put-all-your-eggs-in-one-basket">Don’t Put All your Eggs in One Basket</h4>
<ul>
<li><p>We’ve learned how to use linear regression and propensity score weighting to estimate <span class="math inline">\(E[Y|D=1] - E[Y|D=0] | X\)</span>. But which one should we use and when?</p></li>
<li><p>When in doubt, just use both! <strong>Doubly Robust Estimation</strong> is a way of combining propensity score and linear regression in a way you don’t have to rely on either of them.</p></li>
</ul>
</section></section>
<section>
<section id="doubly-robust-estimation-1" class="title-slide slide level1 center">
<h1>Doubly Robust Estimation</h1>

</section>
<section id="doubly-robust-estimation-2" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: large">
<p>The estimator is as follows.</p>
<p><span class="math display">\[
\hat{ATE} = \frac{1}{N}\sum \bigg( \dfrac{D_i(Y_i - \hat{\mu_1}(X_i))}{\hat{P}(X_i)} + \hat{\mu_1}(X_i) \bigg) - \frac{1}{N}\sum \bigg( \dfrac{(1-D_i)(Y_i - \hat{\mu_0}(X_i))}{1-\hat{P}(X_i)} + \hat{\mu_0}(X_i) \bigg)
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(\hat{P}(x)\)</span> is an estimation of the propensity score (using logistic regression, for example),</p></li>
<li><p><span class="math inline">\(\hat{\mu_1}(x)\)</span> is an estimation of <span class="math inline">\(E[Y|X, D=1]\)</span> (using linear regression, for example).</p></li>
</ul>
<p>The first part of the doubly robust estimator estimates <span class="math inline">\(E[Y^1]\)</span> and the second part estimates <span class="math inline">\(E[Y^0]\)</span>.</p>
</div>
</section>
<section id="doubly-robust-estimation-3" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<p>First let’s examine the code. Note we use a recipe with the regression to add the polynomial confounders for each</p>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">data</a></li><li><a href="#tabset-2-2">DR function</a></li><li><a href="#tabset-2-3">estimates</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>D <span class="ot">&lt;-</span> <span class="st">"net"</span></span>
<span id="cb13-2"><a></a>Y <span class="ot">&lt;-</span> <span class="st">"malaria_risk"</span></span>
<span id="cb13-3"><a></a>X <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">c</span>(<span class="st">'income'</span>, <span class="st">'health'</span>, <span class="st">'temperature'</span>),<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'_poly_1'</span>,<span class="dv">3</span>),<span class="fu">rep</span>(<span class="st">'_poly_2'</span>,<span class="dv">3</span>)))</span>
<span id="cb13-4"><a></a></span>
<span id="cb13-5"><a></a>doubly_robust_rec <span class="ot">&lt;-</span> causalworkshop<span class="sc">::</span>net_data <span class="sc">|&gt;</span> </span>
<span id="cb13-6"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">net =</span> <span class="fu">as.numeric</span>(net)) <span class="sc">|&gt;</span> </span>
<span id="cb13-7"><a></a>  recipes<span class="sc">::</span><span class="fu">recipe</span>(malaria_risk <span class="sc">~</span> net <span class="sc">+</span> income <span class="sc">+</span> health <span class="sc">+</span> temperature) <span class="sc">|&gt;</span> </span>
<span id="cb13-8"><a></a>  <span class="co"># </span><span class="al">NOTE</span><span class="co">: these are orthogonal polynomial terms, were not used in regression adjustment earlier</span></span>
<span id="cb13-9"><a></a>  recipes<span class="sc">::</span><span class="fu">step_poly</span>(income, health, temperature) <span class="sc">|&gt;</span> </span>
<span id="cb13-10"><a></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() </span>
<span id="cb13-11"><a></a></span>
<span id="cb13-12"><a></a>doubly_robust_dat <span class="ot">&lt;-</span> doubly_robust_rec <span class="sc">|&gt;</span> recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data=</span><span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>doubly_robust <span class="ot">&lt;-</span> <span class="cf">function</span>(df, X, D, Y){</span>
<span id="cb14-2"><a></a>  ps <span class="ot">&lt;-</span> <span class="co"># propensity score</span></span>
<span id="cb14-3"><a></a>    <span class="fu">as.formula</span>(<span class="fu">paste</span>(D, <span class="st">" ~ "</span>, <span class="fu">paste</span>(X, <span class="at">collapse=</span> <span class="st">"+"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a></a>    stats<span class="sc">::</span><span class="fu">glm</span>( <span class="at">data =</span> df, <span class="at">family =</span> <span class="fu">binomial</span>() ) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">data =</span> df) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb14-7"><a></a>  </span>
<span id="cb14-8"><a></a>  lin_frml <span class="ot">&lt;-</span> <span class="fu">formula</span>(<span class="fu">paste</span>(Y, <span class="st">" ~ "</span>, <span class="fu">paste</span>(X, <span class="at">collapse=</span> <span class="st">"+"</span>)))</span>
<span id="cb14-9"><a></a>  </span>
<span id="cb14-10"><a></a>  idx <span class="ot">&lt;-</span> df[,D] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb14-11"><a></a>  mu0 <span class="ot">&lt;-</span> <span class="co"># mean response D == 0</span></span>
<span id="cb14-12"><a></a>    <span class="fu">lm</span>(lin_frml, <span class="at">data =</span> df[idx,]) <span class="sc">|&gt;</span> </span>
<span id="cb14-13"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">newdata =</span> df[,X]) <span class="sc">|&gt;</span></span>
<span id="cb14-14"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb14-15"><a></a>  </span>
<span id="cb14-16"><a></a>  idx <span class="ot">&lt;-</span> df[,D] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb14-17"><a></a>  mu1 <span class="ot">&lt;-</span> <span class="co"># mean response D == 1</span></span>
<span id="cb14-18"><a></a>    <span class="fu">lm</span>(lin_frml, <span class="at">data =</span> df[idx,]) <span class="sc">|&gt;</span>  </span>
<span id="cb14-19"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">newdata =</span> df[,X]) <span class="sc">|&gt;</span> </span>
<span id="cb14-20"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb14-21"><a></a>  </span>
<span id="cb14-22"><a></a>  <span class="co"># convert treatment factor to integer | recast as vectors</span></span>
<span id="cb14-23"><a></a>  d <span class="ot">&lt;-</span> df[,D] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.character</span>() <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb14-24"><a></a>  y <span class="ot">&lt;-</span> df[,Y] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>)</span>
<span id="cb14-25"><a></a>  </span>
<span id="cb14-26"><a></a>  <span class="fu">mean</span>( d<span class="sc">*</span>(y <span class="sc">-</span> mu1)<span class="sc">/</span>ps <span class="sc">+</span> mu1 ) <span class="sc">-</span></span>
<span id="cb14-27"><a></a>    <span class="fu">mean</span>(( <span class="dv">1</span><span class="sc">-</span>d)<span class="sc">*</span>(y <span class="sc">-</span> mu0)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps) <span class="sc">+</span> mu0 )</span>
<span id="cb14-28"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>doubly_robust_dat <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a></a>  <span class="fu">doubly_robust</span>(X, D, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -12.9</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="doubly-robust-estimation-4" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<p>Once again, we can use bootstrap to construct confidence intervals.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>use bootstrap fold to estimate using DRE</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>all_results_dat <span class="ot">&lt;-</span> both_results_dat <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb17-3"><a></a>    <span class="at">dre_estimate =</span> </span>
<span id="cb17-4"><a></a>      purrr<span class="sc">::</span><span class="fu">map_dbl</span>(</span>
<span id="cb17-5"><a></a>        splits</span>
<span id="cb17-6"><a></a>        , (\(x){</span>
<span id="cb17-7"><a></a>            doubly_robust_rec <span class="sc">|&gt;</span> </span>
<span id="cb17-8"><a></a>              recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> rsample<span class="sc">::</span><span class="fu">analysis</span>(x)) <span class="sc">|&gt;</span> </span>
<span id="cb17-9"><a></a>              <span class="fu">doubly_robust</span>(X, D, Y)</span>
<span id="cb17-10"><a></a>        })</span>
<span id="cb17-11"><a></a>      )</span>
<span id="cb17-12"><a></a>  )</span>
<span id="cb17-13"><a></a></span>
<span id="cb17-14"><a></a>all_results_dat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Bootstrap sampling with apparent sample 
# A tibble: 1,001 × 7
   splits             id            ipw_fits reg_fits
   &lt;list&gt;             &lt;chr&gt;         &lt;list&gt;   &lt;list&gt;  
 1 &lt;split [1752/647]&gt; Bootstrap0001 &lt;tibble&gt; &lt;tibble&gt;
 2 &lt;split [1752/662]&gt; Bootstrap0002 &lt;tibble&gt; &lt;tibble&gt;
 3 &lt;split [1752/636]&gt; Bootstrap0003 &lt;tibble&gt; &lt;tibble&gt;
 4 &lt;split [1752/642]&gt; Bootstrap0004 &lt;tibble&gt; &lt;tibble&gt;
 5 &lt;split [1752/621]&gt; Bootstrap0005 &lt;tibble&gt; &lt;tibble&gt;
 6 &lt;split [1752/640]&gt; Bootstrap0006 &lt;tibble&gt; &lt;tibble&gt;
 7 &lt;split [1752/628]&gt; Bootstrap0007 &lt;tibble&gt; &lt;tibble&gt;
 8 &lt;split [1752/652]&gt; Bootstrap0008 &lt;tibble&gt; &lt;tibble&gt;
 9 &lt;split [1752/663]&gt; Bootstrap0009 &lt;tibble&gt; &lt;tibble&gt;
10 &lt;split [1752/649]&gt; Bootstrap0010 &lt;tibble&gt; &lt;tibble&gt;
# ℹ 991 more rows
# ℹ 3 more variables: reg_estimate &lt;dbl&gt;,
#   ipw_estimate &lt;dbl&gt;, dre_estimate &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="doubly-robust-estimation-5" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<p>Looking at the histogram/distributions of all the estimates:</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>dat <span class="ot">&lt;-</span> all_results_dat <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(reg_estimate, ipw_estimate, dre_estimate) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"method"</span>, <span class="at">values_to =</span> <span class="st">"effect estimate"</span>)</span>
<span id="cb19-4"><a></a></span>
<span id="cb19-5"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method=</span><span class="fu">factor</span>(method)) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a></a>  <span class="fu">ggplot</span>( <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb19-8"><a></a>    , <span class="fu">aes</span>(</span>
<span id="cb19-9"><a></a>      <span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fu">after_stat</span>(density) , <span class="at">colour =</span> method, <span class="at">fill =</span> method</span>
<span id="cb19-10"><a></a>      )</span>
<span id="cb19-11"><a></a>  ) <span class="sc">+</span></span>
<span id="cb19-12"><a></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb19-13"><a></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb19-14"><a></a>  <span class="fu">theme</span>(<span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="BSMM_8740_lec_08_files/figure-revealjs/dre reg ipw plot-1.png" width="960" class="r-stretch"></section>
<section id="doubly-robust-estimation-6" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<p>Confidence intervals, including for the dre estimate are:</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>compute CIs for IPW, rgression and DRE</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(method) <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb20-4"><a></a>  <span class="at">mean =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>)</span>
<span id="cb20-5"><a></a>  , <span class="at">lower_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.025</span>)</span>
<span id="cb20-6"><a></a>  , <span class="at">upper_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.975</span>)</span>
<span id="cb20-7"><a></a>) <span class="sc">|&gt;</span> gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="nmxmaveufk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#nmxmaveufk table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#nmxmaveufk thead, #nmxmaveufk tbody, #nmxmaveufk tfoot, #nmxmaveufk tr, #nmxmaveufk td, #nmxmaveufk th {
  border-style: none;
}

#nmxmaveufk p {
  margin: 0;
  padding: 0;
}

#nmxmaveufk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nmxmaveufk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#nmxmaveufk .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nmxmaveufk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nmxmaveufk .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nmxmaveufk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nmxmaveufk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nmxmaveufk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nmxmaveufk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nmxmaveufk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nmxmaveufk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nmxmaveufk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nmxmaveufk .gt_spanner_row {
  border-bottom-style: hidden;
}

#nmxmaveufk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#nmxmaveufk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nmxmaveufk .gt_from_md > :first-child {
  margin-top: 0;
}

#nmxmaveufk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nmxmaveufk .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nmxmaveufk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nmxmaveufk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nmxmaveufk .gt_row_group_first td {
  border-top-width: 2px;
}

#nmxmaveufk .gt_row_group_first th {
  border-top-width: 2px;
}

#nmxmaveufk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nmxmaveufk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nmxmaveufk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nmxmaveufk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nmxmaveufk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nmxmaveufk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nmxmaveufk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#nmxmaveufk .gt_striped {
  background-color: #FAFAFA;
}

#nmxmaveufk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nmxmaveufk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nmxmaveufk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nmxmaveufk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nmxmaveufk .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nmxmaveufk .gt_left {
  text-align: left;
}

#nmxmaveufk .gt_center {
  text-align: center;
}

#nmxmaveufk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nmxmaveufk .gt_font_normal {
  font-weight: normal;
}

#nmxmaveufk .gt_font_bold {
  font-weight: bold;
}

#nmxmaveufk .gt_font_italic {
  font-style: italic;
}

#nmxmaveufk .gt_super {
  font-size: 65%;
}

#nmxmaveufk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#nmxmaveufk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nmxmaveufk .gt_indent_1 {
  text-indent: 5px;
}

#nmxmaveufk .gt_indent_2 {
  text-indent: 10px;
}

#nmxmaveufk .gt_indent_3 {
  text-indent: 15px;
}

#nmxmaveufk .gt_indent_4 {
  text-indent: 20px;
}

#nmxmaveufk .gt_indent_5 {
  text-indent: 25px;
}

#nmxmaveufk .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#nmxmaveufk div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="method" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">method</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="lower_ci" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">lower_ci</th>
<th id="upper_ci" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">upper_ci</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="method">dre_estimate</td>
<td class="gt_row gt_right" headers="mean">-12.91</td>
<td class="gt_row gt_right" headers="lower_ci">-13.62</td>
<td class="gt_row gt_right" headers="upper_ci">-12.28</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="method">ipw_estimate</td>
<td class="gt_row gt_right gt_striped" headers="mean">-12.56</td>
<td class="gt_row gt_right gt_striped" headers="lower_ci">-13.42</td>
<td class="gt_row gt_right gt_striped" headers="upper_ci">-11.66</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="method">reg_estimate</td>
<td class="gt_row gt_right" headers="mean">-12.39</td>
<td class="gt_row gt_right" headers="lower_ci">-12.98</td>
<td class="gt_row gt_right" headers="upper_ci">-11.83</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div style="font-size: x-large">
<p>All methods are consistent.</p>
</div>
</section>
<section id="doubly-robust-estimation-7" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<p>The doubly robust estimator is called doubly robust because it only requires one of the models, <span class="math inline">\(\hat{P}(x)\)</span> or <span class="math inline">\(\hat{\mu}(x)\)</span>, to be correctly specified.</p>
<p>Look at the first part that estimates <span class="math inline">\(E[Y^1]\)</span></p>
<p><span class="math display">\[
\hat{E}[Y^1] = \frac{1}{N}\sum \bigg( \dfrac{D_i(Y_i - \hat{\mu_1}(X_i))}{\hat{P}(X_i)} + \hat{\mu_1}(X_i) \bigg)
\]</span></p>
<p>Assume that <span class="math inline">\(\hat{\mu_1}(x)\)</span> is correct. If the propensity score model is wrong, we wouldn’t need to worry. Because if <span class="math inline">\(\hat{\mu_1}(x)\)</span> is correct, then <span class="math inline">\(E[D_i(Y_i - \hat{\mu_1}(X_i))]=0\)</span>. That is because the multiplication by <span class="math inline">\(D_i\)</span> selects only the treated and the residual of <span class="math inline">\(\hat{\mu_1}\)</span> on the treated have, by definition, mean zero.</p>
<p>This causes the whole thing to reduce to <span class="math inline">\(\hat{\mu_1}(X_i)\)</span>, which is correctly estimated <span class="math inline">\(E[Y^1]\)</span> by assumption. Similar reasoning applies to the estimator of <span class="math inline">\(E[Y^0]\)</span>.</p>
</div>
</section>
<section id="doubly-robust-estimation-8" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: large">
<p>Here we deliberately bias the IPW estimate by replacing the propensity score by a random uniform variable that goes from 0.1 to 0.9 (we don’t want very small weights to blow up the propensity score variance). Since this is random, there is no way it is a good propensity score model, but the doubly robust estimator still manages to produce an estimation that is very close to when the propensity score was estimated with logistic regression.</p>
<div class="cell">
<details class="code-fold">
<summary>define a DRE with a bad IPW model</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a>doubly_robust_bad_ipw <span class="ot">&lt;-</span> <span class="cf">function</span>(df, X, D, Y){</span>
<span id="cb21-2"><a></a>  ps <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fu">dim</span>(df)[<span class="dv">1</span>], <span class="fl">0.1</span>, <span class="fl">0.9</span>) <span class="co"># wrong propensity score </span></span>
<span id="cb21-3"><a></a>  </span>
<span id="cb21-4"><a></a>  lin_frml <span class="ot">&lt;-</span> <span class="fu">formula</span>(<span class="fu">paste</span>(Y, <span class="st">" ~ "</span>, <span class="fu">paste</span>(X, <span class="at">collapse=</span> <span class="st">"+"</span>)))</span>
<span id="cb21-5"><a></a>  </span>
<span id="cb21-6"><a></a>  idx <span class="ot">&lt;-</span> df[,D] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb21-7"><a></a>  mu0 <span class="ot">&lt;-</span> <span class="co"># mean response D == 0</span></span>
<span id="cb21-8"><a></a>    <span class="fu">lm</span>(lin_frml, <span class="at">data =</span> df[idx,]) <span class="sc">|&gt;</span></span>
<span id="cb21-9"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">newdata =</span> df[,X]) <span class="sc">|&gt;</span></span>
<span id="cb21-10"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb21-11"><a></a>  </span>
<span id="cb21-12"><a></a>  idx <span class="ot">&lt;-</span> df[,D] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb21-13"><a></a>  mu1 <span class="ot">&lt;-</span> <span class="co"># mean response D == 1</span></span>
<span id="cb21-14"><a></a>    <span class="fu">lm</span>(lin_frml, <span class="at">data =</span> df[idx,]) <span class="sc">|&gt;</span></span>
<span id="cb21-15"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">newdata =</span> df[,X]) <span class="sc">|&gt;</span></span>
<span id="cb21-16"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb21-17"><a></a>  </span>
<span id="cb21-18"><a></a>  <span class="co"># convert treatment factor to integer | recast as vectors</span></span>
<span id="cb21-19"><a></a>  d <span class="ot">&lt;-</span> df[,D] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.character</span>() <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb21-20"><a></a>  y <span class="ot">&lt;-</span> df[,Y] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>)</span>
<span id="cb21-21"><a></a>  </span>
<span id="cb21-22"><a></a>  <span class="fu">mean</span>( d<span class="sc">*</span>(y <span class="sc">-</span> mu1)<span class="sc">/</span>ps <span class="sc">+</span> mu1 ) <span class="sc">-</span></span>
<span id="cb21-23"><a></a>    <span class="fu">mean</span>(( <span class="dv">1</span><span class="sc">-</span>d)<span class="sc">*</span>(y <span class="sc">-</span> mu0)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps) <span class="sc">+</span> mu0 )</span>
<span id="cb21-24"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="doubly-robust-estimation-9" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>all_results_dat <span class="ot">&lt;-</span> all_results_dat <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb22-3"><a></a>    <span class="at">dre_bad_ipw_estimate =</span> </span>
<span id="cb22-4"><a></a>      purrr<span class="sc">::</span><span class="fu">map_dbl</span>(</span>
<span id="cb22-5"><a></a>        splits</span>
<span id="cb22-6"><a></a>        , (\(x){</span>
<span id="cb22-7"><a></a>          <span class="co"># rsample::analysis(x) |&gt; </span></span>
<span id="cb22-8"><a></a>          <span class="co">#   # dplyr::mutate(net = as.numeric(net)) |&gt; # not needed</span></span>
<span id="cb22-9"><a></a>          <span class="co">#   recipes::bake(new_data = rsample::analysis(x)) |&gt; </span></span>
<span id="cb22-10"><a></a>          doubly_robust_rec <span class="sc">|&gt;</span> </span>
<span id="cb22-11"><a></a>            recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> rsample<span class="sc">::</span><span class="fu">analysis</span>(x)) <span class="sc">|&gt;</span> </span>
<span id="cb22-12"><a></a>            <span class="fu">doubly_robust_bad_ipw</span>(X, D, Y)</span>
<span id="cb22-13"><a></a>        })</span>
<span id="cb22-14"><a></a>      )</span>
<span id="cb22-15"><a></a>  )</span>
<span id="cb22-16"><a></a></span>
<span id="cb22-17"><a></a>dat <span class="ot">&lt;-</span> all_results_dat <span class="sc">|&gt;</span> </span>
<span id="cb22-18"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(reg_estimate, ipw_estimate, dre_estimate, dre_bad_ipw_estimate) <span class="sc">|&gt;</span> </span>
<span id="cb22-19"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"method"</span>, <span class="at">values_to =</span> <span class="st">"effect estimate"</span>)</span>
<span id="cb22-20"><a></a></span>
<span id="cb22-21"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb22-22"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method=</span><span class="fu">factor</span>(method)) <span class="sc">|&gt;</span></span>
<span id="cb22-23"><a></a>  <span class="fu">ggplot</span>( <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb22-24"><a></a>    , <span class="fu">aes</span>(</span>
<span id="cb22-25"><a></a>      <span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fu">after_stat</span>(density) , <span class="at">colour =</span> method, <span class="at">fill =</span> method</span>
<span id="cb22-26"><a></a>      )</span>
<span id="cb22-27"><a></a>  ) <span class="sc">+</span></span>
<span id="cb22-28"><a></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb22-29"><a></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb22-30"><a></a>  <span class="fu">theme</span>(<span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="BSMM_8740_lec_08_files/figure-revealjs/bad ipw estimate plot-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="doubly-robust-estimation-10" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div class="cell">
<details class="code-fold">
<summary>summarize the models so far.</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(method) <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb23-4"><a></a>  <span class="at">mean =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>)</span>
<span id="cb23-5"><a></a>  , <span class="at">lower_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.025</span>)</span>
<span id="cb23-6"><a></a>  , <span class="at">upper_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.975</span>)</span>
<span id="cb23-7"><a></a>) <span class="sc">|&gt;</span> gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="qphkhzvxhj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#qphkhzvxhj table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qphkhzvxhj thead, #qphkhzvxhj tbody, #qphkhzvxhj tfoot, #qphkhzvxhj tr, #qphkhzvxhj td, #qphkhzvxhj th {
  border-style: none;
}

#qphkhzvxhj p {
  margin: 0;
  padding: 0;
}

#qphkhzvxhj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qphkhzvxhj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qphkhzvxhj .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qphkhzvxhj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qphkhzvxhj .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qphkhzvxhj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qphkhzvxhj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qphkhzvxhj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qphkhzvxhj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qphkhzvxhj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qphkhzvxhj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qphkhzvxhj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qphkhzvxhj .gt_spanner_row {
  border-bottom-style: hidden;
}

#qphkhzvxhj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qphkhzvxhj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qphkhzvxhj .gt_from_md > :first-child {
  margin-top: 0;
}

#qphkhzvxhj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qphkhzvxhj .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qphkhzvxhj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qphkhzvxhj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qphkhzvxhj .gt_row_group_first td {
  border-top-width: 2px;
}

#qphkhzvxhj .gt_row_group_first th {
  border-top-width: 2px;
}

#qphkhzvxhj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qphkhzvxhj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qphkhzvxhj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qphkhzvxhj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qphkhzvxhj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qphkhzvxhj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qphkhzvxhj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qphkhzvxhj .gt_striped {
  background-color: #FAFAFA;
}

#qphkhzvxhj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qphkhzvxhj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qphkhzvxhj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qphkhzvxhj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qphkhzvxhj .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qphkhzvxhj .gt_left {
  text-align: left;
}

#qphkhzvxhj .gt_center {
  text-align: center;
}

#qphkhzvxhj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qphkhzvxhj .gt_font_normal {
  font-weight: normal;
}

#qphkhzvxhj .gt_font_bold {
  font-weight: bold;
}

#qphkhzvxhj .gt_font_italic {
  font-style: italic;
}

#qphkhzvxhj .gt_super {
  font-size: 65%;
}

#qphkhzvxhj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qphkhzvxhj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qphkhzvxhj .gt_indent_1 {
  text-indent: 5px;
}

#qphkhzvxhj .gt_indent_2 {
  text-indent: 10px;
}

#qphkhzvxhj .gt_indent_3 {
  text-indent: 15px;
}

#qphkhzvxhj .gt_indent_4 {
  text-indent: 20px;
}

#qphkhzvxhj .gt_indent_5 {
  text-indent: 25px;
}

#qphkhzvxhj .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qphkhzvxhj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="method" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">method</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="lower_ci" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">lower_ci</th>
<th id="upper_ci" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">upper_ci</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="method">dre_bad_ipw_estimate</td>
<td class="gt_row gt_right" headers="mean">-12.93</td>
<td class="gt_row gt_right" headers="lower_ci">-13.71</td>
<td class="gt_row gt_right" headers="upper_ci">-12.16</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="method">dre_estimate</td>
<td class="gt_row gt_right gt_striped" headers="mean">-12.91</td>
<td class="gt_row gt_right gt_striped" headers="lower_ci">-13.62</td>
<td class="gt_row gt_right gt_striped" headers="upper_ci">-12.28</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="method">ipw_estimate</td>
<td class="gt_row gt_right" headers="mean">-12.56</td>
<td class="gt_row gt_right" headers="lower_ci">-13.42</td>
<td class="gt_row gt_right" headers="upper_ci">-11.66</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="method">reg_estimate</td>
<td class="gt_row gt_right gt_striped" headers="mean">-12.39</td>
<td class="gt_row gt_right gt_striped" headers="lower_ci">-12.98</td>
<td class="gt_row gt_right gt_striped" headers="upper_ci">-11.83</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="doubly-robust-estimation-11" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: large">
<p>Messing up the propensity score yields slightly different ATEs, but not by much. Now let’s again take a good look at the first part of the estimator, rearranging some terms:</p>
<p><span class="math display">\[
\begin{align*}
\hat{E}[Y^{1}] &amp; =\frac{1}{N}\sum\bigg(\dfrac{D_{i}(Y_{i}-\hat{\mu_{1}}(X_{i}))}{\hat{P}(X_{i})}+\hat{\mu_{1}}(X_{i})\bigg)\\
&amp; =\frac{1}{N}\sum\bigg(\dfrac{D_{i}Y_{i}}{\hat{P}(X_{i})}-\dfrac{D_{i}\hat{\mu_{1}}(X_{i})}{\hat{P}(X_{i})}+\hat{\mu_{1}}(X_{i})\bigg)\\
&amp; =\frac{1}{N}\sum\bigg(\dfrac{D_{i}Y_{i}}{\hat{P}(X_{i})}-\bigg(\dfrac{D_{i}}{\hat{P}(X_{i})}-1\bigg)\hat{\mu_{1}}(X_{i})\bigg)\\
&amp; =\frac{1}{N}\sum\bigg(\dfrac{D_{i}Y_{i}}{\hat{P}(X_{i})}-\bigg(\dfrac{D_{i}-\hat{P}(X_{i})}{\hat{P}(X_{i})}\bigg)\hat{\mu_{1}}(X_{i})\bigg)
\end{align*}
\]</span></p>
</div>
</section>
<section id="doubly-robust-estimation-12" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<p>Assume that the propensity score <span class="math inline">\(\hat{P}(X_i)\)</span> is correctly specified. In this case, <span class="math inline">\(E[D_i - \hat{P}(X_i)]=0\)</span>, which wipes out the part dependent on <span class="math inline">\(\hat{\mu_1}(X_i)\)</span>. This reduces the doubly robust estimator to the propensity score weighting estimator <span class="math inline">\(\frac{D_iY_i}{\hat{P}(X_i)}\)</span>, which is correct by assumption.</p>
<p>So, even if the <span class="math inline">\(\hat{\mu_1}(X_i)\)</span> is wrong, the estimator will still be correct, provided that the propensity score is correctly specified.</p>
</div>
</section>
<section id="doubly-robust-estimation-13" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div class="cell">
<details class="code-fold">
<summary>define a DRE with a bad regression model</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a>doubly_robust_bad_reg <span class="ot">&lt;-</span> <span class="cf">function</span>(df, X, D, Y){</span>
<span id="cb24-2"><a></a>  ps <span class="ot">&lt;-</span> <span class="co"># propensity score</span></span>
<span id="cb24-3"><a></a>    <span class="fu">as.formula</span>(<span class="fu">paste</span>(D, <span class="st">" ~ "</span>, <span class="fu">paste</span>(X, <span class="at">collapse=</span> <span class="st">"+"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a></a>    stats<span class="sc">::</span><span class="fu">glm</span>( <span class="at">data =</span> df, <span class="at">family =</span> <span class="fu">binomial</span>() ) <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">data =</span> df) <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(.fitted)</span>
<span id="cb24-7"><a></a>  </span>
<span id="cb24-8"><a></a>  mu0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">dim</span>(df)[<span class="dv">1</span>], <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># wrong mean response D == 0</span></span>
<span id="cb24-9"><a></a>  mu1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">dim</span>(df)[<span class="dv">1</span>], <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># wrong mean response D == 1</span></span>
<span id="cb24-10"><a></a>  </span>
<span id="cb24-11"><a></a>  <span class="co"># convert treatment factor to integer | recast as vectors</span></span>
<span id="cb24-12"><a></a>  d <span class="ot">&lt;-</span> df[,D] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">as.character</span>() <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb24-13"><a></a>  y <span class="ot">&lt;-</span> df[,Y] <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>)</span>
<span id="cb24-14"><a></a>  </span>
<span id="cb24-15"><a></a>  <span class="fu">mean</span>( d<span class="sc">*</span>(y <span class="sc">-</span> mu1)<span class="sc">/</span>ps <span class="sc">+</span> mu1 ) <span class="sc">-</span></span>
<span id="cb24-16"><a></a>    <span class="fu">mean</span>(( <span class="dv">1</span><span class="sc">-</span>d)<span class="sc">*</span>(y <span class="sc">-</span> mu0)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>ps) <span class="sc">+</span> mu0 )</span>
<span id="cb24-17"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="doubly-robust-estimation-14" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>all_results_dat <span class="ot">&lt;-</span> all_results_dat <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb25-3"><a></a>    <span class="at">dre_bad_reg_estimate =</span> </span>
<span id="cb25-4"><a></a>      purrr<span class="sc">::</span><span class="fu">map_dbl</span>(</span>
<span id="cb25-5"><a></a>        splits</span>
<span id="cb25-6"><a></a>        , (\(x){</span>
<span id="cb25-7"><a></a>          <span class="co"># rsample::analysis(x) |&gt; </span></span>
<span id="cb25-8"><a></a>          <span class="co">#   # dplyr::mutate(net = as.numeric(net)) |&gt; # not needed</span></span>
<span id="cb25-9"><a></a>          <span class="co">#   recipes::bake(new_data = rsample::analysis(x)) |&gt; </span></span>
<span id="cb25-10"><a></a>          doubly_robust_rec <span class="sc">|&gt;</span> </span>
<span id="cb25-11"><a></a>            recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> rsample<span class="sc">::</span><span class="fu">analysis</span>(x)) <span class="sc">|&gt;</span> </span>
<span id="cb25-12"><a></a>            <span class="fu">doubly_robust_bad_reg</span>(X, D, Y)</span>
<span id="cb25-13"><a></a>        })</span>
<span id="cb25-14"><a></a>      )</span>
<span id="cb25-15"><a></a>  )</span>
<span id="cb25-16"><a></a></span>
<span id="cb25-17"><a></a>dat <span class="ot">&lt;-</span> all_results_dat <span class="sc">|&gt;</span> </span>
<span id="cb25-18"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb25-19"><a></a>    reg_estimate, ipw_estimate, dre_estimate, dre_bad_ipw_estimate, dre_bad_reg_estimate</span>
<span id="cb25-20"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb25-21"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"method"</span>, <span class="at">values_to =</span> <span class="st">"effect estimate"</span>)</span>
<span id="cb25-22"><a></a></span>
<span id="cb25-23"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb25-24"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">method=</span><span class="fu">factor</span>(method)) <span class="sc">|&gt;</span></span>
<span id="cb25-25"><a></a>  <span class="fu">ggplot</span>( <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb25-26"><a></a>    , <span class="fu">aes</span>(</span>
<span id="cb25-27"><a></a>      <span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fu">after_stat</span>(density) , <span class="at">colour =</span> method, <span class="at">fill =</span> method</span>
<span id="cb25-28"><a></a>      )</span>
<span id="cb25-29"><a></a>  ) <span class="sc">+</span></span>
<span id="cb25-30"><a></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb25-31"><a></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb25-32"><a></a>  <span class="fu">theme</span>(<span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="BSMM_8740_lec_08_files/figure-revealjs/bad reg estimate plot-1.png" width="960" class="r-stretch"></section>
<section id="doubly-robust-estimation-15" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<p>Once again, we can use bootstrap and see that the variance is just slightly higher.</p>
<div class="cell">
<details class="code-fold">
<summary>compare the results so far</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(method) <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb26-4"><a></a>  <span class="at">mean =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>)</span>
<span id="cb26-5"><a></a>  , <span class="at">lower_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.025</span>)</span>
<span id="cb26-6"><a></a>  , <span class="at">upper_ci =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">effect estimate</span><span class="st">`</span>, <span class="fl">0.975</span>)</span>
<span id="cb26-7"><a></a>) <span class="sc">|&gt;</span> gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="sagnnufkau" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#sagnnufkau table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#sagnnufkau thead, #sagnnufkau tbody, #sagnnufkau tfoot, #sagnnufkau tr, #sagnnufkau td, #sagnnufkau th {
  border-style: none;
}

#sagnnufkau p {
  margin: 0;
  padding: 0;
}

#sagnnufkau .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sagnnufkau .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#sagnnufkau .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sagnnufkau .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sagnnufkau .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sagnnufkau .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sagnnufkau .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sagnnufkau .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sagnnufkau .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sagnnufkau .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sagnnufkau .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sagnnufkau .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sagnnufkau .gt_spanner_row {
  border-bottom-style: hidden;
}

#sagnnufkau .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#sagnnufkau .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sagnnufkau .gt_from_md > :first-child {
  margin-top: 0;
}

#sagnnufkau .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sagnnufkau .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sagnnufkau .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#sagnnufkau .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#sagnnufkau .gt_row_group_first td {
  border-top-width: 2px;
}

#sagnnufkau .gt_row_group_first th {
  border-top-width: 2px;
}

#sagnnufkau .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sagnnufkau .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#sagnnufkau .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#sagnnufkau .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sagnnufkau .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sagnnufkau .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sagnnufkau .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#sagnnufkau .gt_striped {
  background-color: #FAFAFA;
}

#sagnnufkau .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sagnnufkau .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sagnnufkau .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sagnnufkau .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sagnnufkau .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sagnnufkau .gt_left {
  text-align: left;
}

#sagnnufkau .gt_center {
  text-align: center;
}

#sagnnufkau .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sagnnufkau .gt_font_normal {
  font-weight: normal;
}

#sagnnufkau .gt_font_bold {
  font-weight: bold;
}

#sagnnufkau .gt_font_italic {
  font-style: italic;
}

#sagnnufkau .gt_super {
  font-size: 65%;
}

#sagnnufkau .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#sagnnufkau .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#sagnnufkau .gt_indent_1 {
  text-indent: 5px;
}

#sagnnufkau .gt_indent_2 {
  text-indent: 10px;
}

#sagnnufkau .gt_indent_3 {
  text-indent: 15px;
}

#sagnnufkau .gt_indent_4 {
  text-indent: 20px;
}

#sagnnufkau .gt_indent_5 {
  text-indent: 25px;
}

#sagnnufkau .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#sagnnufkau div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="method" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">method</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="lower_ci" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">lower_ci</th>
<th id="upper_ci" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">upper_ci</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="method">dre_bad_ipw_estimate</td>
<td class="gt_row gt_right" headers="mean">-12.93</td>
<td class="gt_row gt_right" headers="lower_ci">-13.71</td>
<td class="gt_row gt_right" headers="upper_ci">-12.16</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="method">dre_bad_reg_estimate</td>
<td class="gt_row gt_right gt_striped" headers="mean">-12.75</td>
<td class="gt_row gt_right gt_striped" headers="lower_ci">-13.56</td>
<td class="gt_row gt_right gt_striped" headers="upper_ci">-11.95</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="method">dre_estimate</td>
<td class="gt_row gt_right" headers="mean">-12.91</td>
<td class="gt_row gt_right" headers="lower_ci">-13.62</td>
<td class="gt_row gt_right" headers="upper_ci">-12.28</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="method">ipw_estimate</td>
<td class="gt_row gt_right gt_striped" headers="mean">-12.56</td>
<td class="gt_row gt_right gt_striped" headers="lower_ci">-13.42</td>
<td class="gt_row gt_right gt_striped" headers="upper_ci">-11.66</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="method">reg_estimate</td>
<td class="gt_row gt_right" headers="mean">-12.39</td>
<td class="gt_row gt_right" headers="lower_ci">-12.98</td>
<td class="gt_row gt_right" headers="upper_ci">-11.83</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="doubly-robust-estimation-16" class="slide level2">
<h2>Doubly Robust Estimation</h2>
<div style="font-size: x-large">
<p>Once more, messing up the conditional mean model alone yields only slightly different ATE. The magic of doubly robust estimation happens because in causal inference, there are two ways to remove bias from our causal estimates: you either model the treatment mechanism or the outcome mechanism. If either of these models are correct, you are good to go.</p>
<p>One caveat is that, in practice, it’s very hard to model precisely either of those. More often, what ends up happening is that neither the propensity score nor the outcome model are 100% correct. They are both wrong, but in different ways. When this happens, it is not exactly settled <a href="https://www.stat.cmu.edu/~ryantibs/journalclub/kang_2007.pdf">[1]</a> <a href="https://arxiv.org/pdf/0804.2969.pdf">[2]</a> <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2798744/">[3]</a> if it’s better to use a single model or doubly robust estimation. At least it gives you two possibilities of being correct.</p>
</div>
</section></section>
<section>
<section id="finite-sample-bias" class="title-slide slide level1 center">
<h1>Finite Sample Bias</h1>

</section>
<section id="finite-sample-bias-1" class="slide level2">
<h2>Finite Sample Bias</h2>
<div style="font-size: x-large">
<p>We know that not accounting for confounders or blocking open backdoor paths can bias our causal estimates, but it turns out that even after accounting for all confounders, we may still get a biased estimate with finite samples. Many of the properties we tout in statistics rely on large samples—how “large” is defined can be opaque. Let’s look at a quick simulation. Here, we have an exposure/treatment, <span class="math inline">\(X\)</span>, an outcome, <span class="math inline">\(Y\)</span>, and one confounder, <span class="math inline">\(Z\)</span>. We will simulate <span class="math inline">\(Y\)</span>, which is only dependent on <span class="math inline">\(Z\)</span> (so the true treatment effect is 0), and <span class="math inline">\(X\)</span>, which also depends on <span class="math inline">\(Z\)</span>.</p>
</div>
<p><span class="math display">\[
\begin{align*}
Z &amp;\sim \mathscr{N}(0,1)\\
X &amp; = \mathrm{ifelse}(0.5+Z&gt;0,1,0)\\
Y &amp; = Z +  \mathscr{N}(0,1)
\end{align*}
\]</span></p>
</section>
<section id="finite-sample-bias-2" class="slide level2">
<h2>Finite Sample Bias</h2>
<h4 id="sampling-code">Sampling code</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a><span class="fu">set.seed</span>(<span class="dv">928</span>)</span>
<span id="cb27-2"><a></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb27-3"><a></a>finite_sample <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb27-4"><a></a>  <span class="co"># z is normally distributed with a mean: 0 and sd: 1</span></span>
<span id="cb27-5"><a></a>  <span class="at">z =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb27-6"><a></a>  <span class="co"># x is defined from a probit selection model with normally distributed errors</span></span>
<span id="cb27-7"><a></a>  <span class="at">x =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb27-8"><a></a>    <span class="fl">0.5</span> <span class="sc">+</span> z <span class="sc">+</span> <span class="fu">rnorm</span>(n) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb27-9"><a></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb27-10"><a></a>  ),</span>
<span id="cb27-11"><a></a>  <span class="co"># y is continuous, dependent only on z with normally distrbuted errors</span></span>
<span id="cb27-12"><a></a>  <span class="at">y =</span> z <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb27-13"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="finite-sample-bias-3" class="slide level2">
<h2>Finite Sample Bias</h2>
<div style="font-size: x-large">
<p>If we fit a propensity score model using the one confounder <span class="math inline">\(Z\)</span> and calculate the weighted estimator, we should get an unbiased result (which in this case would be <span class="math inline">\(0\)</span>).</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>fit the propensity score model with finite samples</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="do">## fit the propensity score model</span></span>
<span id="cb28-2"><a></a>finite_sample_wts <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb28-3"><a></a>  x <span class="sc">~</span> z,</span>
<span id="cb28-4"><a></a>  <span class="at">data =</span> finite_sample,</span>
<span id="cb28-5"><a></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"probit"</span>)</span>
<span id="cb28-6"><a></a>) <span class="sc">|&gt;</span></span>
<span id="cb28-7"><a></a>  broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">newdata =</span> finite_sample, <span class="at">type.predict =</span> <span class="st">"response"</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-8"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">wts =</span> propensity<span class="sc">::</span><span class="fu">wt_ate</span>(.fitted, x))</span>
<span id="cb28-9"><a></a></span>
<span id="cb28-10"><a></a>finite_sample_wts <span class="sc">|&gt;</span></span>
<span id="cb28-11"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb28-12"><a></a>    <span class="at">effect =</span> <span class="fu">sum</span>(y <span class="sc">*</span> x <span class="sc">*</span> wts) <span class="sc">/</span> <span class="fu">sum</span>(x <span class="sc">*</span> wts) <span class="sc">-</span></span>
<span id="cb28-13"><a></a>      <span class="fu">sum</span>(y <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x) <span class="sc">*</span> wts) <span class="sc">/</span> <span class="fu">sum</span>((<span class="dv">1</span> <span class="sc">-</span> x) <span class="sc">*</span> wts)</span>
<span id="cb28-14"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  effect
   &lt;dbl&gt;
1  0.197</code></pre>
</div>
</div>
</section>
<section id="finite-sample-bias-4" class="slide level2">
<h2>Finite Sample Bias</h2>
<div style="font-size: x-large">
<p>Our effect of is pretty far from 0, although it’s hard to know if this is really bias, or something we are just seeing by chance in this particular simulated sample.</p>
<p>To explore the potential for finite sample bias, we can rerun this simulation many times at different sample sizes:</p>
<div class="cell">
<details class="code-fold">
<summary>fit the propensity score model with different number of finite samples</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>sim <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb30-2"><a></a>  <span class="do">## create a simulated dataset</span></span>
<span id="cb30-3"><a></a>  finite_sample <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb30-4"><a></a>    <span class="at">z =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb30-5"><a></a>    <span class="at">x =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb30-6"><a></a>      <span class="fl">0.5</span> <span class="sc">+</span> z <span class="sc">+</span> <span class="fu">rnorm</span>(n) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb30-7"><a></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb30-8"><a></a>    ),</span>
<span id="cb30-9"><a></a>    <span class="at">y =</span> z <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb30-10"><a></a>  )</span>
<span id="cb30-11"><a></a>  finite_sample_wts <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb30-12"><a></a>    x <span class="sc">~</span> z,</span>
<span id="cb30-13"><a></a>    <span class="at">data =</span> finite_sample,</span>
<span id="cb30-14"><a></a>    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"probit"</span>)</span>
<span id="cb30-15"><a></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-16"><a></a>    broom<span class="sc">::</span><span class="fu">augment</span>(<span class="at">newdata =</span> finite_sample, <span class="at">type.predict =</span> <span class="st">"response"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-17"><a></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">wts =</span> propensity<span class="sc">::</span><span class="fu">wt_ate</span>(.fitted, x))</span>
<span id="cb30-18"><a></a>  bias <span class="ot">&lt;-</span> finite_sample_wts <span class="sc">|&gt;</span></span>
<span id="cb30-19"><a></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb30-20"><a></a>      <span class="at">effect =</span> <span class="fu">sum</span>(y <span class="sc">*</span> x <span class="sc">*</span> wts) <span class="sc">/</span> <span class="fu">sum</span>(x <span class="sc">*</span> wts) <span class="sc">-</span></span>
<span id="cb30-21"><a></a>        <span class="fu">sum</span>(y <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x) <span class="sc">*</span> wts) <span class="sc">/</span> <span class="fu">sum</span>((<span class="dv">1</span> <span class="sc">-</span> x) <span class="sc">*</span> wts)</span>
<span id="cb30-22"><a></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb30-23"><a></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>()</span>
<span id="cb30-24"><a></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb30-25"><a></a>    <span class="at">n =</span> n,</span>
<span id="cb30-26"><a></a>    <span class="at">bias =</span> bias</span>
<span id="cb30-27"><a></a>  )</span>
<span id="cb30-28"><a></a>}</span>
<span id="cb30-29"><a></a></span>
<span id="cb30-30"><a></a><span class="do">## Examine 5 different sample sizes, simulate each 1000 times</span></span>
<span id="cb30-31"><a></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb30-32"><a></a>finite_sample_sims <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(</span>
<span id="cb30-33"><a></a>  <span class="fu">rep</span>(</span>
<span id="cb30-34"><a></a>    <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">5000</span>, <span class="dv">10000</span>),</span>
<span id="cb30-35"><a></a>    <span class="at">each =</span> <span class="dv">1000</span></span>
<span id="cb30-36"><a></a>  ),</span>
<span id="cb30-37"><a></a>  sim</span>
<span id="cb30-38"><a></a>)</span>
<span id="cb30-39"><a></a></span>
<span id="cb30-40"><a></a>bias <span class="ot">&lt;-</span> finite_sample_sims <span class="sc">|&gt;</span></span>
<span id="cb30-41"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(n) <span class="sc">|&gt;</span></span>
<span id="cb30-42"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">bias =</span> <span class="fu">mean</span>(bias))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="finite-sample-bias-5" class="slide level2">
<h2>Finite Sample Bias</h2>
<p>Plotting the results:</p>

<img data-src="BSMM_8740_lec_08_files/figure-revealjs/unnamed-chunk-30-1.png" width="960" class="r-stretch quarto-figure-center"><p class="caption">Finite sample bias present with ATE weights created using correctly specified propensity score model, varying the sample size from n = 50 to n = 10,000</p></section>
<section id="finite-sample-bias-6" class="slide level2">
<h2>Finite Sample Bias</h2>
<div style="font-size: x-large">
<p>This is demonstrates finite sample bias. Notice that even when the sample size is quite large (5,000) we still see some bias away from the “true” effect of 0. It isn’t until a sample size larger than 10,000 that we see this bias disappear.</p>
<p>Estimands that utilize weights that are unbounded (i.e.&nbsp;that theoretically can be infinitely large) are more likely to suffer from finite sample bias. The likelihood of falling into finite sample bias depends on:</p>
<ol type="1">
<li>the estimand you have chosen (i.e.&nbsp;are the weights bounded?)</li>
<li>the distribution of the covariates in the exposed and unexposed groups (i.e.&nbsp;is there good overlap? Potential positivity violations, when there is poor overlap, are the regions where weights can become too large)</li>
<li>the sample size.</li>
</ol>
</div>
</section></section>
<section>
<section id="matching" class="title-slide slide level1 center">
<h1>Matching</h1>

</section>
<section id="matching-1" class="slide level2">
<h2>Matching</h2>
<div style="font-size: x-large">
<p>Regression is good at controlling for additional variables when we do a test vs control comparison. If we have independence, <span class="math inline">\((Y^0, Y^1)\perp D | X\)</span>, then regression can identify the ATE by controlling for <span class="math inline">\(X\)</span>.</p>
<p>To get some intuition about controlling for <span class="math inline">\(X\)</span>, let’s remember the case when all variables <span class="math inline">\(X\)</span> are dummy variables.</p>
<p>If that is the case, regression partitions the data into the dummy cells and computes the mean difference between test and control. Effectively we are calculating doing</p>
<p><span class="math display">\[
E[Y|D=1, X=x] - E[Y|D=0, X=x]
\]</span></p>
<p>where <span class="math inline">\(x\)</span> is a dummy cell (all dummies set to 1, for example).</p>
<p>Regression then combines the estimate in each of the cells to produce a final ATE. The way it does this is by applying weights to the cell proportional to the variance of the treatment on that group.</p>
</div>
</section>
<section id="matching-2" class="slide level2">
<h2>Matching</h2>
<div style="font-size: large">
<p>To give an example, suppose we try to estimate the effect of a drug and I have drug data for 6 men and 4 women. The response variable is days hospitalised and I hope my drug can lower that. On men, the true causal effect is -3, so the drug lowers the stay period by 3 days. On women, it is -2.</p>
<p>To make matters more interesting, men are much more affected by this illness and stay longer at the hospital. They also get much more of the drug. Only 1 out of the 6 men does not get the drug. On the other hand, women are more resistant to this illness, so they stay less at the hospital. 50% of the women get the drug.</p>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="uaaskkmbew" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#uaaskkmbew table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#uaaskkmbew thead, #uaaskkmbew tbody, #uaaskkmbew tfoot, #uaaskkmbew tr, #uaaskkmbew td, #uaaskkmbew th {
  border-style: none;
}

#uaaskkmbew p {
  margin: 0;
  padding: 0;
}

#uaaskkmbew .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uaaskkmbew .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#uaaskkmbew .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uaaskkmbew .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uaaskkmbew .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uaaskkmbew .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uaaskkmbew .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uaaskkmbew .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uaaskkmbew .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uaaskkmbew .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uaaskkmbew .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uaaskkmbew .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uaaskkmbew .gt_spanner_row {
  border-bottom-style: hidden;
}

#uaaskkmbew .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#uaaskkmbew .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uaaskkmbew .gt_from_md > :first-child {
  margin-top: 0;
}

#uaaskkmbew .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uaaskkmbew .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uaaskkmbew .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#uaaskkmbew .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#uaaskkmbew .gt_row_group_first td {
  border-top-width: 2px;
}

#uaaskkmbew .gt_row_group_first th {
  border-top-width: 2px;
}

#uaaskkmbew .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uaaskkmbew .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#uaaskkmbew .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#uaaskkmbew .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uaaskkmbew .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uaaskkmbew .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uaaskkmbew .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#uaaskkmbew .gt_striped {
  background-color: #FAFAFA;
}

#uaaskkmbew .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uaaskkmbew .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uaaskkmbew .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uaaskkmbew .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uaaskkmbew .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uaaskkmbew .gt_left {
  text-align: left;
}

#uaaskkmbew .gt_center {
  text-align: center;
}

#uaaskkmbew .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uaaskkmbew .gt_font_normal {
  font-weight: normal;
}

#uaaskkmbew .gt_font_bold {
  font-weight: bold;
}

#uaaskkmbew .gt_font_italic {
  font-style: italic;
}

#uaaskkmbew .gt_super {
  font-size: 65%;
}

#uaaskkmbew .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#uaaskkmbew .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#uaaskkmbew .gt_indent_1 {
  text-indent: 5px;
}

#uaaskkmbew .gt_indent_2 {
  text-indent: 10px;
}

#uaaskkmbew .gt_indent_3 {
  text-indent: 15px;
}

#uaaskkmbew .gt_indent_4 {
  text-indent: 20px;
}

#uaaskkmbew .gt_indent_5 {
  text-indent: 25px;
}

#uaaskkmbew .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#uaaskkmbew div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="sex" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">sex</th>
<th id="drug" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">drug</th>
<th id="days" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">days</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="sex">M</td>
<td class="gt_row gt_right" headers="drug">1</td>
<td class="gt_row gt_right" headers="days">5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="sex">M</td>
<td class="gt_row gt_right gt_striped" headers="drug">1</td>
<td class="gt_row gt_right gt_striped" headers="days">5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="sex">M</td>
<td class="gt_row gt_right" headers="drug">1</td>
<td class="gt_row gt_right" headers="days">5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="sex">M</td>
<td class="gt_row gt_right gt_striped" headers="drug">1</td>
<td class="gt_row gt_right gt_striped" headers="days">5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="sex">M</td>
<td class="gt_row gt_right" headers="drug">1</td>
<td class="gt_row gt_right" headers="days">5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="sex">M</td>
<td class="gt_row gt_right gt_striped" headers="drug">0</td>
<td class="gt_row gt_right gt_striped" headers="days">8</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="sex">W</td>
<td class="gt_row gt_right" headers="drug">1</td>
<td class="gt_row gt_right" headers="days">2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="sex">W</td>
<td class="gt_row gt_right gt_striped" headers="drug">0</td>
<td class="gt_row gt_right gt_striped" headers="days">4</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="sex">W</td>
<td class="gt_row gt_right" headers="drug">1</td>
<td class="gt_row gt_right" headers="days">2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="sex">W</td>
<td class="gt_row gt_right gt_striped" headers="drug">0</td>
<td class="gt_row gt_right gt_striped" headers="days">4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-3" class="slide level2">
<h2>Matching</h2>
<div style="font-size: x-large">
<p>Note that simple comparison of treatment and control yields a negatively biased effect, that is, the drug seems less effective than it truly is. This is expected, since we’ve omitted the sex confounder.</p>
<p>In this case, the estimated ATE is smaller than the true one because men get more of the drug and are more affected by the illness.</p>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="kyuiqrqycx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#kyuiqrqycx table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kyuiqrqycx thead, #kyuiqrqycx tbody, #kyuiqrqycx tfoot, #kyuiqrqycx tr, #kyuiqrqycx td, #kyuiqrqycx th {
  border-style: none;
}

#kyuiqrqycx p {
  margin: 0;
  padding: 0;
}

#kyuiqrqycx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kyuiqrqycx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kyuiqrqycx .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kyuiqrqycx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kyuiqrqycx .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kyuiqrqycx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kyuiqrqycx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kyuiqrqycx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kyuiqrqycx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kyuiqrqycx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kyuiqrqycx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kyuiqrqycx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kyuiqrqycx .gt_spanner_row {
  border-bottom-style: hidden;
}

#kyuiqrqycx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kyuiqrqycx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kyuiqrqycx .gt_from_md > :first-child {
  margin-top: 0;
}

#kyuiqrqycx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kyuiqrqycx .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kyuiqrqycx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kyuiqrqycx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kyuiqrqycx .gt_row_group_first td {
  border-top-width: 2px;
}

#kyuiqrqycx .gt_row_group_first th {
  border-top-width: 2px;
}

#kyuiqrqycx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyuiqrqycx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kyuiqrqycx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kyuiqrqycx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kyuiqrqycx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyuiqrqycx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kyuiqrqycx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kyuiqrqycx .gt_striped {
  background-color: #FAFAFA;
}

#kyuiqrqycx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kyuiqrqycx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kyuiqrqycx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyuiqrqycx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kyuiqrqycx .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyuiqrqycx .gt_left {
  text-align: left;
}

#kyuiqrqycx .gt_center {
  text-align: center;
}

#kyuiqrqycx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kyuiqrqycx .gt_font_normal {
  font-weight: normal;
}

#kyuiqrqycx .gt_font_bold {
  font-weight: bold;
}

#kyuiqrqycx .gt_font_italic {
  font-style: italic;
}

#kyuiqrqycx .gt_super {
  font-size: 65%;
}

#kyuiqrqycx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kyuiqrqycx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kyuiqrqycx .gt_indent_1 {
  text-indent: 5px;
}

#kyuiqrqycx .gt_indent_2 {
  text-indent: 10px;
}

#kyuiqrqycx .gt_indent_3 {
  text-indent: 15px;
}

#kyuiqrqycx .gt_indent_4 {
  text-indent: 20px;
}

#kyuiqrqycx .gt_indent_5 {
  text-indent: 25px;
}

#kyuiqrqycx .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kyuiqrqycx div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="drug" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">drug</th>
<th id="mean_effect" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean_effect</th>
<th id="ATE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ATE</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="drug">0</td>
<td class="gt_row gt_right" headers="mean_effect">5.333</td>
<td class="gt_row gt_right" headers="ATE">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="drug">1</td>
<td class="gt_row gt_right gt_striped" headers="mean_effect">4.143</td>
<td class="gt_row gt_right gt_striped" headers="ATE">-1.19</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-4" class="slide level2">
<h2>Matching</h2>
<div style="font-size: x-large">
<p>Since the true effect for men is -3 and the true effect for women is -2, the ATE should be</p>
</div>
<p><span class="math display">\[
ATE=\dfrac{(-3*6) + (-2*4)}{10}=-2.6
\]</span></p>
<div style="font-size: x-large">
<p>This estimate is done by</p>
<ol type="1">
<li>partitioning the data into confounder cells, in this case, men and women,</li>
<li>estimating the effect on each cell and</li>
<li>combining the estimate with a weighted average, where the weight is the sample size of the cell or covariate group.</li>
</ol>
</div>
</section>
<section id="matching-5" class="slide level2">
<h2>Matching</h2>
<div style="font-size: x-large">
<p>If we had exactly the same number of men and women in the data, the ATE estimate would be right in the middle of the ATE of the 2 groups, -2.5. Since there are more men than women in our dataset, the ATE estimate is a little bit closer to the men’s ATE.</p>
<p>This is called a non-parametric estimate, since it places no assumption on how the data was generated.</p>
<p>If we control for sex using regression, we will add the assumption of linearity. Regression will also partition the data into men and women and estimate the effect on both of these groups.</p>
<p>So far, so good. However, when it comes to combining the effect on each group, it does not weigh them by the sample size.</p>
</div>
</section>
<section id="matching-6" class="slide level2">
<h2>Matching</h2>
<div style="font-size: x-large">
<p>Instead, regression uses weights that are proportional to the variance of the treatment in that group. In our case, the variance of the treatment in men is smaller than in women, since only one man is in the control group.</p>
<p>To be exact, the variance of D for men is <span class="math inline">\(0.139=1/6*(1 - 1/6)\)</span> and for women is <span class="math inline">\(0.25=2/4*(1 - 2/4)\)</span>.</p>
<p>So regression will give a higher weight to women in our example and the ATE will be a bit closer to the women’s ATE of -2.</p>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="kgmohzmjrw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#kgmohzmjrw table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kgmohzmjrw thead, #kgmohzmjrw tbody, #kgmohzmjrw tfoot, #kgmohzmjrw tr, #kgmohzmjrw td, #kgmohzmjrw th {
  border-style: none;
}

#kgmohzmjrw p {
  margin: 0;
  padding: 0;
}

#kgmohzmjrw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kgmohzmjrw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kgmohzmjrw .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kgmohzmjrw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kgmohzmjrw .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kgmohzmjrw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kgmohzmjrw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kgmohzmjrw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kgmohzmjrw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kgmohzmjrw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kgmohzmjrw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kgmohzmjrw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kgmohzmjrw .gt_spanner_row {
  border-bottom-style: hidden;
}

#kgmohzmjrw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kgmohzmjrw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kgmohzmjrw .gt_from_md > :first-child {
  margin-top: 0;
}

#kgmohzmjrw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kgmohzmjrw .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kgmohzmjrw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kgmohzmjrw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kgmohzmjrw .gt_row_group_first td {
  border-top-width: 2px;
}

#kgmohzmjrw .gt_row_group_first th {
  border-top-width: 2px;
}

#kgmohzmjrw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgmohzmjrw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kgmohzmjrw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kgmohzmjrw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kgmohzmjrw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgmohzmjrw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kgmohzmjrw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kgmohzmjrw .gt_striped {
  background-color: #FAFAFA;
}

#kgmohzmjrw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kgmohzmjrw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kgmohzmjrw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgmohzmjrw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kgmohzmjrw .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgmohzmjrw .gt_left {
  text-align: left;
}

#kgmohzmjrw .gt_center {
  text-align: center;
}

#kgmohzmjrw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kgmohzmjrw .gt_font_normal {
  font-weight: normal;
}

#kgmohzmjrw .gt_font_bold {
  font-weight: bold;
}

#kgmohzmjrw .gt_font_italic {
  font-style: italic;
}

#kgmohzmjrw .gt_super {
  font-size: 65%;
}

#kgmohzmjrw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kgmohzmjrw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kgmohzmjrw .gt_indent_1 {
  text-indent: 5px;
}

#kgmohzmjrw .gt_indent_2 {
  text-indent: 10px;
}

#kgmohzmjrw .gt_indent_3 {
  text-indent: 15px;
}

#kgmohzmjrw .gt_indent_4 {
  text-indent: 20px;
}

#kgmohzmjrw .gt_indent_5 {
  text-indent: 25px;
}

#kgmohzmjrw .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kgmohzmjrw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal">Regression summary (ATE)</th>
</tr>
<tr class="gt_heading even">
<th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">days ~ drug + sex</th>
</tr>
<tr class="gt_col_headings header">
<th id="term" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">term</th>
<th id="estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">estimate</th>
<th id="std.error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">std.error</th>
<th id="statistic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">statistic</th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">p.value</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="term">(Intercept)</td>
<td class="gt_row gt_right" headers="estimate">7.5455</td>
<td class="gt_row gt_right" headers="std.error">0.188</td>
<td class="gt_row gt_right" headers="statistic">40.093</td>
<td class="gt_row gt_right" headers="p.value">0.000</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="term">drug</td>
<td class="gt_row gt_right gt_striped" headers="estimate">−2.4545</td>
<td class="gt_row gt_right gt_striped" headers="std.error">0.188</td>
<td class="gt_row gt_right gt_striped" headers="statistic">−13.042</td>
<td class="gt_row gt_right gt_striped" headers="p.value">0.000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="term">sexW</td>
<td class="gt_row gt_right" headers="estimate">−3.3182</td>
<td class="gt_row gt_right" headers="std.error">0.176</td>
<td class="gt_row gt_right" headers="statistic">−18.849</td>
<td class="gt_row gt_right" headers="p.value">0.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-7" class="slide level2">
<h2>Matching</h2>
<div style="font-size: x-large">
<p>The result is more intuitive with dummy variables, but regression also keeps continuous variables constant while estimating the effect.</p>
<p>Also, with continuous variables, the ATE will point in the direction where covariates have more variance.</p>
<p>So we’ve seen that regression has its idiosyncrasies. It is linear, parametric, likes high variance features… This can be good or bad, depending on the context.</p>
<p>Because of this, it’s important to be aware of other techniques we can use to control for confounders. Not only are they an extra tool in your causal tool belt, but understanding different ways to deal with confounding expands our understanding of the problem.</p>
<p>For this reason, we’ll now examne the Subclassification Estimator!</p>
</div>
</section>
<section id="matching-subclassification" class="slide level2">
<h2>Matching: subclassification</h2>
<div style="font-size: x-large">
<p>In general, if there is some causal effect we want to estimate, but it is hard to do so because of confounding of some variables X, what we need to do is make the treatment vs control comparison within small groups where X is the same.</p>
<p>If we have conditional independence <span class="math inline">\((Y^0, Y^1)\perp D | X\)</span> , then we can write the ATE as follows.</p>
</div>
<p><span class="math display">\[
ATE = \int(E[Y|X=x, D=1] - E[Y|X=x, D=0])dP(x)
\]</span></p>
<div style="font-size: x-large">
<p>What the integral does is it goes through all the space of the distribution of features X, computes the difference in means for all those tiny spaces and combines everything into the ATE.</p>
</div>
</section>
<section id="matching-subclassification-1" class="slide level2">
<h2>Matching: subclassification</h2>
<div style="font-size: x-large">
<p>Another way to see this is to think about a discrete set of features.</p>
<p>In this case, we can say that values the feature set X takes on falls into K different sets <span class="math inline">\(\{X_1, X_2, ..., X_k\}\)</span> and what we are doing is computing the treatment effect in each set and combining them into the ATE.</p>
<p>In this discrete case, converting the integral to a sum, we can derive the subclassifications estimator:</p>
</div>
<p><span class="math display">\[
\hat{ATE} = \sum^K_{k=1}(\bar{Y}^1_k - \bar{Y}^0_k) * \dfrac{N_k}{N}
\]</span></p>
</section>
<section id="matching-subclassification-2" class="slide level2">
<h2>Matching: subclassification</h2>
<p><span class="math display">\[
\hat{ATE} = \sum^K_{k=1}(\bar{Y}^1_k - \bar{Y}^0_k) * \dfrac{N_k}{N}
\]</span></p>
<div style="font-size: x-large">
<p>As you can see, we are computing a local ATE for each cell and combining them using a weighted average, where the weights are the sample size of the cell. In our medicine example above, this would be the first estimate, which gave us −2.6.</p>
<p>The subclassification estimator isn’t used much in practice, because of the curse of dimensionality.</p>
</div>
</section>
<section id="matching-estimator" class="slide level2">
<h2>Matching estimator</h2>
<p>The subclassification estimator gives us a nice intuition of what a causal inference estimator should do, how it should control for confounders.</p>
<p>This allows us to explore other kinds of estimators, such as the Matching Estimator.</p>
</section>
<section id="matching-estimator-1" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>When some confounder X makes it so that treated and untreated are not initially comparable, we can make them so by matching each treated unit with a similar untreated unit - finding an untreated twin for every treated unit. In making such comparisons, treated and untreated become again comparable.</p>
<p>As an example, let’s suppose we are trying to estimate the effect of a trainee program on earnings. Here is what the trainees looks like:</p>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">trainees</a></li><li><a href="#tabset-3-2">non trainees</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a>data_trainees <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/trainees.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-2"><a></a></span>
<span id="cb31-3"><a></a>data_trainees <span class="sc">|&gt;</span> </span>
<span id="cb31-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trainees<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-5"><a></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-6"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb31-7"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="mduhivknhv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#mduhivknhv table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mduhivknhv thead, #mduhivknhv tbody, #mduhivknhv tfoot, #mduhivknhv tr, #mduhivknhv td, #mduhivknhv th {
  border-style: none;
}

#mduhivknhv p {
  margin: 0;
  padding: 0;
}

#mduhivknhv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mduhivknhv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mduhivknhv .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mduhivknhv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mduhivknhv .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mduhivknhv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mduhivknhv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mduhivknhv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mduhivknhv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mduhivknhv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mduhivknhv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mduhivknhv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mduhivknhv .gt_spanner_row {
  border-bottom-style: hidden;
}

#mduhivknhv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mduhivknhv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mduhivknhv .gt_from_md > :first-child {
  margin-top: 0;
}

#mduhivknhv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mduhivknhv .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mduhivknhv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mduhivknhv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mduhivknhv .gt_row_group_first td {
  border-top-width: 2px;
}

#mduhivknhv .gt_row_group_first th {
  border-top-width: 2px;
}

#mduhivknhv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mduhivknhv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mduhivknhv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mduhivknhv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mduhivknhv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mduhivknhv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mduhivknhv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mduhivknhv .gt_striped {
  background-color: #FAFAFA;
}

#mduhivknhv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mduhivknhv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mduhivknhv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mduhivknhv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mduhivknhv .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mduhivknhv .gt_left {
  text-align: left;
}

#mduhivknhv .gt_center {
  text-align: center;
}

#mduhivknhv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mduhivknhv .gt_font_normal {
  font-weight: normal;
}

#mduhivknhv .gt_font_bold {
  font-weight: bold;
}

#mduhivknhv .gt_font_italic {
  font-style: italic;
}

#mduhivknhv .gt_super {
  font-size: 65%;
}

#mduhivknhv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mduhivknhv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mduhivknhv .gt_indent_1 {
  text-indent: 5px;
}

#mduhivknhv .gt_indent_2 {
  text-indent: 10px;
}

#mduhivknhv .gt_indent_3 {
  text-indent: 15px;
}

#mduhivknhv .gt_indent_4 {
  text-indent: 20px;
}

#mduhivknhv .gt_indent_5 {
  text-indent: 25px;
}

#mduhivknhv .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mduhivknhv div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="unit" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unit</th>
<th id="trainees" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trainees</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="earnings" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">earnings</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="unit">1</td>
<td class="gt_row gt_right" headers="trainees">1</td>
<td class="gt_row gt_right" headers="age">28</td>
<td class="gt_row gt_right" headers="earnings">17700</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit">2</td>
<td class="gt_row gt_right gt_striped" headers="trainees">1</td>
<td class="gt_row gt_right gt_striped" headers="age">34</td>
<td class="gt_row gt_right gt_striped" headers="earnings">10200</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit">3</td>
<td class="gt_row gt_right" headers="trainees">1</td>
<td class="gt_row gt_right" headers="age">29</td>
<td class="gt_row gt_right" headers="earnings">14400</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit">4</td>
<td class="gt_row gt_right gt_striped" headers="trainees">1</td>
<td class="gt_row gt_right gt_striped" headers="age">25</td>
<td class="gt_row gt_right gt_striped" headers="earnings">20800</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit">5</td>
<td class="gt_row gt_right" headers="trainees">1</td>
<td class="gt_row gt_right" headers="age">29</td>
<td class="gt_row gt_right" headers="earnings">6100</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a>data_trainees <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trainees<span class="sc">==</span><span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="edgwgjaxri" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#edgwgjaxri table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#edgwgjaxri thead, #edgwgjaxri tbody, #edgwgjaxri tfoot, #edgwgjaxri tr, #edgwgjaxri td, #edgwgjaxri th {
  border-style: none;
}

#edgwgjaxri p {
  margin: 0;
  padding: 0;
}

#edgwgjaxri .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#edgwgjaxri .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#edgwgjaxri .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#edgwgjaxri .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#edgwgjaxri .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#edgwgjaxri .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#edgwgjaxri .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#edgwgjaxri .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#edgwgjaxri .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#edgwgjaxri .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#edgwgjaxri .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#edgwgjaxri .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#edgwgjaxri .gt_spanner_row {
  border-bottom-style: hidden;
}

#edgwgjaxri .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#edgwgjaxri .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#edgwgjaxri .gt_from_md > :first-child {
  margin-top: 0;
}

#edgwgjaxri .gt_from_md > :last-child {
  margin-bottom: 0;
}

#edgwgjaxri .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#edgwgjaxri .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#edgwgjaxri .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#edgwgjaxri .gt_row_group_first td {
  border-top-width: 2px;
}

#edgwgjaxri .gt_row_group_first th {
  border-top-width: 2px;
}

#edgwgjaxri .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#edgwgjaxri .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#edgwgjaxri .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#edgwgjaxri .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#edgwgjaxri .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#edgwgjaxri .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#edgwgjaxri .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#edgwgjaxri .gt_striped {
  background-color: #FAFAFA;
}

#edgwgjaxri .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#edgwgjaxri .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#edgwgjaxri .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#edgwgjaxri .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#edgwgjaxri .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#edgwgjaxri .gt_left {
  text-align: left;
}

#edgwgjaxri .gt_center {
  text-align: center;
}

#edgwgjaxri .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#edgwgjaxri .gt_font_normal {
  font-weight: normal;
}

#edgwgjaxri .gt_font_bold {
  font-weight: bold;
}

#edgwgjaxri .gt_font_italic {
  font-style: italic;
}

#edgwgjaxri .gt_super {
  font-size: 65%;
}

#edgwgjaxri .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#edgwgjaxri .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#edgwgjaxri .gt_indent_1 {
  text-indent: 5px;
}

#edgwgjaxri .gt_indent_2 {
  text-indent: 10px;
}

#edgwgjaxri .gt_indent_3 {
  text-indent: 15px;
}

#edgwgjaxri .gt_indent_4 {
  text-indent: 20px;
}

#edgwgjaxri .gt_indent_5 {
  text-indent: 25px;
}

#edgwgjaxri .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#edgwgjaxri div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="unit" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unit</th>
<th id="trainees" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trainees</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="earnings" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">earnings</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="unit">20</td>
<td class="gt_row gt_right" headers="trainees">0</td>
<td class="gt_row gt_right" headers="age">43</td>
<td class="gt_row gt_right" headers="earnings">20900</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit">21</td>
<td class="gt_row gt_right gt_striped" headers="trainees">0</td>
<td class="gt_row gt_right gt_striped" headers="age">50</td>
<td class="gt_row gt_right gt_striped" headers="earnings">31000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit">22</td>
<td class="gt_row gt_right" headers="trainees">0</td>
<td class="gt_row gt_right" headers="age">30</td>
<td class="gt_row gt_right" headers="earnings">21000</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit">23</td>
<td class="gt_row gt_right gt_striped" headers="trainees">0</td>
<td class="gt_row gt_right gt_striped" headers="age">27</td>
<td class="gt_row gt_right gt_striped" headers="earnings">9300</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit">24</td>
<td class="gt_row gt_right" headers="trainees">0</td>
<td class="gt_row gt_right" headers="age">54</td>
<td class="gt_row gt_right" headers="earnings">41100</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="matching-estimator-2" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>A simple comparison in means, identifies that the trainees earn less money than those that didn’t go through the program.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a>data_trainees <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(trainees) <span class="sc">|&gt;</span> </span>
<span id="cb33-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">mean_effect =</span> <span class="fu">mean</span>(earnings)) <span class="sc">|&gt;</span> </span>
<span id="cb33-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ATE =</span> mean_effect <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>( mean_effect) ) <span class="sc">|&gt;</span> </span>
<span id="cb33-5"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb33-6"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="hzjsgpcyxm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#hzjsgpcyxm table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hzjsgpcyxm thead, #hzjsgpcyxm tbody, #hzjsgpcyxm tfoot, #hzjsgpcyxm tr, #hzjsgpcyxm td, #hzjsgpcyxm th {
  border-style: none;
}

#hzjsgpcyxm p {
  margin: 0;
  padding: 0;
}

#hzjsgpcyxm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hzjsgpcyxm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hzjsgpcyxm .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hzjsgpcyxm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hzjsgpcyxm .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hzjsgpcyxm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzjsgpcyxm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hzjsgpcyxm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hzjsgpcyxm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hzjsgpcyxm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hzjsgpcyxm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hzjsgpcyxm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hzjsgpcyxm .gt_spanner_row {
  border-bottom-style: hidden;
}

#hzjsgpcyxm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hzjsgpcyxm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hzjsgpcyxm .gt_from_md > :first-child {
  margin-top: 0;
}

#hzjsgpcyxm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hzjsgpcyxm .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hzjsgpcyxm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjsgpcyxm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hzjsgpcyxm .gt_row_group_first td {
  border-top-width: 2px;
}

#hzjsgpcyxm .gt_row_group_first th {
  border-top-width: 2px;
}

#hzjsgpcyxm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjsgpcyxm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hzjsgpcyxm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hzjsgpcyxm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzjsgpcyxm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjsgpcyxm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hzjsgpcyxm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hzjsgpcyxm .gt_striped {
  background-color: #FAFAFA;
}

#hzjsgpcyxm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzjsgpcyxm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hzjsgpcyxm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjsgpcyxm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hzjsgpcyxm .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjsgpcyxm .gt_left {
  text-align: left;
}

#hzjsgpcyxm .gt_center {
  text-align: center;
}

#hzjsgpcyxm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hzjsgpcyxm .gt_font_normal {
  font-weight: normal;
}

#hzjsgpcyxm .gt_font_bold {
  font-weight: bold;
}

#hzjsgpcyxm .gt_font_italic {
  font-style: italic;
}

#hzjsgpcyxm .gt_super {
  font-size: 65%;
}

#hzjsgpcyxm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hzjsgpcyxm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hzjsgpcyxm .gt_indent_1 {
  text-indent: 5px;
}

#hzjsgpcyxm .gt_indent_2 {
  text-indent: 10px;
}

#hzjsgpcyxm .gt_indent_3 {
  text-indent: 15px;
}

#hzjsgpcyxm .gt_indent_4 {
  text-indent: 20px;
}

#hzjsgpcyxm .gt_indent_5 {
  text-indent: 25px;
}

#hzjsgpcyxm .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hzjsgpcyxm div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="trainees" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trainees</th>
<th id="mean_effect" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean_effect</th>
<th id="ATE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ATE</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="trainees">0</td>
<td class="gt_row gt_right" headers="mean_effect">20724</td>
<td class="gt_row gt_right" headers="ATE">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="trainees">1</td>
<td class="gt_row gt_right gt_striped" headers="mean_effect">16426</td>
<td class="gt_row gt_right gt_striped" headers="ATE">-4297</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div style="font-size: x-large">
<p>However, if we look at the data tables, we notice that trainees are much younger than non trainees, which indicates that age is probably a confounder.</p>
</div>
</section>
<section id="matching-estimator-3" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>We can use matching on age to try to correct that.</p>
<p>We will take unit 1 from the treated and pair it with unit 27, since both are 28 years old. Unit 2 we will pair it with unit 34, unit 3 with unit 37, unit 4 we will pair it with unit 35… When it comes to unit 5, we need to find someone with age 29 from the non treated, but that is unit 37, which is already paired.</p>
<p>This is not a problem, since we can use the same unit multiple times. If more than 1 unit is a match, we can choose randomly between them.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>unique_on_age <span class="ot">&lt;-</span> data_trainees <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trainees <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(age, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-4"><a></a></span>
<span id="cb34-5"><a></a>matches <span class="ot">&lt;-</span> data_trainees <span class="sc">|&gt;</span> </span>
<span id="cb34-6"><a></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(trainees <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-7"><a></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(unique_on_age, <span class="at">by =</span> <span class="st">'age'</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_t_1"</span>, <span class="st">"_t_0"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb34-8"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">t1_minus_t0 =</span> earnings_t_1 <span class="sc">-</span> earnings_t_0) </span>
<span id="cb34-9"><a></a></span>
<span id="cb34-10"><a></a>matches <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-11"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-12"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="dicxhclvix" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#dicxhclvix table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dicxhclvix thead, #dicxhclvix tbody, #dicxhclvix tfoot, #dicxhclvix tr, #dicxhclvix td, #dicxhclvix th {
  border-style: none;
}

#dicxhclvix p {
  margin: 0;
  padding: 0;
}

#dicxhclvix .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dicxhclvix .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dicxhclvix .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dicxhclvix .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dicxhclvix .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dicxhclvix .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dicxhclvix .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dicxhclvix .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dicxhclvix .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dicxhclvix .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dicxhclvix .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dicxhclvix .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dicxhclvix .gt_spanner_row {
  border-bottom-style: hidden;
}

#dicxhclvix .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dicxhclvix .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dicxhclvix .gt_from_md > :first-child {
  margin-top: 0;
}

#dicxhclvix .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dicxhclvix .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dicxhclvix .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dicxhclvix .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dicxhclvix .gt_row_group_first td {
  border-top-width: 2px;
}

#dicxhclvix .gt_row_group_first th {
  border-top-width: 2px;
}

#dicxhclvix .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dicxhclvix .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dicxhclvix .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dicxhclvix .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dicxhclvix .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dicxhclvix .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dicxhclvix .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dicxhclvix .gt_striped {
  background-color: #FAFAFA;
}

#dicxhclvix .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dicxhclvix .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dicxhclvix .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dicxhclvix .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dicxhclvix .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dicxhclvix .gt_left {
  text-align: left;
}

#dicxhclvix .gt_center {
  text-align: center;
}

#dicxhclvix .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dicxhclvix .gt_font_normal {
  font-weight: normal;
}

#dicxhclvix .gt_font_bold {
  font-weight: bold;
}

#dicxhclvix .gt_font_italic {
  font-style: italic;
}

#dicxhclvix .gt_super {
  font-size: 65%;
}

#dicxhclvix .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dicxhclvix .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dicxhclvix .gt_indent_1 {
  text-indent: 5px;
}

#dicxhclvix .gt_indent_2 {
  text-indent: 10px;
}

#dicxhclvix .gt_indent_3 {
  text-indent: 15px;
}

#dicxhclvix .gt_indent_4 {
  text-indent: 20px;
}

#dicxhclvix .gt_indent_5 {
  text-indent: 25px;
}

#dicxhclvix .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#dicxhclvix div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="unit_t_1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unit_t_1</th>
<th id="trainees_t_1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trainees_t_1</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="earnings_t_1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">earnings_t_1</th>
<th id="unit_t_0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">unit_t_0</th>
<th id="trainees_t_0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">trainees_t_0</th>
<th id="earnings_t_0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">earnings_t_0</th>
<th id="t1_minus_t0" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">t1_minus_t0</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="unit_t_1">1</td>
<td class="gt_row gt_right" headers="trainees_t_1">1</td>
<td class="gt_row gt_right" headers="age">28</td>
<td class="gt_row gt_right" headers="earnings_t_1">17700</td>
<td class="gt_row gt_right" headers="unit_t_0">27</td>
<td class="gt_row gt_right" headers="trainees_t_0">0</td>
<td class="gt_row gt_right" headers="earnings_t_0">8800</td>
<td class="gt_row gt_right" headers="t1_minus_t0">8900</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit_t_1">2</td>
<td class="gt_row gt_right gt_striped" headers="trainees_t_1">1</td>
<td class="gt_row gt_right gt_striped" headers="age">34</td>
<td class="gt_row gt_right gt_striped" headers="earnings_t_1">10200</td>
<td class="gt_row gt_right gt_striped" headers="unit_t_0">34</td>
<td class="gt_row gt_right gt_striped" headers="trainees_t_0">0</td>
<td class="gt_row gt_right gt_striped" headers="earnings_t_0">24200</td>
<td class="gt_row gt_right gt_striped" headers="t1_minus_t0">-14000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit_t_1">3</td>
<td class="gt_row gt_right" headers="trainees_t_1">1</td>
<td class="gt_row gt_right" headers="age">29</td>
<td class="gt_row gt_right" headers="earnings_t_1">14400</td>
<td class="gt_row gt_right" headers="unit_t_0">37</td>
<td class="gt_row gt_right" headers="trainees_t_0">0</td>
<td class="gt_row gt_right" headers="earnings_t_0">6200</td>
<td class="gt_row gt_right" headers="t1_minus_t0">8200</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="unit_t_1">4</td>
<td class="gt_row gt_right gt_striped" headers="trainees_t_1">1</td>
<td class="gt_row gt_right gt_striped" headers="age">25</td>
<td class="gt_row gt_right gt_striped" headers="earnings_t_1">20800</td>
<td class="gt_row gt_right gt_striped" headers="unit_t_0">35</td>
<td class="gt_row gt_right gt_striped" headers="trainees_t_0">0</td>
<td class="gt_row gt_right gt_striped" headers="earnings_t_0">23300</td>
<td class="gt_row gt_right gt_striped" headers="t1_minus_t0">-2500</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="unit_t_1">5</td>
<td class="gt_row gt_right" headers="trainees_t_1">1</td>
<td class="gt_row gt_right" headers="age">29</td>
<td class="gt_row gt_right" headers="earnings_t_1">6100</td>
<td class="gt_row gt_right" headers="unit_t_0">37</td>
<td class="gt_row gt_right" headers="trainees_t_0">0</td>
<td class="gt_row gt_right" headers="earnings_t_0">6200</td>
<td class="gt_row gt_right" headers="t1_minus_t0">-100</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="matching-estimator-4" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>If we take the mean of this last column we get the ATET estimate while controlling for age. Notice how the estimate is now very positive, compared to the previous one where we used a simple difference in means.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>matches <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">ATE =</span> <span class="fu">mean</span>(t1_minus_t0)) <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="ctpbxfhgco" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#ctpbxfhgco table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ctpbxfhgco thead, #ctpbxfhgco tbody, #ctpbxfhgco tfoot, #ctpbxfhgco tr, #ctpbxfhgco td, #ctpbxfhgco th {
  border-style: none;
}

#ctpbxfhgco p {
  margin: 0;
  padding: 0;
}

#ctpbxfhgco .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ctpbxfhgco .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ctpbxfhgco .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ctpbxfhgco .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ctpbxfhgco .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ctpbxfhgco .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ctpbxfhgco .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ctpbxfhgco .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ctpbxfhgco .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ctpbxfhgco .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ctpbxfhgco .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ctpbxfhgco .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ctpbxfhgco .gt_spanner_row {
  border-bottom-style: hidden;
}

#ctpbxfhgco .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ctpbxfhgco .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ctpbxfhgco .gt_from_md > :first-child {
  margin-top: 0;
}

#ctpbxfhgco .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ctpbxfhgco .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ctpbxfhgco .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ctpbxfhgco .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ctpbxfhgco .gt_row_group_first td {
  border-top-width: 2px;
}

#ctpbxfhgco .gt_row_group_first th {
  border-top-width: 2px;
}

#ctpbxfhgco .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctpbxfhgco .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ctpbxfhgco .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ctpbxfhgco .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ctpbxfhgco .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctpbxfhgco .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ctpbxfhgco .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ctpbxfhgco .gt_striped {
  background-color: #FAFAFA;
}

#ctpbxfhgco .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ctpbxfhgco .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ctpbxfhgco .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctpbxfhgco .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ctpbxfhgco .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctpbxfhgco .gt_left {
  text-align: left;
}

#ctpbxfhgco .gt_center {
  text-align: center;
}

#ctpbxfhgco .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ctpbxfhgco .gt_font_normal {
  font-weight: normal;
}

#ctpbxfhgco .gt_font_bold {
  font-weight: bold;
}

#ctpbxfhgco .gt_font_italic {
  font-style: italic;
}

#ctpbxfhgco .gt_super {
  font-size: 65%;
}

#ctpbxfhgco .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ctpbxfhgco .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ctpbxfhgco .gt_indent_1 {
  text-indent: 5px;
}

#ctpbxfhgco .gt_indent_2 {
  text-indent: 10px;
}

#ctpbxfhgco .gt_indent_3 {
  text-indent: 15px;
}

#ctpbxfhgco .gt_indent_4 {
  text-indent: 20px;
}

#ctpbxfhgco .gt_indent_5 {
  text-indent: 25px;
}

#ctpbxfhgco .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ctpbxfhgco div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="ATE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ATE</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="ATE">2458</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div style="font-size: x-large">
<p>This is a contrived example, just to introduce matching.</p>
</div>
</section>
<section id="matching-estimator-5" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>In practice, we usually have more than one feature and units don’t match perfectly. In this case, we have to define some measurement of proximity to compare how units are close to each other.</p>
<p>One common metric for this is the euclidean norm <span class="math inline">\(||X_i - X_j||\)</span>. This difference, however, is not invariant to the scale of the features.</p>
<p>This means that features like age, that take values on the tenths, will be much less important when computing this norm compared to features like income, which take the order of hundreds.</p>
<p>For this reason, before applying the norm, we need to scale the features so that they are on roughly the same scale.</p>
</div>
</section>
<section id="matching-estimator-6" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>Having defined a distance measure, we can now define the match as the nearest neighbour to that sample we wish to match.</p>
<p>We can write the matching estimator the following way:</p>
</div>
<p><span class="math display">\[
\hat{ATE} = \frac{1}{N} \sum^N_{i=1} (2D_i - 1)\big(Y_i - Y_{jm}(i)\big)
\]</span></p>
<div style="font-size: x-large">
<p>Where <span class="math inline">\(Y_{jm}(i)\)</span> is the sample from the other treatment group which is most similar to <span class="math inline">\(Y_i\)</span>.</p>
<p>We scale by <span class="math inline">\(2D_i - 1\)</span> to match both ways: treated with controls and controls with the treatment.</p>
</div>
</section>
<section id="matching-estimator-7" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>To test this estimator, let’s consider a medicine example.</p>
<p>Once again, we want to find the effect of a medication on days until recovery.</p>
<p>Unfortunately, this effect is confounded by severity, sex and age. We have reasons to believe that patients with more severe conditions have a higher chance of receiving the medicine.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a>data_med <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/medicine_impact_recovery.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-2"><a></a></span>
<span id="cb36-3"><a></a>data_med <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-5"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb36-6"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>() <span class="sc">|&gt;</span> </span>
<span id="cb36-7"><a></a>  gt<span class="sc">::</span><span class="fu">as_raw_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="pvpgmxiuch" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
  
  
<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 3px; border-top-color: #FFFFFF; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="gt_col_headings header" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="sex" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">sex</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">age</th>
<th id="severity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">severity</th>
<th id="medication" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">medication</th>
<th id="recovery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">recovery</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0</td>
<td class="gt_row gt_right" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">35.05</td>
<td class="gt_row gt_right" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.8877</td>
<td class="gt_row gt_right" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1</td>
<td class="gt_row gt_right" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">31</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_right gt_striped" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1</td>
<td class="gt_row gt_right gt_striped" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">41.58</td>
<td class="gt_row gt_right gt_striped" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0.8998</td>
<td class="gt_row gt_right gt_striped" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">49</td>
</tr>
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1</td>
<td class="gt_row gt_right" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">28.13</td>
<td class="gt_row gt_right" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.4863</td>
<td class="gt_row gt_right" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0</td>
<td class="gt_row gt_right" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">38</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_right gt_striped" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1</td>
<td class="gt_row gt_right gt_striped" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">36.38</td>
<td class="gt_row gt_right gt_striped" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0.3231</td>
<td class="gt_row gt_right gt_striped" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0</td>
<td class="gt_row gt_right gt_striped" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">35</td>
</tr>
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0</td>
<td class="gt_row gt_right" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">25.09</td>
<td class="gt_row gt_right" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.2090</td>
<td class="gt_row gt_right" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0</td>
<td class="gt_row gt_right" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-8" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>If we look at a simple difference in means, <span class="math inline">\(E[Y|D=1]-E[Y|D=0]\)</span>, we get that the treated take, on average, 16.9 more days to recover than the untreated.</p>
<p>This is probably due to confounding, since we don’t expect the medicine to cause harm to the patient.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a>data_med <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(medication) <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">mean_effect =</span> <span class="fu">mean</span>(recovery)) <span class="sc">|&gt;</span> </span>
<span id="cb37-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ATE =</span> mean_effect <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>( mean_effect) ) <span class="sc">|&gt;</span> </span>
<span id="cb37-5"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb37-6"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>() <span class="sc">|&gt;</span> </span>
<span id="cb37-7"><a></a>  gt<span class="sc">::</span><span class="fu">as_raw_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="lstobdjlbd" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
  
  
<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 3px; border-top-color: #FFFFFF; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="gt_col_headings header" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="medication" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">medication</th>
<th id="mean_effect" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">mean_effect</th>
<th id="ATE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">ATE</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0</td>
<td class="gt_row gt_right" headers="mean_effect" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">21.68</td>
<td class="gt_row gt_right" headers="ATE" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">NA</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_right gt_striped" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1</td>
<td class="gt_row gt_right gt_striped" headers="mean_effect" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">38.57</td>
<td class="gt_row gt_right gt_striped" headers="ATE" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">16.9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-9" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>To correct for this bias, we will control for X using matching.</p>
<p>First, we need to remember to scale our features, otherwise, features like age will have higher importance than features like severity when we compute the distance between points.</p>
<p>To do so, we can standardise the features.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a>data_med <span class="ot">&lt;-</span> data_med <span class="sc">|&gt;</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(recovery <span class="sc">~</span> .) <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a></a>  recipes<span class="sc">::</span><span class="fu">update_role</span>(medication, <span class="at">new_role =</span> <span class="st">'treatment'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(recipes<span class="sc">::</span><span class="fu">all_predictors</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb38-4"><a></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-5"><a></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data=</span><span class="cn">NULL</span>)</span>
<span id="cb38-6"><a></a></span>
<span id="cb38-7"><a></a>data_med <span class="sc">|&gt;</span>   </span>
<span id="cb38-8"><a></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-9"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-10"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-11"><a></a>  gt<span class="sc">::</span><span class="fu">as_raw_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="ghjtqmoerj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
  
  
<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 3px; border-top-color: #FFFFFF; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="gt_col_headings header" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="sex" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">sex</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">age</th>
<th id="severity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">severity</th>
<th id="medication" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">medication</th>
<th id="recovery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">recovery</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">-0.997</td>
<td class="gt_row gt_right" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.2808</td>
<td class="gt_row gt_right" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1.4598</td>
<td class="gt_row gt_right" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1</td>
<td class="gt_row gt_right" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">31</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_right gt_striped" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1.003</td>
<td class="gt_row gt_right gt_striped" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0.8654</td>
<td class="gt_row gt_right gt_striped" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1.5022</td>
<td class="gt_row gt_right gt_striped" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">49</td>
</tr>
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1.003</td>
<td class="gt_row gt_right" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">-0.3387</td>
<td class="gt_row gt_right" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.0578</td>
<td class="gt_row gt_right" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0</td>
<td class="gt_row gt_right" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">38</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_right gt_striped" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1.003</td>
<td class="gt_row gt_right gt_striped" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0.3995</td>
<td class="gt_row gt_right gt_striped" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">-0.5126</td>
<td class="gt_row gt_right gt_striped" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0</td>
<td class="gt_row gt_right gt_striped" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">35</td>
</tr>
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">-0.997</td>
<td class="gt_row gt_right" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">-0.6105</td>
<td class="gt_row gt_right" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">-0.9111</td>
<td class="gt_row gt_right" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0</td>
<td class="gt_row gt_right" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-10" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>Instead of coding a matching function, we will use the K nearest neighbour algorithm from <code>caret::knnreg</code>.</p>
<p>This algorithm makes predictions by finding the nearest data point in an estimation or training set.</p>
<p>For matching, we will need 2 of those. One, <span class="math inline">\(mt_0\)</span>, will store the untreated points and will find matches in the untreated when asked to do so.</p>
<p>The other, <span class="math inline">\(mt_1\)</span>, will store the treated point and will find matches in the treated when asked to do so. After this fitting step, we can use these KNN models to make predictions, which will be our matches.</p>
</div>
</section>
<section id="matching-estimator-11" class="slide level2">
<h2>Matching estimator</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a>treated   <span class="ot">&lt;-</span> data_med <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(medication<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb39-2"><a></a>untreated <span class="ot">&lt;-</span> data_med <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(medication<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb39-3"><a></a></span>
<span id="cb39-4"><a></a>mt0 <span class="ot">&lt;-</span> <span class="co"># untreated knn model predicting recovery</span></span>
<span id="cb39-5"><a></a>  caret<span class="sc">::</span><span class="fu">knnreg</span>(<span class="at">x =</span> untreated <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(sex,age,severity), <span class="at">y =</span> untreated<span class="sc">$</span>recovery, <span class="at">k=</span><span class="dv">1</span>)</span>
<span id="cb39-6"><a></a>mt1 <span class="ot">&lt;-</span> <span class="co"># treated knn model predicting recovery</span></span>
<span id="cb39-7"><a></a>  caret<span class="sc">::</span><span class="fu">knnreg</span>(<span class="at">x =</span> treated <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(sex,age,severity), <span class="at">y =</span> treated<span class="sc">$</span>recovery, <span class="at">k=</span><span class="dv">1</span>)</span>
<span id="cb39-8"><a></a></span>
<span id="cb39-9"><a></a>predicted <span class="ot">&lt;-</span></span>
<span id="cb39-10"><a></a>  <span class="co"># combine the treated and untreated matches</span></span>
<span id="cb39-11"><a></a>  <span class="fu">c</span>(</span>
<span id="cb39-12"><a></a>    <span class="co"># find matches for the treated looking at the untreated knn model</span></span>
<span id="cb39-13"><a></a>    treated <span class="sc">|&gt;</span></span>
<span id="cb39-14"><a></a>      tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(<span class="st">"ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-15"><a></a>      {\(y)<span class="fu">split</span>(y,y<span class="sc">$</span>ID)}() <span class="sc">|&gt;</span> <span class="co"># hack for native pipe </span></span>
<span id="cb39-16"><a></a>      <span class="co"># split(.$ID) |&gt;         # this vesion works with magrittr</span></span>
<span id="cb39-17"><a></a>      purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb39-18"><a></a>        (\(x){</span>
<span id="cb39-19"><a></a>          x <span class="sc">|&gt;</span> </span>
<span id="cb39-20"><a></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb39-21"><a></a>              <span class="at">match =</span> <span class="fu">predict</span>( mt0, x[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>)] )</span>
<span id="cb39-22"><a></a>            )</span>
<span id="cb39-23"><a></a>        })</span>
<span id="cb39-24"><a></a>      )</span>
<span id="cb39-25"><a></a>    <span class="co"># find matches for the untreated looking at the treated knn model</span></span>
<span id="cb39-26"><a></a>    , untreated <span class="sc">|&gt;</span></span>
<span id="cb39-27"><a></a>        tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(<span class="st">"ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-28"><a></a>        {\(y)<span class="fu">split</span>(y,y<span class="sc">$</span>ID)}() <span class="sc">|&gt;</span> </span>
<span id="cb39-29"><a></a>        <span class="co"># split(.$ID) |&gt; </span></span>
<span id="cb39-30"><a></a>        purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb39-31"><a></a>          (\(x){</span>
<span id="cb39-32"><a></a>            x <span class="sc">|&gt;</span> </span>
<span id="cb39-33"><a></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb39-34"><a></a>                <span class="at">match =</span> <span class="fu">predict</span>( mt1, x[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>)] )</span>
<span id="cb39-35"><a></a>              )</span>
<span id="cb39-36"><a></a>          })</span>
<span id="cb39-37"><a></a>        )</span>
<span id="cb39-38"><a></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb39-39"><a></a>  <span class="co"># bind the treated and untreated data </span></span>
<span id="cb39-40"><a></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb39-41"><a></a></span>
<span id="cb39-42"><a></a>predicted <span class="sc">|&gt;</span>   </span>
<span id="cb39-43"><a></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-44"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb39-45"><a></a>  gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>), <span class="at">decimals =</span> <span class="dv">6</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-46"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>() <span class="sc">|&gt;</span> </span>
<span id="cb39-47"><a></a>  gt<span class="sc">::</span><span class="fu">as_raw_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="gubvmaftha" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
  
  
<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 3px; border-top-color: #FFFFFF; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="gt_col_headings header" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="ID" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">ID</th>
<th id="sex" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">sex</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">age</th>
<th id="severity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">severity</th>
<th id="medication" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">medication</th>
<th id="recovery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">recovery</th>
<th id="match" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">match</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="ID" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1</td>
<td class="gt_row gt_right" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−0.996980</td>
<td class="gt_row gt_right" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.280787</td>
<td class="gt_row gt_right" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1.459800</td>
<td class="gt_row gt_right" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1</td>
<td class="gt_row gt_right" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">31</td>
<td class="gt_row gt_right" headers="match" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">39</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_right gt_striped" headers="ID" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">2</td>
<td class="gt_row gt_right gt_striped" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1.002979</td>
<td class="gt_row gt_right gt_striped" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0.865375</td>
<td class="gt_row gt_right gt_striped" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1.502164</td>
<td class="gt_row gt_right gt_striped" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">49</td>
<td class="gt_row gt_right gt_striped" headers="match" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">52</td>
</tr>
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="ID" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">3</td>
<td class="gt_row gt_right" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−0.996980</td>
<td class="gt_row gt_right" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1.495134</td>
<td class="gt_row gt_right" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1.268540</td>
<td class="gt_row gt_right" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1</td>
<td class="gt_row gt_right" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">38</td>
<td class="gt_row gt_right" headers="match" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">46</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_right gt_striped" headers="ID" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">4</td>
<td class="gt_row gt_right gt_striped" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1.002979</td>
<td class="gt_row gt_right gt_striped" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">−0.106534</td>
<td class="gt_row gt_right gt_striped" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0.545911</td>
<td class="gt_row gt_right gt_striped" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">34</td>
<td class="gt_row gt_right gt_striped" headers="match" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">45</td>
</tr>
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="ID" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">5</td>
<td class="gt_row gt_right" headers="sex" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−0.996980</td>
<td class="gt_row gt_right" headers="age" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.043034</td>
<td class="gt_row gt_right" headers="severity" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1.428732</td>
<td class="gt_row gt_right" headers="medication" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1</td>
<td class="gt_row gt_right" headers="recovery" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">30</td>
<td class="gt_row gt_right" headers="match" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">39</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-estimator-12" class="slide level2">
<h2>Matching estimator</h2>
<div style="font-size: x-large">
<p>With the matches, we can now apply the matching estimator formula</p>
</div>
<p><span class="math display">\[
\hat{ATE} = \frac{1}{N} \sum^N_{i=1} (2D_i - 1)\big(Y_i - Y_{jm}(i)\big)
\]</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a>predicted <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb40-3"><a></a>    <span class="st">"ATE (est)"</span> <span class="ot">=</span> <span class="fu">mean</span>( (<span class="dv">2</span><span class="sc">*</span>medication <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (recovery <span class="sc">-</span> match) )</span>
<span id="cb40-4"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb40-5"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-6"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-7"><a></a>  gt<span class="sc">::</span><span class="fu">as_raw_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="hxdcaqcbfy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
  
  
<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 3px; border-top-color: #FFFFFF; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="gt_col_headings header" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="ATE (est)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">ATE (est)</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="ATE (est)" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">-0.9954</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div style="font-size: x-large">
<p>Using this sort of matching, we can see that the effect of the medicine is not positive anymore.</p>
<p>This means that, controlling for <span class="math inline">\(X\)</span>, the medicine reduces the recovery time by about 1 day, on average.</p>
<p>This is already a huge improvement on top of the biased estimate that predicted a 16.9 increase in recovery time.</p>
</div>
</section>
<section id="matching-bias" class="slide level2">
<h2>Matching bias</h2>
<div style="font-size: x-large">
<p>It turns out the matching estimator as we’ve designed above is biased.</p>
<p>To see this, let’s consider the ATET estimator, instead of the ATE, just because it is simpler to write.</p>
<p>The intuition will apply to the ATE as well.</p>
</div>
<p><span class="math display">\[
\hat{ATET} = \frac{1}{N_1}\sum (Y_i - Y_j(i))
\]</span></p>
<div style="font-size: x-large">
<p>where <span class="math inline">\(N_1\)</span> is the number of treated individuals and <span class="math inline">\(Y_j(i)\)</span> is the untreated match of treated unit i.</p>
</div>
</section>
<section id="matching-bias-1" class="slide level2">
<h2>Matching bias</h2>
<div style="font-size: x-large">
<p>To check for bias, what we do is hope we can apply the Central Limit Theorem so that this estimate converges to a normal distribution with mean zero.</p>
</div>
<p><span class="math display">\[
\sqrt{N_1}(\hat{ATET} - ATET)
\]</span></p>
<div style="font-size: x-large">
<p>However, this doesn’t alway happen. If we define the mean outcome for the untreated given X, <span class="math inline">\(\mu_0(x)=E[Y|X=x, D=0]\)</span>, we will have that</p>
</div>
<p><span class="math display">\[
\begin{align*}
\mathbb{E}\left [\sqrt{N_1}(\hat{ATET} - ATET)\right] &amp; = \\
\mathbb{E}\left[\sqrt{N_1}(\mu_0(X_i) - \mu_0(X_j(i))\right]
\end{align*}
\]</span></p>
</section>
<section id="matching-bias-2" class="slide level2">
<h2>Matching bias</h2>
<div style="font-size: x-large">
<p>Now, <span class="math inline">\(\mu_0(X_i) - \mu_0(X_j(i))\)</span> is not so simple to understand, so let’s look at it more carefully.</p>
<ul>
<li><span class="math inline">\(\mu_0(X_i)\)</span> is the outcome Y value of a treated unit <span class="math inline">\(i\)</span> had it not been treated. It is the counterfactual outcome <span class="math inline">\(Y^0\)</span> for unit <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\mu_0(X_j(i))\)</span> is the outcome of the untreated unit <span class="math inline">\(j\)</span> that is the match of unit <span class="math inline">\(i\)</span>.</li>
<li>It is also the <span class="math inline">\(Y^0\)</span>, but for unit <span class="math inline">\(j\)</span> now.</li>
<li>Only this time, it is a factual outcome, because <span class="math inline">\(j\)</span> is in the non treated group.</li>
<li>Now, because <span class="math inline">\(j\)</span> and <span class="math inline">\(i\)</span> are only similar, but not the same, this will likely not be zero. In other words, <span class="math inline">\(X_i \approx X_j\)</span>, so, <span class="math inline">\(Y^0_i \approx Y^0_j\)</span>.</li>
</ul>
</div>
</section>
<section id="matching-bias-3" class="slide level2">
<h2>Matching bias</h2>
<div style="font-size: x-large">
<p>As we increase the sample size, there will be more units to match, so the difference between unit <span class="math inline">\(i\)</span> and its match <span class="math inline">\(j\)</span> will also get smaller.</p>
<p>But this difference converges to zero slowly.</p>
<p>As a result <span class="math inline">\(E[\sqrt{N_1}(\mu_0(X_i) - \mu_0(X_j(i)))]\)</span> may not converge to zero, because the <span class="math inline">\(\sqrt{N_1}\)</span> grows faster than <span class="math inline">\((\mu_0(X_i) - \mu_0(X_j(i)))\)</span> diminishes.</p>
</div>
</section>
<section id="matching-bias-4" class="slide level2">
<h2>Matching bias</h2>
<div style="font-size: x-large">
<p>Bias arises when the matching discrepancies are huge. Fortunately, we know how to correct it. Each observation contributes <span class="math inline">\((\mu_0(X_i) - \mu_0(X_j(i))\)</span> to the bias so all we need to do is subtract this quantity from each matching comparison in our estimator.</p>
<p>To do so, we can replace <span class="math inline">\(\mu_0(X_j(i))\)</span> with some sort of estimate of this quantity <span class="math inline">\(\hat{\mu}_0(X_j(i))\)</span>, which can be obtained with models like linear regression. This updates the ATET estimator to the following equation:</p>
</div>
<p><span class="math display">\[
\hat{ATET} = \frac{1}{N_1}\sum \big((Y_i - Y_{j(i)}) - (\hat{\mu_0}(X_i) - \hat{\mu_0}(X_{j(i)})\big)
\]</span></p>
<div style="font-size: x-large">
<p>where <span class="math inline">\(\hat{\mu_0}(x)\)</span> is some estimative of <span class="math inline">\(E[Y|X, D=0]\)</span>, like a linear regression fitted only on the untreated sample.</p>
</div>
</section>
<section id="matching-bias-5" class="slide level2">
<h2>Matching bias</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a>ols0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(recovery <span class="sc">~</span> sex <span class="sc">+</span> age <span class="sc">+</span> severity, <span class="at">data =</span> untreated) </span>
<span id="cb41-2"><a></a>ols1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(recovery <span class="sc">~</span> sex <span class="sc">+</span> age <span class="sc">+</span> severity, <span class="at">data =</span> treated) </span>
<span id="cb41-3"><a></a></span>
<span id="cb41-4"><a></a><span class="co"># find the units that match to the treated</span></span>
<span id="cb41-5"><a></a>treated_match_index <span class="ot">&lt;-</span> <span class="co"># RANN::nn2 does Nearest Neighbour Search</span></span>
<span id="cb41-6"><a></a>  (RANN<span class="sc">::</span><span class="fu">nn2</span>(mt0<span class="sc">$</span>learn<span class="sc">$</span>X, treated <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(sex,age,severity), <span class="at">k=</span><span class="dv">1</span>))<span class="sc">$</span>nn.idx <span class="sc">|&gt;</span> </span>
<span id="cb41-7"><a></a>  <span class="fu">as.vector</span>()</span>
<span id="cb41-8"><a></a></span>
<span id="cb41-9"><a></a><span class="co"># find the units that match to the untreated</span></span>
<span id="cb41-10"><a></a>untreated_match_index <span class="ot">&lt;-</span> <span class="co"># RANN::nn2 does Nearest Neighbour Search</span></span>
<span id="cb41-11"><a></a>  (RANN<span class="sc">::</span><span class="fu">nn2</span>(mt1<span class="sc">$</span>learn<span class="sc">$</span>X, untreated <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(sex,age,severity), <span class="at">k=</span><span class="dv">1</span>))<span class="sc">$</span>nn.idx <span class="sc">|&gt;</span> </span>
<span id="cb41-12"><a></a>  <span class="fu">as.vector</span>()</span>
<span id="cb41-13"><a></a></span>
<span id="cb41-14"><a></a>predicted <span class="ot">&lt;-</span> </span>
<span id="cb41-15"><a></a><span class="fu">c</span>(</span>
<span id="cb41-16"><a></a>  purrr<span class="sc">::</span><span class="fu">map2</span>(</span>
<span id="cb41-17"><a></a>    <span class="at">.x =</span> </span>
<span id="cb41-18"><a></a>      treated <span class="sc">|&gt;</span> tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(<span class="st">"ID"</span>) <span class="sc">|&gt;</span> {\(y)<span class="fu">split</span>(y,y<span class="sc">$</span>ID)}() <span class="co"># split(.$ID) </span></span>
<span id="cb41-19"><a></a>    , <span class="at">.y =</span> treated_match_index</span>
<span id="cb41-20"><a></a>    , <span class="at">.f =</span> (\(x,y){</span>
<span id="cb41-21"><a></a>          x <span class="sc">|&gt;</span> </span>
<span id="cb41-22"><a></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb41-23"><a></a>              <span class="at">match =</span> <span class="fu">predict</span>( mt0, x[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>)] )</span>
<span id="cb41-24"><a></a>              , <span class="at">bias_correct =</span></span>
<span id="cb41-25"><a></a>                  <span class="fu">predict</span>( ols0, x[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>)] ) <span class="sc">-</span></span>
<span id="cb41-26"><a></a>                  <span class="fu">predict</span>( ols0, untreated[y,<span class="fu">c</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>)] )</span>
<span id="cb41-27"><a></a>            )</span>
<span id="cb41-28"><a></a>        })</span>
<span id="cb41-29"><a></a>  )</span>
<span id="cb41-30"><a></a>  , purrr<span class="sc">::</span><span class="fu">map2</span>(</span>
<span id="cb41-31"><a></a>    <span class="at">.x =</span> </span>
<span id="cb41-32"><a></a>      untreated <span class="sc">|&gt;</span> tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(<span class="st">"ID"</span>) <span class="sc">|&gt;</span> {\(y)<span class="fu">split</span>(y,y<span class="sc">$</span>ID)}() <span class="co"># split(.$ID) </span></span>
<span id="cb41-33"><a></a>    , <span class="at">.y =</span> untreated_match_index</span>
<span id="cb41-34"><a></a>    , <span class="at">.f =</span> (\(x,y){</span>
<span id="cb41-35"><a></a>          x <span class="sc">|&gt;</span> </span>
<span id="cb41-36"><a></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb41-37"><a></a>              <span class="at">match =</span> <span class="fu">predict</span>( mt1, x[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>)] )</span>
<span id="cb41-38"><a></a>              , <span class="at">bias_correct =</span></span>
<span id="cb41-39"><a></a>                  <span class="fu">predict</span>( ols1, x[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>)] ) <span class="sc">-</span></span>
<span id="cb41-40"><a></a>                  <span class="fu">predict</span>( ols1, treated[y,<span class="fu">c</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>)] )</span>
<span id="cb41-41"><a></a>            )</span>
<span id="cb41-42"><a></a>        })</span>
<span id="cb41-43"><a></a>  )</span>
<span id="cb41-44"><a></a>) <span class="sc">|&gt;</span> </span>
<span id="cb41-45"><a></a>  <span class="co"># bind the treated and untreated data </span></span>
<span id="cb41-46"><a></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb41-47"><a></a></span>
<span id="cb41-48"><a></a>predicted <span class="sc">|&gt;</span>   </span>
<span id="cb41-49"><a></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb41-50"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb41-51"><a></a>  gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>), <span class="at">decimals =</span> <span class="dv">6</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-52"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="hszyereimh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#hszyereimh table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hszyereimh thead, #hszyereimh tbody, #hszyereimh tfoot, #hszyereimh tr, #hszyereimh td, #hszyereimh th {
  border-style: none;
}

#hszyereimh p {
  margin: 0;
  padding: 0;
}

#hszyereimh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hszyereimh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hszyereimh .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hszyereimh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hszyereimh .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hszyereimh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hszyereimh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hszyereimh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hszyereimh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hszyereimh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hszyereimh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hszyereimh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hszyereimh .gt_spanner_row {
  border-bottom-style: hidden;
}

#hszyereimh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hszyereimh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hszyereimh .gt_from_md > :first-child {
  margin-top: 0;
}

#hszyereimh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hszyereimh .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hszyereimh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hszyereimh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hszyereimh .gt_row_group_first td {
  border-top-width: 2px;
}

#hszyereimh .gt_row_group_first th {
  border-top-width: 2px;
}

#hszyereimh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hszyereimh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hszyereimh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hszyereimh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hszyereimh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hszyereimh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hszyereimh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hszyereimh .gt_striped {
  background-color: #FAFAFA;
}

#hszyereimh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hszyereimh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hszyereimh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hszyereimh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hszyereimh .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hszyereimh .gt_left {
  text-align: left;
}

#hszyereimh .gt_center {
  text-align: center;
}

#hszyereimh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hszyereimh .gt_font_normal {
  font-weight: normal;
}

#hszyereimh .gt_font_bold {
  font-weight: bold;
}

#hszyereimh .gt_font_italic {
  font-style: italic;
}

#hszyereimh .gt_super {
  font-size: 65%;
}

#hszyereimh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hszyereimh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hszyereimh .gt_indent_1 {
  text-indent: 5px;
}

#hszyereimh .gt_indent_2 {
  text-indent: 10px;
}

#hszyereimh .gt_indent_3 {
  text-indent: 15px;
}

#hszyereimh .gt_indent_4 {
  text-indent: 20px;
}

#hszyereimh .gt_indent_5 {
  text-indent: 25px;
}

#hszyereimh .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hszyereimh div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="ID" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ID</th>
<th id="sex" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">sex</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="severity" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">severity</th>
<th id="medication" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">medication</th>
<th id="recovery" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">recovery</th>
<th id="match" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">match</th>
<th id="bias_correct" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">bias_correct</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="ID">1</td>
<td class="gt_row gt_right" headers="sex">−0.996980</td>
<td class="gt_row gt_right" headers="age">0.280787</td>
<td class="gt_row gt_right" headers="severity">1.459800</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">31</td>
<td class="gt_row gt_right" headers="match">39</td>
<td class="gt_row gt_right" headers="bias_correct">4.404</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="ID">2</td>
<td class="gt_row gt_right gt_striped" headers="sex">1.002979</td>
<td class="gt_row gt_right gt_striped" headers="age">0.865375</td>
<td class="gt_row gt_right gt_striped" headers="severity">1.502164</td>
<td class="gt_row gt_right gt_striped" headers="medication">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery">49</td>
<td class="gt_row gt_right gt_striped" headers="match">52</td>
<td class="gt_row gt_right gt_striped" headers="bias_correct">12.915</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="ID">3</td>
<td class="gt_row gt_right" headers="sex">−0.996980</td>
<td class="gt_row gt_right" headers="age">1.495134</td>
<td class="gt_row gt_right" headers="severity">1.268540</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">38</td>
<td class="gt_row gt_right" headers="match">46</td>
<td class="gt_row gt_right" headers="bias_correct">1.871</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="ID">4</td>
<td class="gt_row gt_right gt_striped" headers="sex">1.002979</td>
<td class="gt_row gt_right gt_striped" headers="age">−0.106534</td>
<td class="gt_row gt_right gt_striped" headers="severity">0.545911</td>
<td class="gt_row gt_right gt_striped" headers="medication">1</td>
<td class="gt_row gt_right gt_striped" headers="recovery">34</td>
<td class="gt_row gt_right gt_striped" headers="match">45</td>
<td class="gt_row gt_right gt_striped" headers="bias_correct">-0.497</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="ID">5</td>
<td class="gt_row gt_right" headers="sex">−0.996980</td>
<td class="gt_row gt_right" headers="age">0.043034</td>
<td class="gt_row gt_right" headers="severity">1.428732</td>
<td class="gt_row gt_right" headers="medication">1</td>
<td class="gt_row gt_right" headers="recovery">30</td>
<td class="gt_row gt_right" headers="match">39</td>
<td class="gt_row gt_right" headers="bias_correct">2.610</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-bias-6" class="slide level2">
<h2>Matching bias</h2>
<div style="font-size: x-large">
<p>Doesn’t this defeat the point of matching? If I have to run a linear regression anyway, why don’t I use only that, instead of this complicated model.</p>
<p>First of all, this linear regression that we are fitting doesn’t extrapolate on the treatment dimension to get the treatment effect. Instead, its purpose is just to correct bias.</p>
<p>Linear regression here is local, in the sense that it doesn’t try to see how the treated would be if it looked like the untreated. It does none of that extrapolation. This is left to the matching part.</p>
<p>The meat of the estimator is still the matching component. The point is that OLS is secondary to this estimator.</p>
</div>
</section>
<section id="matching-bias-7" class="slide level2">
<h2>Matching bias</h2>
<div style="font-size: x-large">
<p>The second point is that matching is a non-parametric estimator. It doesn’t assume linearity or any kind of parametric model.</p>
<p>As such, it is more flexible than linear regression and can work in situations where linear regression will not, namely, those where non linearity is very strong.</p>
</div>
</section>
<section id="matching-bias-8" class="slide level2">
<h2>Matching bias</h2>
<p>With the bias correction formula, I get the following ATE estimation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a></a>predicted <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb42-3"><a></a>    <span class="st">"ATE (est)"</span> <span class="ot">=</span> </span>
<span id="cb42-4"><a></a>      <span class="fu">mean</span>( (<span class="dv">2</span><span class="sc">*</span>medication <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (recovery <span class="sc">-</span> match <span class="sc">-</span> bias_correct) )) <span class="sc">|&gt;</span> </span>
<span id="cb42-5"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb42-6"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="meffhyyfjn" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#meffhyyfjn table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#meffhyyfjn thead, #meffhyyfjn tbody, #meffhyyfjn tfoot, #meffhyyfjn tr, #meffhyyfjn td, #meffhyyfjn th {
  border-style: none;
}

#meffhyyfjn p {
  margin: 0;
  padding: 0;
}

#meffhyyfjn .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#meffhyyfjn .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#meffhyyfjn .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#meffhyyfjn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#meffhyyfjn .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#meffhyyfjn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#meffhyyfjn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#meffhyyfjn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#meffhyyfjn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#meffhyyfjn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#meffhyyfjn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#meffhyyfjn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#meffhyyfjn .gt_spanner_row {
  border-bottom-style: hidden;
}

#meffhyyfjn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#meffhyyfjn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#meffhyyfjn .gt_from_md > :first-child {
  margin-top: 0;
}

#meffhyyfjn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#meffhyyfjn .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#meffhyyfjn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#meffhyyfjn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#meffhyyfjn .gt_row_group_first td {
  border-top-width: 2px;
}

#meffhyyfjn .gt_row_group_first th {
  border-top-width: 2px;
}

#meffhyyfjn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#meffhyyfjn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#meffhyyfjn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#meffhyyfjn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#meffhyyfjn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#meffhyyfjn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#meffhyyfjn .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#meffhyyfjn .gt_striped {
  background-color: #FAFAFA;
}

#meffhyyfjn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#meffhyyfjn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#meffhyyfjn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#meffhyyfjn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#meffhyyfjn .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#meffhyyfjn .gt_left {
  text-align: left;
}

#meffhyyfjn .gt_center {
  text-align: center;
}

#meffhyyfjn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#meffhyyfjn .gt_font_normal {
  font-weight: normal;
}

#meffhyyfjn .gt_font_bold {
  font-weight: bold;
}

#meffhyyfjn .gt_font_italic {
  font-style: italic;
}

#meffhyyfjn .gt_super {
  font-size: 65%;
}

#meffhyyfjn .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#meffhyyfjn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#meffhyyfjn .gt_indent_1 {
  text-indent: 5px;
}

#meffhyyfjn .gt_indent_2 {
  text-indent: 10px;
}

#meffhyyfjn .gt_indent_3 {
  text-indent: 15px;
}

#meffhyyfjn .gt_indent_4 {
  text-indent: 20px;
}

#meffhyyfjn .gt_indent_5 {
  text-indent: 25px;
}

#meffhyyfjn .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#meffhyyfjn div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="ATE (est)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">ATE (est)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="ATE (est)">-7.363</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="matching-ci" class="slide level2">
<h2>Matching CI</h2>
<div style="font-size: large">
<p>Of course, we also need to place a confidence interval around this measurement.</p>
<p>In practice, we can simply use someone else’s code and just import a matching estimator. Here is one from the library Matching.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a><span class="fu">require</span>(Matching)</span>
<span id="cb43-2"><a></a><span class="co">#  See https://www.jsekhon.com for additional documentation.</span></span>
<span id="cb43-3"><a></a><span class="fu">c</span>(<span class="st">"ATE"</span>, <span class="st">"ATC"</span>, <span class="st">"ATT"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-4"><a></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb43-5"><a></a>    (\(x){</span>
<span id="cb43-6"><a></a>      pairmatching <span class="ot">&lt;-</span> Matching<span class="sc">::</span><span class="fu">Match</span>(</span>
<span id="cb43-7"><a></a>        <span class="at">Y =</span> data_med<span class="sc">$</span>recovery</span>
<span id="cb43-8"><a></a>        , <span class="at">Tr =</span> data_med<span class="sc">$</span>medication</span>
<span id="cb43-9"><a></a>        , <span class="at">X =</span> data_med <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">'sex'</span>,<span class="st">'age'</span>,<span class="st">'severity'</span>)</span>
<span id="cb43-10"><a></a>        , <span class="at">estimand =</span> x</span>
<span id="cb43-11"><a></a>        , <span class="at">BiasAdjust =</span> <span class="cn">TRUE</span></span>
<span id="cb43-12"><a></a>      )</span>
<span id="cb43-13"><a></a>      tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">measure =</span> x, <span class="at">est =</span> pairmatching<span class="sc">$</span>est[<span class="dv">1</span>,<span class="dv">1</span>], <span class="at">se =</span> pairmatching<span class="sc">$</span>se)</span>
<span id="cb43-14"><a></a>    })</span>
<span id="cb43-15"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb43-16"><a></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-17"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-18"><a></a>  gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">'est'</span>,<span class="st">'se'</span>), <span class="at">decimals =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-19"><a></a>  gt<span class="sc">::</span><span class="fu">tab_header</span>(</span>
<span id="cb43-20"><a></a>    <span class="at">title =</span> <span class="st">"Treatment Effect Estimates: Matching"</span></span>
<span id="cb43-21"><a></a>    , <span class="at">subtitle =</span> <span class="st">"using R package Matching"</span></span>
<span id="cb43-22"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb43-23"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="iywmsjsjod" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#iywmsjsjod table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#iywmsjsjod thead, #iywmsjsjod tbody, #iywmsjsjod tfoot, #iywmsjsjod tr, #iywmsjsjod td, #iywmsjsjod th {
  border-style: none;
}

#iywmsjsjod p {
  margin: 0;
  padding: 0;
}

#iywmsjsjod .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#iywmsjsjod .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#iywmsjsjod .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#iywmsjsjod .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#iywmsjsjod .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iywmsjsjod .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iywmsjsjod .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iywmsjsjod .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#iywmsjsjod .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#iywmsjsjod .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#iywmsjsjod .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#iywmsjsjod .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#iywmsjsjod .gt_spanner_row {
  border-bottom-style: hidden;
}

#iywmsjsjod .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#iywmsjsjod .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#iywmsjsjod .gt_from_md > :first-child {
  margin-top: 0;
}

#iywmsjsjod .gt_from_md > :last-child {
  margin-bottom: 0;
}

#iywmsjsjod .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#iywmsjsjod .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#iywmsjsjod .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#iywmsjsjod .gt_row_group_first td {
  border-top-width: 2px;
}

#iywmsjsjod .gt_row_group_first th {
  border-top-width: 2px;
}

#iywmsjsjod .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iywmsjsjod .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#iywmsjsjod .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#iywmsjsjod .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iywmsjsjod .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iywmsjsjod .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#iywmsjsjod .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#iywmsjsjod .gt_striped {
  background-color: #FAFAFA;
}

#iywmsjsjod .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iywmsjsjod .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iywmsjsjod .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iywmsjsjod .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iywmsjsjod .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iywmsjsjod .gt_left {
  text-align: left;
}

#iywmsjsjod .gt_center {
  text-align: center;
}

#iywmsjsjod .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#iywmsjsjod .gt_font_normal {
  font-weight: normal;
}

#iywmsjsjod .gt_font_bold {
  font-weight: bold;
}

#iywmsjsjod .gt_font_italic {
  font-style: italic;
}

#iywmsjsjod .gt_super {
  font-size: 65%;
}

#iywmsjsjod .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#iywmsjsjod .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#iywmsjsjod .gt_indent_1 {
  text-indent: 5px;
}

#iywmsjsjod .gt_indent_2 {
  text-indent: 10px;
}

#iywmsjsjod .gt_indent_3 {
  text-indent: 15px;
}

#iywmsjsjod .gt_indent_4 {
  text-indent: 20px;
}

#iywmsjsjod .gt_indent_5 {
  text-indent: 25px;
}

#iywmsjsjod .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#iywmsjsjod div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="3" class="gt_heading gt_title gt_font_normal">Treatment Effect Estimates: Matching</th>
</tr>
<tr class="gt_heading even">
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">using R package Matching</th>
</tr>
<tr class="gt_col_headings header">
<th id="measure" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">measure</th>
<th id="est" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">est</th>
<th id="se" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">se</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="measure">ATE</td>
<td class="gt_row gt_right" headers="est">−7.708</td>
<td class="gt_row gt_right" headers="se">0.962</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="measure">ATC</td>
<td class="gt_row gt_right gt_striped" headers="est">−6.664</td>
<td class="gt_row gt_right gt_striped" headers="se">1.644</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="measure">ATT</td>
<td class="gt_row gt_right" headers="est">−9.680</td>
<td class="gt_row gt_right" headers="se">0.123</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div style="font-size: large">
<p>Finally, we can say with confidence that our medicine does indeed lower the time someone spends at the hospital. The ATE estimate is just a little bit lower than our algorithm, due to the difference in tie breaking of matches of knn implementation and the <code>Matching</code> R package.</p>
</div>
</section>
<section id="matching-bias-again" class="slide level2">
<h2>Matching bias again</h2>
<div style="font-size: large">
<p>We saw that matching is biased when the unit and its match are not so similar. But what causes them to be so different?</p>
<p>As it turns out, the answer is quite simple and intuitive. It is easy to find people that match on a few characteristics, like sex. But if we add more characteristics, like age, income, city of birth and so on, it becomes harder and harder to find matches. In more general terms, <u><strong>the more features we have, the higher will be the distance between units and their matches</strong></u>.</p>
<p>This is not something that hurts only the matching estimator. It ties back to the subclassification estimator we saw earlier. In that contrived medicine example where with man and woman, it was quite easy to build the subclassification estimator. That was because we only had 2 cells: man and woman. But what would happen if we had more?</p>
<p>Let’s say we have 2 continuous features like age and income and we manage to discretise them into 5 buckets each. This will give us 25 cells, or <span class="math inline">\(5^2\)</span>. And what if we had 10 covariates with 3 buckets each? Doesn’t seem like a lot right? Well, this would give us 59049 cells, or <span class="math inline">\(3^{10}\)</span>. It’s easy to see how this can blow out of proportion pretty quickly. This is a phenomena pervasive in all data science, which is called the <u><strong>The Curse of Dimensionality</strong></u><strong>!!!</strong></p>
</div>
</section>
<section id="matching-bias-again-1" class="slide level2">
<h2>Matching bias again</h2>
<div style="font-size: x-large">
<p>In the context of the subclassification estimator, the curse of dimensionality means that it will suffer if we have lots of features.</p>
<p>Lots of features imply multiple cells in X. If there are multiple cells, some of them will have very few data. Some of them might even have only treated or only control, so it won’t be possible to estimate the ATE there, which would break our estimator.</p>
<p>In the matching context, this means that the feature space will be very sparse and units will be very far from each other. This will increase the distance between matches and cause bias problems.</p>
</div>
</section>
<section id="matching-bias-again-2" class="slide level2">
<h2>Matching bias again</h2>
<div style="font-size: x-large">
<p>As for linear regression, it actually handles this problem quite well.</p>
<p>What it does is project all the features X into a single one, the Y dimension. It then makes treatment and control comparison on that projection.</p>
<p>So, in some way, linear regression performs some sort of dimensionality reduction to estimate the ATE. It’s quite elegant.</p>
</div>
</section></section>
<section>
<section id="difference-in-differences" class="title-slide slide level1 center">
<h1>Difference-in-Differences</h1>

</section>
<section id="difference-in-differences-1" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="three-billboards-in-the-south-of-brazil">Three Billboards in the South of Brazil</h4>
<div style="font-size: large">
<p>To figure out how good billboards were as a marketing channel, A bank placed 3 billboards in the city of Porto Alegre, the capital of the state of Rio Grande do Sul.</p>
<p>They wanted to see if that boosted deposits into our savings account.</p>
<p>Rio Grande do Sul is part of the south of Brazil, one of the most developed regions.</p>
<p>Data was also obtained from another capital from the south, Florianopolis, the capital city of the state of Santa Catarina in Brasil. The idea is that Florianopolis could be used as a control sample to estimate the counterfactual when compared to Porto Alegre. The billboard was placed in Porto Alegre for the entire month of June. The resulting data like this:</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a></a>data_bboard <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/billboard_impact.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb44-2"><a></a></span>
<span id="cb44-3"><a></a>data_bboard <span class="sc">|&gt;</span> </span>
<span id="cb44-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-5"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb44-6"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="kggvfxbxgy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#kggvfxbxgy table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kggvfxbxgy thead, #kggvfxbxgy tbody, #kggvfxbxgy tfoot, #kggvfxbxgy tr, #kggvfxbxgy td, #kggvfxbxgy th {
  border-style: none;
}

#kggvfxbxgy p {
  margin: 0;
  padding: 0;
}

#kggvfxbxgy .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kggvfxbxgy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kggvfxbxgy .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kggvfxbxgy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kggvfxbxgy .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kggvfxbxgy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kggvfxbxgy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kggvfxbxgy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kggvfxbxgy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kggvfxbxgy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kggvfxbxgy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kggvfxbxgy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kggvfxbxgy .gt_spanner_row {
  border-bottom-style: hidden;
}

#kggvfxbxgy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kggvfxbxgy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kggvfxbxgy .gt_from_md > :first-child {
  margin-top: 0;
}

#kggvfxbxgy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kggvfxbxgy .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kggvfxbxgy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kggvfxbxgy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kggvfxbxgy .gt_row_group_first td {
  border-top-width: 2px;
}

#kggvfxbxgy .gt_row_group_first th {
  border-top-width: 2px;
}

#kggvfxbxgy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kggvfxbxgy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kggvfxbxgy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kggvfxbxgy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kggvfxbxgy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kggvfxbxgy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kggvfxbxgy .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kggvfxbxgy .gt_striped {
  background-color: #FAFAFA;
}

#kggvfxbxgy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kggvfxbxgy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kggvfxbxgy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kggvfxbxgy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kggvfxbxgy .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kggvfxbxgy .gt_left {
  text-align: left;
}

#kggvfxbxgy .gt_center {
  text-align: center;
}

#kggvfxbxgy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kggvfxbxgy .gt_font_normal {
  font-weight: normal;
}

#kggvfxbxgy .gt_font_bold {
  font-weight: bold;
}

#kggvfxbxgy .gt_font_italic {
  font-style: italic;
}

#kggvfxbxgy .gt_super {
  font-size: 65%;
}

#kggvfxbxgy .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kggvfxbxgy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kggvfxbxgy .gt_indent_1 {
  text-indent: 5px;
}

#kggvfxbxgy .gt_indent_2 {
  text-indent: 10px;
}

#kggvfxbxgy .gt_indent_3 {
  text-indent: 15px;
}

#kggvfxbxgy .gt_indent_4 {
  text-indent: 20px;
}

#kggvfxbxgy .gt_indent_5 {
  text-indent: 25px;
}

#kggvfxbxgy .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kggvfxbxgy div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="deposits" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">deposits</th>
<th id="poa" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">poa</th>
<th id="jul" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">jul</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="deposits">42</td>
<td class="gt_row gt_right" headers="poa">1</td>
<td class="gt_row gt_right" headers="jul">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="deposits">0</td>
<td class="gt_row gt_right gt_striped" headers="poa">1</td>
<td class="gt_row gt_right gt_striped" headers="jul">0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="deposits">52</td>
<td class="gt_row gt_right" headers="poa">1</td>
<td class="gt_row gt_right" headers="jul">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="deposits">119</td>
<td class="gt_row gt_right gt_striped" headers="poa">1</td>
<td class="gt_row gt_right gt_striped" headers="jul">0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="deposits">21</td>
<td class="gt_row gt_right" headers="poa">1</td>
<td class="gt_row gt_right" headers="jul">0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="difference-in-differences-2" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="three-billboards-in-the-south-of-brazil-1">Three Billboards in the South of Brazil</h4>
<div style="font-size: x-large">
<p>In this example deposits are our outcome variable, the one the bank wishes to increase with the billboards. POA is a dummy variable for the city of Porto Alegre. When it is zero, it means the samples are from Florianopolis. Jul is a dummy for the month of July, or for the post intervention period. When it is zero it refers to samples from May, the pre-intervention period.</p>
</div>
</section>
<section id="difference-in-differences-3" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator">DID Estimator</h4>
<div style="font-size: x-large">
<p>Let <span class="math inline">\(Y^D(T)\)</span> be the potential outcome for treatment D on period T. In an ideal world where we have the ability to observe the counterfactual, we would estimate the treatment effect of an intervention the following way:</p>
</div>
<p><span class="math display">\[
\hat{ATET} = E[Y^1(1) - Y^0(1)|D=1]
\]</span></p>
<div style="font-size: x-large">
<p>In words, the causal effect is the outcome in the period post intervention in case of a treatment minus the outcome in also in the period after the intervention, but in the case of no treatment. Of course, we can’t measure this because <span class="math inline">\(Y^0(1)\)</span> is counterfactual.</p>
</div>
</section>
<section id="difference-in-differences-4" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-1">DID Estimator</h4>
<div style="font-size: x-large">
<p>One way around this is a before and after comparison.</p>
<p><span class="math display">\[
\hat{ATET} = E[Y(1)|D=1] - E[Y(0)|D=1]
\]</span></p>
<p>In our example, we would compare the average deposits from POA before and after the billboard was placed.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a></a>poa_before <span class="ot">&lt;-</span> data_bboard <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(poa<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> jul<span class="sc">==</span><span class="dv">0</span>) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(deposits) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb45-2"><a></a>poa_after  <span class="ot">&lt;-</span> data_bboard <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(poa<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> jul<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(deposits) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb45-3"><a></a>poa_after <span class="sc">-</span> poa_before</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 41.05</code></pre>
</div>
</div>
<p>This estimator is telling us that we should expect deposits to increase R<span class="math inline">\(\$ 41.05\)</span> after the intervention. But can we trust this?</p>
</div>
</section>
<section id="difference-in-differences-5" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-2">DID Estimator</h4>
<div style="font-size: x-large">
<p>Notice that <span class="math inline">\(E[Y(0)|D=1]=E[Y^0(0)|D=1]\)</span>, the observed outcome for the treated unit before the intervention is equal to the counterfactual outcome for the treated unit also before the intervention. Since we are using this to estimate <span class="math inline">\(E[Y^0(1)|D=1]\)</span>, the counterfactual after the intervention, this estimation above assumes that <span class="math inline">\(E[Y^0(1)|D=1] = E[Y^0(0)|D=1]\)</span>.</p>
<p>It is saying that in the case of no intervention, the outcome in the latter period would be the same as the outcome from the starting period. This would obviously be false if your outcome variable follows any kind of trend.</p>
</div>
</section>
<section id="difference-in-differences-6" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-3">DID Estimator</h4>
<div style="font-size: x-large">
<p>For example, if deposits are going up in POA, <span class="math inline">\(E[Y^0(1)|D=1] &gt; E[Y^0(0)|D=1]\)</span>, i.e.&nbsp;the outcome of the latter period would be greater than that of the starting period even in the absence of the intervention.</p>
<p>With a similar argument, if the trend in Y is going down, <span class="math inline">\(E[Y^0(1)|D=1] &lt; E[Y^0(0)|D=1]\)</span>. This is to show that this before and after thing is not a great estimator.</p>
</div>
</section>
<section id="difference-in-differences-7" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-4">DID Estimator</h4>
<div style="font-size: x-large">
<p>Another idea is to compare the treated group with an untreated group that didn’t get the intervention:</p>
<p><span class="math display">\[
\hat{ATET} = E[Y(1)|D=1] - E[Y(1)|D=0]
\]</span></p>
<p>In our example, it would be to compare the deposits from POA to that of Florianopolis in the post intervention period.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a></a>fl_after  <span class="ot">&lt;-</span> data_bboard <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(poa<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> jul<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(deposits) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb47-2"><a></a>poa_after <span class="sc">-</span> fl_after</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -119.1</code></pre>
</div>
</div>
<p>This estimator is telling us that the campaign is detrimental and that customers will decrease deposits by R$ 119.10.</p>
</div>
</section>
<section id="difference-in-differences-8" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-5">DID Estimator</h4>
<div style="font-size: x-large">
<p>This estimator is telling us that the campaign is detrimental and that customers will decrease deposits by R<span class="math inline">\(\$ 119.10\)</span>.</p>
<p>Notice that <span class="math inline">\(E[Y(1)|D=0]=E[Y^0(1)|D=0]\)</span>. And since we are using <span class="math inline">\(E[Y(1)|D=0]\)</span> to estimate the counterfactual for the treated after the intervention, we are assuming we can replace the missing counterfactual like this: <span class="math inline">\(E[Y^0(1)|D=0] = E[Y^0(1)|D=1]\)</span>.</p>
<p>But notice that this would only be true if both groups have a very similar baseline level. For instance, if Florianopolis has way more deposits than Porto Alegre, this would not be true because <span class="math inline">\(E[Y^0(1)|D=0] &gt; E[Y^0(1)|D=1]\)</span>.</p>
<p>On the other hand, if the level of deposits are lower in Florianopolis, we would have <span class="math inline">\(E[Y^0(1)|D=0] &lt; E[Y^0(1)|D=1]\)</span>.</p>
</div>
</section>
<section id="difference-in-differences-9" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-6">DID Estimator</h4>
<div style="font-size: x-large">
<p>Notice that <span class="math inline">\(E[Y(1)|D=0]=E[Y^0(1)|D=0]\)</span>. And since we are using <span class="math inline">\(E[Y(1)|D=0]\)</span> to estimate the counterfactual for the treated after the intervention, we are assuming we can replace the missing counterfactual like this: <span class="math inline">\(E[Y^0(1)|D=0] = E[Y^0(1)|D=1]\)</span>. But notice that this would only be true if both groups have a very similar baseline level.</p>
<p>For instance, if Florianopolis has way more deposits than Porto Alegre, this would not be true because <span class="math inline">\(E[Y^0(1)|D=0] &gt; E[Y^0(1)|D=1]\)</span>.</p>
<p>On the other hand, if the level of deposits are lower in Florianopolis, we would have <span class="math inline">\(E[Y^0(1)|D=0] &lt; E[Y^0(1)|D=1]\)</span>.</p>
</div>
</section>
<section id="difference-in-differences-10" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-7">DID Estimator</h4>
<div style="font-size: x-large">
<p>Again, this is not a great idea. To solve this, we can use both space and time comparison. This is the idea of the difference in difference approach. It works by replacing the missing counterfactual the following way:</p>
</div>
<p><span class="math display">\[
\begin{align*}
E[Y^0(1)|D=1] &amp; = E[Y^0(0)|D=1] + \\
&amp; (E[Y^0(1)|D=0] - E[Y^0(0)|D=0])
\end{align*}
\]</span></p>
<div style="font-size: x-large">
<p>What this does is take the treated unit <strong>before the intervention</strong> and adds a trend component to it, which is estimated using the control <span class="math inline">\(E[Y^0(1)|D=0] - E[Y^0(0)|D=0]\)</span>. In words, it is saying that the treated <strong>after the intervention</strong>, had it not been treated, would look like the <strong>treated before the treatment</strong> plus a growth factor that is the same as the growth of the control.</p>
</div>
</section>
<section id="difference-in-differences-11" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-8">DID Estimator</h4>
<div style="font-size: x-large">
<p>It is important to notice that this assumes that the trends in the treatment and control are the same:</p>
<p><span class="math display">\[
E[Y^0(1) − Y^0(0)|D=1] = E[Y^0(1) − Y^0(0)|D=0]
\]</span></p>
<p>where the left hand side is the counterfactual trend. Now, we can replace the estimated counterfactual in the treatment effect definition</p>
<p><span class="math inline">\(E[Y^1(1)|D=1] - E[Y^0(1)|D=1]\)</span></p>
<p><span class="math display">\[
\hat{ATET} = E[Y(1)|D=1] - (E[Y(0)|D=1] + (E[Y(1)|D=0] - E[Y(0)|D=0])
\]</span></p>
<p>It gets that name because it gets the difference between the difference between treatment and control after and before the treatment.</p>
</div>
</section>
<section id="difference-in-differences-12" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-9">DID Estimator</h4>
<div style="font-size: x-large">
<p>Here is what that looks in code.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a>fl_before <span class="ot">&lt;-</span> data_bboard <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(poa<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> jul<span class="sc">==</span><span class="dv">0</span>) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(deposits) <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb49-2"><a></a>diff_in_diff <span class="ot">=</span> (poa_after<span class="sc">-</span>poa_before)<span class="sc">-</span>(fl_after<span class="sc">-</span>fl_before)</span>
<span id="cb49-3"><a></a>diff_in_diff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.525</code></pre>
</div>
</div>
<div style="font-size: x-large">
<p>Diff-in-Diff is telling us that we should expect deposits to increase by R<span class="math inline">\(\$ 6.52\)</span> per customer.</p>
<p>Notice that the assumption that diff-in-diff makes is much more plausible than the other 2 estimators. It just assumes that the growth pattern between the 2 cities are the same. But it doesn’t require them to have the same base level nor does it require the trend to be zero.</p>
</div>
</section>
<section id="difference-in-differences-13" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-10">DID Estimator</h4>
<div style="font-size: x-large">
<p>To visualize what diff-in-diff is doing, we can project the growth trend from the untreated into the treated to see the counterfactual, that is, the number of deposits we should expect if there were no intervention.</p>
</div>

<img data-src="BSMM_8740_lec_08_files/figure-revealjs/unnamed-chunk-51-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"><div style="font-size: x-large">
<p>The small difference between the solid and the dashed lines shows the small treatment effect on Porto Alegre.</p>
</div>
</section>
<section id="difference-in-differences-14" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-11">DID Estimator</h4>
<div style="font-size: large">
<p>But how much can we trust this estimator? To get standard errors we use a neat trick that uses regression. Specifically, we will estimate the following linear model</p>
</div>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1 POA_i + \beta_2 Jul_i + \beta_3 POA_i*Jul_i + e_i
\]</span></p>
<div style="font-size: large">
<p>Notice that <span class="math inline">\(\beta_0\)</span> is the baseline of the control. In our case, is the level of deposits in Florianopolis in the month of May.</p>
<p>If we turn on the treated city dummy, we get <span class="math inline">\(\beta_1\)</span>. So <span class="math inline">\(\beta_0+\beta_1\)</span> is the baseline of Porto Alegre in May, before the intervention, and <span class="math inline">\(\beta_1\)</span> is the increase of Porto Alegre baseline on top of Florianopolis.</p>
<p>If we turn the POA dummy off and turn the July dummy on, we get <span class="math inline">\(\beta_0+\beta_2\)</span>, which is the level of Florianópolis in July, after the intervention period. <span class="math inline">\(\beta_2\)</span> is then the trend of the control, since we add it on top of the baseline to get the level of the control at the period post intervention.</p>
</div>
</section>
<section id="difference-in-differences-15" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="did-estimator-12">DID Estimator</h4>
<div style="font-size: x-large">
<p>As a recap, <span class="math inline">\(\beta_1\)</span> is the increment we get by going from the control to the treated, <span class="math inline">\(\beta_2\)</span> is the increment we get by going from the period before to the period after the intervention. Finally, if we turn both dummies on, we get <span class="math inline">\(\beta_3\)</span>. <span class="math inline">\(\beta_0+\beta_1+\beta_2+\beta_3\)</span> is the level in Porto Alegre after the intervention. So <span class="math inline">\(\beta_3\)</span> is the incremental impact when you go from May to July and from Florianopolis to POA. In other words, it is the Difference in Difference estimator.</p>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   172.        2.36     72.6  0        
2 poa          -126.        4.48    -28.0  1.39e-159
3 jul            34.5       3.04     11.4  1.43e- 29
4 poa:jul         6.52      5.73      1.14 2.55e-  1</code></pre>
</div>
</div>
</section>
<section id="difference-in-differences-16" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="non-parallel-trends">Non Parallel Trends</h4>
<div style="font-size: x-large">
<p>One obvious potential problem with Diff-in-Diff is failure to satisfy the parallel trend assumption. If the growth trend from the treated is different from the trend of the control, diff-in-diff will be biased.</p>
<p>This is a common problem with non-random data, where the decision to treat a region is based on its potential to respond well to the treatment, or when the treatment is targeted at regions that are not performing very well. In our marketing example we decided to test billboards in Porto Alegre not in order to check the effect of billboards in general. The reason is simply because sales perform poorly there.</p>
<p>Perhaps online marketing is not working there. In this case, it could be that the growth we would see in Porto Alegre without a billboard would be lower than the growth we observe in other cities. This would cause us to underestimate the effect of the billboard there.</p>
</div>
</section>
<section id="difference-in-differences-17" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="non-parallel-trends-1">Non Parallel Trends</h4>
<div style="font-size: x-large">
<p>One way to check if this is happening is to plot the trend using past periods. For example, let’s suppose POA had a small decreasing trend but Florianopolis was on a steep ascent. In this case, showing periods from before would reveal those trends and we would know Diff-in-Diff is not a reliable estimator.</p>
</div>

<img data-src="BSMM_8740_lec_08_files/figure-revealjs/unnamed-chunk-53-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="difference-in-differences-18" class="slide level2">
<h2>Difference-in-Differences</h2>
<h4 id="non-parallel-trends-2">Non Parallel Trends</h4>
<div style="font-size: x-large">
<p>One final issue that is worth mentioning is that you won’t be able to place confidence intervals around your Diff-in-Diff estimator if you only have aggregated data.</p>
<p>Say for instance you don’t have data on what each of our customers from Florianópolis or Porto Alegre did. Instead, you only have the average deposits before and after the intervention for both cities.</p>
<p>In this case, you will still be able to estimate the causal effect by Diff-in-Diff, but you won’t know the variance of it. That’s because all the variability in your data got squashed out in aggregation.</p>
</div>
</section></section>
<section>
<section id="panel-data-and-fixed-effects" class="title-slide slide level1 center">
<h1>Panel Data and Fixed Effects</h1>

</section>
<section id="panel-data-and-fixed-effects-1" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<div style="font-size: x-large">
<p>In the simple Diff-in-Diff setup, we have a treated and a control group (the city of POA and FLN, respectively) and only two periods, a pre-intervention and a post-intervention period. But what would happen if we had more periods? Or more groups?</p>
<p>This setup is so common and powerful for causal inference and gets its own name: <u><strong>panel data</strong></u>.</p>
<p>A panel is when we have repeated observations of the same unit over multiple periods of time. This is incredibly common in the industry, where companies track user data over multiple weeks and months.</p>
<p>To understand how we can leverage such data structure, let’s first continue with our diff-in-diff example, where we wanted to estimate the impact of placing a billboard (treatment) in the city of Porto Alegre (POA). Specifically, we want to know how much deposits in our investments account would increase if we placed more billboards.</p>
</div>
</section>
<section id="panel-data-and-fixed-effects-2" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<div style="font-size: x-large">
<p>In the previous section, we motivated the DiD estimator as an imputation strategy of what would have happened to Porto Alegre had we not placed the billboards in it.</p>
<p>We said that the counterfactual outcome <span class="math inline">\(Y^0\)</span> for Porto Alegre <strong>after the intervention</strong> (placing a billboard) could be imputed as the number of deposits in Porto Alegre <strong>before the intervention</strong> plus a growth factor.</p>
<p>This growth factor was estimated in a control city, Florianopolis (FLN).</p>
</div>
</section>
<section id="panel-data-and-fixed-effects-3" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<div style="font-size: xx-large">
<p>To recap some notation, here is how we can estimate this counterfactual outcome</p>
</div>
<div style="font-size: x-large">
<p><span class="math display">\[
\begin{align*}
\begin{split}
\underbrace{\widehat{Y^0(1)|D=1}}_{\substack{\text{POA outcome after intervention} \\ \text{if no intervention had taken place}}}
= \underbrace{Y^0(0)|D=1}_{\substack{\text{POA outcome} \\ \text{before intervention}}}
+ \big( \underbrace{Y^0(1)|D=0}_{\substack{\text{FLN outcome after} \\ \text{intervention in POA}}}
- \underbrace{Y^0(0)|D=0}_{\substack{\text{FLN outcome before} \\ \text{intervention in POA}}} \big)
\end{split}
\end{align*}
\]</span></p>
</div>
<div style="font-size: xx-large">
<p>where <span class="math inline">\(t\)</span> denotes time, <span class="math inline">\(D\)</span> denotes the treatment (since <span class="math inline">\(t\)</span> is taken), <span class="math inline">\(Y^D(t)\)</span> denote the potential outcome for treatment <span class="math inline">\(D\)</span> in period <span class="math inline">\(t\)</span> (for example, <span class="math inline">\(Y^0(1)\)</span> is the outcome under the control in period 1).</p>
</div>
</section>
<section id="panel-data-and-fixed-effects-4" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<div style="font-size: x-large">
<p>Now, if we take that imputed potential outcome, we can recover the treatment effect for POA (ATT) as follows</p>
</div>
<p><span class="math display">\[
\begin{split}
\widehat{ATT} = \underbrace{Y^1(1)|D=1}_{\substack{\text{POA outcome} \\ \text{after intervention}}} - \widehat{Y^0(1)|D=1}
\end{split}
\]</span></p>
<div style="font-size: x-large">
<p>The effect of placing a billboard in POA is the outcome we saw on POA after placing the billboard minus our estimate of what would have happened if we hadn’t placed the billboard. Recall that the power of DiD comes from the fact that estimating the mentioned counterfactual only requires that the growth deposits in POA matches the growth in deposits in FLW. This is the key <strong>parallel trends assumption</strong>.</p>
</div>
</section>
<section id="panel-data-and-fixed-effects-5" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="parallel-trends">Parallel Trends</h4>
<div style="font-size: x-large">
<p>One way to see the parallel (or common) trends assumptions is as an independence assumption. Recall that the independence assumption requires that the treatment assignment is independent from the potential outcomes:</p>
</div>
<p><span class="math display">\[
Y^d \perp  D
\]</span></p>
<div style="font-size: x-large">
<p>So we don’t give more treatment to units with higher outcome (causing upward bias in the effect estimation) or lower outcome (causing downward bias).</p>
<p>If the marketing manager decides to add billboards only to cities that already have very high deposits, the manager can later boast that cities with billboards generate more deposits, and that the marketing campaign was a success.</p>
<p>This violates the independence assumption: we are giving the treatment to cities with high <span class="math inline">\(Y^0\)</span>.</p>
</div>
</section>
<section id="panel-data-and-fixed-effects-6" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="parallel-trends-1">Parallel Trends</h4>
<div style="font-size: large">
<p>Recall that a natural extension of this assumption is the conditional independence assumption, which allows the potential outcomes to be dependent on the treatment at first, but independent once we condition on the confounders <span class="math inline">\(X\)</span></p>
</div>
<p><span class="math display">\[
Y^d \perp D | X
\]</span></p>
<div style="font-size: large">
<p>If the traditional independence assumption states that the treatment assignment can’t be related to <strong>the levels</strong> of potential outcomes, the parallel trends states that the treatment assignment can’t be related to <strong>the growth</strong> in potential outcomes over time, and one way to write the parallel trends assumption is as follows</p>
</div>
<p><span class="math display">\[
\big(Y^d(t) - Y^d(t-1) \big)  \perp D
\]</span></p>
</section>
<section id="panel-data-and-fixed-effects-7" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="parallel-trends-2">Parallel Trends</h4>
<div style="font-size: x-large">
<p>This assumption says it is fine that we assign the treatment to units that have a higher or lower level of the outcome. What we can’t do is assign the treatment to units based on how the outcome is growing.</p>
<p>In our billboard example, this means it is OK to place billboards only in cities with originally high deposit levels. What we can’t do is place billboards only in cities where the deposits are growing the most.</p>
<p>Remember that DiD is imputing the counterfactual growth in the treated unit with the growth in the control unit. If growth in the treated unit under the control is different than the growth in the control unit, then we are in trouble.</p>
</div>
</section>
<section id="panel-data-and-fixed-effects-8" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="controlling-what-you-cannot-see">Controlling What you Cannot See</h4>
<div style="font-size: x-large">
<p>Methods like propensity score, linear regression and matching are very good at controlling for confounding in non-random/observational data, but they rely on a key assumption: conditional unconfoundedness</p>
</div>
<p><span class="math display">\[
(Y^0, Y^1) \perp D | X
\]</span></p>
<div style="font-size: x-large">
<p>To put it in words, they require that all the confounders are known and measured, so that we can condition on them and make the treatment as good as random.</p>
</div>
</section>
<section id="panel-data-and-fixed-effects-9" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="controlling-what-you-cannot-see-1">Controlling What you Cannot See</h4>
<div style="font-size: large">
<p>One issue is that sometimes we can’t measure a confounder. For instance, take a classical labor economics problem of figuring out the impact of marriage on men’s earnings. It’s considered a fact in economics that married men earn more than single men. However, it is not clear if this relationship is causal or not.</p>
<p>It could be that more educated men are both more likely to marry and more likely to have a high earnings job, which would mean that education is a confounder of the effect of marriage on earnings. For this confounder, we could measure the education of the person in the study and run a regression controlling for that.</p>
<p>But another confounder could be physical attractiveness. It could be that more handsome men are both more likely to get married and more likely to have a high paying job. Unfortunately, attractiveness is one of those characteristics like intelligence. It’s something we can’t measure very well.</p>
</div>
</section>
<section id="panel-data-and-fixed-effects-10" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects">Fixed Effects</h4>
<div class="columns">
<div class="column" style="width:40%;">
<div style="font-size: large">
<div class="cell">
<details class="code-fold">
<summary>load panel data</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a></a>data_panel <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/wage_panel.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-2"><a></a></span>
<span id="cb52-3"><a></a>data_panel <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-5"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-6"><a></a>  gt<span class="sc">::</span><span class="fu">tab_options</span>( <span class="at">table.font.size =</span> gt<span class="sc">::</span><span class="fu">px</span>(<span class="dv">28</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb52-7"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="vuxhczevcu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#vuxhczevcu table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vuxhczevcu thead, #vuxhczevcu tbody, #vuxhczevcu tfoot, #vuxhczevcu tr, #vuxhczevcu td, #vuxhczevcu th {
  border-style: none;
}

#vuxhczevcu p {
  margin: 0;
  padding: 0;
}

#vuxhczevcu .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vuxhczevcu .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vuxhczevcu .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vuxhczevcu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vuxhczevcu .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vuxhczevcu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vuxhczevcu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vuxhczevcu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vuxhczevcu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vuxhczevcu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vuxhczevcu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vuxhczevcu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vuxhczevcu .gt_spanner_row {
  border-bottom-style: hidden;
}

#vuxhczevcu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vuxhczevcu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vuxhczevcu .gt_from_md > :first-child {
  margin-top: 0;
}

#vuxhczevcu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vuxhczevcu .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vuxhczevcu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vuxhczevcu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vuxhczevcu .gt_row_group_first td {
  border-top-width: 2px;
}

#vuxhczevcu .gt_row_group_first th {
  border-top-width: 2px;
}

#vuxhczevcu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vuxhczevcu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vuxhczevcu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vuxhczevcu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vuxhczevcu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vuxhczevcu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vuxhczevcu .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vuxhczevcu .gt_striped {
  background-color: #FAFAFA;
}

#vuxhczevcu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vuxhczevcu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vuxhczevcu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vuxhczevcu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vuxhczevcu .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vuxhczevcu .gt_left {
  text-align: left;
}

#vuxhczevcu .gt_center {
  text-align: center;
}

#vuxhczevcu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vuxhczevcu .gt_font_normal {
  font-weight: normal;
}

#vuxhczevcu .gt_font_bold {
  font-weight: bold;
}

#vuxhczevcu .gt_font_italic {
  font-style: italic;
}

#vuxhczevcu .gt_super {
  font-size: 65%;
}

#vuxhczevcu .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vuxhczevcu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vuxhczevcu .gt_indent_1 {
  text-indent: 5px;
}

#vuxhczevcu .gt_indent_2 {
  text-indent: 10px;
}

#vuxhczevcu .gt_indent_3 {
  text-indent: 15px;
}

#vuxhczevcu .gt_indent_4 {
  text-indent: 20px;
}

#vuxhczevcu .gt_indent_5 {
  text-indent: 25px;
}

#vuxhczevcu .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#vuxhczevcu div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="nr" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">nr</th>
<th id="year" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">year</th>
<th id="black" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">black</th>
<th id="exper" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">exper</th>
<th id="hisp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">hisp</th>
<th id="hours" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">hours</th>
<th id="married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">married</th>
<th id="educ" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">educ</th>
<th id="union" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">union</th>
<th id="lwage" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">lwage</th>
<th id="expersq" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">expersq</th>
<th id="occupation" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">occupation</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="nr">13</td>
<td class="gt_row gt_right" headers="year">1980</td>
<td class="gt_row gt_right" headers="black">0</td>
<td class="gt_row gt_right" headers="exper">1</td>
<td class="gt_row gt_right" headers="hisp">0</td>
<td class="gt_row gt_right" headers="hours">2672</td>
<td class="gt_row gt_right" headers="married">0</td>
<td class="gt_row gt_right" headers="educ">14</td>
<td class="gt_row gt_right" headers="union">0</td>
<td class="gt_row gt_right" headers="lwage">1.198</td>
<td class="gt_row gt_right" headers="expersq">1</td>
<td class="gt_row gt_right" headers="occupation">9</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="nr">13</td>
<td class="gt_row gt_right gt_striped" headers="year">1981</td>
<td class="gt_row gt_right gt_striped" headers="black">0</td>
<td class="gt_row gt_right gt_striped" headers="exper">2</td>
<td class="gt_row gt_right gt_striped" headers="hisp">0</td>
<td class="gt_row gt_right gt_striped" headers="hours">2320</td>
<td class="gt_row gt_right gt_striped" headers="married">0</td>
<td class="gt_row gt_right gt_striped" headers="educ">14</td>
<td class="gt_row gt_right gt_striped" headers="union">1</td>
<td class="gt_row gt_right gt_striped" headers="lwage">1.853</td>
<td class="gt_row gt_right gt_striped" headers="expersq">4</td>
<td class="gt_row gt_right gt_striped" headers="occupation">9</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="nr">13</td>
<td class="gt_row gt_right" headers="year">1982</td>
<td class="gt_row gt_right" headers="black">0</td>
<td class="gt_row gt_right" headers="exper">3</td>
<td class="gt_row gt_right" headers="hisp">0</td>
<td class="gt_row gt_right" headers="hours">2940</td>
<td class="gt_row gt_right" headers="married">0</td>
<td class="gt_row gt_right" headers="educ">14</td>
<td class="gt_row gt_right" headers="union">0</td>
<td class="gt_row gt_right" headers="lwage">1.344</td>
<td class="gt_row gt_right" headers="expersq">9</td>
<td class="gt_row gt_right" headers="occupation">9</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="nr">13</td>
<td class="gt_row gt_right gt_striped" headers="year">1983</td>
<td class="gt_row gt_right gt_striped" headers="black">0</td>
<td class="gt_row gt_right gt_striped" headers="exper">4</td>
<td class="gt_row gt_right gt_striped" headers="hisp">0</td>
<td class="gt_row gt_right gt_striped" headers="hours">2960</td>
<td class="gt_row gt_right gt_striped" headers="married">0</td>
<td class="gt_row gt_right gt_striped" headers="educ">14</td>
<td class="gt_row gt_right gt_striped" headers="union">0</td>
<td class="gt_row gt_right gt_striped" headers="lwage">1.433</td>
<td class="gt_row gt_right gt_striped" headers="expersq">16</td>
<td class="gt_row gt_right gt_striped" headers="occupation">9</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="nr">13</td>
<td class="gt_row gt_right" headers="year">1984</td>
<td class="gt_row gt_right" headers="black">0</td>
<td class="gt_row gt_right" headers="exper">5</td>
<td class="gt_row gt_right" headers="hisp">0</td>
<td class="gt_row gt_right" headers="hours">3071</td>
<td class="gt_row gt_right" headers="married">0</td>
<td class="gt_row gt_right" headers="educ">14</td>
<td class="gt_row gt_right" headers="union">0</td>
<td class="gt_row gt_right" headers="lwage">1.568</td>
<td class="gt_row gt_right" headers="expersq">25</td>
<td class="gt_row gt_right" headers="occupation">5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div><div class="column" style="width:60%;">
<div style="font-size: large">
<p>Generally, the fixed effect model is defined as</p>
<p><span class="math display">\[
y_{it} = \beta X_{it} + \gamma U_i + e_{it}
\]</span></p>
<p>where <span class="math inline">\(y_{it}\)</span> is the outcome of individual <span class="math inline">\(i\)</span> at time <span class="math inline">\(t\)</span>, <span class="math inline">\(X_{it}\)</span> is the vector of variables for individual <span class="math inline">\(i\)</span> at time <span class="math inline">\(t\)</span>. <span class="math inline">\(U_i\)</span> is a set of unobservables for individual <span class="math inline">\(i\)</span> .</p>
<p>Notice that those unobservables are unchanging through time, hence the lack of the time subscript.</p>
<p>Finally, <span class="math inline">\(e_{it}\)</span> is the error term. For the education example, <span class="math inline">\(y_{it}\)</span> is log wages, <span class="math inline">\(X_{it}\)</span> are the observable variables that change in time, like marriage and experience and <span class="math inline">\(U_i\)</span> are the variables that are not observed but constant for each individual, like beauty and intelligence.</p>
</div>
</div></div>
</section>
<section id="panel-data-and-fixed-effects-11" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-1">Fixed Effects</h4>
<div style="font-size: x-large">
<p>Using panel data with a fixed effect model is as simple as adding a dummy for the entities.</p>
<p>This is true, but in practice, we don’t actually do it.</p>
<p>Imagine a dataset where we have 1 million customers. If we add one dummy for each of them, we would end up with 1 million columns, which is probably not a good idea. Instead, we use the trick of partitioning the linear regression into 2 separate models.</p>
<p>We’ve seen this before, but now is a good time to recap it.</p>
</div>
</section>
<section id="panel-data-and-fixed-effects-12" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-2">Fixed Effects</h4>
<div style="font-size: large">
<p>Suppose you have a linear regression model with a set of features <span class="math inline">\(X_1\)</span> and another set of features <span class="math inline">\(X_2\)</span>.</p>
<p><span class="math display">\[
\hat{Y} = \hat{\beta_1} X_1 + \hat{\beta_2} X_2
\]</span></p>
<p>where <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> are feature matrices (one row per feature and one column per observation) and <span class="math inline">\(\hat{\beta_1}\)</span> and <span class="math inline">\(\hat{\beta_2}\)</span> are row vectors. You can get the exact same <span class="math inline">\(\hat{\beta_1}\)</span> parameter by doing<sup>1</sup></p>
<ol type="1">
<li>regress the outcome <span class="math inline">\(y\)</span> on the second set of features <span class="math inline">\(\hat{y^*} = \hat{\gamma_1} X_2\)</span></li>
<li>regress the first set of features on the second <span class="math inline">\(\hat{X_1} = \hat{\gamma_2} X_2\)</span></li>
<li>obtain the residuals <span class="math inline">\(\tilde{X}_1 = X_1 - \hat{X_1}\)</span> and <span class="math inline">\(\tilde{y} = y - \hat{y^*}\)</span></li>
<li>regress the residuals of the outcome on the residuals of the features <span class="math inline">\(\tilde{y} = \hat{\beta_1} \tilde{X}_1\)</span></li>
</ol>
</div>
<aside><ol class="aside-footnotes"><li id="fn2"><p>See the FWL Theorem</p></li></ol></aside></section>
<section id="panel-data-and-fixed-effects-13" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-3">Fixed Effects</h4>
<p>The parameter from this last regression will be exactly the same as running the regression with all the features.</p>
<p>But how exactly does this help us? Well, we can break the estimation of the model with the entity dummies into 2. First, we use the dummies to predict the outcome and the features. These are steps 1 and 2 above.</p>
</section>
<section id="panel-data-and-fixed-effects-14" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-4">Fixed Effects</h4>
<div style="font-size: x-large">
<p>Recall how running a regression on a dummy variable is as simple as estimating the mean for that dummy? Let’s run a model where we predict wages as a function of the year dummy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a><span class="fu">lm</span>(lwage <span class="sc">~</span> year, <span class="at">data =</span> data_panel <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">factor</span>(year))) <span class="sc">|&gt;</span> </span>
<span id="cb53-2"><a></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)    1.39     0.0220     63.5  0       
2 year1981       0.119    0.0311      3.84 1.22e- 4
3 year1982       0.178    0.0311      5.74 1.02e- 8
4 year1983       0.226    0.0311      7.27 4.21e-13
5 year1984       0.297    0.0311      9.56 1.94e-21
6 year1985       0.346    0.0311     11.1  1.93e-28
7 year1986       0.406    0.0311     13.1  2.19e-38
8 year1987       0.473    0.0311     15.2  4.40e-51</code></pre>
</div>
</div>
</div>
</section>
<section id="panel-data-and-fixed-effects-15" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-5">Fixed Effects</h4>
<div style="font-size: x-large">
<p>Notice how this model is predicting the average income in 1980 to be 1.3935, in 1981 to be 1.5129 (1.3935+0.1194) and so on. Now, if we compute the average by year, we get the exact same result. (Remember that the base year, 1980, is the intercept. So you have to add the intercept to the parameters of the other years to get the mean <code>lwage</code> for the year).</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a></a>data_panel <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">group_by</span>(year) <span class="sc">|&gt;</span> </span>
<span id="cb55-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">avg_lwage =</span> <span class="fu">mean</span>(lwage)) <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>(<span class="st">'year'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-4"><a></a>  gt<span class="sc">::</span><span class="fu">tab_options</span>( <span class="at">table.font.size =</span> gt<span class="sc">::</span><span class="fu">px</span>(<span class="dv">28</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb55-5"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="yrwrbwaykp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#yrwrbwaykp table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#yrwrbwaykp thead, #yrwrbwaykp tbody, #yrwrbwaykp tfoot, #yrwrbwaykp tr, #yrwrbwaykp td, #yrwrbwaykp th {
  border-style: none;
}

#yrwrbwaykp p {
  margin: 0;
  padding: 0;
}

#yrwrbwaykp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yrwrbwaykp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#yrwrbwaykp .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yrwrbwaykp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yrwrbwaykp .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yrwrbwaykp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yrwrbwaykp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yrwrbwaykp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yrwrbwaykp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yrwrbwaykp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yrwrbwaykp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yrwrbwaykp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yrwrbwaykp .gt_spanner_row {
  border-bottom-style: hidden;
}

#yrwrbwaykp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#yrwrbwaykp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yrwrbwaykp .gt_from_md > :first-child {
  margin-top: 0;
}

#yrwrbwaykp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yrwrbwaykp .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yrwrbwaykp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#yrwrbwaykp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#yrwrbwaykp .gt_row_group_first td {
  border-top-width: 2px;
}

#yrwrbwaykp .gt_row_group_first th {
  border-top-width: 2px;
}

#yrwrbwaykp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yrwrbwaykp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#yrwrbwaykp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#yrwrbwaykp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yrwrbwaykp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yrwrbwaykp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yrwrbwaykp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#yrwrbwaykp .gt_striped {
  background-color: #FAFAFA;
}

#yrwrbwaykp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yrwrbwaykp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yrwrbwaykp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yrwrbwaykp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yrwrbwaykp .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yrwrbwaykp .gt_left {
  text-align: left;
}

#yrwrbwaykp .gt_center {
  text-align: center;
}

#yrwrbwaykp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yrwrbwaykp .gt_font_normal {
  font-weight: normal;
}

#yrwrbwaykp .gt_font_bold {
  font-weight: bold;
}

#yrwrbwaykp .gt_font_italic {
  font-style: italic;
}

#yrwrbwaykp .gt_super {
  font-size: 65%;
}

#yrwrbwaykp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#yrwrbwaykp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#yrwrbwaykp .gt_indent_1 {
  text-indent: 5px;
}

#yrwrbwaykp .gt_indent_2 {
  text-indent: 10px;
}

#yrwrbwaykp .gt_indent_3 {
  text-indent: 15px;
}

#yrwrbwaykp .gt_indent_4 {
  text-indent: 20px;
}

#yrwrbwaykp .gt_indent_5 {
  text-indent: 25px;
}

#yrwrbwaykp .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#yrwrbwaykp div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="avg_lwage" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">avg_lwage</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">1980</td>
<td class="gt_row gt_right" headers="stub_1_1 avg_lwage">1.393</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">1981</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 avg_lwage">1.513</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">1982</td>
<td class="gt_row gt_right" headers="stub_1_3 avg_lwage">1.572</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">1983</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 avg_lwage">1.619</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">1984</td>
<td class="gt_row gt_right" headers="stub_1_5 avg_lwage">1.690</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">1985</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 avg_lwage">1.739</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">1986</td>
<td class="gt_row gt_right" headers="stub_1_7 avg_lwage">1.800</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">1987</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_8 avg_lwage">1.866</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="panel-data-and-fixed-effects-16" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-6">Fixed Effects</h4>
<div style="font-size: x-large">
<p>This means that if we get the average for every person in our panel, we are essentially regressing the individual dummy on the other variables. This motivates the following estimation procedure:</p>
<ol type="1">
<li>Create time-demeaned variables by subtracting the mean for the individual:</li>
</ol>
<p><span class="math display">\[
    \begin{align*}
    \ddot{Y}_{it} &amp; =Y_{it}-\bar{Y}_{i}\\
    \ddot{X}_{it} &amp; =X_{it}-\bar{X}_{i}
    \end{align*}
\]</span> 2. Regress <span class="math inline">\(\ddot{Y}_{it}\)</span> on <span class="math inline">\(\ddot{X}_{it}\)</span></p>
</div>
</section>
<section id="panel-data-and-fixed-effects-17" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-7">Fixed Effects</h4>
<div style="font-size: x-large">
<p>Notice that when we do so, the unobserved <span class="math inline">\(U_i\)</span> vanishes. Since <span class="math inline">\(U_i\)</span> is constant across time, we have that <span class="math inline">\(\bar{U_i}=U_i\)</span>. If we have the following system of two equations</p>
</div>
<p><span class="math display">\[
\begin{split}
\begin{align}
Y_{it} &amp; = \beta X_{it} + \gamma U_i + e_{it} \\
\bar{Y}_{i} &amp; = \beta \bar{X}_{it} + \gamma \bar{U}_i + \bar{e}_{it} \\
\end{align}
\end{split}
\]</span></p>
</section>
<section id="panel-data-and-fixed-effects-18" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-8">Fixed Effects</h4>
<div style="font-size: x-large">
<p>And we subtract one from the other, we get</p>
</div>
<p><span class="math display">\[
\begin{split}
\begin{align}
(Y_{it} - \bar{Y}_{i}) &amp; = (\beta X_{it} - \beta \bar{X}_{it}) + (\gamma U_i - \gamma U_i) + (e_{it}-\bar{e}_{it}) \\
(Y_{it} - \bar{Y}_{i}) &amp; = \beta(X_{it} - \bar{X}_{it}) + (e_{it}-\bar{e}_{it}) \\
\ddot{Y}_{it} &amp; = \beta \ddot{X}_{it} + \ddot{e}_{it} \\
\end{align}
\end{split}
\]</span></p>
<div style="font-size: x-large">
<p>which wipes out all unobserved that are constant across time. To be honest, not only do the unobserved variables vanish. This happens to all the variables that are constant in time. For this reason, you can’t include any variables that are constant across time, as they would be a linear combination of the dummy variables and the model wouldn’t run.</p>
</div>
</section>
<section id="panel-data-and-fixed-effects-19" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-9">Fixed Effects</h4>
<div style="font-size: x-large">
<p>To check which variables are those, we can group our data by individual and get the sum of the standard deviations. If it is zero, it means the variable isn’t changing across time for any of the individuals.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a></a>data_panel <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">group_by</span>(nr) <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"nr"</span>),sd)) <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-5"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"nr"</span>),sum)) <span class="sc">|&gt;</span> </span>
<span id="cb56-6"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb56-7"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>(<span class="st">'nr'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-8"><a></a>  gt<span class="sc">::</span><span class="fu">tab_options</span>( <span class="at">table.font.size =</span> gt<span class="sc">::</span><span class="fu">px</span>(<span class="dv">28</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb56-9"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="slbbflawfs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#slbbflawfs table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#slbbflawfs thead, #slbbflawfs tbody, #slbbflawfs tfoot, #slbbflawfs tr, #slbbflawfs td, #slbbflawfs th {
  border-style: none;
}

#slbbflawfs p {
  margin: 0;
  padding: 0;
}

#slbbflawfs .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#slbbflawfs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#slbbflawfs .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#slbbflawfs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#slbbflawfs .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#slbbflawfs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#slbbflawfs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#slbbflawfs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#slbbflawfs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#slbbflawfs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#slbbflawfs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#slbbflawfs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#slbbflawfs .gt_spanner_row {
  border-bottom-style: hidden;
}

#slbbflawfs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#slbbflawfs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#slbbflawfs .gt_from_md > :first-child {
  margin-top: 0;
}

#slbbflawfs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#slbbflawfs .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#slbbflawfs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#slbbflawfs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#slbbflawfs .gt_row_group_first td {
  border-top-width: 2px;
}

#slbbflawfs .gt_row_group_first th {
  border-top-width: 2px;
}

#slbbflawfs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#slbbflawfs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#slbbflawfs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#slbbflawfs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#slbbflawfs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#slbbflawfs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#slbbflawfs .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#slbbflawfs .gt_striped {
  background-color: #FAFAFA;
}

#slbbflawfs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#slbbflawfs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#slbbflawfs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#slbbflawfs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#slbbflawfs .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#slbbflawfs .gt_left {
  text-align: left;
}

#slbbflawfs .gt_center {
  text-align: center;
}

#slbbflawfs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#slbbflawfs .gt_font_normal {
  font-weight: normal;
}

#slbbflawfs .gt_font_bold {
  font-weight: bold;
}

#slbbflawfs .gt_font_italic {
  font-style: italic;
}

#slbbflawfs .gt_super {
  font-size: 65%;
}

#slbbflawfs .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#slbbflawfs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#slbbflawfs .gt_indent_1 {
  text-indent: 5px;
}

#slbbflawfs .gt_indent_2 {
  text-indent: 10px;
}

#slbbflawfs .gt_indent_3 {
  text-indent: 15px;
}

#slbbflawfs .gt_indent_4 {
  text-indent: 20px;
}

#slbbflawfs .gt_indent_5 {
  text-indent: 25px;
}

#slbbflawfs .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#slbbflawfs div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">name</th>
<th id="value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">value</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="name">year</td>
<td class="gt_row gt_right" headers="value">1335.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="name">black</td>
<td class="gt_row gt_right gt_striped" headers="value">0.0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">exper</td>
<td class="gt_row gt_right" headers="value">1335.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="name">hisp</td>
<td class="gt_row gt_right gt_striped" headers="value">0.0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">hours</td>
<td class="gt_row gt_right" headers="value">203098.2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="name">married</td>
<td class="gt_row gt_right gt_striped" headers="value">140.4</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">educ</td>
<td class="gt_row gt_right" headers="value">0.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="name">union</td>
<td class="gt_row gt_right gt_striped" headers="value">106.5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">lwage</td>
<td class="gt_row gt_right" headers="value">173.9</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="name">expersq</td>
<td class="gt_row gt_right gt_striped" headers="value">17608.2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="name">occupation</td>
<td class="gt_row gt_right" headers="value">739.2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="panel-data-and-fixed-effects-20" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-10">Fixed Effects</h4>
<div style="font-size: large">
<p>So, for our data, we need to remove ethnicity dummies, <code>black</code> and <code>hisp</code>, since they are constant for the individual. Also, we need to remove education. We will also not use occupation, since this is probably mediating the effect of marriage on wage (it could be that single men are able to take more time demanding positions). Having selected the features we will use, it’s time to estimate this model.</p>
<p>To run our fixed effect model, first, let’s get our mean data. We can achieve this by grouping everything by individuals and taking the mean.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a></a>data_panel <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">group_by</span>(nr) <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(married, expersq, union, hours, lwage) <span class="sc">|&gt;</span> </span>
<span id="cb57-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="fu">across</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"nr"</span>),mean), <span class="at">.groups=</span><span class="st">'drop'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-5"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>(<span class="st">'nr'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-6"><a></a>  gt<span class="sc">::</span><span class="fu">tab_options</span>( <span class="at">table.font.size =</span> gt<span class="sc">::</span><span class="fu">px</span>(<span class="dv">28</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb57-7"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="xttxvokuuc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#xttxvokuuc table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xttxvokuuc thead, #xttxvokuuc tbody, #xttxvokuuc tfoot, #xttxvokuuc tr, #xttxvokuuc td, #xttxvokuuc th {
  border-style: none;
}

#xttxvokuuc p {
  margin: 0;
  padding: 0;
}

#xttxvokuuc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xttxvokuuc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xttxvokuuc .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xttxvokuuc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xttxvokuuc .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xttxvokuuc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xttxvokuuc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xttxvokuuc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xttxvokuuc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xttxvokuuc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xttxvokuuc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xttxvokuuc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xttxvokuuc .gt_spanner_row {
  border-bottom-style: hidden;
}

#xttxvokuuc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xttxvokuuc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xttxvokuuc .gt_from_md > :first-child {
  margin-top: 0;
}

#xttxvokuuc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xttxvokuuc .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xttxvokuuc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xttxvokuuc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xttxvokuuc .gt_row_group_first td {
  border-top-width: 2px;
}

#xttxvokuuc .gt_row_group_first th {
  border-top-width: 2px;
}

#xttxvokuuc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xttxvokuuc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xttxvokuuc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xttxvokuuc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xttxvokuuc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xttxvokuuc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xttxvokuuc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xttxvokuuc .gt_striped {
  background-color: #FAFAFA;
}

#xttxvokuuc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xttxvokuuc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xttxvokuuc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xttxvokuuc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xttxvokuuc .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xttxvokuuc .gt_left {
  text-align: left;
}

#xttxvokuuc .gt_center {
  text-align: center;
}

#xttxvokuuc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xttxvokuuc .gt_font_normal {
  font-weight: normal;
}

#xttxvokuuc .gt_font_bold {
  font-weight: bold;
}

#xttxvokuuc .gt_font_italic {
  font-style: italic;
}

#xttxvokuuc .gt_super {
  font-size: 65%;
}

#xttxvokuuc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xttxvokuuc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xttxvokuuc .gt_indent_1 {
  text-indent: 5px;
}

#xttxvokuuc .gt_indent_2 {
  text-indent: 10px;
}

#xttxvokuuc .gt_indent_3 {
  text-indent: 15px;
}

#xttxvokuuc .gt_indent_4 {
  text-indent: 20px;
}

#xttxvokuuc .gt_indent_5 {
  text-indent: 25px;
}

#xttxvokuuc .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#xttxvokuuc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">married</th>
<th id="expersq" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">expersq</th>
<th id="union" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">union</th>
<th id="hours" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">hours</th>
<th id="lwage" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">lwage</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">13</td>
<td class="gt_row gt_right" headers="stub_1_1 married">0.000</td>
<td class="gt_row gt_right" headers="stub_1_1 expersq">25.5</td>
<td class="gt_row gt_right" headers="stub_1_1 union">0.125</td>
<td class="gt_row gt_right" headers="stub_1_1 hours">2808</td>
<td class="gt_row gt_right" headers="stub_1_1 lwage">1.256</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">17</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 married">0.000</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 expersq">61.5</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 union">0.000</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 hours">2504</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 lwage">1.638</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">18</td>
<td class="gt_row gt_right" headers="stub_1_3 married">1.000</td>
<td class="gt_row gt_right" headers="stub_1_3 expersq">61.5</td>
<td class="gt_row gt_right" headers="stub_1_3 union">0.000</td>
<td class="gt_row gt_right" headers="stub_1_3 hours">2350</td>
<td class="gt_row gt_right" headers="stub_1_3 lwage">2.034</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">45</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 married">0.125</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 expersq">35.5</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 union">0.250</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 hours">2226</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 lwage">1.774</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">110</td>
<td class="gt_row gt_right" headers="stub_1_5 married">0.500</td>
<td class="gt_row gt_right" headers="stub_1_5 expersq">77.5</td>
<td class="gt_row gt_right" headers="stub_1_5 union">0.125</td>
<td class="gt_row gt_right" headers="stub_1_5 hours">2108</td>
<td class="gt_row gt_right" headers="stub_1_5 lwage">2.055</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="panel-data-and-fixed-effects-21" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-11">Fixed Effects</h4>
<div style="font-size: x-large">
<p>To demean the data, we need to set the index of the original data to be the individual identifier, <code>nr</code>. Then, we can simply subtract one data frame from the mean data frame.</p>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="wwakolrqbh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#wwakolrqbh table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wwakolrqbh thead, #wwakolrqbh tbody, #wwakolrqbh tfoot, #wwakolrqbh tr, #wwakolrqbh td, #wwakolrqbh th {
  border-style: none;
}

#wwakolrqbh p {
  margin: 0;
  padding: 0;
}

#wwakolrqbh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wwakolrqbh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wwakolrqbh .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wwakolrqbh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wwakolrqbh .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wwakolrqbh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wwakolrqbh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wwakolrqbh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wwakolrqbh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wwakolrqbh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wwakolrqbh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wwakolrqbh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wwakolrqbh .gt_spanner_row {
  border-bottom-style: hidden;
}

#wwakolrqbh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wwakolrqbh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wwakolrqbh .gt_from_md > :first-child {
  margin-top: 0;
}

#wwakolrqbh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wwakolrqbh .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wwakolrqbh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wwakolrqbh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wwakolrqbh .gt_row_group_first td {
  border-top-width: 2px;
}

#wwakolrqbh .gt_row_group_first th {
  border-top-width: 2px;
}

#wwakolrqbh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wwakolrqbh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wwakolrqbh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wwakolrqbh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wwakolrqbh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wwakolrqbh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wwakolrqbh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wwakolrqbh .gt_striped {
  background-color: #FAFAFA;
}

#wwakolrqbh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wwakolrqbh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wwakolrqbh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wwakolrqbh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wwakolrqbh .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wwakolrqbh .gt_left {
  text-align: left;
}

#wwakolrqbh .gt_center {
  text-align: center;
}

#wwakolrqbh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wwakolrqbh .gt_font_normal {
  font-weight: normal;
}

#wwakolrqbh .gt_font_bold {
  font-weight: bold;
}

#wwakolrqbh .gt_font_italic {
  font-style: italic;
}

#wwakolrqbh .gt_super {
  font-size: 65%;
}

#wwakolrqbh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wwakolrqbh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wwakolrqbh .gt_indent_1 {
  text-indent: 5px;
}

#wwakolrqbh .gt_indent_2 {
  text-indent: 10px;
}

#wwakolrqbh .gt_indent_3 {
  text-indent: 15px;
}

#wwakolrqbh .gt_indent_4 {
  text-indent: 20px;
}

#wwakolrqbh .gt_indent_5 {
  text-indent: 25px;
}

#wwakolrqbh .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wwakolrqbh div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">married</th>
<th id="expersq" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">expersq</th>
<th id="union" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">union</th>
<th id="hours" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">hours</th>
<th id="lwage" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">lwage</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">13</td>
<td class="gt_row gt_right" headers="stub_1_1 married">0</td>
<td class="gt_row gt_right" headers="stub_1_1 expersq">-24.5</td>
<td class="gt_row gt_right" headers="stub_1_1 union">-0.125</td>
<td class="gt_row gt_right" headers="stub_1_1 hours">-135.6</td>
<td class="gt_row gt_right" headers="stub_1_1 lwage">-0.05811</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">13</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 married">0</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 expersq">-21.5</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 union">0.875</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 hours">-487.6</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 lwage">0.59741</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">13</td>
<td class="gt_row gt_right" headers="stub_1_3 married">0</td>
<td class="gt_row gt_right" headers="stub_1_3 expersq">-16.5</td>
<td class="gt_row gt_right" headers="stub_1_3 union">-0.125</td>
<td class="gt_row gt_right" headers="stub_1_3 hours">132.4</td>
<td class="gt_row gt_right" headers="stub_1_3 lwage">0.08881</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">13</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 married">0</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 expersq">-9.5</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 union">-0.125</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 hours">152.4</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 lwage">0.17756</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_right gt_stub" data-quarto-table-cell-role="th" scope="row">13</td>
<td class="gt_row gt_right" headers="stub_1_5 married">0</td>
<td class="gt_row gt_right" headers="stub_1_5 expersq">-0.5</td>
<td class="gt_row gt_right" headers="stub_1_5 union">-0.125</td>
<td class="gt_row gt_right" headers="stub_1_5 hours">263.4</td>
<td class="gt_row gt_right" headers="stub_1_5 lwage">0.31247</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="panel-data-and-fixed-effects-22" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-12">Fixed Effects</h4>
<div style="font-size: x-large">
<p>Finally, we can run our fixed effect model on the time-demeaned data.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a></a><span class="fu">lm</span>(lwage <span class="sc">~</span> married <span class="sc">+</span> expersq <span class="sc">+</span> union <span class="sc">+</span> hours, <span class="at">data =</span> data_panel_baked) <span class="sc">|&gt;</span> </span>
<span id="cb58-2"><a></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  term         estimate std.error statistic   p.value
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept) -4.71e-17 0.00507   -9.28e-15 1.00e+  0
2 married      1.15e- 1 0.0170     6.76e+ 0 1.61e- 11
3 expersq      3.95e- 3 0.000180   2.20e+ 1 1.92e-101
4 union        7.84e- 2 0.0184     4.26e+ 0 2.08e-  5
5 hours       -8.46e- 5 0.0000125 -6.74e+ 0 1.74e- 11</code></pre>
</div>
</div>
</section>
<section id="panel-data-and-fixed-effects-23" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-13">Fixed Effects</h4>
<div style="font-size: large">
<p>If we believe that fixed effect eliminates the all omitted variable bias, this model is telling us that marriage increases a man’s wage by 11%. This result is very significant. One detail here is that for fixed effect models, the standard errors need to be clustered. So, instead of doing all our estimation by hand (which is only nice for pedagogical reasons), we can use the library <code>linearmodels</code> and set the argument <code>cluster_entity</code> to True.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a></a><span class="co"># see https://www.r-bloggers.com/2021/05/clustered-standard-errors-with-r/</span></span>
<span id="cb60-2"><a></a>estimatr<span class="sc">::</span><span class="fu">lm_robust</span>(</span>
<span id="cb60-3"><a></a>  lwage <span class="sc">~</span> expersq<span class="sc">+</span>union<span class="sc">+</span>married<span class="sc">+</span>hours </span>
<span id="cb60-4"><a></a>  , <span class="at">data =</span> data_panel_baked</span>
<span id="cb60-5"><a></a>  , <span class="at">fixed_effects =</span> <span class="sc">~</span>nr ) <span class="sc">|&gt;</span> broom<span class="sc">::</span><span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     term   estimate std.error statistic   p.value
1 expersq  0.0039509 1.861e-04    21.232 1.208e-94
2   union  0.0784442 1.991e-02     3.940 8.287e-05
3 married  0.1146543 1.825e-02     6.281 3.739e-10
4   hours -0.0000846 1.842e-05    -4.593 4.512e-06
    conf.low  conf.high   df outcome
1  0.0035861  4.316e-03 3811   lwage
2  0.0394117  1.175e-01 3811   lwage
3  0.0788661  1.504e-01 3811   lwage
4 -0.0001207 -4.849e-05 3811   lwage</code></pre>
</div>
</div>
</section>
<section id="panel-data-and-fixed-effects-24" class="slide level2">
<h2>Panel Data and Fixed Effects</h2>
<h4 id="fixed-effects-14">Fixed Effects</h4>
<div style="font-size: large">
<p>Notice how the parameter estimates are identical to the ones we’ve got with time-demeaned data. The only difference is that the standard errors are a bit larger. Compare this to the simple OLS model that doesn’t take the time structure of the data into account. For this model, we add back the variables that are constant in time.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  term          estimate std.error statistic   p.value
  &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)  0.265     0.0647        4.10  4.16e-  5
2 expersq      0.00324   0.000206     15.7   2.14e- 54
3 union        0.183     0.0173       10.6   6.27e- 26
4 married      0.141     0.0158        8.93  6.11e- 19
5 hours       -0.0000532 0.0000134    -3.98  7.05e-  5
6 black       -0.135     0.0237       -5.68  1.44e-  8
7 hisp         0.0132    0.0210        0.632 5.28e-  1
8 educ         0.106     0.00469      22.6   1.38e-106</code></pre>
</div>
</div>
<p>This model is saying that marriage increases the man’s wage by 14%. A somewhat larger effect than the one we found with the fixed effect model. This suggests some omitted variable bias due to fixed individual factors, like intelligence and beauty, not being added to the model.</p>
</div>
</section>
<section id="more" class="slide level2">
<h2>More</h2>
<ul>
<li>Read <a href="https://chabefer.github.io/STCI/index.html">Statistical tools for causal inference</a></li>
<li>Read <a href="https://www.r-causal.org/">Causal inference in R</a></li>
<li>Read Scott Cunningham: <a href="https://mixtape.scunning.com/">Causal Inference The Mixtape</a></li>
<li>Take a course from Scott Cunningham: <a href="https://www.mixtapesessions.io/sessions/">Mixtape Sessions</a></li>
<li>Read <a href="https://causality.cs.ucla.edu/blog/index.php/category/bad-control/">A Crash Course in Good and Bad Control</a></li>
<li>Read <a href="https://arxiv.org/ftp/arxiv/papers/2207/2207.01722.pdf">A Causal Approach for Business Optimization</a></li>
</ul>
</section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<p>We looked in some detail at other methods used to estimate causal effects, along with methods used for special situations, including:</p>
<ul>
<li>regression adjustment</li>
<li>doubly robust estimation</li>
<li>matching</li>
<li>difference in differences</li>
<li>fixed effects and methods for panel data</li>
</ul>


</section></section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="images/logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://bsmm-8740-fall-2024.github.io/osb/">bsmm-8740-fall-2024.github.io/osb</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true,"numbers":true},
'chalkboard': {"buttons":true},
'multiplex': {"secret":null,"id":"1019794033bce944","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 5.0e-2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/bsmm-8740-fall-2024\.github\.io\/osb\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>