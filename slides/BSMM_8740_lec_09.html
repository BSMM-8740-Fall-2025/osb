<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.31">

  <meta name="author" content="L.L. Odette">
  <title>BSMM-8740 - Fall 2025 – Monte Carlo Methods</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-156995b38130bdaa56919fb0a5db863b.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<meta property="og:title" content="Monte Carlo Methods – BSMM-8740 - Fall 2025">
<meta property="og:description" content="BSMM8740-2-R-2024F [WEEK - 9]">
<meta property="og:site_name" content="BSMM-8740 - Fall 2025">
<meta name="twitter:title" content="Monte Carlo Methods – BSMM-8740 - Fall 2025">
<meta name="twitter:description" content="BSMM8740-2-R-2024F [WEEK - 9]">
<meta name="twitter:image" content="https://bsmm-8740-fall-2025.github.io/osb/slides/images/twitter-card.png">
<meta name="twitter:creator" content="@lodette">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Monte Carlo Methods</h1>
  <p class="subtitle">BSMM8740-2-R-2024F [WEEK - 9]</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
L.L. Odette 
</div>
</div>
</div>

</section>
<section id="recap-of-last-week" class="slide level2">
<h2>Recap of last week</h2>
<ul>
<li>Last week we looked at causal effect estimation methods in greater depth, including
<ul>
<li>inverse probaiity weighting</li>
<li>regression adjustment</li>
<li>doubly robust estimation</li>
<li>matching estimation</li>
<li>Difference in Differences (DiD)</li>
<li>Panel Data and fixed effects (FE)</li>
</ul></li>
</ul>
</section>
<section id="this-week" class="slide level2">
<h2>This week</h2>
<ul>
<li>We will explore Monte Carlo methods as a way to integrate difficult functions, and to sample from difficult probability distributions.</li>
<li>Along the way we will look at Markov Chains, which can both underlie sampling methods and provide a way to model the generation of data.</li>
<li>Finally, we look at Markov Chain Monte Carlo (MCMC) methods to sample from probability distributions.</li>
</ul>
</section>
<section>
<section id="monte-carlo-mc-methods" class="title-slide slide level1 center">
<h1>Monte Carlo (MC) Methods</h1>

</section>
<section id="monte-carlo-mc-methods-1" class="slide level2">
<h2>Monte Carlo (MC) Methods</h2>
<p>Monte Carlo methods are a class of <em>simulation-based</em> methods that seek to avoid complicated and/or intractable mathematical computations.</p>
<p>Especially those that arise from probability distributions.</p>
<p>First we consider how ‘random numbers’ are computer generated.</p>
</section>
<section id="random-number-generation" class="slide level2">
<h2>Random Number Generation</h2>
<div style="font-size: x-large">
<p>Random numbers from a given distribution are drawn using random numbers from a (<span class="math inline">\([0,1]\)</span>) uniform distribution, using the <strong>inverse transform sampling method</strong> as follows:</p>
<ol type="1">
<li><p><strong>Uniform Distribution</strong>: Start by drawing a random number (<span class="math inline">\(U\)</span>) from a (<span class="math inline">\([0,1]\)</span>) uniform distribution. This gives us a random variable that is uniformly distributed between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>.</p></li>
<li><p><strong>Cumulative Distribution Function (CDF)</strong>: Every probability distribution has a CDF (<span class="math inline">\(F_X(x)\)</span>), which gives the probability that a random variable (<span class="math inline">\(X\)</span>) is less than or equal to (<span class="math inline">\(x\)</span>).</p></li>
<li><p><strong>Inverse CDF</strong>: The key idea is that if (<span class="math inline">\(U\)</span>) is uniformly distributed in (<span class="math inline">\([0,1]\)</span>), then (<span class="math inline">\(F_X^{-1}(U)\)</span>) (the inverse of the CDF) will give us a random sample from the distribution of (<span class="math inline">\(X\)</span>).</p></li>
</ol>
</div>
</section>
<section id="random-number-generation-1" class="slide level2">
<h2>Random Number Generation</h2>
<div style="font-size: x-large">
<p><strong>Process</strong>:</p>
<ul>
<li>Draw a random number (<span class="math inline">\(U\)</span>) from the uniform (<span class="math inline">\([0,1]\)</span>) distribution.</li>
<li>Use the inverse CDF of the desired distribution: (<span class="math inline">\(X = F_X^{-1}(U)\)</span>).</li>
<li>The result (X) is a random number that follows the target distribution.</li>
</ul>
<p><strong>Example</strong>: For an exponential distribution with rate parameter (<span class="math inline">\(\lambda\)</span>), the CDF is<span class="math inline">\(F_X(x) = 1 - e^{-\lambda x}\)</span>. To generate a random draw from this distribution: Draw <span class="math inline">\(U \sim \mathcal{U}(0,1)\)</span>, then use the inverse of the CDF: (<span class="math inline">\(X = -\frac{1}{\lambda} \ln(1 - U)\)</span>), to get an exponentially distributed random variable.</p>
<p>This method applies broadly to any distribution where you can compute or approximate the inverse CDF.</p>
</div>
</section>
<section id="random-number-generation-2" class="slide level2">
<h2>Random Number Generation</h2>
<p>Pseudo-random generators found in computers use a deterministic (i.e.&nbsp;repeatable) algorithm to generate a sequence of (apparently) random numbers on the <span class="math inline">\((0, 1)\)</span> interval.</p>
<p>What defines a good random number generator (RNG) is a long period – how long it takes before the sequence repeats itself. A period of <span class="math inline">\(2^{32}\)</span> is not enough (need at least <span class="math inline">\(2^{40}\)</span>). Various statistical tests exist to measure “randomness” – well validated software will have gone through these checks.</p>
</section>
<section id="random-number-generation-3" class="slide level2">
<h2>Random Number Generation</h2>
<p>Alternatives to inverse transform sampling are special algorithms that generate random samples from particular distributions, e.g.&nbsp;one way to sample from a Gaussian random number generation uses the Box-Muller method:</p>
<ul>
<li>generate two independent uniform <span class="math inline">\([0, 1]\)</span> random variables, and</li>
<li>use some trigonometry.</li>
</ul>
<p><u><strong>Very important</strong></u>: never write your own generator, always use a well validated generator from a reputable source (e.g.&nbsp;R).</p>
</section>
<section id="random-number-generation-4" class="slide level2">
<h2>Random Number Generation</h2>
<p>Recall that <span class="math inline">\(\mathscr{N}(0, 1)\)</span> Normal random variables (mean 0, variance 1) have the probability density function:</p>
<p><span class="math display">\[
p(x)=\frac{1}{2\pi}e^{-\frac{1}{2}x^2}\equiv\phi(x)
\]</span> and if <span class="math inline">\(X\sim\mathscr{N}(0, 1)\)</span> then its CDF is:</p>
<p><span class="math display">\[
\mathbb{P}[X\le x] = \int_{-\infty}^x\phi(x)dx
\]</span></p>
</section>
<section id="random-number-generation-5" class="slide level2">
<h2>Random Number Generation</h2>
<p>The Box-Muller transformation method takes two independent uniform <span class="math inline">\((0, 1)\)</span> random numbers <span class="math inline">\(y_1\)</span>, <span class="math inline">\(y_2\)</span>, and defines:</p>
<p><span class="math display">\[
\begin{align*}
x_{1} &amp; =\sqrt{-2\log y_{1}}\cos(2\pi y_{2})\\
x_2&amp; =\sqrt{-2\log y_{1}}\sin(2\pi y_{2})
\end{align*}
\]</span></p>
<p>It can be proved that <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> are independent <span class="math inline">\(\mathscr{N}(0, 1)\)</span> random variables</p>
</section>
<section id="random-number-generation-6" class="slide level2">
<h2>Random Number Generation</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="co"># The Box-Muller transformation</span></span>
<span id="cb1-2"><a></a>samples <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">10000</span>), <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-3"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb1-4"><a></a>    <span class="at">normals =</span> </span>
<span id="cb1-5"><a></a>      purrr<span class="sc">::</span><span class="fu">map2</span>(</span>
<span id="cb1-6"><a></a>        X1, X2</span>
<span id="cb1-7"><a></a>        ,(\(x1,x2){</span>
<span id="cb1-8"><a></a>          <span class="fu">data.frame</span>(</span>
<span id="cb1-9"><a></a>            <span class="at">y1 =</span> <span class="fu">sqrt</span>( <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(x1) ) <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> x2)</span>
<span id="cb1-10"><a></a>            , <span class="at">y2 =</span> <span class="fu">sqrt</span>( <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(x1) ) <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> x2) </span>
<span id="cb1-11"><a></a>          )</span>
<span id="cb1-12"><a></a>        })</span>
<span id="cb1-13"><a></a>      )</span>
<span id="cb1-14"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb1-15"><a></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(normals)  </span>
<span id="cb1-16"><a></a>  </span>
<span id="cb1-17"><a></a></span>
<span id="cb1-18"><a></a>p0 <span class="ot">&lt;-</span> samples <span class="sc">|&gt;</span> </span>
<span id="cb1-19"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(X1,X2)) <span class="sc">|&gt;</span> </span>
<span id="cb1-20"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>value, <span class="at">color=</span>name, <span class="at">fill=</span>name)) <span class="sc">+</span> </span>
<span id="cb1-21"><a></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1-22"><a></a>    <span class="fu">aes</span>(<span class="at">y=</span>..density..), <span class="at">bins =</span> <span class="dv">60</span>, <span class="at">position=</span><span class="st">"identity"</span>, <span class="at">alpha=</span><span class="fl">0.3</span></span>
<span id="cb1-23"><a></a>  ) <span class="sc">+</span> </span>
<span id="cb1-24"><a></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Value"</span>, <span class="at">y=</span><span class="st">"Density"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb1-25"><a></a></span>
<span id="cb1-26"><a></a>p1 <span class="ot">&lt;-</span> samples <span class="sc">|&gt;</span> </span>
<span id="cb1-27"><a></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>y1, <span class="at">y=</span>y2)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb1-28"><a></a></span>
<span id="cb1-29"><a></a>p0<span class="sc">+</span>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..density..`) was deprecated in
ggplot2 3.4.0.
ℹ Please use `after_stat(density)` instead.</code></pre>
</div>

</div>
<img data-src="BSMM_8740_lec_09_files/figure-html/unnamed-chunk-2-1.png" width="672" class="r-stretch quarto-figure-center"><p class="caption">Normal y1 vs Normal y2; independent random RVs</p></section>
<section id="random-number-generation-7" class="slide level2">
<h2>Random Number Generation</h2>
<div style="font-size: x-large">
<p>Your computer is only capable of producing pseudorandom numbers. These are made by running a pseudorandom number generator algorithm which is deterministic, e.g.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="fu">set.seed</span>(<span class="dv">340</span>)</span>
<span id="cb3-2"><a></a><span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.1574 -1.1989 -0.8892  1.0091  0.6130  1.0072
 [7]  0.4144 -1.8579 -1.3487  0.5189</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="fu">set.seed</span>(<span class="dv">340</span>)</span>
<span id="cb5-2"><a></a><span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.1574 -1.1989 -0.8892  1.0091  0.6130  1.0072
 [7]  0.4144 -1.8579 -1.3487  0.5189</code></pre>
</div>
</div>
<p>Once the RNG seed is set, the “random” numbers that R generates aren’t random at all. But someone looking at these random numbers would have a very hard time distinguishing these numbers from truly random numbers.</p>
</div>
</section>
<section id="mc-methods" class="slide level2">
<h2>MC Methods</h2>
<p>We can use MC methods to estimate probabilities: for a random variable <span class="math inline">\(Z\)</span> with outcomes in a set <span class="math inline">\(\Omega\)</span>, given a subset <span class="math inline">\(S\subset\Omega\)</span> and defining an event <span class="math inline">\(E\equiv Z\in S\)</span>, we can compute the probability of <span class="math inline">\(E\)</span> (i.e.&nbsp;<span class="math inline">\(\mathbb{P}(E)\)</span>) with of samples of <span class="math inline">\(Z\)</span>, say <span class="math inline">\(z_1,z_2,\ldots,z_M\)</span> as</p>
<p><span class="math display">\[
\mathbb{P}(E) = \frac{1}{M}\sum_{i=1}^M 1_{z_i\in S}
\]</span></p>
</section>
<section id="mc-methods-1" class="slide level2">
<h2>MC Methods</h2>
<h4 id="example">Example</h4>
<p>If <span class="math inline">\(Z\sim\mathscr{N}(1,3)\)</span> and <span class="math inline">\(S=Z:0\le Z\le 3\)</span> then</p>
<p><span class="math display">\[
\mathbb{P}(E) = \mathbb{P}(0\le Z\le 3) = \int_0^3\frac{1}{\sqrt{2\pi3}}e^{-\frac{(t-1)^2}{2*3}}dt
\]</span> In which case it is easier to just use R and calculate:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="fu">pnorm</span>(<span class="dv">3</span>, <span class="at">mean=</span><span class="dv">1</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="dv">3</span>)) <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="dv">0</span>, <span class="at">mean=</span><span class="dv">1</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.594</code></pre>
</div>
</div>
<p>than it is to compute the integral.</p>
</section>
<section id="mc-methods-2" class="slide level2">
<h2>MC Methods</h2>
<h4 id="example-continued">Example continued</h4>
<p>In case we don’t know that <code>pnorm</code> exists, we could do this:</p>
<div class="cell">
<details class="code-fold">
<summary>MC computation</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="co"># define the event</span></span>
<span id="cb9-2"><a></a>event_E_happened <span class="ot">&lt;-</span> <span class="cf">function</span>( x ) {</span>
<span id="cb9-3"><a></a>  <span class="cf">if</span>( <span class="dv">0</span> <span class="sc">&lt;=</span> x <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">3</span> ) {</span>
<span id="cb9-4"><a></a>    <span class="fu">return</span>( <span class="cn">TRUE</span> ) <span class="co"># The event happened</span></span>
<span id="cb9-5"><a></a>  } <span class="cf">else</span> {</span>
<span id="cb9-6"><a></a>    <span class="fu">return</span>( <span class="cn">FALSE</span> ) <span class="co"># The event DIDN'T happen</span></span>
<span id="cb9-7"><a></a>  }</span>
<span id="cb9-8"><a></a>}</span>
<span id="cb9-9"><a></a><span class="fu">set.seed</span>(<span class="dv">8740</span>)</span>
<span id="cb9-10"><a></a><span class="co"># generate lots of copies of Z...</span></span>
<span id="cb9-11"><a></a>NMC <span class="ot">&lt;-</span> <span class="dv">10000</span>; <span class="co"># 10000 seems like "a lot".</span></span>
<span id="cb9-12"><a></a><span class="fu">rnorm</span>( NMC, <span class="at">mean=</span><span class="dv">1</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="dv">3</span>) ) <span class="sc">|&gt;</span> </span>
<span id="cb9-13"><a></a>  purrr<span class="sc">::</span><span class="fu">map_lgl</span>(event_E_happened) <span class="sc">|&gt;</span> </span>
<span id="cb9-14"><a></a>  <span class="fu">sum</span>()<span class="sc">/</span>NMC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5941</code></pre>
</div>
</div>
</section>
<section id="mc-methods-3" class="slide level2">
<h2>MC Methods</h2>
<p>Given event <span class="math inline">\(E\equiv Z\in S\)</span>,</p>
<div style="font-size: x-large">
<p><span class="math display">\[
\mathbb{P}(E) = \frac{1}{M}\sum_{i=1}^M 1_{z_i\in S}
\]</span></p>
</div>
<p>is the MC estimate of <span class="math inline">\(\mathbb{E}[E]\)</span>, which is unbiased because for each <span class="math inline">\(i\)</span>, <span class="math inline">\(\mathbb{E}[1_{z_i\in S}]=\mathbb{E}[E]\)</span>, and the variance is</p>
<div style="font-size: x-large">
<p><span class="math display">\[
\begin{align*}
\mathrm{Var}\left({\mathbb{P}(E)}\right) &amp; =\frac{1}{M^{2}}\mathrm{Var}\left(\sum_{i=1}^{M}1_{z_{i}\in S}\right)\\
&amp; =\frac{1}{M^{2}}\sum_{i=1}^{M}\mathrm{Var}\left(1_{z_{i}\in S}\right)=\frac{1}{M}\mathrm{Var}\left(1_{z_{i}\in S}\right)
\end{align*}
\]</span></p>
</div>
</section>
<section id="mc-methods-4" class="slide level2">
<h2>MC Methods</h2>
<p>This is true for any function of the random variable <span class="math inline">\(Z\)</span>, and</p>
<p><span class="math display">\[
\mathbb{E}\left[h(Z)\right]\approx \hat{h}=\frac{1}{M}\sum_{i=1}^M h(z_i)
\]</span></p>
<p>and the variance of <span class="math inline">\(h(Z)\)</span> decreases as <span class="math inline">\(1/M\)</span> by the same reasoning.</p>
</section>
<section id="moments-and-the-mgf" class="slide level2">
<h2>Moments and the MGF</h2>
<div style="font-size: x-large">
<p>The <span class="math inline">\(k\)</span>-th moment of a random variable <span class="math inline">\(X\)</span> is the expected value of: <span class="math inline">\(X\)</span> raised to the <span class="math inline">\(k\)</span>-th power.</p>
<p><span class="math display">\[
\acute{\mu}_k(X)=\mathbb{E}[X^k]
\]</span> which is known as the <span class="math inline">\(k\)</span>-th raw moment.</p>
<p>The <span class="math inline">\(k\)</span>-th moment of a random variable <span class="math inline">\(X\)</span> around some value <span class="math inline">\(c\)</span> is known as the <span class="math inline">\(k\)</span>-th central moment of <span class="math inline">\(X\)</span>. It is the <span class="math inline">\(k\)</span>-th raw moment of <span class="math inline">\(X-c\)</span>.</p>
<p><span class="math display">\[
\mu_k(X)=\mathbb{E}[(X-c)^k]
\]</span></p>
<p>The <span class="math inline">\(k\)</span>-th standardized moment of a random variable <span class="math inline">\(X\)</span> is the <span class="math inline">\(k\)</span>-th central moment of <span class="math inline">\(X\)</span> divided by the <span class="math inline">\(k\)</span>-th power of the standard deviation of <span class="math inline">\(X\)</span>.</p>
</div>
</section>
<section id="moments-and-the-mgf-1" class="slide level2">
<h2>Moments and the MGF</h2>
<p>The Taylor series expansion of <span class="math inline">\(e^{tX}\)</span> is</p>
<p><span class="math display">\[
e^{tX} = \sum_{k=0}^\infty\frac{(tX)^k}{k!}=1+\frac{t}{1!}X+\frac{t^2}{2!}X^2+\cdots
\]</span></p>
<p>The Moment Generating Function (MGF) is <span class="math inline">\(\mathbb{E}[e^{tX}]\)</span></p>
<p><span class="math display">\[
\begin{align*}
M_X(t)=\mathbb{E}[e^{tX}] &amp; =\sum_{k=0}^{\infty}\mathbb{E}\left[\frac{(tX)^{k}}{k!}\right]\\
&amp; =1+\frac{t}{1!}\mathbb{E}\left[X\right]+\frac{t^{2}}{2!}\mathbb{E}\left[X^{2}\right]+\cdots
\end{align*}
\]</span></p>
</section>
<section id="moments-and-the-mgf-2" class="slide level2">
<h2>Moments and the MGF</h2>
<p>Note that the derivatives evaluated at <span class="math inline">\(t=0\)</span> give the corresponding moments</p>
<p><span class="math display">\[
\begin{align*}
\left.\frac{d^{2}}{dt^{2}}M_{X}(t)\right|_{t=0} &amp; =\mathbb{E}\left[X^{2}\right]\\
\left.\frac{d^{3}}{dt^{3}}M_{X}(t)\right|_{t=0} &amp; =\mathbb{E}\left[X^{3}\right]
\end{align*}
\]</span></p>
<p>and so <span class="math inline">\(\left.\frac{d^{n}}{dt^{n}}M_{X}(t)\right|_{t=0}=\mathbb{E}\left[X^{n}\right]\)</span></p>
</section>
<section id="moments-and-the-mgf-3" class="slide level2">
<h2>Moments and the MGF</h2>
<h4 id="key-facts-needed-for-the-clt">Key facts needed for the CLT</h4>
<div style="font-size: x-large">
<p>The exponential function can be defined by the limit<sup>1</sup>:</p>
<p><span class="math display">\[
e^x=\lim_{n\rightarrow\infty}\left(1+\frac{x}{n}\right)^n
\]</span></p>
<p>A Taylor series around point <span class="math inline">\(a\)</span> can be defined as<sup>2</sup>:</p>
<p><span class="math display">\[
f(x)=\sum_{n=0}^k\frac{f^{(n)}(a)}{n!}(x-a)^n+h_k(x)(x-a)^k
\]</span></p>
<p>where <span class="math inline">\(\lim_{n\rightarrow\infty..}\frac{h_k(x)}{(x-a)^k}=0\)</span></p>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p><a href="https://en.wikipedia.org/wiki/Characterizations_of_the_exponential_function">reference</a></p></li><li id="fn2"><p>see <a href="https://en.wikipedia.org/wiki/Taylor%27s_theorem">here</a></p></li></ol></aside></section>
<section id="moments-and-the-mgf-4" class="slide level2">
<h2>Moments and the MGF</h2>
<h4 id="other-properties-of-the-mgf">Other properties of the MGF</h4>
<ul>
<li>if <span class="math inline">\(Y=\beta_0+\beta_1X\)</span> then</li>
</ul>
<p><span class="math display">\[
M_Y(t)=\mathbb{E}[e^{t(\beta_0+\beta_1X)}]=e^{\beta_0t}M_X(\beta_1t)
\]</span></p>
</section>
<section id="moments-and-the-mgf-5" class="slide level2">
<h2>Moments and the MGF</h2>
<h4 id="other-properties-of-the-mgf-1">Other properties of the MGF</h4>
<ul>
<li>if <span class="math inline">\(Y=X_1+X_2+\cdots X_n\)</span> then <span class="math inline">\(M_Y(t)=\mathbb{E}[e^{t(X_1+X_2+\cdots X_n)}]\)</span> and:</li>
</ul>
<p><span class="math display">\[
M_Y(t) = \prod_{i=1}^n M_{X_i}(t)
\]</span></p>
<p>if the <span class="math inline">\(X\)</span> are independent, and if the <span class="math inline">\(X\)</span> are IID:</p>
<p><span class="math display">\[
M_Y(t) = \left(M_{X}(t)\right)^n
\]</span></p>
</section>
<section id="moments-and-the-mgf-6" class="slide level2">
<h2>Moments and the MGF</h2>
<h4 id="other-properties-of-the-mgf3">Other properties of the MGF<sup>1</sup></h4>
<p>if <span class="math inline">\(Y=\mathscr{N}(0,1)\)</span> then starting with the Taylor series expansion of <span class="math inline">\(e^{t^2/2}\)</span>:</p>
<p><span class="math display">\[
\begin{align*}
e^{t^{2}/2} &amp; =1+\frac{1}{2}t^{2}+\frac{1}{2^{2}}\frac{t^{4}}{2!}+\frac{1}{2^{3}}\frac{t^{6}}{3!}+\cdots\\
\left.\frac{d^{n}}{dt^{n}}M_{Y}(t)\right|_{t=0} &amp; =\mathbb{E}\left[Y^{n}\right]=\begin{cases}
0 &amp; n\,\mathrm{\mathrm{odd}}\\
2^{-n/2}\frac{n!}{(n/2)!} &amp; n\,\mathrm{even}
\end{cases}\\
M_{Y}(t) &amp; =e^{t^{2}/2}
\end{align*}
\]</span></p>
<aside><ol class="aside-footnotes"><li id="fn3"><p>see <a href="http://www.srabbani.com/moments.pdf">here</a> for a derivation of the moments of the standard Normal pdf.</p></li></ol></aside></section>
<section id="central-limit-theorem" class="slide level2">
<h2>Central Limit Theorem</h2>
<div style="font-size: xx-large">
<p>Let <span class="math inline">\(X_1+X_2+\cdots X_n\)</span> be IID with mean <span class="math inline">\(\bar{X}_n=n^{-1}\sum_{i=1}^nX_i\)</span> and standardized mean <span class="math inline">\(\bar{Z}_n=(\bar{X}_n-\mu)/(\sigma/\sqrt{n})\)</span></p>
<p><span class="math display">\[
\begin{align*}
\bar{Z}_{n} &amp; =\frac{\bar{X}_{n}-\mu}{\sigma/\sqrt{n}}=\frac{\sqrt{n}}{\sigma}\left[\frac{X_{1}+X_{2}+\cdots X_{n}}{n}-\mu\right]\\
&amp; =\frac{\sqrt{n}}{\sigma}\left[\frac{X_{1}+X_{2}+\cdots X_{n}-n\mu}{n}\right]\\
&amp; =\sqrt{n}\left[\frac{\frac{X_{1}-\mu}{\sigma}+\frac{X_{2}-\mu}{\sigma}+\cdots\frac{X_{n}-\mu}{\sigma}}{n}\right]=\frac{1}{\sqrt{n}}\sum_{i=1}^{n}Z_{i}
\end{align*}
\]</span></p>
</div>
</section>
<section id="central-limit-theorem-1" class="slide level2">
<h2>Central Limit Theorem</h2>
<p><span class="math display">\[
\begin{align*}
M_{\bar{Z}_{n}}(t) &amp; =\left(M_{Z/\sqrt{n}}(t)\right)^{n}=\left(M_{Z}(t/\sqrt{n})\right)^{n}\\
M_{Z}(t/\sqrt{n}) &amp; =1+0+\frac{\left(t/\sqrt{n}\right)^{2}}{2!}+\sum_{k=3}^{\infty}M_{Z}^{(k)}(0)\frac{\left(t/\sqrt{n}\right)^{k}}{k!}
\end{align*}
\]</span> Now <span class="math inline">\(M_{Z}(t/\sqrt{n}) = T_2(t/\sqrt{n}) + R_2(t/\sqrt{n})\)</span> where <span class="math inline">\(T_2\)</span> is the Taylor series up to order 2, and <span class="math inline">\(R_2\)</span> is the residual - the Taylor series terms greater than order 2.</p>
</section>
<section id="central-limit-theorem-2" class="slide level2">
<h2>Central Limit Theorem</h2>
<div style="font-size: x-large">
<p><span class="math display">\[
\lim_{n\rightarrow\infty}\frac{R_2(t/\sqrt{n})}{(t/\sqrt{n})^2}=\lim_{n\rightarrow\infty}nR_2(t/\sqrt{n})=0
\]</span> and</p>
<p><span class="math display">\[
\begin{align*}
\lim_{n\rightarrow\infty}M_{\bar{Z}_{n}}(t) &amp; =\lim_{n\rightarrow\infty}\left(1+0+\frac{\left(t/\sqrt{n}\right)^{2}}{2!}+R_{2}(t/\sqrt{n})\right)^{n}\\
&amp; =\lim_{n\rightarrow\infty}\left(1+\frac{1}{n}\left(\frac{t^{2}}{2}+nR_{2}(t/\sqrt{n})\right)\right)^{n}=\lim_{n\rightarrow\infty}\left(1+\frac{t^{2}/2}{n}\right)^{n}
\end{align*}
\]</span></p>
</div>
</section>
<section id="central-limit-theorem-3" class="slide level2">
<h2>Central Limit Theorem</h2>
<p>and since</p>
<p><span class="math display">\[
e^x=\lim_{n\rightarrow\infty}\left(1+\frac{x}{n}\right)^n
\]</span></p>
<p>we have</p>
<p><span class="math display">\[
\lim_{n\rightarrow\infty}M_{\bar{Z}_{n}}(t)=\lim_{n\rightarrow\infty}\left(1+\frac{t^{2}/2}{n}\right)^{n}=e^{t^2/2}
\]</span></p>
<p>i.e.&nbsp;the sum of <span class="math inline">\(n\)</span> IID samples of a random variable converges to a Gaussian in the limit <span class="math inline">\(n\rightarrow\infty\)</span>.</p>
</section>
<section id="central-limit-theorem-4" class="slide level2">
<h2>Central Limit Theorem</h2>
<p>The CLT says that for <span class="math inline">\(f=\mathbb{P}(E)\)</span> if <span class="math inline">\(\sigma^2\equiv\mathrm{Var}\left(f\right)\)</span> is finite then the error of the MC estimate</p>
<p><span class="math display">\[
e_N(f)=\bar{f}-\mathbb{E}[f]
\]</span></p>
<p>is approximately Normal in distribution for large <span class="math inline">\(M\)</span>, i.e.</p>
<p><span class="math display">\[
e_N(f)\sim\sigma M^{1/2}Z
\]</span> where <span class="math inline">\(Z\sim\mathscr{N}(0,1)\)</span></p>
</section>
<section id="mc-methods-5" class="slide level2">
<h2>MC Methods</h2>
<div style="font-size: xx-large">
<p>Suppose we need to compute an expectation <span class="math inline">\(\mathbb{E}[h(Z)]\)</span> for some random variable <span class="math inline">\(Z\)</span> and some function <span class="math inline">\(h:\mathbb{R}\to\mathbb{R}\)</span>.</p>
<p>Monte Carlo methods avoid doing any integration and instead just generate many samples of <span class="math inline">\(Z\)</span>, say <span class="math inline">\(z_1,z_2,\ldots,z_M\)</span> and <em>estimate</em> <span class="math inline">\(\mathbb{E}[h(Z)]\)</span> as <span class="math inline">\(\frac{1}{M}\sum_{i=1}^Mh(z_i)\)</span>, relying on empirical probability. The law of large numbers states that this sample mean should be close to <span class="math inline">\(\mathbb{E}[h(Z)]\)</span>.</p>
<p>Monte Carlo replaces the work of computing an integral (i.e., an expectation) with the work of generating many random variables.</p>
</div>
</section>
<section id="mc-methods-6" class="slide level2">
<h2>MC Methods</h2>
<h4 id="sampling">sampling</h4>
<div style="font-size: x-large">
<p>If <span class="math inline">\(X\sim\mathscr{N}(\mu,\sigma)\)</span> and we want to compute <span class="math inline">\(\mathbb{E}[\log|X|]\)</span>, we could set up and solve the integral</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{E}\left[\log|X|\right] &amp; =\int_{-\infty}^{\infty}\left(\log|t|\right)f(t;\mu,\sigma)dt\\
&amp; =\int_{-\infty}^{\infty}\frac{\log|t|}{\sqrt{2\pi\sigma^{2}}}\exp\left\{ \frac{-(t-\mu)^{2}}{2\sigma^{2}}\right\} dt
\end{align*}
\]</span></p>
<p>Alternatively, we could just draw lots of Monte Carlo replicates <span class="math inline">\(X_1,X_2,\cdots,X_M\)</span> from a normal with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span>, and look at the sample mean <span class="math inline">\(M^{-1}\sum_{i=1}^M\log|x_i|\)</span>, once again appealing to the law of large numbers to ensure that this sample mean is close to its expectation.</p>
</div>
</section>
<section id="mc-methods-7" class="slide level2">
<h2>MC Methods</h2>
<h4 id="sampling-1">sampling</h4>
<div style="font-size: x-large">
<p>Suppose that we want to compute an integral</p>
<p><span class="math display">\[
\int_Dg_0(x)dx
\]</span> where <span class="math inline">\(D\)</span> is some domain of integration and <span class="math inline">\(g_0(.)\)</span> is a function.</p>
<p>Let <span class="math inline">\(f(x)\)</span> be the density of some random variable with <span class="math inline">\(f(x)&gt;0, \forall x\in D\)</span>. Then we can rewrite the integral as</p>
<p><span class="math display">\[
\int_Dg_0(x)dx = \int_D\frac{g_0(x)}{f(x)}f(x)dx = \mathbb{E}_f[h(x)]
\]</span></p>
<p>where <span class="math inline">\(h(x)=g_0(x)/f(x)\)</span> and <span class="math inline">\(X\sim f\)</span></p>
</div>
</section>
<section id="mc-methods-8" class="slide level2">
<h2>MC Methods</h2>
<div style="font-size: x-large">
<p>Similarly, if we are given <span class="math inline">\(h(x)\)</span> and we want to compute <span class="math inline">\(\mathbb{E}_f[h(X)]\)</span> where <span class="math inline">\(X\sim f,\,x\in D\)</span>. What if we could not sample from <span class="math inline">\(f\)</span> directly?</p>
<p>If there were some other distribution <span class="math inline">\(g_1(x)\)</span> we could sample from, such that <span class="math inline">\(g_1(x)&gt;0,\,x\in D\)</span>, then</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{E}_{f}\left[h(x)\right] &amp; =\int_{D}h(x)f(x)dx\\
&amp; =\int_{S}h(x)\frac{f(x)}{g_1(x)}g_1(x)dx=\mathbb{E}_{g_1}\left[h(x)\frac{f(x)}{g_1(x)}\right]\\
&amp; =\frac{1}{n}\sum_{i=1}^{n}h(x_{i})\frac{f(x_{i})}{g_1(x_{i})}\quad x_{i}\sim g_1
\end{align*}
\]</span></p>
</div>
</section>
<section id="mc-methods-9" class="slide level2">
<h2>MC Methods</h2>
<div style="font-size: x-large">
<p>This method is called importance sampling (IS).</p>
<ol type="1">
<li>draw iid <span class="math inline">\(x_1,x_2,\ldots,x_n\)</span> from <span class="math inline">\(g_1\)</span> and calculate the importance weight</li>
</ol>
<p><span class="math display">\[
w(x_i)=\frac{f(x_{i})}{g_1(x_{i})}
\]</span> 2. estimate <span class="math inline">\(\mathbb{E}_f\left[h(X)\right]\)</span> by</p>
<p><span class="math display">\[
\hat{\mu}_h=\frac{1}{n}\sum_{i=1}^nw(x_i)h(x_i)
\]</span></p>
</div>
</section>
<section id="mc-methods-10" class="slide level2">
<h2>MC Methods</h2>
<h4 id="example-1">example</h4>
<div style="font-size: x-large">
<p>Estimate <span class="math inline">\(\mathbb E_f(X)\)</span> where <span class="math inline">\(f(x) = \sqrt{2/\pi}e^{-\frac{x^2}{2}};\;x\ge 0\)</span> (this is the half-Normal distribution)</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>integrate the half-normal</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>n <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb11-2"><a></a>X <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate=</span><span class="dv">2</span>)</span>
<span id="cb11-3"><a></a><span class="co"># calculate the importance weights</span></span>
<span id="cb11-4"><a></a>W <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> X<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>X) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb11-5"><a></a></span>
<span id="cb11-6"><a></a>mu_h  <span class="ot">&lt;-</span> <span class="fu">mean</span>(W<span class="sc">*</span>X)</span>
<span id="cb11-7"><a></a>var_h <span class="ot">&lt;-</span> <span class="fu">var</span>(W<span class="sc">*</span>X)<span class="sc">/</span>n</span>
<span id="cb11-8"><a></a>se_h  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var_h)</span>
<span id="cb11-9"><a></a></span>
<span id="cb11-10"><a></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">mean =</span> mu_h,  <span class="at">variance =</span> var_h, <span class="st">'standard error'</span> <span class="ot">=</span> se_h) <span class="sc">|&gt;</span> </span>
<span id="cb11-11"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-12"><a></a>  gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">decimals=</span><span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-13"><a></a>  gt<span class="sc">::</span><span class="fu">tab_options</span>( <span class="at">table.font.size =</span> gt<span class="sc">::</span><span class="fu">px</span>(<span class="dv">30</span>) ) <span class="sc">|&gt;</span>  </span>
<span id="cb11-14"><a></a>  gt<span class="sc">::</span><span class="fu">as_raw_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="epumqvnflh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
  
  
<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 30px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="gt_col_headings header" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">mean</th>
<th id="variance" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">variance</th>
<th id="standard-error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">standard error</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="mean" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.8208</td>
<td class="gt_row gt_right" headers="variance" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.0003</td>
<td class="gt_row gt_right" headers="standard error" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.0186</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="mc-methods-11" class="slide level2">
<h2>MC Methods</h2>
<h4 id="repeating-the-prior-example-but-un-normalized">repeating the prior example, but un-normalized</h4>
<div style="font-size: xx-large">
<p>Estimate <span class="math inline">\(\mathbb E_f(X)\)</span> where <span class="math inline">\(f(x) = e^{-\frac{x^2}{2}};\;x\ge 0\)</span> (this is the half-Normal distribution, un-normalized)</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>integrate the (un-normalized) half-normal</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="co"># un-normalized weights</span></span>
<span id="cb12-2"><a></a>n <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb12-3"><a></a>X <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate=</span><span class="dv">2</span>)</span>
<span id="cb12-4"><a></a><span class="co"># calculate the weights</span></span>
<span id="cb12-5"><a></a>W <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> X<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>X)</span>
<span id="cb12-6"><a></a></span>
<span id="cb12-7"><a></a>mu_h2  <span class="ot">&lt;-</span> <span class="fu">sum</span>(W<span class="sc">*</span>X)<span class="sc">/</span><span class="fu">sum</span>(W)</span>
<span id="cb12-8"><a></a>var_h2 <span class="ot">&lt;-</span> <span class="fu">var</span>(W<span class="sc">/</span><span class="fu">mean</span>(W))</span>
<span id="cb12-9"><a></a>se_h2  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var_h2)</span>
<span id="cb12-10"><a></a></span>
<span id="cb12-11"><a></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">mean =</span> mu_h2,  <span class="at">variance =</span> var_h2, <span class="st">'standard error'</span> <span class="ot">=</span> se_h2) <span class="sc">|&gt;</span> </span>
<span id="cb12-12"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-13"><a></a>  gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">decimals=</span><span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-14"><a></a>  gt<span class="sc">::</span><span class="fu">tab_options</span>( <span class="at">table.font.size =</span> gt<span class="sc">::</span><span class="fu">px</span>(<span class="dv">30</span>) ) <span class="sc">|&gt;</span>  </span>
<span id="cb12-15"><a></a>  <span class="co">#gt::tab_header(title = )</span></span>
<span id="cb12-16"><a></a>  gt<span class="sc">::</span><span class="fu">as_raw_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="xaxgswrnch" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
  
  
<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 30px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="gt_col_headings header" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">mean</th>
<th id="variance" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">variance</th>
<th id="standard-error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">standard error</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_right" headers="mean" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.7994</td>
<td class="gt_row gt_right" headers="variance" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.4183</td>
<td class="gt_row gt_right" headers="standard error" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.6468</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="mc-methods-12" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling">rejection sampling</h4>
<div style="font-size: xx-large">
<ul>
<li>Assume we have an un-normalized <span class="math inline">\(g(x)\)</span>, i.e.&nbsp;<span class="math inline">\(\pi(x)=cg(x)\)</span> but <span class="math inline">\(c\)</span> is unknown.</li>
<li>We want to generate iid samples <span class="math inline">\(x_1,x_2,\ldots,x_M\sim \pi\)</span> to estimate <span class="math inline">\(\mathbb{E}_\pi[h(X)]\)</span>.</li>
<li>Now assume we have an easily sampled density <span class="math inline">\(f\)</span>, and known <span class="math inline">\(K&gt;0\)</span>, such that <span class="math inline">\(Kf(x)\ge g(x),\;\forall x\)</span>, i.e.&nbsp;<span class="math inline">\(Kf(x)\ge \pi(x)/c\)</span> (or <span class="math inline">\(cKf(x)\ge \pi(x)\)</span>).</li>
</ul>
</div>
</section>
<section id="mc-methods-13" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-1">rejection sampling</h4>
<div style="font-size: xx-large">
<p>Then use the following procedure:</p>
<ol type="1">
<li>sample <span class="math inline">\(X\sim f\)</span> and <span class="math inline">\(U\sim \mathrm{uniform}[0,1]\)</span></li>
<li>if <span class="math inline">\(U\le\frac{g(x)}{Kf(x)}\)</span>, the accept <span class="math inline">\(x\)</span> as a draw from <span class="math inline">\(\pi\)</span></li>
<li>otherwise reject the sample and repeat</li>
</ol>
</div>
</section>
<section id="mc-methods-14" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-2">rejection sampling</h4>
<div style="font-size: x-large">
<ul>
<li><p>Since <span class="math inline">\(0\le\frac{g(x)}{Kf(x)}\le 1\)</span> we know that <span class="math inline">\(\mathbb{P}\left(U\le\frac{g(X)}{Kf(X)}|X=x\right)=\frac{g(x)}{Kf(x)}\)</span></p></li>
<li><p>and so</p></li>
</ul>
<p><span class="math display">\[
\begin{align*}
\mathbb{E}_{f}\left[\mathbb{P}\left(U\le\frac{g(X)}{Kf(X)}|X=x\right)\right] &amp; =\mathbb{E}_{f}\left[\frac{g(X)}{Kf(X)}\right]\\
&amp; =\int_{-\infty}^{\infty}\frac{g(x)}{Kf(x)}f(x)dx\\
&amp; =\int_{-\infty}^{\infty}\frac{g(x)}{K}dx
\end{align*}
\]</span></p>
</div>
</section>
<section id="mc-methods-15" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-3">rejection sampling</h4>
<div style="font-size: large">
<p>Similarly, for any <span class="math inline">\(y\in\mathbb{R}\)</span>, we can calculate the joint probability</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{P}\left(X\le y,U\le\frac{g(X)}{Kf(X)}\right) &amp; =\mathbb{E}_f\left[1_{X\le y}1_{U\le\frac{g(X)}{Kf(X)}}\right]\\
&amp; =\mathbb{E}_f\left[1_{X\le y}\mathbb{P}\left(U\le\frac{g(X)}{Kf(X)}|X=x\right)\right]\\
&amp; =\mathbb{E}_f\left[1_{X\le y}\frac{g(X)}{Kf(X)}\right]=\int_{-\infty}^{y}\frac{g(x)}{Kf(x)}f(x)dx\\
&amp; =\int_{-\infty}^{y}\frac{g(x)}{K}dx
\end{align*}
\]</span></p>
<ul>
<li>and so we have the joint probability (above - <span class="math inline">\(\mathbb{P}(A,B)\)</span>), and the probability of acceptance (previous slide - <span class="math inline">\(\mathbb{P}(B)\)</span>), so the probability, conditional on acceptance (<span class="math inline">\(\mathbb{P}(A|B)\)</span>) is <span class="math inline">\(\frac{\mathbb{P}(A,B)}{\mathbb{P}(B)}\)</span> by Bayes rule.</li>
</ul>
</div>
</section>
<section id="mc-methods-16" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-4">rejection sampling</h4>
<p>Substituting for the numerator and denominator:</p>
<div style="font-size: xx-large">
<p><span class="math display">\[
\mathbb{P}\left(X\le y|U\le\frac{g(X)}{Kf(X)}\right)=\frac{\int_{-\infty}^{y}\frac{g(x)}{K}dx}{\int_{-\infty}^\infty\frac{g(X)}{K}dx}=\int_{-\infty}^{y}\pi(x)dx
\]</span></p>
</div>
</section>
<section id="mc-methods-17" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-proof-for-discrete-rv">rejection sampling: proof for discrete rv</h4>
<div style="font-size: xx-large">
<p>We have <span class="math inline">\(\mathbb{P}(X=x) = \sum_{i=1}^n\mathbb{P}(\mathrm{reject }\,Y)^{n-1}\mathbb{P}(\mathrm{draw }\,Y=x\,\mathrm{and\, accept})\)</span></p>
<p>We also have</p>
<p><span class="math display">\[
\begin{align*}
&amp; \mathbb{P}(\mathrm{draw}\,Y=x\,\mathrm{and\,accept})\\
= &amp; \mathbb{P}(\mathrm{draw}\,Y=x)\mathbb{P}(\left.\mathrm{accept}\,Y\right|Y=x)\\
= &amp; f(x)\mathbb{P}\left(\left.U\le\frac{q(Y)}{Kf(Y)}\right|Y=x\right)\\
= &amp; \frac{q(x)}{K} = \frac{\pi(x)}{cK}
\end{align*}
\]</span></p>
</div>
</section>
<section id="mc-methods-18" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-proof-for-discrete-rv-1">rejection sampling: proof for discrete rv</h4>
<div style="font-size: xx-large">
<p>The probability of rejection of a draw is</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{P}(\mathrm{{reject}}\,Y) &amp; =\sum_{x\in D}\mathbb{P}(\mathrm{{draw}}\,Y=x\,\mathrm{and\,reject\,it})\\
&amp; =\sum_{x\in D}f(x)\mathbb{P}\left(\left.U\ge\frac{q(Y)}{Kf(Y)}\right|Y=x\right)\\
&amp; =\sum_{x\in D}f(x)\left(1-\frac{q(x)}{Kf(x)}\right)=1-\frac{1}{cK}
\end{align*}
\]</span></p>
</div>
</section>
<section id="mc-methods-19" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-proof-for-discrete-rv-2">rejection sampling: proof for discrete rv</h4>
<div style="font-size: xx-large">
<p>and so<sup>1</sup></p>
<p><span class="math display">\[
\begin{align*}
\mathbb{P}(X=x) &amp; =\sum_{n=1}^{\infty}\mathbb{P}(\mathrm{reject}\,Y)^{n-1}\mathbb{P}(\mathrm{draw}\,Y=x\,\mathrm{and\,accept})\\
&amp; =\sum_{n=1}^{\infty}\left(1-\frac{1}{cK}\right)^{n-1}\frac{\pi(x)}{cK}=\pi(x)
\end{align*}
\]</span></p>
</div>
<aside><ol class="aside-footnotes"><li id="fn4"><p>The <strong>geometric distribution</strong> is a discrete pmf that can be interpreted as the number of failures before the first success (<span class="math inline">\(\mathbb{P}(X=k)=(1-p)^{k-1}p\)</span>, with mean <span class="math inline">\(p\)</span>).</p></li></ol></aside></section></section>
<section>
<section id="stochastic-processes" class="title-slide slide level1 center">
<h1>Stochastic processes</h1>

</section>
<section id="stochastic-processes-1" class="slide level2">
<h2>Stochastic processes</h2>
<div style="font-size: x-large">
<p>A stochastic process, which we will usually write as <span class="math inline">\((X_n)\)</span>, is an indexed sequence of random variables that are possibly dependent on each other.</p>
<p>Each random variable <span class="math inline">\(X_n\)</span> takes a value in a state space <span class="math inline">\(\mathcal S\)</span> which is the set of possible values for the process. As with usual random variables, the state space <span class="math inline">\(\mathcal S\)</span> can be discrete or continuous.</p>
<p>A discrete state space denotes a set of distinct possible outcomes, which can be finite or countably infinite. For example, <span class="math inline">\(\mathcal S = \{\text{Heads},\text{Tails}\}\)</span> is the state space for a single coin flip, while in the case of counting insurance claims, the state space would be the nonnegative integers <span class="math inline">\(\mathcal S = \mathbb Z_+ = \{0,1,2,\dots\}\)</span>.</p>
</div>
</section>
<section id="stochastic-processes-2" class="slide level2">
<h2>Stochastic processes</h2>
<p>The stochastic process has an index set that orders the random variables that make up the process.</p>
<p>The index set is usually interpreted as a time variable, telling us when the process will be measured. The index set for time can also be discrete or continuous. Discrete time denotes a process sampled at distinct points, often denoted by <span class="math inline">\(n = 0,1,2,\dots\)</span>, while continuous time denotes a process monitored constantly over time, often denoted by <span class="math inline">\(t \in \mathbb R_+ = \{x \in \mathbb R : x \geq 0\}\)</span>.</p>
</section>
<section id="markov-property" class="slide level2">
<h2>Markov property</h2>
<div style="font-size: x-large">
<p>Consider a simple board game where we roll a dice and move that many squares forward on the board. Suppose we are currently on the square <span class="math inline">\(X_n\)</span>. What can we say about which square <span class="math inline">\(X_{n+1}\)</span> we move to on our next turn?</p>
<ul>
<li><span class="math inline">\(X_{n+1}\)</span> is random, since it depends on the roll of the dice.</li>
<li><span class="math inline">\(X_{n+1}\)</span> depends on where we are now <span class="math inline">\(X_n\)</span>, since the score of dice will be added onto the number our current square,</li>
<li>Given the square <span class="math inline">\(X_n\)</span> we are now, <span class="math inline">\(X_{n+1}\)</span> doesn’t depend on which sequence of squares <span class="math inline">\(X_0, X_1, \dots, X_{n-1}\)</span> we used to get here.</li>
</ul>
</div>
</section>
<section id="markov-property-1" class="slide level2">
<h2>Markov property</h2>
<div style="font-size: xx-large">
<p>The third point is called the Markov property or memoryless property.</p>
<p>The key property of Markov Chains is memoryless: to get the next value we only need to know where we are, not which squares we visited to get here.</p>
<p>The past and the future are conditionally independent given the present.</p>
</div>
</section>
<section id="markov-chains" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: x-large">
<p>Consider the following <strong>simple random walk</strong> on the positive integers <span class="math inline">\(\mathbb Z\)</span>:</p>
<p>We start at <span class="math inline">\(0\)</span>, then at each time step, we go up by one with probability <span class="math inline">\(p\)</span> and down by one with probability <span class="math inline">\(q = 1-p\)</span>. When <span class="math inline">\(p = q = \frac12\)</span>, we’re equally as likely to go up as down, and we call this the <strong>simple symmetric random walk</strong>.</p>
<p>The simple random walk is a simple but very useful model for lots of processes, like stock prices, sizes of populations, or positions of gas particles. (In many modern models, however, these have been replaced by more complicated continuous time and space models.) The simple random walk is sometimes called the “drunkard’s walk.”</p>
</div>
</section>
<section id="markov-chains-1" class="slide level2">
<h2>Markov Chains</h2>
<details class="code-fold">
<summary>random walks</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="fu">require</span>(ggplot2, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-2"><a></a><span class="fu">set.seed</span>(<span class="dv">315</span>)</span>
<span id="cb13-3"><a></a></span>
<span id="cb13-4"><a></a>rrw <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">p =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) {</span>
<span id="cb13-5"><a></a>  q <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> p</span>
<span id="cb13-6"><a></a>  Z <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(p, q))</span>
<span id="cb13-7"><a></a>  X <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(Z))</span>
<span id="cb13-8"><a></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(Z))</span>
<span id="cb13-9"><a></a>}</span>
<span id="cb13-10"><a></a></span>
<span id="cb13-11"><a></a>n <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb13-12"><a></a>rw_dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">x=</span><span class="dv">0</span><span class="sc">:</span>n) <span class="sc">|&gt;</span> </span>
<span id="cb13-13"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb13-14"><a></a>    <span class="st">"p = 2/3"</span> <span class="ot">=</span> <span class="fu">rrw</span>(n, <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb13-15"><a></a>    , <span class="st">"p = 1/3"</span> <span class="ot">=</span> <span class="fu">rrw</span>(n, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb13-16"><a></a>    , <span class="st">"p = 1/2"</span> <span class="ot">=</span> <span class="fu">rrw</span>(n, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb13-17"><a></a>  )</span>
<span id="cb13-18"><a></a></span>
<span id="cb13-19"><a></a>p0 <span class="ot">&lt;-</span> rw_dat <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-20"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>x) <span class="sc">|&gt;</span> </span>
<span id="cb13-21"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>value, <span class="at">color=</span>name)) <span class="sc">+</span> </span>
<span id="cb13-22"><a></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb13-23"><a></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb13-24"><a></a></span>
<span id="cb13-25"><a></a>p1 <span class="ot">&lt;-</span> rw_dat <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-26"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>x) <span class="sc">|&gt;</span> </span>
<span id="cb13-27"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>value, <span class="at">color=</span>name)) <span class="sc">+</span> </span>
<span id="cb13-28"><a></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb13-29"><a></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb13-30"><a></a></span>
<span id="cb13-31"><a></a>p3 <span class="ot">&lt;-</span> rw_dat <span class="sc">|&gt;</span> <span class="co">#dplyr::slice_head(n=200) |&gt; </span></span>
<span id="cb13-32"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>x) <span class="sc">|&gt;</span> </span>
<span id="cb13-33"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>value, <span class="at">color=</span>name)) <span class="sc">+</span> </span>
<span id="cb13-34"><a></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb13-35"><a></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb13-36"><a></a></span>
<span id="cb13-37"><a></a>p0<span class="sc">+</span>p1<span class="sc">+</span>p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img data-src="BSMM_8740_lec_09_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
</div>
</div>
</section>
<section id="markov-chains-2" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: x-large">
<p>We can write this as a stochastic process <span class="math inline">\((X_n)\)</span> with discrete time <span class="math inline">\(n = \{0,1,2,\dots\} = \mathbb Z_+\)</span> and discrete state space <span class="math inline">\(\mathcal S = \mathbb Z\)</span>, where <span class="math inline">\(X_0 = 0\)</span> and, for <span class="math inline">\(n \geq 0\)</span>, we have</p>
<p><span class="math display">\[
X_{n+1} =
\begin{cases}
X_n + 1 &amp; \text{with probability $p$,} \\
X_n - 1 &amp; \text{with probability $1-p$}
\end{cases}
\]</span></p>
<p>It’s clear from this definition that <span class="math inline">\(X_{n+1}\)</span> (the future) depends on <span class="math inline">\(X_n\)</span> (the present), but, given <span class="math inline">\(X_n\)</span>, does not depend on <span class="math inline">\(X_{n-1}, \dots, X_1, X_0\)</span> (the past). Thus the Markov property holds, and the simple random walk is a discrete time Markov process or <u><strong>Markov chain</strong></u>.</p>
</div>
</section>
<section id="markov-chains-3" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: xx-large">
<p>To define a Markov chain, we first need to say where we start from, and then what the probabilities of transitions from one state to another are.</p>
<p>In our examples of the simple random walk and gambler’s ruin, we specified the start point <span class="math inline">\(X_0 = i\)</span> exactly, but we could also pick the start point at random according to some distribution <span class="math inline">\(\pi_i = \mathbb P(X_0 = i)\)</span>.</p>
</div>
</section>
<section id="markov-chains-4" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: x-large">
<p>We also need to know the transition probabilities <span class="math inline">\(\mathbb P(X_{n+1} = j \mid X_n = i)\)</span> for <span class="math inline">\(i,j \in \mathcal S\)</span>. Because of the Markov property, the transition probability only needs to condition on the state we’re in now <span class="math inline">\(X_n = i\)</span>, and not on the whole history of the process.</p>
<p>In the case of the simple random walk, for example, we had initial distribution</p>
<p><span class="math display">\[
\lambda_i = \mathbb P(X_0 = i) = \begin{cases} 1 &amp; \text{if $i = 0$} \\ 0 &amp; \text{otherwise} \end{cases}
\]</span></p>
<p>and transition probabilities</p>
<p><span class="math display">\[
\mathbb P(X_{n+1} = j \mid X_n = i) = \begin{cases} p &amp; \text{if $j = i+1$} \\ q &amp; \text{if $j = i-1$} \\ 0 &amp; \text{otherwise.} \end{cases}
\]</span></p>
</div>
</section>
<section id="markov-chains-5" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: xx-large">
<p>For the random walk (and also the gambler’s ruin), the transition probabilities <span class="math inline">\(\mathbb P(X_{n+1} = j \mid X_n = i)\)</span> don’t depend on <span class="math inline">\(n\)</span>; in other words, the transition probabilities stay the same over time.</p>
<p>A Markov process with this property is called time homogeneous. We will only consider time homogeneous processes in this course.</p>
</div>
</section>
<section id="markov-chains-6" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: x-large">
<p>Write <span class="math inline">\(p_{ij} = \mathbb P(X_{n+1} = j \mid X_n = i)\)</span> for the transition probabilities, which are independent of <span class="math inline">\(n\)</span>. We must have <span class="math inline">\(p_{ij} \geq 0\)</span>, since it is a probability, and we must also have <span class="math inline">\(\sum_j p_{ij} = 1\)</span> for all states <span class="math inline">\(i\)</span>, as this is the sum of the probabilities of all the places you can move to from state i.</p>
<p>When the state space is finite (and even sometimes when it’s not), it’s convenient to write the transition probabilities <span class="math inline">\((p_{ij})\)</span> as a matrix <span class="math inline">\(\mathsf P\)</span>, called the transition matrix, whose <span class="math inline">\((i,j)\)</span>th entry is <span class="math inline">\(p_{ij}\)</span>.</p>
<p>Then the condition that <span class="math inline">\(\sum_j p_{ij} = 1\)</span> is the condition that each of the rows of <span class="math inline">\(\mathsf P\)</span> add up to <span class="math inline">\(1\)</span>.</p>
</div>
</section>
<section id="markov-chains-7" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: x-large">
<p>Consider a simple two-state Markov chain with state space <span class="math inline">\(\mathcal S = \{0,1\}\)</span> and transition matrix <span class="math display">\[ \mathsf P = \begin{pmatrix} p_{00} &amp; p_{01} \\ p_{10} &amp; p_{11} \end{pmatrix} = \begin{pmatrix} 1-\alpha &amp; \alpha \\ \beta &amp; 1-\beta \end{pmatrix}  \]</span> for some <span class="math inline">\(0 &lt; \alpha&lt;1, 0&gt;\beta &lt; 1\)</span>. Note that the rows of <span class="math inline">\(\mathsf P\)</span> add up to <span class="math inline">\(1\)</span>, as they must.</p>
<p>like</p>
<p>We can illustrate <span class="math inline">\(\mathsf P\)</span> by a transition diagram/graph, where the nodes/vertices are the states and the arrows give the transition probabilities. (We don’t draw the arrow if <span class="math inline">\(p_{ij} = 0\)</span>.) In this case, our transition diagram looks the graph on the next slide:</p>
</div>
</section>
<section id="markov-chains-8" class="slide level2">
<h2>Markov Chains</h2>

<img data-src="BSMM_8740_lec_09_files/figure-html/unnamed-chunk-10-1.png" width="384" class="r-stretch quarto-figure-center"><p class="caption">Transition diagram for the two-state Markov chain</p></section>
<section id="markov-chains-9" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: xx-large">
<p>We can use this graph as a simple model of customer churn, for example. If the customer has closed their account (state 0) on one period, then with probability <span class="math inline">\(\alpha\)</span> we will be able to entice them to open their account again (state 1) by the next period; while if the customer has an account (state 1), then with probability <span class="math inline">\(\beta\)</span> they will have closed their account (state 0) by the next period.</p>
</div>
</section>
<section id="markov-chains-10" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: x-large">
<div id="printer" class="example">
<p>If the customer has an account in period <span class="math inline">\(n\)</span>, what’s the probability they also have an account in period <span class="math inline">\(n+2\)</span>?</p>
<p><span class="math display">\[
p_{11}(2) = \mathbb P (X_{n+2} = 1 \mid X_n = 1)
\]</span></p>
<p>The key to calculating this is to <em>condition on the first step</em> again – that is, on whether the customer has an account in period <span class="math inline">\(n\)</span>. We have</p>
<p><span class="math display">\[
\begin{align*}
  p_{11}(2) &amp;= \mathbb P (X_{n+1} = 0 \mid X_n = 1)\,\mathbb P (X_{n+2} = 1 \mid X_{n+1} = 0, X_n = 1) \\
  &amp;\qquad{} + \mathbb P (X_{n+1} = 1 \mid X_n = 1)\,\mathbb P (X_{n+2} = 1 \mid X_{n+1} = 1, X_n = 1) \\
  &amp;= \mathbb P (X_{n+1} = 0 \mid X_n = 1)\,\mathbb P (X_{n+2} = 1 \mid X_{n+1} = 0) \\
  &amp;\qquad{} + \mathbb P (X_{n+1} = 1 \mid X_n = 1)\,\mathbb P (X_{n+2} = 1 \mid X_{n+1} = 1) \\
  &amp;= p_{10}p_{01} + p_{11}p_{11} \\
  &amp;= \beta\alpha + (1-\beta)^2
\end{align*}
\]</span></p>
</div>
</div>
</section>
<section id="markov-chains-11" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: xx-large">
<p>In the second equality, we used the Markov property to mean conditional probabilities like <span class="math inline">\(\mathbb P(X_{n+2} = 1 \mid X_{n+1} = k)\)</span> did not have to depend on <span class="math inline">\(X_n\)</span>.</p>
<p>Another way to think of this as we summing the probabilities of all length-2 paths from 1 to 1, which are <span class="math inline">\(1\to 0\to 1\)</span> with probability <span class="math inline">\(\beta\alpha\)</span> and <span class="math inline">\(1 \to 1 \to 1\)</span> with probability <span class="math inline">\((1-\beta)^2\)</span></p>
</div>
</section>
<section id="markov-chains-12" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: large">
<p>In the above example, we calculated a two-step transition probability:</p>
<p><span class="math display">\[
p_{ij}(2) = \mathbb P (X_{n+2} = j \mid X_n = i)
\]</span></p>
<p>by conditioning on the first step. That is, by considering all the possible intermediate steps <span class="math inline">\(k\)</span>, we have</p>
<p><span class="math display">\[
\begin{align*}
p_{ij}(2) &amp; =\sum_{k\in\mathcal{S}}\mathbb{P}(X_{n+1}=k\mid X_{n}=i)\mathbb{P}(X_{n+2}=j\mid X_{n+1}=k)\\
&amp; =\sum_{k\in\mathcal{S}}p_{ik}p_{kj}
\end{align*}
\]</span></p>
<p>But this is exactly the formula for multiplying the matrix <span class="math inline">\(\mathsf P\)</span> with itself! In other words, <span class="math inline">\(p_{ij}(2) = \sum_{k} p_{ik}p_{kj}\)</span> is the <span class="math inline">\((i,j)\)</span>th entry of the matrix square <span class="math inline">\(\mathsf P^2 = \mathsf{P}\times\mathsf{P}\)</span>. If we write <span class="math inline">\(\mathsf P(2)  = (p_{ij}(2))\)</span> for the matrix of two-step transition probabilities, we have <span class="math inline">\(\mathsf P(2) = \mathsf P^2\)</span>.</p>
<p>More generally, we see that this rule holds over multiple steps, provided we sum over all the possible paths <span class="math inline">\(i\to k_1 \to k_2 \to \cdots \to k_{n-1} \to j\)</span> of length <span class="math inline">\(n\)</span> from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span>.</p>
</div>
</section>
<section id="markov-chains-13" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: x-large">
<div id="thm-n-step" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1</strong></span> Let <span class="math inline">\((X_n)\)</span> be a Markov chain with state space <span class="math inline">\(\mathcal S\)</span> and transition matrix <span class="math inline">\(\mathsf P = (p_{ij})\)</span>. For <span class="math inline">\(i,j \in \mathcal S\)</span>, write <span class="math display">\[ p_{ij}(n) = \mathbb P(X_n = j \mid X_0 = i) \]</span> for the <span class="math inline">\(n\)</span>-step transition probability. Then</p>
<p><span class="math display">\[
p_{ij}(n) = \sum_{k_1, k_2, \dots, k_{n-1} \in \mathcal S} p_{ik_1} p_{k_1k_2} \cdots p_{k_{n-2}k_{n-1}} p_{k_{n-1}j}
\]</span></p>
<p>In particular, <span class="math inline">\(p_{ij}(n)\)</span> is the <span class="math inline">\((i,j)\)</span>th element of the matrix power <span class="math inline">\(\mathsf P^n\)</span>, and the matrix of <span class="math inline">\(n\)</span>-step transition probabilities is given by <span class="math inline">\(\mathsf P(n) = \mathsf P^n\)</span>.</p>
</div>
</div>
</section>
<section id="markov-chains-14" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: xx-large">
<p>The so-called <strong>Chapman–Kolmogorov equations</strong> follow immediately from this.</p>
<div id="c-k" class="theorem" name="Chapman–Kolmogorov equations">
<p>Let <span class="math inline">\((X_n)\)</span> be a Markov chain with state space <span class="math inline">\(\mathcal S\)</span> and transition matrix <span class="math inline">\(\mathsf P = (p_{ij})\)</span>. Then, for non-negative integers <span class="math inline">\(n,m\)</span>, we have <span class="math display">\[ p_{ij}(n+m) = \sum_{k \in \mathcal S} p_{ik}(n)p_{kj}(m) , \]</span> or, in matrix notation, <span class="math inline">\(\mathsf P(n+m) = \mathsf P(n)\mathsf P(m)\)</span>.</p>
</div>
</div>
</section>
<section id="markov-chains-15" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: xx-large">
<p>In other words, a trip of length <span class="math inline">\(n + m\)</span> from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> is a trip of length <span class="math inline">\(n\)</span> from <span class="math inline">\(i\)</span> to some other state <span class="math inline">\(k\)</span>, then a trip of length <span class="math inline">\(m\)</span> from <span class="math inline">\(k\)</span> back to <span class="math inline">\(j\)</span>, and this intermediate stop <span class="math inline">\(k\)</span> can be any state, so we have to sum the probabilities.</p>
<p>Of course, once we know that <span class="math inline">\(\mathsf P(n) = \mathsf P^n\)</span> is given by the matrix power, it’s clear to see that <span class="math inline">\(\mathsf P(n+m) = \mathsf P^{n+m} = \mathsf P^n \mathsf P^m = \mathsf P(n)\mathsf P(m)\)</span>.</p>
</div>
</section>
<section id="markov-chains-16" class="slide level2">
<h2>Markov Chains</h2>
<h4 id="initial-distribution">initial distribution</h4>
<div style="font-size: xx-large">
<p>If we start from a state given by a pmf <span class="math inline">\(\boldsymbol \pi_0 = (\pi_{0,i})_{i\in S}\)</span>, then after step 1 the probability we’re in state <span class="math inline">\(j\)</span> is <span class="math inline">\(\sum_i \pi_{0,i} p_{ij}\)</span>.</p>
<p>Given transition matrix <span class="math inline">\(\mathsf P\)</span> and initial state pmf <span class="math inline">\(\boldsymbol \pi_0\)</span>, the pmf for the state after one step is <span class="math inline">\(\boldsymbol \pi_1=\boldsymbol \pi_0 \times\mathsf P\)</span>, i.e.&nbsp;<span class="math inline">\(\boldsymbol \pi_1\)</span> and <span class="math inline">\(\boldsymbol \pi_0\)</span> are row vectors, and for any given state pmf, the pmf for the states on the next step of the Markov chain is the current state pmf multiplied<sup>1</sup> by the transition matrix.</p>
</div>
<aside><ol class="aside-footnotes"><li id="fn5"><p>note: on the left</p></li></ol></aside></section>
<section id="markov-chains-17" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: x-large">
<p>Starting from a state given by a distribution <span class="math inline">\(\boldsymbol \pi = (\pi_i)_{i\in S}\)</span>, then after step 1 the probability we’re in state <span class="math inline">\(j\)</span> is <span class="math inline">\(\sum_i \pi_i p_{ij}\)</span>. So if <span class="math inline">\(\pi_j = \sum_i \pi_i p_{ij}\)</span>, we stay in this distribution forever. We call such a distribution a stationary distribution. We again recognise this formula as a matrix-vector multiplication, so this is <span class="math inline">\(\boldsymbol \pi = \boldsymbol \pi\mathsf P\)</span>, where <span class="math inline">\(\boldsymbol \pi\)</span> is a <em>row</em> vector.</p>
<div class="definition">
<p>Let <span class="math inline">\((X_n)\)</span> be a Markov chain on a state space <span class="math inline">\(\mathcal S\)</span> with transition matrix <span class="math inline">\(\mathsf P\)</span>. Let <span class="math inline">\(\boldsymbol \pi = (\pi_i)\)</span> be a distribution on <span class="math inline">\(\mathcal S\)</span>, in that <span class="math inline">\(\pi_i \geq 0\)</span> for all <span class="math inline">\(i \in \mathcal S\)</span> and <span class="math inline">\(\sum_{i \in \mathcal S} \pi_i = 1\)</span>. We call <span class="math inline">\(\boldsymbol \pi\)</span> a <strong>stationary distribution</strong> if</p>
<p><span class="math display">\[
\pi_j = \sum_{i\in \mathcal S} \pi_i p_{ij} \quad \text{for all $j \in \mathcal S$}
\]</span></p>
<p>or, equivalently, if <span class="math inline">\(\boldsymbol \pi = \boldsymbol \pi\mathsf P\)</span>.</p>
</div>
</div>
</section>
<section id="markov-chains-18" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: xx-large">
<p>Note that we’re saying the <em>distribution</em> <span class="math inline">\(\mathbb P(X_n = i)\)</span> stays the same; the Markov chain <span class="math inline">\((X_n)\)</span> itself will keep moving.</p>
<p>One way to think is that if we started off a thousand Markov chains, choosing each starting position to be <span class="math inline">\(i\)</span> with probability <span class="math inline">\(\pi_i\)</span>, then (roughly) <span class="math inline">\(1000 \pi_j\)</span> of them would be in state <span class="math inline">\(j\)</span> at any time in the future – but not necessarily the same ones each time.</p>
</div>
</section>
<section id="markov-chains-19" class="slide level2">
<h2>Markov Chains</h2>
<h4 id="stationary-distributions">stationary distributions</h4>
<div style="font-size: x-large">
<p>So our definition of the stationary state pmf is: <span class="math inline">\(\pi\)</span> such that <span class="math inline">\(\pi=\pi\times \mathsf P\)</span>. We can calculate it as follows:</p>
<p><span class="math display">\[
\begin{align*}
\pi-\pi\mathsf{P} &amp; =0\\
\pi\left(I-\mathsf{P}\right) &amp; =0\\
\left(I-\mathsf{P}\right)^{\top}\pi^{\top} &amp; =0
\end{align*}
\]</span></p>
<p>along with the additional constraint <span class="math inline">\(\sum_i\pi_i=1\)</span>.</p>
<p>If we add a row of ones at the bottom of our matrix <span class="math inline">\(\left(I-\mathsf{P}\right)^{\top}\)</span> and a <span class="math inline">\(1\)</span> at the bottom of the vector on the right we can solve for <span class="math inline">\(\pi\)</span>, e.g.&nbsp;using <code>qr.solve</code>.</p>
</div>
</section>
<section id="markov-chains-20" class="slide level2">
<h2>Markov Chains</h2>
<h4 id="stationary-distribution-example">stationary distribution example</h4>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">P</a></li><li><a href="#tabset-1-2">t(I-P)</a></li><li><a href="#tabset-1-3">solve</a></li><li><a href="#tabset-1-4">confirm</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>P <span class="ot">=</span> <span class="fu">matrix</span>(</span>
<span id="cb14-2"><a></a>  <span class="fu">c</span>(</span>
<span id="cb14-3"><a></a>    <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="dv">0</span>,</span>
<span id="cb14-4"><a></a>    <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.8</span>,</span>
<span id="cb14-5"><a></a>    <span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="dv">0</span>, <span class="fl">0.3</span>,</span>
<span id="cb14-6"><a></a>    <span class="fl">0.3</span>,<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.3</span></span>
<span id="cb14-7"><a></a>  )</span>
<span id="cb14-8"><a></a>  , <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb14-9"><a></a>)</span>
<span id="cb14-10"><a></a>P</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]  0.2  0.3  0.5  0.0
[2,]  0.0  0.1  0.1  0.8
[3,]  0.5  0.2  0.0  0.3
[4,]  0.3  0.1  0.3  0.3</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a>A <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">diag</span>(<span class="dv">1</span>,<span class="dv">4</span>) <span class="sc">-</span> P)</span>
<span id="cb16-2"><a></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]  0.8  0.0 -0.5 -0.3
[2,] -0.3  0.9 -0.2 -0.1
[3,] -0.5 -0.1  1.0 -0.3
[4,]  0.0 -0.8 -0.3  0.7</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>pi <span class="ot">&lt;-</span> </span>
<span id="cb18-2"><a></a>  <span class="fu">qr.solve</span>(</span>
<span id="cb18-3"><a></a>    A <span class="sc">|&gt;</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb18-4"><a></a>    , <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb18-5"><a></a>    , <span class="at">tol =</span> <span class="fl">1e-10</span></span>
<span id="cb18-6"><a></a>  )</span>
<span id="cb18-7"><a></a>pi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2686 0.1782 0.2447 0.3085</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>pi <span class="sc">%*%</span> P</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       [,1]   [,2]   [,3]   [,4]
[1,] 0.2686 0.1782 0.2447 0.3085</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="markov-chains-21" class="slide level2">
<h2>Markov Chains</h2>
<h4 id="properties">properties</h4>
<div style="font-size: xx-large">
<ul>
<li><p>A Markov Chain is <u><strong>irreducible</strong></u> if you have positive probability of eventually getting to anywhere in the state space from anywhere else in the state space</p></li>
<li><p>A Markov Chain is <u><strong>aperiodic</strong></u> if there are no forced cycles, i.e.&nbsp;there do not exist disjoint non-empty subsets <span class="math inline">\(X_1,X_2,...,X_d\)</span> for <span class="math inline">\(d≥2\)</span>, such that <span class="math inline">\(P(x,X_{i+1})=1\)</span> for all <span class="math inline">\(x\in X_i \;(1≤i≤d−1)\)</span>, and <span class="math inline">\(P(x,X_1)=1\)</span> for all <span class="math inline">\(x\in X_d\)</span>.</p></li>
</ul>
</div>
</section>
<section id="markov-chains-22" class="slide level2">
<h2>Markov Chains</h2>

<img data-src="BSMM_8740_lec_09_files/figure-html/unnamed-chunk-15-1.png" width="480" class="r-stretch quarto-figure-center"><p class="caption">MC with cycle</p></section></section>
<section>
<section id="markov-chain-monte-carlo" class="title-slide slide level1 center">
<h1>Markov Chain Monte Carlo</h1>

</section>
<section id="markov-chain-monte-carlo-1" class="slide level2">
<h2>Markov Chain Monte Carlo</h2>
<div style="font-size: x-large">
<p>Suppose have complicated, high-dimensional density <span class="math inline">\(\pi = cg\)</span> and we want samples <span class="math inline">\(X_1, X_2,\dots \sim \pi\)</span>.</p>
<p>Define a Markov chain <span class="math inline">\(X_0, X_1,X_2\dots\)</span> in such a way that for large enough <span class="math inline">\(m\)</span>, we have <span class="math inline">\(X_n\sim \pi,\,\forall n\ge m\)</span>.</p>
<p>Then we can estimate <span class="math inline">\(\mathbb{E}_{\pi}(h) ≡ \int h(x) \pi(x) dx\)</span> by:</p>
<p><span class="math display">\[
\mathbb{E}_{\pi}[h] \approx \frac{1}{M-B}\sum_{i=B+1}^{M}h(x_i)
\]</span></p>
<p>where <span class="math inline">\(B\)</span> (“burn-in”) is chosen large enough so <span class="math inline">\(X_B\sim\pi\)</span>, and <span class="math inline">\(M\)</span> is chosen large enough to get good Monte Carlo estimates.</p>
</div>
</section>
<section id="mcmc-metropolis-algo" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<div style="font-size: x-large">
<ol type="1">
<li>choose some initial value <span class="math inline">\(X_0\)</span>, then</li>
<li>given <span class="math inline">\(X_{n-1}\)</span>, choose a proposal state <span class="math inline">\(Y_n\sim \textrm{MVN}(X_{n-1},\sigma^2\textrm{I})\)</span>, for some fixed <span class="math inline">\(\sigma^2&gt;0\)</span></li>
<li>let <span class="math inline">\(A_n=\pi(Y_n)/\pi(X_{n-1})=g(Y_n)/g(X_{n-1})\)</span> and <span class="math inline">\(U_n\sim\textrm{U}[0,1]\)</span>, then</li>
<li>if <span class="math inline">\(U_n&lt;A_n\)</span> set <span class="math inline">\(X_n=Y_n\)</span> (“accept”), otherwise set <span class="math inline">\(X_n = X_{n-1}\)</span> (“reject”)</li>
<li>repeat for <span class="math inline">\(n=1,2,3,\ldots,M\)</span></li>
</ol>
<p>This version is called <u><strong>random-walk Metropolis</strong></u> - if we always accepted the proposals, they would form a traditional random walk process.</p>
</div>
</section>
<section id="mcmc-metropolis-algo-1" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<ul>
<li>the burn-in period is a matter of trial and error</li>
<li>the start values don’t matter much, but central. ones are ‘better’</li>
<li>if <span class="math inline">\(\sigma\)</span> is too small then we usually <u>accept</u> and the chain doesn’t move much</li>
<li>if <span class="math inline">\(\sigma\)</span> is too big then we usually <u>reject</u> and the chain doesn’t move much</li>
<li>generally the acceptance rate should be far from both zero and 1</li>
</ul>
</section>
<section id="mcmc-metropolis-algo-2" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<p>The variance of the estimate is</p>
<p><span class="math display">\[
\frac{1}{M-B}\textrm{Var}_{\pi}(h)\times \textrm{varfact}
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\textrm{varfact} = 1+2\sum_{k=1}^{\infty}\textrm{Corr}_{\pi} \left(h(X_0),h(X_k)\right)=\sum_{-\infty}^{\infty}\rho_k
\]</span></p>
</section>
<section id="mcmc-metropolis-algo-3" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<div class="cell">
<details class="code-fold">
<summary>a simple Metropolis algorithm in one dimension (continuous RV)</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>g <span class="ot">=</span> <span class="cf">function</span>(y) {</span>
<span id="cb22-2"><a></a>    <span class="cf">if</span> ( (y<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">||</span> (y<span class="sc">&gt;</span><span class="dv">1</span>) )</span>
<span id="cb22-3"><a></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb22-4"><a></a>    <span class="cf">else</span></span>
<span id="cb22-5"><a></a>    <span class="fu">return</span>( y<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="fu">sin</span>(y<span class="sc">^</span><span class="dv">4</span>) <span class="sc">*</span> <span class="fu">cos</span>(y<span class="sc">^</span><span class="dv">5</span>) )</span>
<span id="cb22-6"><a></a>}</span>
<span id="cb22-7"><a></a></span>
<span id="cb22-8"><a></a>h <span class="ot">=</span> <span class="cf">function</span>(y) { <span class="fu">return</span>(y<span class="sc">^</span><span class="dv">2</span>) }</span>
<span id="cb22-9"><a></a></span>
<span id="cb22-10"><a></a>M <span class="ot">=</span> <span class="dv">11000</span>  <span class="co"># run length</span></span>
<span id="cb22-11"><a></a>B <span class="ot">=</span> <span class="dv">1000</span>  <span class="co"># amount of burn-in</span></span>
<span id="cb22-12"><a></a>X <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>)  <span class="co"># overdispersed starting distribution</span></span>
<span id="cb22-13"><a></a>sigma <span class="ot">=</span> <span class="dv">1</span>  <span class="co"># proposal scaling</span></span>
<span id="cb22-14"><a></a>xlist <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>,M)  <span class="co"># for keeping track of chain values</span></span>
<span id="cb22-15"><a></a>hlist <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>,M)  <span class="co"># for keeping track of h function values</span></span>
<span id="cb22-16"><a></a>numaccept <span class="ot">=</span> <span class="dv">0</span>;</span>
<span id="cb22-17"><a></a></span>
<span id="cb22-18"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M) {</span>
<span id="cb22-19"><a></a>  Y <span class="ot">=</span> X <span class="sc">+</span> sigma <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)  <span class="co"># proposal value</span></span>
<span id="cb22-20"><a></a>  U <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>)              <span class="co"># for accept/reject</span></span>
<span id="cb22-21"><a></a>  alpha <span class="ot">=</span> <span class="fu">g</span>(Y) <span class="sc">/</span> <span class="fu">g</span>(X)       <span class="co"># for accept/reject</span></span>
<span id="cb22-22"><a></a>  <span class="cf">if</span> (U <span class="sc">&lt;</span> alpha) {</span>
<span id="cb22-23"><a></a>    X <span class="ot">=</span> Y                   <span class="co"># accept proposal</span></span>
<span id="cb22-24"><a></a>    numaccept <span class="ot">=</span> numaccept <span class="sc">+</span> <span class="dv">1</span>;</span>
<span id="cb22-25"><a></a>  }</span>
<span id="cb22-26"><a></a>    xlist[i] <span class="ot">=</span> X;</span>
<span id="cb22-27"><a></a>    hlist[i] <span class="ot">=</span> <span class="fu">h</span>(X);</span>
<span id="cb22-28"><a></a>}</span>
<span id="cb22-29"><a></a></span>
<span id="cb22-30"><a></a>u <span class="ot">=</span> <span class="fu">mean</span>(hlist[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>M])</span>
<span id="cb22-31"><a></a>se1 <span class="ot">=</span>  <span class="fu">sd</span>(hlist[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>M]) <span class="sc">/</span> <span class="fu">sqrt</span>(M<span class="sc">-</span>B)</span>
<span id="cb22-32"><a></a>varfact <span class="ot">&lt;-</span> <span class="cf">function</span>(xxx) { <span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">acf</span>(xxx, <span class="at">plot=</span><span class="cn">FALSE</span>)<span class="sc">$</span>acf) <span class="sc">-</span> <span class="dv">1</span> }</span>
<span id="cb22-33"><a></a>thevarfact <span class="ot">=</span> <span class="fu">varfact</span>(hlist[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>M])</span>
<span id="cb22-34"><a></a>se <span class="ot">=</span> se1 <span class="sc">*</span> <span class="fu">sqrt</span>( thevarfact )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb23-2"><a></a>  <span class="at">measure =</span> <span class="fu">c</span>(<span class="st">"iterations"</span>,<span class="st">"burn-in"</span>,<span class="st">"mean of h"</span>,<span class="st">"iid se"</span>,<span class="st">"varfact"</span>,<span class="st">"true se"</span>,<span class="st">"95% CI lb"</span>,<span class="st">"95% CI ub"</span>)</span>
<span id="cb23-3"><a></a>  , <span class="at">value =</span> <span class="fu">c</span>(M,B,u,se1,thevarfact,se,u<span class="fl">-1.96</span><span class="sc">*</span>se,u<span class="fl">+1.96</span><span class="sc">*</span>se)</span>
<span id="cb23-4"><a></a>) <span class="sc">|&gt;</span> </span>
<span id="cb23-5"><a></a>gt<span class="sc">::</span><span class="fu">gt</span>(<span class="st">"measure"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-6"><a></a>gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">rows =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">decimals =</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-7"><a></a>gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">rows =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-8"><a></a>gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="qogpyngwtd" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#qogpyngwtd table {
  font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qogpyngwtd thead, #qogpyngwtd tbody, #qogpyngwtd tfoot, #qogpyngwtd tr, #qogpyngwtd td, #qogpyngwtd th {
  border-style: none;
}

#qogpyngwtd p {
  margin: 0;
  padding: 0;
}

#qogpyngwtd .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #FFFFFF;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qogpyngwtd .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qogpyngwtd .gt_title {
  color: #333333;
  font-size: 24px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qogpyngwtd .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qogpyngwtd .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qogpyngwtd .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qogpyngwtd .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qogpyngwtd .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qogpyngwtd .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qogpyngwtd .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qogpyngwtd .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qogpyngwtd .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qogpyngwtd .gt_spanner_row {
  border-bottom-style: hidden;
}

#qogpyngwtd .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qogpyngwtd .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qogpyngwtd .gt_from_md > :first-child {
  margin-top: 0;
}

#qogpyngwtd .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qogpyngwtd .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #F6F7F7;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qogpyngwtd .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qogpyngwtd .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qogpyngwtd .gt_row_group_first td {
  border-top-width: 2px;
}

#qogpyngwtd .gt_row_group_first th {
  border-top-width: 2px;
}

#qogpyngwtd .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qogpyngwtd .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qogpyngwtd .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qogpyngwtd .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qogpyngwtd .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qogpyngwtd .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qogpyngwtd .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qogpyngwtd .gt_striped {
  background-color: #FAFAFA;
}

#qogpyngwtd .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qogpyngwtd .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qogpyngwtd .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qogpyngwtd .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qogpyngwtd .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qogpyngwtd .gt_left {
  text-align: left;
}

#qogpyngwtd .gt_center {
  text-align: center;
}

#qogpyngwtd .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qogpyngwtd .gt_font_normal {
  font-weight: normal;
}

#qogpyngwtd .gt_font_bold {
  font-weight: bold;
}

#qogpyngwtd .gt_font_italic {
  font-style: italic;
}

#qogpyngwtd .gt_super {
  font-size: 65%;
}

#qogpyngwtd .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qogpyngwtd .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qogpyngwtd .gt_indent_1 {
  text-indent: 5px;
}

#qogpyngwtd .gt_indent_2 {
  text-indent: 10px;
}

#qogpyngwtd .gt_indent_3 {
  text-indent: 15px;
}

#qogpyngwtd .gt_indent_4 {
  text-indent: 20px;
}

#qogpyngwtd .gt_indent_5 {
  text-indent: 25px;
}

#qogpyngwtd .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qogpyngwtd div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">value</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">iterations</td>
<td class="gt_row gt_right" headers="stub_1_1 value">11,000</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">burn-in</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 value">1,000</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">mean of h</td>
<td class="gt_row gt_right" headers="stub_1_3 value">0.7730</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">iid se</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 value">0.0017</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">varfact</td>
<td class="gt_row gt_right" headers="stub_1_5 value">21.0156</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">true se</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 value">0.0076</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">95% CI lb</td>
<td class="gt_row gt_right" headers="stub_1_7 value">0.7581</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">95% CI ub</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_8 value">0.7879</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(xlist), <span class="at">y=</span>xlist) <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb24-3"><a></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Plot of accepted values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="BSMM_8740_lec_09_files/figure-html/unnamed-chunk-18-1.png" width="864"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="mcmc-metropolis-algo-4" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">target</a></li><li><a href="#tabset-2-2">code</a></li><li><a href="#tabset-2-3">samples</a></li><li><a href="#tabset-2-4">histogram</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>target density shape</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>p <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb25-2"><a></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb25-3"><a></a>sd <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb25-4"><a></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb25-5"><a></a>    p     <span class="sc">*</span> <span class="fu">dnorm</span>(x, mu[<span class="dv">1</span>], sd[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb25-6"><a></a>    (<span class="dv">1</span><span class="sc">-</span>p) <span class="sc">*</span> <span class="fu">dnorm</span>(x, mu[<span class="dv">2</span>], sd[<span class="dv">2</span>])</span>
<span id="cb25-7"><a></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">10.1</span>, <span class="dv">2</span>, .<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">oma=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb25-8"><a></a><span class="fu">curve</span>(<span class="fu">f</span>(x), <span class="at">col=</span><span class="st">"red"</span>, <span class="sc">-</span><span class="dv">4</span>, <span class="dv">8</span>, <span class="at">n=</span><span class="dv">301</span>, <span class="at">las=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="BSMM_8740_lec_09_files/figure-html/unnamed-chunk-19-1.png" class="quarto-figure quarto-figure-center" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<details class="code-fold">
<summary>Metropolis sampling algrithm</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>propose <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">rnorm</span>(<span class="dv">1</span>, x, <span class="dv">4</span>)</span>
<span id="cb26-2"><a></a>step <span class="ot">&lt;-</span> <span class="cf">function</span>(x, f, q) {</span>
<span id="cb26-3"><a></a>    <span class="do">## Pick new point</span></span>
<span id="cb26-4"><a></a>    xp <span class="ot">&lt;-</span> <span class="fu">propose</span>(x)</span>
<span id="cb26-5"><a></a>    <span class="do">## Acceptance probability:</span></span>
<span id="cb26-6"><a></a>    alpha <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, <span class="fu">f</span>(xp) <span class="sc">/</span> <span class="fu">f</span>(x))</span>
<span id="cb26-7"><a></a>    <span class="do">## Accept new point with probability alpha:</span></span>
<span id="cb26-8"><a></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> alpha) x <span class="ot">&lt;-</span> xp</span>
<span id="cb26-9"><a></a>    <span class="do">## Returning the point:</span></span>
<span id="cb26-10"><a></a>    x</span>
<span id="cb26-11"><a></a>}</span>
<span id="cb26-12"><a></a>run <span class="ot">&lt;-</span> <span class="cf">function</span>(x, f, q, nsteps) {</span>
<span id="cb26-13"><a></a>    res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, nsteps, <span class="fu">length</span>(x))</span>
<span id="cb26-14"><a></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(nsteps))</span>
<span id="cb26-15"><a></a>        res[i,] <span class="ot">&lt;-</span> x <span class="ot">&lt;-</span> <span class="fu">step</span>(x, f, q)</span>
<span id="cb26-16"><a></a>    <span class="fu">drop</span>(res)</span>
<span id="cb26-17"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-3">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Metropolis samples from target</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>res <span class="ot">&lt;-</span> <span class="fu">run</span>(<span class="sc">-</span><span class="dv">10</span>, f, q, <span class="dv">1000</span>)</span>
<span id="cb27-2"><a></a></span>
<span id="cb27-3"><a></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>))</span>
<span id="cb27-4"><a></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">10.1</span>, <span class="fl">1.5</span>, .<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">oma=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb27-5"><a></a><span class="fu">plot</span>(res, <span class="at">type=</span><span class="st">"s"</span>, <span class="at">xpd=</span><span class="cn">NA</span>, <span class="at">ylab=</span><span class="st">"Parameter"</span>, <span class="at">xlab=</span><span class="st">"Sample"</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb27-6"><a></a>usr <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="st">"usr"</span>)</span>
<span id="cb27-7"><a></a>xx <span class="ot">&lt;-</span> <span class="fu">seq</span>(usr[<span class="dv">3</span>], usr[<span class="dv">4</span>], <span class="at">length=</span><span class="dv">301</span>)</span>
<span id="cb27-8"><a></a><span class="fu">plot</span>(<span class="fu">f</span>(xx), xx, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">yaxs=</span><span class="st">"i"</span>, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="BSMM_8740_lec_09_files/figure-html/unnamed-chunk-21-1.png" class="quarto-figure quarto-figure-center" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-4">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Metropolis samples from target: histogram</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">10.1</span>, <span class="fl">1.5</span>, .<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">oma=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb28-2"><a></a><span class="fu">hist</span>(res, <span class="dv">50</span>, <span class="at">freq=</span><span class="cn">FALSE</span>, <span class="at">main=</span><span class="st">""</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">4</span>), <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb28-3"><a></a>     <span class="at">xlab=</span><span class="st">"x"</span>, <span class="at">ylab=</span><span class="st">"Probability density"</span>)</span>
<span id="cb28-4"><a></a>z <span class="ot">&lt;-</span> <span class="fu">integrate</span>(f, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>)<span class="sc">$</span>value</span>
<span id="cb28-5"><a></a><span class="fu">curve</span>(<span class="fu">f</span>(x) <span class="sc">/</span> z, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">n=</span><span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="BSMM_8740_lec_09_files/figure-html/unnamed-chunk-22-1.png" class="quarto-figure quarto-figure-center" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="mcmc-metropolis-algo-5" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<h4 id="discrete-case">Discrete case</h4>
<ul>
<li><p>stationary means that if <span class="math inline">\(X_0\sim\pi\)</span>, i.e.&nbsp;<span class="math inline">\(\mathbb{P}(X_0=i)=\pi(i)\)</span>, then <span class="math inline">\(\mathbb{P}(X_1=j)=\pi(j),\;\forall j\)</span></p></li>
<li><p><span class="math inline">\(\mathbb{P}(X_1=j)=\sum_{i\in S}\mathbb{P}\left(X_0=i,X_1=j\right)\)</span> which is <span class="math inline">\(\sum_{i\in S}\mathbb{P}(X_0=i)\mathsf{P}(i,j)\)</span></p></li>
<li><p>so <span class="math inline">\(\pi\)</span> is stationary if <span class="math inline">\(\sum_{i\in S}\pi(i)\mathsf{P}(i,j)=\pi(j),\;\forall j\)</span></p></li>
</ul>
</section>
<section id="mcmc-metropolis-algo-6" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<h4 id="discrete-case-1">Discrete case</h4>
<p>let <span class="math inline">\(q(x,y)=\mathbb{P}(Y_n=y|X_{n-1}=x)\)</span> be the proposal distribution</p>
<ul>
<li><p>assume <span class="math inline">\(q\)</span> is symmetic, i.e.&nbsp;<span class="math inline">\(q(x,y)=q(y,x),\;\forall x,y\)</span></p></li>
<li><p>then if <span class="math inline">\(\alpha(x,y)\)</span> is the acceptance probability from <span class="math inline">\(x\)</span> to <span class="math inline">\(y\)</span>:</p></li>
</ul>
<p><span class="math display">\[
\begin{align*}
\alpha(x,y) &amp; =\mathbb{P}(U_{n}&lt;A_{n}|X_{n-1}=x,Y_{n}=y)\\
&amp; \mathbb{P}\left(U_{n}&lt;\frac{\pi(y)}{\pi(x)}\right)=\min\left[1,\frac{\pi(y)}{\pi(x)}\right]
\end{align*}
\]</span></p>
</section>
<section id="mcmc-metropolis-algo-7" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<h4 id="discrete-case-2">Discrete case</h4>
<p>Then, for <span class="math inline">\(i,j\)</span> in the state space, with <span class="math inline">\(i\ne j\)</span></p>
<p><span class="math display">\[
\begin{align*}
\mathsf{P}(i,j)=q(i,j)\alpha(i,j)=q(i,j)\min\left[1,\frac{\pi(j)}{\pi(i)}\right]
\end{align*}
\]</span></p>
<p>and, by symmetry of <span class="math inline">\(q\)</span></p>
<p><span class="math display">\[
\begin{align*}
\pi(i)\mathsf{P}(i,j) &amp; =q(i,j)\min\left(\pi(i),\pi(j)\right)\\
&amp; =q(j,i)\min\left(\pi(j),\pi(i)\right)=\pi(j)\mathsf{P}(j,i)
\end{align*}
\]</span></p>
</section>
<section id="mcmc-metropolis-algo-8" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<h4 id="discrete-case-3">Discrete case</h4>
<p>If <span class="math inline">\(X_0\sim\pi\)</span>, then</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{P}(X_{1}=j) &amp; =\sum_{i\in\chi}\mathbb{P}(X_{0}=i)\mathsf{P}(i,j)=\sum_{i\in\chi}\pi(i)\mathsf{P}(i,j)\\
&amp; =\sum_{i\in\chi}\pi(j)\mathsf{P}(j,i)=\pi(j)\sum_{i\in\chi}\mathsf{P}(j,i)\\
&amp; =\pi(j)
\end{align*}
\]</span></p>
<p>so <span class="math inline">\(X_1\sim\pi\)</span> too, and the Markov chain preserves <span class="math inline">\(\pi\)</span>, i.e.&nbsp;<span class="math inline">\(\pi\)</span> is a stationary distribution.</p>
</section>
<section id="mcmc-metropolis-algo-9" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<h4 id="example-2">example</h4>
<p><span class="math inline">\(\chi=\mathbb{Z}\)</span>, <span class="math inline">\(\pi(x)=2^{-|x|}/3\)</span>, and <span class="math inline">\(q(x,y)=\frac{1}{2}\)</span> if <span class="math inline">\(|x-y|=1\)</span>, otherwise <span class="math inline">\(0\)</span>.</p>
<ul>
<li>reversible? Yes, it’s a Metropolis algorithm</li>
<li><span class="math inline">\(\pi\)</span> stationary? Yes, follows from reversibility</li>
<li>aperiodic? Yes, since <span class="math inline">\(\mathsf{P}(x,\{x\})&gt;0\)</span></li>
<li>irreducible? Yes, since <span class="math inline">\(\pi(x)&gt;0,\forall x\in\chi\)</span></li>
</ul>
</section>
<section id="mcmc-metropolis-hastings-algo" class="slide level2">
<h2>MCMC Metropolis-Hastings Algo</h2>
<p>MCMC algorithms require that the MC chain is reversible, <span class="math inline">\(\pi\)</span>-stationary, aperiodic, and reducible.</p>
<p>The Metropolis algorithm uses the symmetry of the proposal distribution to ensure reversibility and irreducibility.</p>
<p>If the proposal distribution was not symmetric we might not have those two properties, e.g.&nbsp;if <span class="math inline">\(q(x,y) \gg q(y,x)\)</span> the the Metropolis chain would spend too much time at <span class="math inline">\(y\)</span> and not enough at <span class="math inline">\(x\)</span>, so it accepts fewer moves <span class="math inline">\(x\rightarrow y\)</span>.</p>
</section>
<section id="mcmc-metropolis-hastings-algo-1" class="slide level2">
<h2>MCMC Metropolis-Hastings Algo</h2>
<p>If we only require that <span class="math inline">\(q(x,y)&gt;0\;\textrm{iff}\; q(y,x)&gt;0\)</span>, then replace</p>
<p><span class="math display">\[
A_n = \frac{\pi(Y_n)}{\pi(X_{n-1})}\;\mathrm{with}\; A_n = \frac{\pi(Y_n)q(Y_n,X_{n-1})}{\pi(X_{n-1})q(X_{n-1},Y_n)}
\]</span></p>
<p>and the algorithm is still valid even if <span class="math inline">\(q\)</span> is not symmetric.</p>
</section>
<section id="mcmc-metropolis-hastings-algo-2" class="slide level2">
<h2>MCMC Metropolis-Hastings Algo</h2>
<p>Why is this valid?</p>
<p>For metropolis, the key was that the Markov chain was reversible, i.e.&nbsp;<span class="math inline">\(\pi(x)\mathsf{P}(x,y)=\pi(y)\mathsf{P}(y,x)\)</span></p>
<p>If instead <span class="math inline">\(A_n = \frac{\pi(Y_n)q(Y_n,X_{n-1})}{\pi(X_{n-1})q(X_{n-1},Y_n)}\)</span>, with acceptance probability <span class="math inline">\(\alpha(x,y)=\min\left[1,\frac{\pi(Y_n)q(Y_n,X_{n-1})}{\pi(X_{n-1})q(X_{n-1},Y_n)}\right]\)</span>, then</p>
<p><span class="math display">\[
\begin{align*}
q(x,y)\alpha(x,y)\pi(x) &amp; =q(x,y)\min\left[1,\frac{\pi(y)q(y,x)}{\pi(x)q(x,y)}\right]\pi(x)\\
&amp; =\min\left[\pi(x)q(x,y),\pi(y)q(y,x)\right]
\end{align*}
\]</span></p>
</section>
<section id="mcmc-metropolis-hastings-algo-3" class="slide level2">
<h2>MCMC Metropolis-Hastings Algo</h2>
<p>Then</p>
<ul>
<li><p><span class="math inline">\(\pi(x)\mathsf{P}(x,y)\)</span> is still symmetric, even if <span class="math inline">\(q\)</span> wasn’t.</p></li>
<li><p>the chain is still reversible, so there is a stationary distribution <span class="math inline">\(\pi\)</span>.</p></li>
<li><p>if the chain is irreducible and aperiodic, then it converges to <span class="math inline">\(\pi\)</span>.</p></li>
</ul>
</section>
<section id="mcmc-metropolis-hastings-algo-4" class="slide level2">
<h2>MCMC Metropolis-Hastings Algo</h2>
<h4 id="example-independence-sampler">example: independence sampler</h4>
<p>Here <span class="math inline">\(\{Y_n\}\sim q(\cdot)\)</span> i,e, the <span class="math inline">\(\{Y_n\}\)</span> are IID from some fixed density <span class="math inline">\(q\)</span>, independent of <span class="math inline">\(X_{n-1}\)</span> and we accept <span class="math inline">\(Y_n\)</span> if <span class="math inline">\(U_n&lt;A_n\)</span> where <span class="math inline">\(U_n\sim \textrm{Uniform}[0,1]\)</span> and</p>
<p><span class="math display">\[
A_n = \frac{\pi(Y_n)q(X_{n-1})}{\pi(X_{n-1})q(Y_n)}
\]</span></p>
</section>
<section id="mcmc-and-bayesian-analysis" class="slide level2">
<h2>MCMC and Bayesian Analysis</h2>
<p>The Bayesian model for updating parameter estimates is (to within a scaling constant)</p>
<p><span id="eq-bayes"><span class="math display">\[
\begin{align*}
\pi_\theta\left(\left.\theta\right|X\right)\sim\pi_X\left(\left.X\right|\theta\right)\times\pi_\theta\left(\theta\right)
\end{align*}
\tag{1}\]</span></span></p>
<p>where the parameter set <span class="math inline">\(\theta\)</span> depends on the assumed data generating process <span class="math inline">\(\pi_X\)</span>.</p>
<div style="font-size: 70%">
<p>In words: the joint probability of the parameters given the observed data is equal to (to within a scaling constant) the probability of the observed data given the parameters, times the prior probabilities of the parameters. In practice we refer to the probabilities as likelihoods, and use log-likelihoods in equation (<a href="#/eq-bayes" class="quarto-xref">Equation&nbsp;1</a>) to avoid numerical problems arising from the product of small probabilities.</p>
</div>
</section>
<section id="mcmc-and-bayesian-analysis-1" class="slide level2">
<h2>MCMC and Bayesian Analysis</h2>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">initial</a></li><li><a href="#tabset-3-2">updating</a></li><li><a href="#tabset-3-3">plots</a></li><li><a href="#tabset-3-4">plot code</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell">
<details class="code-fold">
<summary>Initial state: Bayesian parameter estimation, Binomial process</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a><span class="fu">set.seed</span>(<span class="dv">8740</span>)</span>
<span id="cb29-2"><a></a>p <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb29-3"><a></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb29-4"><a></a><span class="co"># range of probability [0.01 - 0.99]</span></span>
<span id="cb29-5"><a></a>p_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">0.99</span>,<span class="fl">0.001</span>)</span>
<span id="cb29-6"><a></a><span class="co"># prior probability is beta(1,1)</span></span>
<span id="cb29-7"><a></a>pr <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(p_values,<span class="dv">7</span>,<span class="dv">2</span>)</span>
<span id="cb29-8"><a></a><span class="co"># Have to normalize given discreteness</span></span>
<span id="cb29-9"><a></a>pr <span class="ot">&lt;-</span> pr <span class="sc">/</span> <span class="fu">sum</span>(pr) </span>
<span id="cb29-10"><a></a><span class="co"># create the data</span></span>
<span id="cb29-11"><a></a>dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">parameters =</span> p_values, <span class="at">prob =</span> pr, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">step=</span> <span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<details class="code-fold">
<summary>7 Bayesian updating steps</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a><span class="co"># Run for M samples</span></span>
<span id="cb30-2"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) {</span>
<span id="cb30-3"><a></a>  <span class="co"># have the data generating process generate a data point</span></span>
<span id="cb30-4"><a></a>  x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, p)</span>
<span id="cb30-5"><a></a>  <span class="co"># multiply the likelihood of observing the data point at each p-value</span></span>
<span id="cb30-6"><a></a>  <span class="co"># by the prior probability of each p-value:</span></span>
<span id="cb30-7"><a></a>  <span class="co"># this gives the posterior probability for each p-value</span></span>
<span id="cb30-8"><a></a>  ps <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(x, n, p_values) <span class="sc">*</span> pr</span>
<span id="cb30-9"><a></a>  <span class="co"># normalize</span></span>
<span id="cb30-10"><a></a>  ps <span class="ot">&lt;-</span> ps <span class="sc">/</span> <span class="fu">sum</span>(ps) </span>
<span id="cb30-11"><a></a>  <span class="co"># lines(ps~p_values, col=(i+1))</span></span>
<span id="cb30-12"><a></a>  <span class="co"># same the posterior p-value probabilities at this step</span></span>
<span id="cb30-13"><a></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb30-14"><a></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb30-15"><a></a>      tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">parameters =</span> p_values, <span class="at">prob =</span> ps, <span class="at">x =</span> x) <span class="sc">|&gt;</span></span>
<span id="cb30-16"><a></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">step =</span> i)</span>
<span id="cb30-17"><a></a>    )</span>
<span id="cb30-18"><a></a>  <span class="co"># update the prior probability of each p-value to be its posterior probability</span></span>
<span id="cb30-19"><a></a>  pr <span class="ot">=</span> ps</span>
<span id="cb30-20"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-3-3">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in
ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="BSMM_8740_lec_09_files/figure-html/unnamed-chunk-25-1.png" class="quarto-figure quarto-figure-center" width="1152"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-4">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Plots of Bayesian updating steps</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a>dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">group_by</span>(step) <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb32-3"><a></a>    <span class="at">title =</span></span>
<span id="cb32-4"><a></a>      dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb32-5"><a></a>        step <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">"Step {step}: prior mean is {(parameters*prob) |&gt; sum() |&gt; round(digits=3)}"</span>)</span>
<span id="cb32-6"><a></a>        , <span class="cn">TRUE</span> <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">"Step {step}: sample is {x} &amp; posterior mean is {(parameters*prob) |&gt; sum() |&gt; round(digits=3)}"</span>)</span>
<span id="cb32-7"><a></a>      )</span>
<span id="cb32-8"><a></a>  )</span>
<span id="cb32-9"><a></a></span>
<span id="cb32-10"><a></a>labels <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(step, title) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">step =</span> <span class="fu">factor</span>(step))</span>
<span id="cb32-11"><a></a>step_labels <span class="ot">&lt;-</span> <span class="fu">split</span>(labels<span class="sc">$</span>title, labels<span class="sc">$</span>step)</span>
<span id="cb32-12"><a></a>step_labeller <span class="ot">&lt;-</span> <span class="cf">function</span>(value){<span class="fu">return</span>(step_labels[value])}</span>
<span id="cb32-13"><a></a></span>
<span id="cb32-14"><a></a>dat <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">step =</span> <span class="fu">factor</span>(step)) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">group_by</span>(step) <span class="sc">|&gt;</span></span>
<span id="cb32-15"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> parameters, <span class="at">y=</span>prob, <span class="at">color =</span> step)) <span class="sc">+</span></span>
<span id="cb32-16"><a></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb32-17"><a></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">0.5</span>, <span class="at">color=</span><span class="st">"grey"</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb32-18"><a></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(step), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">labeller=</span><span class="fu">labeller</span>(<span class="at">step =</span> step_labeller)) <span class="sc">+</span></span>
<span id="cb32-19"><a></a>  <span class="fu">theme</span>(<span class="at">plot.margin=</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>), <span class="st">'cm'</span>)) <span class="sc">+</span></span>
<span id="cb32-20"><a></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb32-21"><a></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Bayesian updating"</span>, <span class="at">subtitle =</span> <span class="st">"Binomial data; n known, true p = 0.5"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="mcmc-and-bayesian-analysis-2" class="slide level2">
<h2>MCMC and Bayesian Analysis</h2>
<div style="font-size: x-large">
<p>It is more common to have multiple data points and multiple parameters. In this case we sample from the posterior using <span class="math inline">\(\pi_X\left(\left.X\right|\theta\right)\times\pi_\theta\left(\theta\right)\)</span> and a MCMC method like Metropolis Hastings.</p>
<p>In the example to follow, we observe <span class="math inline">\((y,x)\)</span> and we have parameters <span class="math inline">\(\theta=(a,b,\sigma)\)</span> that we want to estimate</p>
<ul>
<li>the data generation process is assumed to be <span class="math inline">\(y = \mathscr{N}(ax+b, \sigma^2)\)</span></li>
<li>we choose priors on the parameters as follows
<ul>
<li><span class="math inline">\(a=U[0,10]\)</span></li>
<li><span class="math inline">\(b=\mathscr{N}(0,5)\)</span></li>
<li><span class="math inline">\(\sigma=U[0,30]\)</span></li>
</ul></li>
</ul>
</div>
</section>
<section id="mcmc-and-bayesian-analysis-3" class="slide level2">
<h2>MCMC and Bayesian Analysis</h2>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">data</a></li><li><a href="#tabset-4-2">prior</a></li><li><a href="#tabset-4-3">likelihood</a></li><li><a href="#tabset-4-4">proposal</a></li><li><a href="#tabset-4-5">MH Algo</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a><span class="fu">set.seed</span>(<span class="dv">8740</span>)</span>
<span id="cb33-2"><a></a>a <span class="ot">=</span> <span class="dv">0</span>; b <span class="ot">=</span> <span class="dv">5</span>; sigma <span class="ot">=</span> <span class="dv">10</span>; sampleSize <span class="ot">=</span> <span class="dv">31</span></span>
<span id="cb33-3"><a></a></span>
<span id="cb33-4"><a></a>data <span class="ot">&lt;-</span> </span>
<span id="cb33-5"><a></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb33-6"><a></a>    <span class="at">x =</span> (<span class="sc">-</span>(sampleSize<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">2</span>)<span class="sc">:</span>((sampleSize<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb33-7"><a></a>    , <span class="at">y =</span>  a <span class="sc">+</span> b <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n=</span>sampleSize, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span>sigma)</span>
<span id="cb33-8"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>prior <span class="ot">=</span> <span class="cf">function</span>(param){</span>
<span id="cb34-2"><a></a>  aprior <span class="ot">=</span> <span class="fu">dunif</span>(param[<span class="dv">1</span>], <span class="at">min=</span><span class="dv">0</span>, <span class="at">max=</span><span class="dv">10</span>, <span class="at">log =</span> T)</span>
<span id="cb34-3"><a></a>  bprior <span class="ot">=</span> <span class="fu">dnorm</span>(param[<span class="dv">2</span>], <span class="at">sd =</span> <span class="dv">5</span>, <span class="at">log =</span> T)</span>
<span id="cb34-4"><a></a>  sdprior <span class="ot">=</span> <span class="fu">dunif</span>(param[<span class="dv">3</span>], <span class="at">min=</span><span class="dv">0</span>, <span class="at">max=</span><span class="dv">30</span>, <span class="at">log =</span> T)</span>
<span id="cb34-5"><a></a>  <span class="co"># return the log of the product of probabilities (parameters)</span></span>
<span id="cb34-6"><a></a>  <span class="fu">return</span>(aprior<span class="sc">+</span>bprior<span class="sc">+</span>sdprior)</span>
<span id="cb34-7"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>likelihood <span class="ot">=</span> <span class="cf">function</span>(param, x, y){</span>
<span id="cb35-2"><a></a>  pred <span class="ot">=</span> param[<span class="dv">2</span>] <span class="sc">+</span> param[<span class="dv">1</span>] <span class="sc">*</span> x </span>
<span id="cb35-3"><a></a>  singlelikelihoods <span class="ot">=</span> <span class="fu">dnorm</span>(y, <span class="at">mean =</span> pred, <span class="at">sd =</span> param[<span class="dv">3</span>], <span class="at">log =</span> T)</span>
<span id="cb35-4"><a></a>  sumll <span class="ot">=</span> <span class="fu">sum</span>(singlelikelihoods)</span>
<span id="cb35-5"><a></a>  <span class="co"># return the log of the product of probabilities (data)</span></span>
<span id="cb35-6"><a></a>  <span class="fu">return</span>(sumll)</span>
<span id="cb35-7"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-4">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a>proposalfunction <span class="ot">=</span> <span class="cf">function</span>(param){</span>
<span id="cb36-2"><a></a>  <span class="fu">return</span>( <span class="fu">rnorm</span>(<span class="dv">3</span>, <span class="at">mean =</span> param, <span class="at">sd=</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="fl">0.3</span>)) )</span>
<span id="cb36-3"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-5">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a>run_metropolis_MCMC <span class="ot">=</span> <span class="cf">function</span>(startvalue, iterations, data){</span>
<span id="cb37-2"><a></a>  <span class="co"># initialize</span></span>
<span id="cb37-3"><a></a>  chain <span class="ot">=</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(iterations<span class="sc">+</span><span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb37-4"><a></a>  chain[<span class="dv">1</span>,] <span class="ot">&lt;-</span> startvalue</span>
<span id="cb37-5"><a></a>  </span>
<span id="cb37-6"><a></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iterations){</span>
<span id="cb37-7"><a></a>    proposal <span class="ot">=</span> <span class="fu">proposalfunction</span>(chain[i,])</span>
<span id="cb37-8"><a></a>    probab <span class="ot">=</span> </span>
<span id="cb37-9"><a></a>      <span class="fu">exp</span>(</span>
<span id="cb37-10"><a></a>        <span class="fu">likelihood</span>(proposal, data<span class="sc">$</span>x, data<span class="sc">$</span>y) <span class="sc">+</span> </span>
<span id="cb37-11"><a></a>        <span class="fu">prior</span>(proposal) <span class="sc">-</span> </span>
<span id="cb37-12"><a></a>        <span class="fu">likelihood</span>(chain[i,], data<span class="sc">$</span>x, data<span class="sc">$</span>y) <span class="sc">-</span> </span>
<span id="cb37-13"><a></a>        <span class="fu">prior</span>(chain[i,])</span>
<span id="cb37-14"><a></a>      )</span>
<span id="cb37-15"><a></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> probab){</span>
<span id="cb37-16"><a></a>      chain[i<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">=</span> proposal</span>
<span id="cb37-17"><a></a>    }<span class="cf">else</span>{</span>
<span id="cb37-18"><a></a>      chain[i<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">=</span> chain[i,]</span>
<span id="cb37-19"><a></a>    }</span>
<span id="cb37-20"><a></a>  }</span>
<span id="cb37-21"><a></a>  <span class="fu">return</span>(chain)</span>
<span id="cb37-22"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="mcmc-and-bayesian-analysis-4" class="slide level2">
<h2>MCMC and Bayesian Analysis</h2>
<div class="cell">
<details class="code-fold">
<summary>MH algorithm generating posterior parameter probabilities</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a>startvalue <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">8</span>)</span>
<span id="cb38-2"><a></a>chain <span class="ot">=</span> <span class="fu">run_metropolis_MCMC</span>(startvalue, <span class="dv">20000</span>, data)</span>
<span id="cb38-3"><a></a></span>
<span id="cb38-4"><a></a>mcm_chain <span class="ot">&lt;-</span> coda<span class="sc">::</span><span class="fu">mcmc</span>(chain)</span>
<span id="cb38-5"><a></a>smry <span class="ot">&lt;-</span> <span class="fu">summary</span>(mcm_chain)</span>
<span id="cb38-6"><a></a>smry<span class="sc">$</span>statistics <span class="sc">|&gt;</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-7"><a></a>  dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(smry<span class="sc">$</span>quantiles <span class="sc">|&gt;</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>()) <span class="sc">|&gt;</span></span>
<span id="cb38-8"><a></a>  tibble<span class="sc">::</span><span class="fu">add_column</span>(<span class="at">param =</span> <span class="fu">c</span>(<span class="st">'b'</span>,<span class="st">'a'</span>,<span class="st">'sigma'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-9"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>(<span class="st">"param"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-10"><a></a>  gt<span class="sc">::</span><span class="fu">tab_spanner</span>(<span class="at">label =</span> <span class="st">"percentiles"</span>, <span class="at">columns =</span> <span class="fu">ends_with</span>(<span class="st">"%"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-11"><a></a>  gt<span class="sc">::</span><span class="fu">tab_options</span>( <span class="at">table.font.size =</span> gt<span class="sc">::</span><span class="fu">px</span>(<span class="dv">48</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-12"><a></a>  gtExtras<span class="sc">::</span><span class="fu">gt_theme_espn</span>() <span class="sc">|&gt;</span></span>
<span id="cb38-13"><a></a>  gt<span class="sc">::</span><span class="fu">as_raw_html</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="masivlamnb" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
  
  
<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family: Lato, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 3px; border-top-color: #FFFFFF; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;" data-bgcolor="#FFFFFF">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead style="border-style: none;">
<tr class="gt_col_headings gt_spanner_row header" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; border-bottom-style: hidden;">
<th rowspan="2" id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col" style="text-align: left; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden;" data-bgcolor="#FFFFFF" data-valign="bottom"></th>
<th rowspan="2" id="Mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">Mean</th>
<th rowspan="2" id="SD" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">SD</th>
<th rowspan="2" id="Naive-SE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">Naive SE</th>
<th rowspan="2" id="Time-series-SE" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">Time-series SE</th>
<th colspan="5" id="percentiles" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup" style="text-align: center; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 0;" data-bgcolor="#FFFFFF"><div class="gt_column_spanner" style="border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%;">
percentiles
</div></th>
</tr>
<tr class="gt_col_headings even" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="a2.5%" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">2.5%</th>
<th id="a25%" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">25%</th>
<th id="a50%" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">50%</th>
<th id="a75%" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">75%</th>
<th id="a97.5%" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-bgcolor="#FFFFFF" data-valign="bottom">97.5%</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row" style="text-align: left; border-style: none; padding-top: 7px; padding-bottom: 7px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px;" data-valign="middle" data-bgcolor="#FFFFFF">b</td>
<td class="gt_row gt_right" headers="stub_1_1 Mean" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">4.8424</td>
<td class="gt_row gt_right" headers="stub_1_1 SD" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.1742</td>
<td class="gt_row gt_right" headers="stub_1_1 Naive SE" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.001232</td>
<td class="gt_row gt_right" headers="stub_1_1 Time-series SE" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.005517</td>
<td class="gt_row gt_right" headers="stub_1_1 2.5%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">4.498</td>
<td class="gt_row gt_right" headers="stub_1_1 25%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">4.7268</td>
<td class="gt_row gt_right" headers="stub_1_1 50%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">4.844</td>
<td class="gt_row gt_right" headers="stub_1_1 75%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">4.959</td>
<td class="gt_row gt_right" headers="stub_1_1 97.5%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">5.182</td>
</tr>
<tr class="even" style="border-style: none;">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row" style="text-align: left; border-style: none; padding-top: 7px; padding-bottom: 7px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px;" data-valign="middle" data-bgcolor="#FFFFFF">a</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 Mean" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0.6129</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 SD" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1.4354</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 Naive SE" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0.010149</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 Time-series SE" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0.070569</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 2.5%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">-2.173</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 25%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">-0.3511</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 50%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">0.616</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 75%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">1.560</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 97.5%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; background-color: #FAFAFA; font-variant-numeric: tabular-nums;" data-valign="middle" data-bgcolor="#FAFAFA">3.495</td>
</tr>
<tr class="odd" style="border-style: none;">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row" style="text-align: left; border-style: none; padding-top: 7px; padding-bottom: 7px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; color: #333333; background-color: #FFFFFF; font-size: 80%; font-weight: bolder; text-transform: uppercase; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px;" data-valign="middle" data-bgcolor="#FFFFFF">sigma</td>
<td class="gt_row gt_right" headers="stub_1_3 Mean" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">8.5691</td>
<td class="gt_row gt_right" headers="stub_1_3 SD" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">1.1006</td>
<td class="gt_row gt_right" headers="stub_1_3 Naive SE" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.007783</td>
<td class="gt_row gt_right" headers="stub_1_3 Time-series SE" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.068802</td>
<td class="gt_row gt_right" headers="stub_1_3 2.5%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">6.726</td>
<td class="gt_row gt_right" headers="stub_1_3 25%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">7.7719</td>
<td class="gt_row gt_right" headers="stub_1_3 50%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">8.496</td>
<td class="gt_row gt_right" headers="stub_1_3 75%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">9.256</td>
<td class="gt_row gt_right" headers="stub_1_3 97.5%" style="text-align: right; border-style: none; padding-top: 7px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #F6F7F7; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">10.982</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="mcmc-and-bayesian-analysis-5" class="slide level2">
<h2>MCMC and Bayesian Analysis</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>posterior parameter probability plots</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a><span class="fu">plot</span>(mcm_chain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="BSMM_8740_lec_09_files/figure-html/unnamed-chunk-33-1.png" class="quarto-figure quarto-figure-center r-stretch" width="672"></section>
<section id="mcmc-and-bayesian-analysis-6" class="slide level2">
<h2>MCMC and Bayesian Analysis</h2>
</section>
<section id="more" class="slide level2">
<h2>More</h2>
<ul>
<li>The Random Walk Metropolis: <a href="https://arxiv.org/pdf/1011.6217">Linking Theory and Practice Through a Case Study</a></li>
<li>“The Metropolis-Hastings Algorithm.” April 12, 2023. <a href="https://blog.djnavarro.net/posts/2023-04-12_metropolis-hastings/" class="uri">https://blog.djnavarro.net/posts/2023-04-12_metropolis-hastings/</a>.</li>
<li><a href="https://gregorygundersen.com/blog/2019/11/02/metropolis-hastings/">Why Metropolis–Hastings Works</a></li>
</ul>
</section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<ul>
<li>The week we’ve introduced Monte Carlo (MC) methods for sampling from probability distributions, including using those sample to estimate expected values.</li>
<li>We discus importance sampling, rejection sampling, and Markov Chain Monte Carlo (MCMC) methods, particularily the particularly the Metropolis and Metropolis-Hastings methods.</li>
<li>Finally, we applied the Metropolis-Hastings methods in Bayesian analytics, generating Bayesian estimates for the parameters of linear regression.</li>
</ul>


</section></section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="images/logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://bsmm-8740-fall-2024.github.io/osb/">bsmm-8740-fall-2024.github.io/osb</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true,"numbers":true},
'chalkboard': {"buttons":true},
'multiplex': {"secret":null,"id":"b63bb6dab2164324","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 5.0e-2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/bsmm-8740-fall-2025\.github\.io\/osb\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>