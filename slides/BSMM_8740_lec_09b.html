<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.39">

  <meta name="author" content="L.L. Odette">
  <title>BSMM-8740 - Fall 2024 – Monte Carlo Methods</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-a8986e45384d4e2047f3d84b21c5a23c.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<meta property="og:title" content="Monte Carlo Methods – BSMM-8740 - Fall 2024">
<meta property="og:description" content="BSMM8740-2-R-2024F [WEEK - 9]">
<meta property="og:site_name" content="BSMM-8740 - Fall 2024">
<meta name="twitter:title" content="Monte Carlo Methods – BSMM-8740 - Fall 2024">
<meta name="twitter:description" content="BSMM8740-2-R-2024F [WEEK - 9]">
<meta name="twitter:image" content="https://bsmm-8740-fall-2024.github.io/osb/slides/images/twitter-card.png">
<meta name="twitter:creator" content="@lodette">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Monte Carlo Methods</h1>
  <p class="subtitle">BSMM8740-2-R-2024F [WEEK - 9]</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
L.L. Odette 
</div>
</div>
</div>

</section>
<section id="recap-of-last-week" class="slide level2">
<h2>Recap of last week</h2>
<ul>
<li>Last week we introduced the fundamental problems of inference and the biases of some intuitive estimators.</li>
<li>We also built a basic understanding of the tools used to state and then satisfy causality assumptions.</li>
</ul>
</section>
<section id="this-week" class="slide level2">
<h2>This week</h2>
<ul>
<li>We will get explore Monte Carlo methods as a way to integrate difficult functions, and sample from difficult probability distributions.</li>
<li>Along the way we will look at Markov Chains which both underlie sampling methods and provide a way to model the generation of data.</li>
</ul>
</section>
<section id="monte-carlo-mc-methods" class="slide level2">
<h2>Monte Carlo (MC) Methods</h2>
<p>Monte Carlo methods are a class of <em>simulation-based</em> methods that seek to avoid complicated and/or intractable mathematical computations.</p>
<p>Especially those that arise from probability distributions.</p>
</section>
<section id="mc-methods" class="slide level2">
<h2>MC Methods</h2>
<p>We can use MC methods to estimate probabilities: for a random variable <span class="math inline">\(Z\)</span> with outcomes in a set <span class="math inline">\(\Omega\)</span>, with some subset <span class="math inline">\(S\subset\Omega\)</span> and event <span class="math inline">\(E\equiv Z\in S\)</span>, we can compute the probability of <span class="math inline">\(E\)</span> (i.e.&nbsp;<span class="math inline">\(\mathbb{P}(E)\)</span>) with of samples of <span class="math inline">\(Z\)</span>, say <span class="math inline">\(z_1,z_2,\ldots,z_M\)</span> as</p>
<p><span class="math display">\[
\mathbb{P}(E) = \frac{1}{M}\sum_{i=1}^M 1_{z_i\in S}
\]</span></p>
</section>
<section id="mc-methods-1" class="slide level2">
<h2>MC Methods</h2>
<h4 id="example">Example</h4>
<p>If <span class="math inline">\(Z\sim\mathscr{N}(1,3)\)</span> and <span class="math inline">\(S=Z:0\le Z\le 3\)</span> then</p>
<p><span class="math display">\[
\mathbb{P}(E) = \mathbb{P}(0\le Z\le 3) = \int_0^3\frac{1}{\sqrt{2\pi3}}e^{-\frac{(t-1)^2}{2*3}}dt
\]</span> In which case it is easier to just use R and calculate:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">pnorm</span>(<span class="dv">3</span>, <span class="at">mean=</span><span class="dv">1</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="dv">3</span>)) <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="dv">0</span>, <span class="at">mean=</span><span class="dv">1</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.594</code></pre>
</div>
</div>
<p>than it is to compute the integral.</p>
</section>
<section id="mc-methods-2" class="slide level2">
<h2>MC Methods</h2>
<h4 id="example-continued">Example continued</h4>
<p>Surprisingly, in case we don’t know that <code>pnorm</code> exists, we could do this:</p>
<div class="cell">
<details class="code-fold">
<summary>MC computation</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="co"># define the event</span></span>
<span id="cb3-2"><a></a>event_E_happened <span class="ot">&lt;-</span> <span class="cf">function</span>( x ) {</span>
<span id="cb3-3"><a></a>  <span class="cf">if</span>( <span class="dv">0</span> <span class="sc">&lt;=</span> x <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">3</span> ) {</span>
<span id="cb3-4"><a></a>    <span class="fu">return</span>( <span class="cn">TRUE</span> ) <span class="co"># The event happened</span></span>
<span id="cb3-5"><a></a>  } <span class="cf">else</span> {</span>
<span id="cb3-6"><a></a>    <span class="fu">return</span>( <span class="cn">FALSE</span> ) <span class="co"># The event DIDN'T happen</span></span>
<span id="cb3-7"><a></a>  }</span>
<span id="cb3-8"><a></a>}</span>
<span id="cb3-9"><a></a></span>
<span id="cb3-10"><a></a><span class="co"># Now MC says that we should generate lots of copies of Z...</span></span>
<span id="cb3-11"><a></a>NMC <span class="ot">&lt;-</span> <span class="dv">10000</span>; <span class="co"># 10000 seems like "a lot".</span></span>
<span id="cb3-12"><a></a><span class="fu">rnorm</span>( NMC, <span class="at">mean=</span><span class="dv">1</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="dv">3</span>) ) <span class="sc">|&gt;</span> </span>
<span id="cb3-13"><a></a>  purrr<span class="sc">::</span><span class="fu">map_lgl</span>(event_E_happened) <span class="sc">|&gt;</span> </span>
<span id="cb3-14"><a></a>  <span class="fu">sum</span>()<span class="sc">/</span>NMC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6084</code></pre>
</div>
</div>
</section>
<section id="mc-methods-3" class="slide level2">
<h2>MC Methods</h2>
<p>Now</p>
<div style="font-size: x-large">
<p><span class="math display">\[
\mathbb{P}(E) = \frac{1}{M}\sum_{i=1}^M 1_{z_i\in S}
\]</span></p>
</div>
<p>is the MC estimate of <span class="math inline">\(\mathbb{E}[E]\)</span>, which is unbiased because for each <span class="math inline">\(i\)</span>, <span class="math inline">\(\mathbb{E}[1_{z_i\in S}]=\mathbb{E}[E]\)</span>, and the variance is</p>
<div style="font-size: x-large">
<p><span class="math display">\[
\mathrm{Var}\left({\mathbb{P}(E)}\right)=\frac{1}{M^2}\mathrm{Var}\left(\sum_{i=1}^M 1_{z_i\in S}\right)=\frac{1}{M^2}\sum_{i=1}^M \mathrm{Var}\left(1_{z_i\in S}\right)=\frac{1}{M} \mathrm{Var}\left(1_{z_i\in S}\right)
\]</span></p>
</div>
</section>
<section id="mc-methods-4" class="slide level2">
<h2>MC Methods</h2>
<p>This is true for any function of the random variable <span class="math inline">\(Z\)</span>, and</p>
<p><span class="math display">\[
\mathbb{E}\left[h(Z)\right]\approx \hat{h}=\frac{1}{M}\sum_{i=1}^M h(z_i)
\]</span></p>
<p>and the variance of <span class="math inline">\(h(Z)\)</span> decreases as <span class="math inline">\(1/M\)</span> by the same reasoning.</p>
</section>
<section id="random-number-generation" class="slide level2">
<h2>Random Number Generation</h2>
<p>Monte Carlo simulation starts with random number generation, usually split into 2 stages:</p>
<ul>
<li>generation of independent uniform <span class="math inline">\((0, 1)\)</span> random variables, and</li>
<li>conversion into random variables with a particular distribution (e.g.&nbsp;Normal)</li>
</ul>
<p><u><strong>Very important</strong></u>: never write your own generator, always use a well validated generator from a reputable source (e.g.&nbsp;R).</p>
</section>
<section id="random-number-generation-1" class="slide level2">
<h2>Random Number Generation</h2>
<p>Pseudo-random generators found in computers use a deterministic (i.e.&nbsp;repeatable) algorithm to generate a sequence of (apparently) random numbers on the <span class="math inline">\((0, 1)\)</span> interval.</p>
<p>What defines a good random number generator (RNG) has a long period – how long it takes before the sequence repeats itself <span class="math inline">\(2^{32}\)</span> is not enough (need at least <span class="math inline">\(2^{40}\)</span>). various statistical tests to measure “randomness” – well validated software will have gone through these checks.</p>
</section>
<section id="random-number-generation-2" class="slide level2">
<h2>Random Number Generation</h2>
<p>Recall that <span class="math inline">\(\mathscr{N}(0, 1)\)</span> Normal random variables (mean 0, variance 1) have the probability density function:</p>
<p><span class="math display">\[
p(x)=\frac{1}{2\pi}e^{-\frac{1}{2}x^2}\equiv\phi(x)
\]</span> and if <span class="math inline">\(X\sim\mathscr{N}(0, 1)\)</span> then its CDF is:</p>
<p><span class="math display">\[
\mathbb{P}[X\le x] = \int_{-\infty}^x\phi(x)dx
\]</span> ## Random Number Generation</p>
<p>The Box-Muller transformation method takes two independent uniform <span class="math inline">\((0, 1)\)</span> random numbers <span class="math inline">\(y_1\)</span>, <span class="math inline">\(y_2\)</span>, and defines:</p>
<p><span class="math display">\[
\begin{align*}
x_{1} &amp; =\sqrt{-2\log y_{1}}\cos(2\pi y_{2})\\
x_2&amp; =\sqrt{-2\log y_{1}}\sin(2\pi y_{2})
\end{align*}
\]</span> It can be proved that <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> are independent <span class="math inline">\(\mathscr{N}(0, 1)\)</span> random variables</p>
</section>
<section id="random-number-generation-3" class="slide level2">
<h2>Random Number Generation</h2>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>samples <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">10000</span>), <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb5-3"><a></a>    <span class="at">normals =</span> </span>
<span id="cb5-4"><a></a>      purrr<span class="sc">::</span><span class="fu">map2</span>(</span>
<span id="cb5-5"><a></a>        X1, X2</span>
<span id="cb5-6"><a></a>        ,(\(x1,x2){</span>
<span id="cb5-7"><a></a>          <span class="fu">data.frame</span>(</span>
<span id="cb5-8"><a></a>            <span class="at">y1 =</span> <span class="fu">sqrt</span>( <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(x1) ) <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> x2)</span>
<span id="cb5-9"><a></a>            , <span class="at">y2 =</span> <span class="fu">sqrt</span>( <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(x1) ) <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> x2) </span>
<span id="cb5-10"><a></a>          )</span>
<span id="cb5-11"><a></a>        })</span>
<span id="cb5-12"><a></a>      )</span>
<span id="cb5-13"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb5-14"><a></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(normals)  </span>
<span id="cb5-15"><a></a>  </span>
<span id="cb5-16"><a></a></span>
<span id="cb5-17"><a></a>samples <span class="sc">|&gt;</span> </span>
<span id="cb5-18"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(X1,X2)) <span class="sc">|&gt;</span> </span>
<span id="cb5-19"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>value, <span class="at">color=</span>name, <span class="at">fill=</span>name)) <span class="sc">+</span> </span>
<span id="cb5-20"><a></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..), <span class="at">bins =</span> <span class="dv">60</span>, <span class="at">position=</span><span class="st">"identity"</span>, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb5-21"><a></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Value"</span>, <span class="at">y=</span><span class="st">"Density"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..density..`) was deprecated in
ggplot2 3.4.0.
ℹ Please use `after_stat(density)` instead.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>samples <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>y1, <span class="at">y=</span>y2)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell column-page quarto-layout-panel" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="BSMM_8740_lec_09b_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<figcaption>Normal y1 vs Normal y2; independent random RVs</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="BSMM_8740_lec_09b_files/figure-html/unnamed-chunk-4-2.png" width="672"></p>
<figcaption>Normal y1 vs Normal y2; independent random RVs</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="random-number-generation-4" class="slide level2">
<h2>Random Number Generation</h2>
<p>Your computer is only capable of producing pseudorandom numbers. These are made by running a pseudorandom number generator algorithm which is deterministic, e.g.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="fu">set.seed</span>(<span class="dv">340</span>)</span>
<span id="cb8-2"><a></a><span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.1574 -1.1989 -0.8892  1.0091  0.6130  1.0072
 [7]  0.4144 -1.8579 -1.3487  0.5189</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">set.seed</span>(<span class="dv">340</span>)</span>
<span id="cb10-2"><a></a><span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.1574 -1.1989 -0.8892  1.0091  0.6130  1.0072
 [7]  0.4144 -1.8579 -1.3487  0.5189</code></pre>
</div>
</div>
<p>Once the RNG seed is set, the “random” numbers that R generates aren’t random at all. But someone looking at these random numbers would have a very hard time distinguishing these numbers from truly random numbers. That is what “statistical randomness” means!</p>
</section>
<section id="central-limit-theorem" class="slide level2">
<h2>Central Limit Theorem</h2>
<p>The CLT says that for <span class="math inline">\(f=\mathbb{P}(E)\)</span> if <span class="math inline">\(\sigma^2\equiv\mathrm{Var}\left(f\right)\)</span> is finite then the error of the MC estimate</p>
<p><span class="math display">\[
e_N(f)=\bar{f}-\mathbb{E}[f]
\]</span></p>
<p>is approximately Normal in distribution for large <span class="math inline">\(M\)</span>, i.e.</p>
<p><span class="math display">\[
e_N(f)\sim\sigma M^{1/2}Z
\]</span> where <span class="math inline">\(Z\sim\mathscr{N}(0,1)\)</span></p>
</section>
<section id="mc-methods-5" class="slide level2">
<h2>MC Methods</h2>
<p>Suppose we need to compute an expectation <span class="math inline">\(\mathbb{E}[g(Z)]\)</span> for some random variable <span class="math inline">\(Z\)</span> and some function <span class="math inline">\(g:\mathbb{R}\to\mathbb{R}\)</span>. Monte Carlo methods avoid doing any integration or summation and instead just generate lots of samples of <span class="math inline">\(Z\)</span>, say <span class="math inline">\(z_1,z_2,\ldots,z_M\)</span> and <em>estimate</em> <span class="math inline">\(\mathbb{E}[g(Z)]\)</span> as <span class="math inline">\(\frac{1}{M}\sum_{i=1}^Mg(z_i)\)</span>. The law of large numbers states that this sample mean should be close to <span class="math inline">\(\mathbb{E}[g(Z)]\)</span>.</p>
<p>Said another way, Monte Carlo replaces the work of computing an integral (i.e., an expectation) with the work of generating lots of random variables.</p>
</section>
<section id="mc-methods-6" class="slide level2">
<h2>MC Methods</h2>
<div style="font-size: x-large">
<p>We can use Monte Carlo to estimate probabilities of the form <span class="math inline">\(\mathbb{P}\left[E\right]\)</span> by approximating expectations of the form <span class="math inline">\(\mathbb{E}[1_{X\in E}]\)</span>.</p>
<p>If <span class="math inline">\(X\sim\mathscr{N}(\mu,\sigma)\)</span> and we want to compute <span class="math inline">\(\mathbb{E}[\log|X|]\)</span>, we could set up and solve the integral</p>
<p><span class="math display">\[
\mathbb{E} \log |X|
= \int_{-\infty}^\infty \left( \log |t| \right) f( t; \mu, \sigma) dt
= \int_{-\infty}^\infty \frac{ \log |t| }{ \sqrt{2\pi \sigma^2} }
                  \exp\left\{ \frac{ -(t-\mu)^2 }{ 2\sigma^2 } \right\}dt
\]</span></p>
<p>Alternatively, we could just draw lots of Monte Carlo replicates <span class="math inline">\(X_1,X_2,\cdots,X_M\)</span> from a normal with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span>, and look at the sample mean <span class="math inline">\(M^{-1}\sum_{i=1}^M\log|x_i|\)</span>, once again appealing to the law of large numbers to ensure that this sample mean is close to its expectation.</p>
<p>Monte Carlo replaces the work of computing an integral (i.e., an expectation) with the work of generating lots of random variables.</p>
</div>
</section>
<section id="mc-methods-7" class="slide level2">
<h2>MC Methods</h2>
<div style="font-size: x-large">
<p>This idea can be pushed still further. Suppose that we want to compute an integral</p>
<p><span class="math display">\[
\int_Dg(x)dx
\]</span> where <span class="math inline">\(D\)</span> is some domain of integration and <span class="math inline">\(g(.)\)</span> is a function.</p>
<p>Let <span class="math inline">\(f(x)\)</span> be the density of some random variable with <span class="math inline">\(f(x)&gt;0, \forall x\in D\)</span>. In other words, <span class="math inline">\(f\)</span> is the density of a random variable supported on <span class="math inline">\(D\)</span>. Then we can rewrite the integral as</p>
<p><span class="math display">\[
\int_Dg(x)dx = \int_D\frac{g(x)}{f(x)}f(x)dx = \mathbb{E}[h(x)]
\]</span> where <span class="math inline">\(h(x)=g(x)/f(x)\)</span> and <span class="math inline">\(X\sim f\)</span></p>
</div>
</section>
<section id="mc-methods-8" class="slide level2">
<h2>MC Methods</h2>
<div style="font-size: x-large">
<p>Now suppose we are given <span class="math inline">\(h(x)\)</span> and we want to compute <span class="math inline">\(\mathbb{E}[h(X)]\)</span> where <span class="math inline">\(X\sim f,\,x\in D\)</span>. So we need to sample from <span class="math inline">\(f\)</span>, but what if we could not do that directly?</p>
<p>If there were some other distribution <span class="math inline">\(g(x)\)</span> we could sample from, such that <span class="math inline">\(g(x)&gt;0,\,x\in D\)</span>, then</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{E}_{f}\left[h(x)\right] &amp; =\int_{D}h(x)f(x)dx\\
&amp; =\int_{S}h(x)\frac{f(x)}{g(x)}g(x)dx=\mathbb{E}_{g}\left[h(x)\frac{f(x)}{g(x)}\right]\\
&amp; =\frac{1}{n}\sum_{i=1}^{n}h(x_{i})\frac{f(x_{i})}{g(x_{i})}\quad x_{i}\sim g
\end{align*}
\]</span></p>
</div>
</section>
<section id="mc-methods-9" class="slide level2">
<h2>MC Methods</h2>
<div style="font-size: x-large">
<p>This is called importance sampling (IS).</p>
<ol type="1">
<li>draw iid <span class="math inline">\(x_1,x_2,\ldots,x_n\)</span> from g and calculate the importance weight <span class="math display">\[
w(x_i)=\frac{f(x_{i})}{g(x_{i})}
\]</span></li>
<li>estimate <span class="math inline">\(\mathbb{E}_f(h)\)</span> by <span class="math display">\[
\hat{\mu}_h=\frac{1}{n}\sum_{i=1}^nw(x_i)h(x_i)
\]</span></li>
</ol>
</div>
</section>
<section id="mc-methods-10" class="slide level2">
<h2>MC Methods</h2>
<h4 id="example-1">example</h4>
<div style="font-size: x-large">
<p>Estimate <span class="math inline">\(\mathbb E_f(X)\)</span> where <span class="math inline">\(f(x) = \sqrt{2/\pi}e^{-\frac{x^2}{2}};\;x\ge 0\)</span> (this is the half-Normal distribution)</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a>n <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb12-2"><a></a>X <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate=</span><span class="dv">2</span>)</span>
<span id="cb12-3"><a></a>W <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> X<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>X) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb12-4"><a></a></span>
<span id="cb12-5"><a></a>mu_h  <span class="ot">&lt;-</span> <span class="fu">mean</span>(W<span class="sc">*</span>X)</span>
<span id="cb12-6"><a></a>var_h <span class="ot">&lt;-</span> <span class="fu">var</span>(W<span class="sc">*</span>X)<span class="sc">/</span>n</span>
<span id="cb12-7"><a></a>se_h  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var_h)</span>
<span id="cb12-8"><a></a></span>
<span id="cb12-9"><a></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">mean =</span> mu_h,  <span class="at">variance =</span> var_h, <span class="st">'standard error'</span> <span class="ot">=</span> se_h) <span class="sc">|&gt;</span> </span>
<span id="cb12-10"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-11"><a></a>  gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">decimals=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="axenrzallf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#axenrzallf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#axenrzallf thead, #axenrzallf tbody, #axenrzallf tfoot, #axenrzallf tr, #axenrzallf td, #axenrzallf th {
  border-style: none;
}

#axenrzallf p {
  margin: 0;
  padding: 0;
}

#axenrzallf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#axenrzallf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#axenrzallf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#axenrzallf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#axenrzallf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#axenrzallf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axenrzallf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#axenrzallf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#axenrzallf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#axenrzallf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#axenrzallf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#axenrzallf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#axenrzallf .gt_spanner_row {
  border-bottom-style: hidden;
}

#axenrzallf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#axenrzallf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#axenrzallf .gt_from_md > :first-child {
  margin-top: 0;
}

#axenrzallf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#axenrzallf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#axenrzallf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#axenrzallf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#axenrzallf .gt_row_group_first td {
  border-top-width: 2px;
}

#axenrzallf .gt_row_group_first th {
  border-top-width: 2px;
}

#axenrzallf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#axenrzallf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#axenrzallf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#axenrzallf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axenrzallf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#axenrzallf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#axenrzallf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#axenrzallf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#axenrzallf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axenrzallf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#axenrzallf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#axenrzallf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#axenrzallf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#axenrzallf .gt_left {
  text-align: left;
}

#axenrzallf .gt_center {
  text-align: center;
}

#axenrzallf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#axenrzallf .gt_font_normal {
  font-weight: normal;
}

#axenrzallf .gt_font_bold {
  font-weight: bold;
}

#axenrzallf .gt_font_italic {
  font-style: italic;
}

#axenrzallf .gt_super {
  font-size: 65%;
}

#axenrzallf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#axenrzallf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#axenrzallf .gt_indent_1 {
  text-indent: 5px;
}

#axenrzallf .gt_indent_2 {
  text-indent: 10px;
}

#axenrzallf .gt_indent_3 {
  text-indent: 15px;
}

#axenrzallf .gt_indent_4 {
  text-indent: 20px;
}

#axenrzallf .gt_indent_5 {
  text-indent: 25px;
}

#axenrzallf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#axenrzallf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="variance" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">variance</th>
<th id="standard error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">standard error</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="mean">0.8030</td>
<td class="gt_row gt_right" headers="variance">0.0003</td>
<td class="gt_row gt_right" headers="standard error">0.0178</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="mc-methods-11" class="slide level2">
<h2>MC Methods</h2>
<h4 id="unknown-normalizing-constant">unknown normalizing constant</h4>
<div style="font-size: x-large">
<p>Suppose that <span class="math inline">\(q(x)&gt;0;\;x\in D\)</span> and <span class="math inline">\(\int_Dq(x)dx=Z_q&lt;\infty\)</span> The <span class="math inline">\(q()\)</span> is an un-normalized density on <span class="math inline">\(D\)</span> whereas the corresponding normalized density is <span class="math inline">\(\frac{1}{Z_q}q(x)\)</span>.</p>
<p>Using IS, let <span class="math inline">\(g(x) = \frac{1}{Z_r}r(x);\;Z_r=\int r(x)dx\)</span>, so <span class="math inline">\(r\)</span> is an un-normalized density with <span class="math inline">\(Z_r\)</span> possibly unknown.</p>
<ol type="1">
<li>Draw <span class="math inline">\(x_1,x_2,\ldots,x_n\)</span> from <span class="math inline">\(g(x)\)</span> and calculate importance weights <span class="math inline">\(w(x_i)=g(x_i)/r(x_i)\)</span></li>
<li>Estimate <span class="math inline">\(\mathbb{E}_f\left[h(X)\right]\)</span> by <span class="math display">\[
\hat{\mu_h}=\frac{\sum_{i=1}^nw(x_i)h(x_i)}{\sum_{i=1}^nw(x_i)}
\]</span></li>
</ol>
</div>
</section>
<section id="mc-methods-12" class="slide level2">
<h2>MC Methods</h2>
<h4 id="unknown-normalizing-constant-1">unknown normalizing constant</h4>
<div style="font-size: x-large">
<p>since</p>
<p><span class="math display">\[
\begin{align*}
\frac{1}{n}\sum_{i=1}^{n}w(x_{i}) &amp; \rightarrow\mathbb{E}_{g}\left[\frac{q(X)}{r(X)}\right]=\int\frac{q(X)}{r(X)}g(x)dx=\frac{Z_{q}}{Z_{r}}\\
\frac{1}{n}\sum_{i=1}^{n}w(x_{i}) &amp; \rightarrow\mathbb{E}_{g}\left[\frac{q(X)}{r(X)}h(X)\right]=\int\frac{q(X)}{r(X)}g(x)h(x)dx=\frac{1}{Z_{r}}\int g(x)h(x)dx
\end{align*}
\]</span></p>
</div>
</section>
<section id="mc-methods-13" class="slide level2">
<h2>MC Methods</h2>
<h4 id="repeating-the-prior-example-but-un-normalized">repeating the prior example, but un-normalized</h4>
<div style="font-size: x-large">
<p>Estimate <span class="math inline">\(\mathbb E_f(X)\)</span> where <span class="math inline">\(f(x) = e^{-\frac{x^2}{2}};\;x\ge 0\)</span> (this is the half-Normal distribution, un-normalized)</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="co"># un-normalized weights</span></span>
<span id="cb13-2"><a></a>n <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb13-3"><a></a>X <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate=</span><span class="dv">2</span>)</span>
<span id="cb13-4"><a></a>W <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> X<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>X)</span>
<span id="cb13-5"><a></a></span>
<span id="cb13-6"><a></a>mu_h2  <span class="ot">&lt;-</span> <span class="fu">sum</span>(W<span class="sc">*</span>X)<span class="sc">/</span><span class="fu">sum</span>(W)</span>
<span id="cb13-7"><a></a>var_h2 <span class="ot">&lt;-</span> <span class="fu">var</span>(W<span class="sc">/</span><span class="fu">mean</span>(W))</span>
<span id="cb13-8"><a></a>se_h2  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(var_h2)</span>
<span id="cb13-9"><a></a></span>
<span id="cb13-10"><a></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">mean =</span> mu_h2,  <span class="at">variance =</span> var_h2, <span class="st">'standard error'</span> <span class="ot">=</span> se_h2) <span class="sc">|&gt;</span> </span>
<span id="cb13-11"><a></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-12"><a></a>  gt<span class="sc">::</span><span class="fu">fmt_number</span>(<span class="at">decimals=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="gileglyojp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#gileglyojp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gileglyojp thead, #gileglyojp tbody, #gileglyojp tfoot, #gileglyojp tr, #gileglyojp td, #gileglyojp th {
  border-style: none;
}

#gileglyojp p {
  margin: 0;
  padding: 0;
}

#gileglyojp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gileglyojp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gileglyojp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gileglyojp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gileglyojp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gileglyojp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gileglyojp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gileglyojp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gileglyojp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gileglyojp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gileglyojp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gileglyojp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gileglyojp .gt_spanner_row {
  border-bottom-style: hidden;
}

#gileglyojp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gileglyojp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gileglyojp .gt_from_md > :first-child {
  margin-top: 0;
}

#gileglyojp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gileglyojp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gileglyojp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gileglyojp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gileglyojp .gt_row_group_first td {
  border-top-width: 2px;
}

#gileglyojp .gt_row_group_first th {
  border-top-width: 2px;
}

#gileglyojp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gileglyojp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gileglyojp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gileglyojp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gileglyojp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gileglyojp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gileglyojp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gileglyojp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gileglyojp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gileglyojp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gileglyojp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gileglyojp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gileglyojp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gileglyojp .gt_left {
  text-align: left;
}

#gileglyojp .gt_center {
  text-align: center;
}

#gileglyojp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gileglyojp .gt_font_normal {
  font-weight: normal;
}

#gileglyojp .gt_font_bold {
  font-weight: bold;
}

#gileglyojp .gt_font_italic {
  font-style: italic;
}

#gileglyojp .gt_super {
  font-size: 65%;
}

#gileglyojp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gileglyojp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gileglyojp .gt_indent_1 {
  text-indent: 5px;
}

#gileglyojp .gt_indent_2 {
  text-indent: 10px;
}

#gileglyojp .gt_indent_3 {
  text-indent: 15px;
}

#gileglyojp .gt_indent_4 {
  text-indent: 20px;
}

#gileglyojp .gt_indent_5 {
  text-indent: 25px;
}

#gileglyojp .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#gileglyojp div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="variance" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">variance</th>
<th id="standard error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">standard error</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="mean">0.7895</td>
<td class="gt_row gt_right" headers="variance">0.4058</td>
<td class="gt_row gt_right" headers="standard error">0.6370</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="mc-methods-14" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-procedure">rejection sampling procedure</h4>
<div style="font-size: x-large">
<p>Assume we have an un-normalized <span class="math inline">\(g(x)\)</span>, i.e.&nbsp;<span class="math inline">\(\pi(x)=cg(x)\)</span> but <span class="math inline">\(c\)</span> is unknown.</p>
<p>We want to generate iid samples <span class="math inline">\(x_1,x_2,\ldots,x_M\sim \pi\)</span> to estimate <span class="math inline">\(\mathbb{E}_\pi[h]\)</span></p>
<p>Now assume we have an easily sampled density <span class="math inline">\(f\)</span>, and known <span class="math inline">\(K&gt;0\)</span>, such that <span class="math inline">\(Kf(x)\ge g(x),\;\forall x\)</span>, i.e.&nbsp;<span class="math inline">\(Kf(x)\ge \pi(x)/c\)</span> ( or <span class="math inline">\(cKf(x)\ge \pi(x)\)</span>).</p>
<p>Then use the following procedure:</p>
<ul>
<li>sample <span class="math inline">\(X\sim f\)</span> and <span class="math inline">\(U\sim \mathrm{uniform}[0,1]\)</span></li>
<li>if <span class="math inline">\(U\le\frac{g(X)}{Kf(x)}\)</span>, the accept X as a draw from <span class="math inline">\(\pi\)</span></li>
<li>otherwise reject the sample and repeat</li>
</ul>
</div>
</section>
<section id="mc-methods-15" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling">rejection sampling</h4>
<div style="font-size: x-large">
<ul>
<li><p>Since <span class="math inline">\(0\le\frac{g(x)}{Kf(x)}\le 1\)</span> we know that <span class="math inline">\(\mathbb{P}\left(U\le\frac{g(X)}{Kf(X)}|X=x\right)=\frac{g(x)}{Kf(x)}\)</span></p></li>
<li><p>and so</p></li>
</ul>
<p><span class="math display">\[
\mathbb{E}_f\left[\mathbb{P}\left(U\le\frac{g(X)}{Kf(X)}|X=x\right)\right]=\mathbb{E}_f\left[\frac{g(X)}{Kf(X)}\right]=\int_{-\infty}^\infty\frac{g(X)}{Kf(X)}f(x)dx=\int_{-\infty}^\infty\frac{g(X)}{K}dx
\]</span></p>
</div>
</section>
<section id="mc-methods-16" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-1">rejection sampling</h4>
<div style="font-size: x-large">
<ul>
<li><p>Since <span class="math inline">\(0\le\frac{g(x)}{Kf(x)}\le 1\)</span> we know that <span class="math inline">\(\mathbb{P}\left(U\le\frac{g(X)}{Kf(X)}|X=x\right)=\frac{g(x)}{Kf(x)}\)</span></p></li>
<li><p>and so</p></li>
</ul>
<p><span class="math display">\[
\mathbb{E}_f\left[\mathbb{P}\left(U\le\frac{g(X)}{Kf(X)}|X=x\right)\right]=\mathbb{E}_f\left[\frac{g(X)}{Kf(X)}\right]=\int_{-\infty}^\infty\frac{g(X)}{Kf(X)}f(x)dx=\int_{-\infty}^\infty\frac{g(X)}{K}dx
\]</span></p>
</div>
</section>
<section id="mc-methods-17" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-2">rejection sampling</h4>
<div style="font-size: x-large">
<p>Similarly, for any <span class="math inline">\(y\in\mathbb{R}\)</span>, we can calculate the joint probability</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{P}\left(X\le y,U\le\frac{g(X)}{Kf(X)}\right) &amp; =\mathbb{E}\left[1_{X\le y}1_{U\le\frac{g(X)}{Kf(X)}}\right]\\
&amp; =\mathbb{E}\left[1_{X\le y}\mathbb{P}\left(U\le\frac{g(X)}{Kf(X)}|X\right)\right]\\
&amp; =\mathbb{E}\left[1_{X\le y}\frac{g(X)}{Kf(X)}\right]=\int_{-\infty}^{y}\frac{g(x)}{Kf(x)}f(x)dx\\
&amp; =\int_{-\infty}^{y}\frac{g(x)}{K}dx
\end{align*}
\]</span></p>
<ul>
<li>and so we have the joint probability (above - <span class="math inline">\(\mathbb{P}(A,B)\)</span>), and the probability of acceptance (previous slide - <span class="math inline">\(\mathbb{P}(B)\)</span>), so the probability, conditional on acceptance (<span class="math inline">\(\mathbb{P}(A|B)\)</span>) is <span class="math inline">\(\frac{\mathbb{P}(A,B)}{\mathbb{P}(B)}\)</span> by Bayes rule.</li>
</ul>
</div>
</section>
<section id="mc-methods-18" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-3">rejection sampling</h4>
<div style="font-size: x-large">
<p><span class="math display">\[
\mathbb{P}\left(X\le y|U\le\frac{g(X)}{Kf(X)}\right)=\frac{\int_{-\infty}^{y}\frac{g(x)}{K}dx}{\int_{-\infty}^\infty\frac{g(X)}{K}dx}=\int_{-\infty}^{y}\pi(x)dx
\]</span></p>
</div>
</section>
<section id="mc-methods-19" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-4">rejection sampling</h4>
<ul>
<li>consider random variable <span class="math inline">\(X\)</span> with pdf/pmf <span class="math inline">\(q(x)&gt;0;\;x\in D\)</span> which is difficult to sample from</li>
<li>we will sample from <span class="math inline">\(q\)</span> using a proposal pdf/pmf <span class="math inline">\(f\)</span> which we can sample from</li>
<li>if we can find a constant <span class="math inline">\(K\)</span> such that <span class="math inline">\(q(x)\le Kf(x); \forall x\in D\)</span>. Alternatively <span class="math inline">\(\frac{q(x)}{f(x)}\le K\)</span></li>
<li>then there is a rejection method that returns <span class="math inline">\(X\sim q\)</span></li>
</ul>
</section>
<section id="mc-methods-20" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-method">rejection sampling method</h4>
<ol type="1">
<li>given a proposal pdf/pmf <span class="math inline">\(f\)</span> we can sample from, and constant <span class="math inline">\(K\)</span> such that <span class="math inline">\(\frac{q(x)}{f(x)}\le K; \forall x\in D\)</span></li>
<li>sample <span class="math inline">\(Y_i\sim f\)</span> and <span class="math inline">\(U_i\sim\mathrm{U}[0,1]\)</span></li>
<li>for <span class="math inline">\(U_i\le\frac{q(Y_i)}{Kf(Y_i)}\)</span> return <span class="math inline">\(X_i=Y_i\)</span>; otherwise return nothing and continue.</li>
</ol>
</section>
<section id="mc-methods-21" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-proof-for-discrete-rv">rejection sampling: proof for discrete rv</h4>
<div style="font-size: xx-large">
<p>We have <span class="math inline">\(\mathbb{P}(X=x) = \sum_{i=1}^n\mathbb{P}(\mathrm{reject }\,Y)^{n-1}\mathbb{P}(\mathrm{draw }\,Y=x\,\mathrm{and\, accept})\)</span></p>
<p>We also have</p>
<p><span class="math display">\[
\begin{align*}
&amp; \mathbb{P}(\mathrm{draw}\,Y=x\,\mathrm{and\,accept})\\
= &amp; \mathbb{P}(\mathrm{draw}\,Y=x)\mathbb{P}(\left.\mathrm{accept}\,Y\right|Y=x)\\
= &amp; f(x)\mathbb{P}(\left.U\le\frac{q(Y)}{Kf(Y)}\right|Y=x)\\
= &amp; \frac{q(x)}{K}
\end{align*}
\]</span></p>
</div>
</section>
<section id="mc-methods-22" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-proof-for-discrete-rv-1">rejection sampling: proof for discrete rv</h4>
<div style="font-size: xx-large">
<p>The probability of rejection of a draw is</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{P}(\mathrm{{reject}}\,Y) &amp; =\sum_{x\in D}\mathbb{P}(\mathrm{{draw}}\,Y=x\,\mathrm{and\,reject\,it})\\
&amp; =\sum_{x\in D}f(x)\mathbb{P}(\left.U\ge\frac{q(Y)}{Kf(Y)}\right|Y=x)\\
&amp; =\sum_{x\in D}f(x)(1-\frac{q(x)}{Kf(x)})=1-\frac{1}{K}
\end{align*}
\]</span></p>
</div>
</section>
<section id="mc-methods-23" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-proof-for-discrete-rv-2">rejection sampling: proof for discrete rv</h4>
<div style="font-size: xx-large">
<p>and so<sup>1</sup></p>
<p><span class="math display">\[
\begin{align*}
\mathbb{P}(X=x) &amp; =\sum_{n=1}^{\infty}\mathbb{P}(\mathrm{reject}\,Y)^{n-1}\mathbb{P}(\mathrm{draw}\,Y=x\,\mathrm{and\,accept})\\
&amp; =\sum_{n=1}^{\infty}\left(1-\frac{1}{K}\right)^{n-1}\frac{q(x)}{K}=q(x)
\end{align*}
\]</span></p>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>The <strong>geometric distribution</strong> is a discrete distribution that can be interpreted as the number of failures before the first success (<span class="math inline">\(\mathbb{P}(X=k)=(1-p)^{k-1}p\)</span>, with mean <span class="math inline">\(p\)</span>).</p></li></ol></aside></section>
<section id="mc-methods-24" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-proof-for-continuous-scalar-rv">rejection sampling: proof for continuous scalar rv</h4>
<div style="font-size: x-large">
<p>Recal that we accept the proposal <span class="math inline">\(Y\)</span> whenever <span class="math inline">\((U,Y)\sim q_{U,Y}\)</span> where <span class="math inline">\(q_{U,Y}\left(u,y\right)=q(y)U_{0,1}(u)\)</span> such that <span class="math inline">\(U\le q(Y)/(Kf(Y))\)</span></p>
<p>We have</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{P}\left(X\le x\right) &amp; =\mathbb{P}\left(\left.Y\le x\right|U\le q(Y)/Kf(Y))\right)\\
&amp; =\frac{\mathbb{P}\left(Y\le x,U\le q(Y)/Kf(Y))\right)}{\mathbb{P}\left(U\le q(Y)/Kf(Y))\right)}\\
&amp; =\frac{\int_{-\infty}^{x}\int_{0}^{q(y)/Kf(y)}f_{U,Y}\left(u,y\right)dudy}{\int_{-\infty}^{\infty}\int_{0}^{q(y)/Kf(y)}f_{U,Y}\left(u,y\right)dudy}\\
&amp; =\frac{\int_{-\infty}^{x}\int_{0}^{q(y)/Kf(y)}f\left(y\right)dudy}{\int_{-\infty}^{\infty}\int_{0}^{q(y)/Kf(y)}f\left(y\right)dudy}=\int_{-\infty}^{x}q(y)dy
\end{align*}
\]</span></p>
</div>
</section>
<section id="mc-methods-25" class="slide level2">
<h2>MC Methods</h2>
<h4 id="rejection-sampling-unknown-normalizing-constants">rejection sampling: unknown normalizing constants</h4>
<div style="font-size: x-large">
<p>In most practical scenarios, we know <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(q(x)\)</span> only up to some normalizing constants</p>
<p><span class="math display">\[
f(x)=\bar{f}(x)/K_f\;\mathrm{and}\;q(x)=\bar{q}(x)/K_q
\]</span> We can still use rejection sampling since</p>
<p><span class="math display">\[
\frac{q(x)}{f(x)}\le K\;\mathrm{iff}\;\frac{\bar{q}(x)}{\bar{f}(x)}\le\hat{K}\equiv  K\frac{K_q}{K_f}
\]</span> In practice this means we can ignore the normalizing constants if we can find <span class="math inline">\(\hat{K}\)</span> to bound <span class="math inline">\(\frac{\bar{q}(x)}{\bar{f}(x)}\)</span></p>
</div>
</section>
<section id="mc-methods-26" class="slide level2">
<h2>MC Methods</h2>
<div style="font-size: x-large">
<p>Suppose we need to compute an expectation <span class="math inline">\(\mathbb{E}[g(Z)]\)</span> for some random variable <span class="math inline">\(Z\)</span> and some function <span class="math inline">\(g:\mathbb{R}\to\mathbb{R}\)</span>. Monte Carlo methods avoid doing any integration or summation and instead just generate lots of samples of <span class="math inline">\(Z\)</span>, say <span class="math inline">\(z_1,z_2,\ldots,z_M\)</span> and <em>estimate</em> <span class="math inline">\(\mathbb{E}[g(Z)]\)</span> as <span class="math inline">\(\frac{1}{M}\sum_{i=1}^Mg(z_i)\)</span>. The law of large numbers states that this sample mean should be close to <span class="math inline">\(\mathbb{E}[g(Z)]\)</span>.</p>
<p>Said another way, Monte Carlo replaces the work of computing an integral (i.e., an expectation) with the work of generating lots of random variables.</p>
</div>
</section>
<section id="stochastic-processes" class="slide level2">
<h2>Stochastic processes</h2>
<p>A stochastic process, which we will usually write as <span class="math inline">\((X_n)\)</span>, is an indexed sequence of random variables that are (usually) dependent on each other.</p>
<p>Each random variable <span class="math inline">\(X_n\)</span> takes a value in a state space <span class="math inline">\(\mathcal S\)</span> which is the set of possible values for the process. As with usual random variables, the state space <span class="math inline">\(\mathcal S\)</span> can be discrete or continuous. A discrete state space denotes a set of distinct possible outcomes, which can be finite or countably infinite. For example, <span class="math inline">\(\mathcal S = \{\text{Heads},\text{Tails}\}\)</span> is the state space for a single coin flip, while in the case of counting insurance claims, the state space would be the nonnegative integers <span class="math inline">\(\mathcal S = \mathbb Z_+ = \{0,1,2,\dots\}\)</span>.</p>
</section>
<section id="stochastic-processes-1" class="slide level2">
<h2>Stochastic processes</h2>
<p>Further, the process has an index set that puts the random variables that make up the process in order. The index set is usually interpreted as a time variable, telling us when the process will be measured. The index set for time can also be discrete or continuous. Discrete time denotes a process sampled at distinct points, often denoted by <span class="math inline">\(n = 0,1,2,\dots\)</span>, while continuous time denotes a process monitored constantly over time, often denoted by <span class="math inline">\(t \in \mathbb R_+ = \{x \in \mathbb R : x \geq 0\}\)</span>.</p>
</section>
<section id="markov-property" class="slide level2">
<h2>Markov property</h2>
<p>Think of a simple board game where we roll a dice and move that many squares forward on the board. Suppose we are currently on the square <span class="math inline">\(X_n\)</span>. Then what can we say about which square <span class="math inline">\(X_{n+1}\)</span> we move to on our next turn?</p>
<ul>
<li><span class="math inline">\(X_{n+1}\)</span> is random, since it depends on the roll of the dice.</li>
<li><span class="math inline">\(X_{n+1}\)</span> depends on where we are now <span class="math inline">\(X_n\)</span>, since the score of dice will be added onto the number our current square,</li>
<li>Given the square <span class="math inline">\(X_n\)</span> we are now, <span class="math inline">\(X_{n+1}\)</span> doesn’t depend any further on which sequence of squares <span class="math inline">\(X_0, X_1, \dots, X_{n-1}\)</span> we used to get here.</li>
</ul>
<p>The third point is called the Markov property or memoryless property. We say “memoryless”, because we only need to remember what square we’ve reached, not which squares we used to get here. The stochastic process before this moment has no bearing on the future, given where we are now. A mathematical way to say this is that “the past and the future are conditionally independent given the present.”</p>
</section>
<section id="markov-chains" class="slide level2">
<h2>Markov Chains</h2>
<div style="font-size: xx-large">
<p>Consider the following <strong>simple random walk</strong> on the integers <span class="math inline">\(\mathbb Z\)</span>: We start at <span class="math inline">\(0\)</span>, then at each time step, we go up by one with probability <span class="math inline">\(p\)</span> and down by one with probability <span class="math inline">\(q = 1-p\)</span>. When <span class="math inline">\(p = q = \frac12\)</span>, we’re equally as likely to go up as down, and we call this the <strong>simple symmetric random walk</strong>.</p>
<p>The simple random walk is a simple but very useful model for lots of processes, like stock prices, sizes of populations, or positions of gas particles. (In many modern models, however, these have been replaced by more complicated continuous time and space models.) The simple random walk is sometimes called the “drunkard’s walk”, suggesting it could model a drunk person trying to stagger home.</p>
</div>
</section>
<section id="markov-chains-1" class="slide level2">
<h2>Markov Chains</h2>
<details class="code-fold">
<summary>random walks</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="fu">require</span>(ggplot2, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-2"><a></a><span class="fu">set.seed</span>(<span class="dv">315</span>)</span>
<span id="cb14-3"><a></a></span>
<span id="cb14-4"><a></a>rrw <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">p =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) {</span>
<span id="cb14-5"><a></a>  q <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> p</span>
<span id="cb14-6"><a></a>  Z <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(p, q))</span>
<span id="cb14-7"><a></a>  X <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(Z))</span>
<span id="cb14-8"><a></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(Z))</span>
<span id="cb14-9"><a></a>}</span>
<span id="cb14-10"><a></a></span>
<span id="cb14-11"><a></a>n <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb14-12"><a></a>rw_dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">x=</span><span class="dv">0</span><span class="sc">:</span>n) <span class="sc">|&gt;</span> </span>
<span id="cb14-13"><a></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb14-14"><a></a>    <span class="st">"p = 2/3"</span> <span class="ot">=</span> <span class="fu">rrw</span>(n, <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb14-15"><a></a>    , <span class="st">"p = 1/3"</span> <span class="ot">=</span> <span class="fu">rrw</span>(n, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb14-16"><a></a>    , <span class="st">"p = 1/2"</span> <span class="ot">=</span> <span class="fu">rrw</span>(n, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb14-17"><a></a>  )</span>
<span id="cb14-18"><a></a></span>
<span id="cb14-19"><a></a>p0 <span class="ot">&lt;-</span> rw_dat <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-20"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>x) <span class="sc">|&gt;</span> </span>
<span id="cb14-21"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>value, <span class="at">color=</span>name)) <span class="sc">+</span> </span>
<span id="cb14-22"><a></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb14-23"><a></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb14-24"><a></a></span>
<span id="cb14-25"><a></a>p1 <span class="ot">&lt;-</span> rw_dat <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">200</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-26"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>x) <span class="sc">|&gt;</span> </span>
<span id="cb14-27"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>value, <span class="at">color=</span>name)) <span class="sc">+</span> </span>
<span id="cb14-28"><a></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb14-29"><a></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb14-30"><a></a></span>
<span id="cb14-31"><a></a>p3 <span class="ot">&lt;-</span> rw_dat <span class="sc">|&gt;</span> <span class="co">#dplyr::slice_head(n=200) |&gt; </span></span>
<span id="cb14-32"><a></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>x) <span class="sc">|&gt;</span> </span>
<span id="cb14-33"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>value, <span class="at">color=</span>name)) <span class="sc">+</span> </span>
<span id="cb14-34"><a></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb14-35"><a></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb14-36"><a></a></span>
<span id="cb14-37"><a></a>p0<span class="sc">+</span>p1<span class="sc">+</span>p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img data-src="BSMM_8740_lec_09b_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
</div>
</div>
</section>
<section id="markov-chains-2" class="slide level2">
<h2>Markov Chains</h2>
<p>We can write this as a stochastic process <span class="math inline">\((X_n)\)</span> with discrete time <span class="math inline">\(n = \{0,1,2,\dots\} = \mathbb Z_+\)</span> and discrete state space <span class="math inline">\(\mathcal S = \mathbb Z\)</span>, where <span class="math inline">\(X_0 = 0\)</span> and, for <span class="math inline">\(n \geq 0\)</span>, we have <span class="math display">\[ X_{n+1} = \begin{cases} X_n + 1 &amp; \text{with probability $p$,} \\
                             X_n - 1 &amp; \text{with probability $q$.} \end{cases} \]</span></p>
<p>It’s clear from this definition that <span class="math inline">\(X_{n+1}\)</span> (the future) depends on <span class="math inline">\(X_n\)</span> (the present), but, given <span class="math inline">\(X_n\)</span>, does not depend on <span class="math inline">\(X_{n-1}, \dots, X_1, X_0\)</span> (the past). Thus the Markov property holds, and the simple random walk is a discrete time Markov process or Markov chain.</p>
</section>
<section id="markov-chains-3" class="slide level2">
<h2>Markov Chains</h2>
<p>So far we’ve seen a a few examples of stochastic processes in discrete time and discrete space with the Markov memoryless property. Now we will develop the theory more generally.</p>
<p>To define a so-called “Markov chain”, we first need to say where we start from, and second what the probabilities of transitions from one state to another are.</p>
<p>In our examples of the simple random walk and gambler’s ruin, we specified the start point <span class="math inline">\(X_0 = i\)</span> exactly, but we could pick the start point at random according to some distribution <span class="math inline">\(\lambda_i = \mathbb P(X_0 = i)\)</span>.</p>
</section>
<section id="markov-chains-4" class="slide level2">
<h2>Markov Chains</h2>
<p>After that, we want to know the transition probabilities <span class="math inline">\(\mathbb P(X_{n+1} = j \mid X_n = i)\)</span> for <span class="math inline">\(i,j \in \mathcal S\)</span>. Here, because of the Markov property, the transition probability only needs to condition on the state we’re in now <span class="math inline">\(X_n = i\)</span>, and not on the whole history of the process.</p>
<p>In the case of the simple random walk, for example, we had initial distribution <span class="math display">\[ \lambda_i = \mathbb P(X_0 = i) = \begin{cases} 1 &amp; \text{if $i = 0$} \\ 0 &amp; \text{otherwise} \end{cases} \]</span> and transition probabilities <span class="math display">\[ \mathbb P(X_{n+1} = j \mid X_n = i) = \begin{cases} p &amp; \text{if $j = i+1$} \\ q &amp; \text{if $j = i-1$} \\ 0 &amp; \text{otherwise.} \end{cases} \]</span></p>
<p>For the random walk (and also the gambler’s ruin), the transition probabilities <span class="math inline">\(\mathbb P(X_{n+1} = j \mid X_n = i)\)</span> don’t depend on <span class="math inline">\(n\)</span>; in other words, the transition probabilities stay the same over time. A Markov process with this property is called time homogeneous. We will always consider time homogeneous processes from now on (unless we say otherwise).</p>
</section>
<section id="markov-chains-5" class="slide level2">
<h2>Markov Chains</h2>
<p>Let’s write <span class="math inline">\(p_{ij} = \mathbb P(X_{n+1} = j \mid X_n = i)\)</span> for the transition probabilities, which are independent of <span class="math inline">\(n\)</span>. We must have <span class="math inline">\(p_{ij} \geq 0\)</span>, since it is a probability, and we must also have <span class="math inline">\(\sum_j p_{ij} = 1\)</span> for all states <span class="math inline">\(i\)</span>, as this is the sum of the probabilities of all the places you can move to from state i.</p>
<p>When the state space is finite (and even sometimes when it’s not), it’s convenient to write the transition probabilities <span class="math inline">\((p_{ij})\)</span> as a matrix <span class="math inline">\(\mathsf P\)</span>, called the transition matrix, whose <span class="math inline">\((i,j)\)</span>th entry is <span class="math inline">\(p_{ij}\)</span>. Then the condition that <span class="math inline">\(\sum_j p_{ij} = 1\)</span> is the condition that each of the rows of <span class="math inline">\(\mathsf P\)</span> add up to <span class="math inline">\(1\)</span>.</p>
</section>
<section id="markov-chains-6" class="slide level2">
<h2>Markov Chains</h2>
<p>Consider a simple two-state Markov chain with state space <span class="math inline">\(\mathcal S = \{0,1\}\)</span> and transition matrix <span class="math display">\[ \mathsf P = \begin{pmatrix} p_{00} &amp; p_{01} \\ p_{10} &amp; p_{11} \end{pmatrix} = \begin{pmatrix} 1-\alpha &amp; \alpha \\ \beta &amp; 1-\beta \end{pmatrix}  \]</span> for some <span class="math inline">\(0 &lt; \alpha, \beta &lt; 1\)</span>. Note that the rows of <span class="math inline">\(\mathsf P\)</span> add up to <span class="math inline">\(1\)</span>, as they must.</p>
<p>We can illustrate <span class="math inline">\(\mathsf P\)</span> by a transition diagram, where the blobs are the states and the arrows give the transition probabilities. (We don’t draw the arrow if <span class="math inline">\(p_{ij} = 0\)</span>.) In this case, our transition diagram looks like this:</p>
</section>
<section id="markov-chains-7" class="slide level2">
<h2>Markov Chains</h2>

<img data-src="BSMM_8740_lec_09b_files/figure-html/twostate-1.png" width="384" class="r-stretch quarto-figure-center"><p class="caption">Transition diagram for the two-state Markov chain</p></section>
<section id="markov-chains-8" class="slide level2">
<h2>Markov Chains</h2>
<p>We can use this as a simple model of customer churn, for example. If the customer has closed their account (state 0) on one period, then with probability <span class="math inline">\(\alpha\)</span> we will be able to entice them to open their account again (state 1) by the next period; while if the customer has an account (state 1), then with probability <span class="math inline">\(\beta\)</span> they will have closed their account (state 0) by the next period.</p>
</section>
<section id="markov-chains-9" class="slide level2">
<h2>Markov Chains</h2>
<div id="printer" class="example">
<p><em>If the customer has an account on period n, what’s the probability they also have an account on period n+2?</em></p>
<p><span class="math display">\[
p_{11}(2) = \mathbb P (X_{n+2} = 1 \mid X_n = 1)
\]</span></p>
<p>The key to calculating this is to <em>condition on the first step</em> again – that is, on whether the printer is working on Tuesday. We have</p>
<p><span class="math display">\[
\begin{align*}
  p_{11}(2) &amp;= \mathbb P (X_{n+1} = 0 \mid X_n = 1)\,\mathbb P (X_{n+2} = 1 \mid X_{n+1} = 0, X_n = 1) \\
  &amp;\qquad{} + \mathbb P (X_{n+1} = 1 \mid X_n = 1)\,\mathbb P (X_{n+2} = 1 \mid X_{n+1} = 1, X_n = 1) \\
  &amp;= \mathbb P (X_{n+1} = 0 \mid X_n = 1)\,\mathbb P (X_{n+2} = 1 \mid X_{n+1} = 0) \\
  &amp;\qquad{} + \mathbb P (X_{n+1} = 1 \mid X_n = 1)\,\mathbb P (X_{n+2} = 1 \mid X_{n+1} = 1) \\
  &amp;= p_{10}p_{01} + p_{11}p_{11} \\
  &amp;= \beta\alpha + (1-\beta)^2 .
\end{align*}
\]</span></p>
<p>In the second equality, we used the Markov property to mean conditional probabilities like <span class="math inline">\(\mathbb P(X_{n+2} = 1 \mid X_{n+1} = k)\)</span> did not have to depend on <span class="math inline">\(X_n\)</span>.</p>
<p>Another way to think of this as we summing the probabilities of all length-2 paths from 1 to 1, which are <span class="math inline">\(1\to 0\to 1\)</span> with probability <span class="math inline">\(\beta\alpha\)</span> and <span class="math inline">\(1 \to 1 \to 1\)</span> with probability <span class="math inline">\((1-\beta)^2\)</span></p>
</div>
<p>In the above example, we calculated a two-step transition probability <span class="math inline">\(p_{ij}(2) = \mathbb P (X_{n+2} = j \mid X_n = i)\)</span> by conditioning on the first step. That is, by considering all the possible intermediate steps <span class="math inline">\(k\)</span>, we have</p>
<p><span class="math display">\[
p_{ij}(2) = \sum_{k\in\mathcal S} \mathbb P (X_{n+1} = k \mid X_n = i)\mathbb P (X_{n+2} = j \mid X_{n+1} = k) = \sum_{k\in\mathcal S} p_{ik}p_{kj}
\]</span></p>
<p>But this is exactly the formula for multiplying the matrix <span class="math inline">\(\mathsf P\)</span> with itself! In other words, <span class="math inline">\(p_{ij}(2) = \sum_{k} p_{ik}p_{kj}\)</span> is the <span class="math inline">\((i,j)\)</span>th entry of the matrix square <span class="math inline">\(\mathsf P^2 = \mathsf{PP}\)</span>. If we write <span class="math inline">\(\mathsf P(2)  = (p_{ij}(2))\)</span> for the matrix of two-step transition probabilities, we have <span class="math inline">\(\mathsf P(2) = \mathsf P^2\)</span>.</p>
<p>More generally, we see that this rule holds over multiple steps, provided we sum over all the possible paths <span class="math inline">\(i\to k_1 \to k_2 \to \cdots \to k_{n-1} \to j\)</span> of length <span class="math inline">\(n\)</span> from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span>.</p>
</section>
<section id="markov-chains-10" class="slide level2">
<h2>Markov Chains</h2>
<div id="thm-n-step" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1</strong></span> Let <span class="math inline">\((X_n)\)</span> be a Markov chain with state space <span class="math inline">\(\mathcal S\)</span> and transition matrix <span class="math inline">\(\mathsf P = (p_{ij})\)</span>. For <span class="math inline">\(i,j \in \mathcal S\)</span>, write <span class="math display">\[ p_{ij}(n) = \mathbb P(X_n = j \mid X_0 = i) \]</span> for the <span class="math inline">\(n\)</span>-step transition probability. Then</p>
<p><span class="math display">\[
p_{ij}(n) = \sum_{k_1, k_2, \dots, k_{n-1} \in \mathcal S} p_{ik_1} p_{k_1k_2} \cdots p_{k_{n-2}k_{n-1}} p_{k_{n-1}j}
\]</span></p>
<p>In particular, <span class="math inline">\(p_{ij}(n)\)</span> is the <span class="math inline">\((i,j)\)</span>th element of the matrix power <span class="math inline">\(\mathsf P^n\)</span>, and the matrix of <span class="math inline">\(n\)</span>-step transition probabilities is given by <span class="math inline">\(\mathsf P(n) = \mathsf P^n\)</span>.</p>
</div>
</section>
<section id="markov-chains-11" class="slide level2">
<h2>Markov Chains</h2>
<p>The so-called <strong>Chapman–Kolmogorov equations</strong> follow immediately from this.</p>
<div id="c-k" class="theorem" name="Chapman–Kolmogorov equations">
<p>Let <span class="math inline">\((X_n)\)</span> be a Markov chain with state space <span class="math inline">\(\mathcal S\)</span> and transition matrix <span class="math inline">\(\mathsf P = (p_{ij})\)</span>. Then, for non-negative integers <span class="math inline">\(n,m\)</span>, we have <span class="math display">\[ p_{ij}(n+m) = \sum_{k \in \mathcal S} p_{ik}(n)p_{kj}(m) , \]</span> or, in matrix notation, <span class="math inline">\(\mathsf P(n+m) = \mathsf P(n)\mathsf P(m)\)</span>.</p>
</div>
<p>In other words, a trip of length <span class="math inline">\(n + m\)</span> from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> is a trip of length <span class="math inline">\(n\)</span> from <span class="math inline">\(i\)</span> to some other state <span class="math inline">\(k\)</span>, then a trip of length <span class="math inline">\(m\)</span> from <span class="math inline">\(k\)</span> back to <span class="math inline">\(j\)</span>, and this intermediate stop <span class="math inline">\(k\)</span> can be any state, so we have to sum the probabilities.</p>
<p>Of course, once we know that <span class="math inline">\(\mathsf P(n) = \mathsf P^n\)</span> is given by the matrix power, it’s clear to see that <span class="math inline">\(\mathsf P(n+m) = \mathsf P^{n+m} = \mathsf P^n \mathsf P^m = \mathsf P(n)\mathsf P(m)\)</span>.</p>
</section>
<section id="markov-chains-12" class="slide level2">
<h2>Markov Chains</h2>
<p>If we start from a state given by a distribution <span class="math inline">\(\boldsymbol \pi = (\pi_i)\)</span>, then after step 1 the probability we’re in state <span class="math inline">\(j\)</span> is <span class="math inline">\(\sum_i \pi_i p_{ij}\)</span>. So if <span class="math inline">\(\pi_j = \sum_i \pi_i p_{ij}\)</span>, we stay in this distribution forever. We call such a distribution a stationary distribution. We again recognise this formula as a matrix-vector multiplication, so this is <span class="math inline">\(\boldsymbol \pi = \boldsymbol \pi\mathsf P\)</span>, where <span class="math inline">\(\boldsymbol \pi\)</span> is a <em>row</em> vector.</p>
<div class="definition">
<p>Let <span class="math inline">\((X_n)\)</span> be a Markov chain on a state space <span class="math inline">\(\mathcal S\)</span> with transition matrix <span class="math inline">\(\mathsf P\)</span>. Let <span class="math inline">\(\boldsymbol \pi = (\pi_i)\)</span> be a distribution on <span class="math inline">\(\mathcal S\)</span>, in that <span class="math inline">\(\pi_i \geq 0\)</span> for all <span class="math inline">\(i \in \mathcal S\)</span> and <span class="math inline">\(\sum_{i \in \mathcal S} \pi_i = 1\)</span>. We call <span class="math inline">\(\boldsymbol \pi\)</span> a <strong>stationary distribution</strong> if</p>
<p><span class="math display">\[
\pi_j =* \sum_{i\in \mathcal S} \pi_i p_{ij} \quad \text{for all $j \in \mathcal S$}
\]</span></p>
<p>or, equivalently, if <span class="math inline">\(\boldsymbol \pi = \boldsymbol \pi\mathsf P\)</span>.</p>
</div>
<p>Note that we’re saying the <em>distribution</em> <span class="math inline">\(\mathbb P(X_n = i)\)</span> stays the same; the Markov chain <span class="math inline">\((X_n)\)</span> itself will keep moving. One way to think is that if we started off a thousand Markov chains, choosing each starting position to be <span class="math inline">\(i\)</span> with probability <span class="math inline">\(\pi_i\)</span>, then (roughly) <span class="math inline">\(1000 \pi_j\)</span> of them would be in state <span class="math inline">\(j\)</span> at any time in the future – but not necessarily the same ones each time.</p>
</section>
<section id="markov-chains-13" class="slide level2">
<h2>Markov Chains</h2>
<h4 id="properties">properties</h4>
<p>A Markov Chain is <strong>irreducible</strong> if you have positive probability of eventually getting from anywhere to anywhere else.</p>
<p>A Markov Chain is <strong>aperiodic</strong> if there are no forced cycles, i.e.&nbsp;there do not exist disjoint non-empty subsets X1,X2,…,Xd ford≥2,suchthatP(x,Xi+1)=1 forallx∈Xi (1≤i≤d−1),andP(x,X1)=1forallx∈Xd. [Diagram.]</p>
</section>
<section id="markov-chains-14" class="slide level2">
<h2>Markov Chains</h2>

<img data-src="BSMM_8740_lec_09b_files/figure-html/periods-recap-1.png" width="480" class="r-stretch quarto-figure-center"><p class="caption">MC with cycle</p></section>
<section id="markov-chain-monte-carlo" class="slide level2">
<h2>Markov Chain Monte Carlo</h2>
<p>Suppose have complicated, high-dimensional density <span class="math inline">\(\pi = cg\)</span> and we want samples <span class="math inline">\(X_1, X_2,\dots \sim \pi\)</span>. (Then can do Monte Carlo.)</p>
<p>Define a Markovchain (dependent random process) <span class="math inline">\(X_0, X_1,X_2\dots\)</span> in such a way that for large enough <span class="math inline">\(n\)</span>, <span class="math inline">\(X_n\sim \pi\)</span>.</p>
<p>Then we can estimate <span class="math inline">\(\mathbb{E}_{\pi}(h) ≡ \int h(x) \pi(x) dx\)</span> by:</p>
<p><span class="math display">\[
\mathbb{E}_{\pi}[h] \approx \frac{1}{M-B}\sum_{i=B+1}^{M}
\]</span></p>
<p>where <span class="math inline">\(B\)</span> (“burn-in”) is chosen large enough so <span class="math inline">\(X_B\sim\pi\)</span>, and <span class="math inline">\(M\)</span> is chosen large enough to get good Monte Carlo estimates.</p>
</section>
<section id="mcmc-metropolis-algo" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<ol type="1">
<li>choose some initial value <span class="math inline">\(X_0\)</span>, then</li>
<li>given <span class="math inline">\(X_{n-1}\)</span>, choose a proposal state <span class="math inline">\(Y_n\sim \textrm{MVN}(X_{n-1},\sigma^2\textrm{I})\)</span> for some fixed <span class="math inline">\(\sigma^2&gt;0\)</span></li>
<li>let <span class="math inline">\(A_n=\pi(Y_n)/\pi(X_{n-1}=g(Y_n)/g(X_{n-1})\)</span> and <span class="math inline">\(U_n\sim\textrm{U}[0,1]\)</span>, then</li>
<li>id <span class="math inline">\(U_n&lt;A_n\)</span> set <span class="math inline">\(X_n=Y_n\)</span> (“accept”), otherwise set $X_n = X_{n-1} ) “reject”</li>
<li>repeat for <span class="math inline">\(n=1,2,3,\ldots,M\)</span></li>
</ol>
<p>This version is called random-walk Metropolis</p>
</section>
<section id="mcmc-metropolis-algo-1" class="slide level2">
<h2>MCMC Metropolis Algo</h2>
<div class="cell">
<details class="code-fold">
<summary>a simple Metropolis algorithm in one dimension</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>g <span class="ot">=</span> <span class="cf">function</span>(y) {</span>
<span id="cb15-2"><a></a>    <span class="cf">if</span> ( (y<span class="sc">&lt;</span><span class="dv">0</span>) <span class="sc">||</span> (y<span class="sc">&gt;</span><span class="dv">1</span>) )</span>
<span id="cb15-3"><a></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb15-4"><a></a>    <span class="cf">else</span></span>
<span id="cb15-5"><a></a>    <span class="fu">return</span>( y<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> <span class="fu">sin</span>(y<span class="sc">^</span><span class="dv">4</span>) <span class="sc">*</span> <span class="fu">cos</span>(y<span class="sc">^</span><span class="dv">5</span>) )</span>
<span id="cb15-6"><a></a>}</span>
<span id="cb15-7"><a></a></span>
<span id="cb15-8"><a></a>h <span class="ot">=</span> <span class="cf">function</span>(y) { <span class="fu">return</span>(y<span class="sc">^</span><span class="dv">2</span>) }</span>
<span id="cb15-9"><a></a></span>
<span id="cb15-10"><a></a>M <span class="ot">=</span> <span class="dv">11000</span>  <span class="co"># run length</span></span>
<span id="cb15-11"><a></a>B <span class="ot">=</span> <span class="dv">1000</span>  <span class="co"># amount of burn-in</span></span>
<span id="cb15-12"><a></a>X <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>)  <span class="co"># overdispersed starting distribution</span></span>
<span id="cb15-13"><a></a>sigma <span class="ot">=</span> <span class="dv">1</span>  <span class="co"># proposal scaling</span></span>
<span id="cb15-14"><a></a>xlist <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>,M)  <span class="co"># for keeping track of chain values</span></span>
<span id="cb15-15"><a></a>hlist <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>,M)  <span class="co"># for keeping track of h function values</span></span>
<span id="cb15-16"><a></a>numaccept <span class="ot">=</span> <span class="dv">0</span>;</span>
<span id="cb15-17"><a></a></span>
<span id="cb15-18"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M) {</span>
<span id="cb15-19"><a></a>  Y <span class="ot">=</span> X <span class="sc">+</span> sigma <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)  <span class="co"># proposal value</span></span>
<span id="cb15-20"><a></a>  U <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>)              <span class="co"># for accept/reject</span></span>
<span id="cb15-21"><a></a>  alpha <span class="ot">=</span> <span class="fu">g</span>(Y) <span class="sc">/</span> <span class="fu">g</span>(X)       <span class="co"># for accept/reject</span></span>
<span id="cb15-22"><a></a>  <span class="cf">if</span> (U <span class="sc">&lt;</span> alpha) {</span>
<span id="cb15-23"><a></a>    X <span class="ot">=</span> Y                   <span class="co"># accept proposal</span></span>
<span id="cb15-24"><a></a>    numaccept <span class="ot">=</span> numaccept <span class="sc">+</span> <span class="dv">1</span>;</span>
<span id="cb15-25"><a></a>  }</span>
<span id="cb15-26"><a></a>    xlist[i] <span class="ot">=</span> X;</span>
<span id="cb15-27"><a></a>    hlist[i] <span class="ot">=</span> <span class="fu">h</span>(X);</span>
<span id="cb15-28"><a></a>}</span>
<span id="cb15-29"><a></a></span>
<span id="cb15-30"><a></a><span class="fu">cat</span>(<span class="st">"ran Metropolis algorithm for"</span>, M, <span class="st">"iterations, with burn-in"</span>, B, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ran Metropolis algorithm for 11000 iterations, with burn-in 1000 </code></pre>
</div>
<details class="code-fold">
<summary>a simple Metropolis algorithm in one dimension</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="fu">cat</span>(<span class="st">"acceptance rate ="</span>, numaccept<span class="sc">/</span>M, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>acceptance rate = 0.1046 </code></pre>
</div>
<details class="code-fold">
<summary>a simple Metropolis algorithm in one dimension</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>u <span class="ot">=</span> <span class="fu">mean</span>(hlist[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>M])</span>
<span id="cb19-2"><a></a><span class="fu">cat</span>(<span class="st">"mean of h is about"</span>, u, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>mean of h is about 0.773 </code></pre>
</div>
<details class="code-fold">
<summary>a simple Metropolis algorithm in one dimension</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a>se1 <span class="ot">=</span>  <span class="fu">sd</span>(hlist[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>M]) <span class="sc">/</span> <span class="fu">sqrt</span>(M<span class="sc">-</span>B)</span>
<span id="cb21-2"><a></a><span class="fu">cat</span>(<span class="st">"iid standard error would be about"</span>, se1, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>iid standard error would be about 0.001658 </code></pre>
</div>
<details class="code-fold">
<summary>a simple Metropolis algorithm in one dimension</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>varfact <span class="ot">&lt;-</span> <span class="cf">function</span>(xxx) { <span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">acf</span>(xxx, <span class="at">plot=</span><span class="cn">FALSE</span>)<span class="sc">$</span>acf) <span class="sc">-</span> <span class="dv">1</span> }</span>
<span id="cb23-2"><a></a>thevarfact <span class="ot">=</span> <span class="fu">varfact</span>(hlist[(B<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>M])</span>
<span id="cb23-3"><a></a>se <span class="ot">=</span> se1 <span class="sc">*</span> <span class="fu">sqrt</span>( thevarfact )</span>
<span id="cb23-4"><a></a><span class="fu">cat</span>(<span class="st">"varfact = "</span>, thevarfact, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>varfact =  21.02 </code></pre>
</div>
<details class="code-fold">
<summary>a simple Metropolis algorithm in one dimension</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a><span class="fu">cat</span>(<span class="st">"true standard error is about"</span>, se, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>true standard error is about 0.007601 </code></pre>
</div>
<details class="code-fold">
<summary>a simple Metropolis algorithm in one dimension</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a><span class="fu">cat</span>(<span class="st">"approximate 95% confidence interval is ("</span>, u <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se, <span class="st">","</span>,</span>
<span id="cb27-2"><a></a>                        u <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se, <span class="st">")</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>approximate 95% confidence interval is ( 0.7581 , 0.7879 )</code></pre>
</div>
<details class="code-fold">
<summary>a simple Metropolis algorithm in one dimension</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a><span class="fu">plot</span>(xlist, <span class="at">type=</span><span class="st">'l'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

<details class="code-fold">
<summary>a simple Metropolis algorithm in one dimension</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a><span class="co"># acf(xlist)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<img data-src="BSMM_8740_lec_09b_files/figure-html/unnamed-chunk-10-1.png" width="672" class="r-stretch"></section>
<section id="more" class="slide level2">
<h2>More</h2>
<ul>
<li>Read <a href="https://www.bayesrulesbook.com/">Bayes Rules!</a></li>
<li>Read <a href="http://allendowney.github.io/ThinkBayes2/index.html">Think Bayes</a></li>
<li>Read <a href="https://github.com/rmcelreath/stat_rethinking_2022">Statistical Rethinking</a></li>
</ul>
</section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<ul>
<li>We’ve had the smallest possible taste of statistical programming using Bayes theorem and sampling methods, in the context of adressing the limitations of off-the-shelf implementations of statistical methods and algorithms.</li>
</ul>


</section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="images/logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://bsmm-8740-fall-2024.github.io/osb/">bsmm-8740-fall-2024.github.io/osb</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true,"numbers":true},
'chalkboard': {"buttons":true},
'multiplex': {"secret":null,"id":"bfbb73edbfd62ef2","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 5.0e-2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/bsmm-8740-fall-2024\.github\.io\/osb\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>