<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.39">

  <meta name="author" content="L.L. Odette">
  <title>BSMM-8740 - Fall 2024 – Bayesian Methods</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-a8986e45384d4e2047f3d84b21c5a23c.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<meta property="og:title" content="Bayesian Methods – BSMM-8740 - Fall 2024">
<meta property="og:description" content="BSMM8740-2-R-2024F [WEEK - 10]">
<meta property="og:site_name" content="BSMM-8740 - Fall 2024">
<meta name="twitter:title" content="Bayesian Methods – BSMM-8740 - Fall 2024">
<meta name="twitter:description" content="BSMM8740-2-R-2024F [WEEK - 10]">
<meta name="twitter:image" content="https://bsmm-8740-fall-2024.github.io/osb/slides/images/twitter-card.png">
<meta name="twitter:creator" content="@lodette">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Bayesian Methods</h1>
  <p class="subtitle">BSMM8740-2-R-2024F [WEEK - 10]</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
L.L. Odette 
</div>
</div>
</div>

</section>
<section id="recap-of-last-week" class="slide level2">
<h2>Recap of last week</h2>
<ul>
<li>Last week we introduced Markov Chain methods for integration and sampling from probability distributions.</li>
<li>We also built a basic understanding of the tools for sampling in Bayesian analysis.</li>
</ul>
</section>
<section id="this-week" class="slide level2">
<h2>This week</h2>
<ul>
<li>We will explore Bayesian methods in more detail.</li>
<li>We will use one of the popular R packages for Bayesian analysis.</li>
</ul>
</section>
<section>
<section id="bayesian-regression" class="title-slide slide level1 center">
<h1>Bayesian Regression</h1>
<div style="font-size: x-large">
<p>From Bayes’ Rule we have</p>
<p><span class="math display">\[
P(A \vert B) = \frac{P(B \vert A)P(A)}{P(B)}
\]</span></p>
<p>If <span class="math inline">\(B\)</span> is interpreted as the data <span class="math inline">\(\mathcal{D}\)</span> and <span class="math inline">\(A\)</span> is chosen to be the set of parameters that you’d want to estimate, call this set <span class="math inline">\(\theta\)</span>, then</p>
<p><span class="math display">\[
\underbrace{P(\theta \vert \mathcal{D})}_{\text{Posterior}} =
    \frac{1}{\underbrace{P(\mathcal{D})}_{\text{Normalization}}}
\overbrace{P(\mathcal{D} \vert \theta)}^{\text{Likelihood}}\overbrace{P(\theta)}^{\text{Prior}}
\]</span></p>
</div>
</section>
<section id="maximum-likelihood-mle" class="slide level2">
<h2>Maximum likelihood (MLE)</h2>
<p>Recall that for a linear regression <span class="math inline">\(y\sim \mathcal{N}(\beta x,\sigma^2)\)</span> the likelihood of any one observation <span class="math inline">\(y_i\)</span> is (with <span class="math inline">\(\theta\)</span> representing the set of parameters)</p>
<p><span class="math display">\[
\pi\left(\left.y_{i}\right|x_{i},\beta,\sigma^{2}\right)=\pi\left(\left.y_{i}\right|x_{i},\theta\right)=\frac{1}{\sqrt{2\pi\sigma^{2}}}e^{-\frac{(y_{i}-\beta x_{i})^{2}}{2\sigma^{2}}}
\]</span> and the log-likelihood of <span class="math inline">\(N\)</span> observations <span class="math inline">\(\{y_i\}_{i=1}^N\)</span> is</p>
<p><span class="math display">\[
\log\prod_{i=1}^{N}\pi\left(\left.y_{i}\right|x_{i},\theta\right) = \sum_{i=1}^{N}\log \pi\left(\left.y_{i}\right|x_{i},\theta\right)
\]</span></p>
</section>
<section id="maximum-likelihood-mle-1" class="slide level2">
<h2>Maximum likelihood (MLE)</h2>
<p>The maximum likelihood estimate of <span class="math inline">\(\beta\)</span> is</p>
<p><span class="math display">\[
\hat{\theta}_{\text{MLE}}=\arg\max_{\theta} -\sum_{i=1}^{N}\log \pi\left(\left.y_{i}\right|x_{i},\theta\right)
\]</span></p>
<p><span class="math display">\[
\log\prod_{i=1}^{N}\pi\left(\left.y_{i}\right|x_{i},\theta\right) = \sum_{i=1}^{N}\log \pi\left(\left.y_{i}\right|x_{i},\theta\right)
\]</span></p>
<p>this is equivalent to minimizing the sum of the squared errors, and is also called the <u><strong>a priori</strong></u> estimate.</p>
</section>
<section id="bayesian-model" class="slide level2">
<h2>Bayesian model</h2>
<p>The Bayesian model for linear regression is (to within a scaling constant)</p>
<p><span class="math display">\[
\begin{align*}
\pi_{\theta\vert\mathcal{D}}\left(\left.\theta\right|y_i,x_i\right)\sim\pi_{\mathcal{D}}\left(\left.y_i\right|x_i,\theta\right)\times\pi_\theta\left(\theta\right)
\end{align*}
\]</span></p>
<p>where the parameters are <span class="math inline">\(\theta=\{\beta,\sigma^2\}\)</span>.</p>
<div style="font-size: 70%">
<p>In words: the joint probability of the parameters given the observed volume data is equal to (to within a scaling constant) the probability of the observed volume data given the parameters, times the prior probabilities of the parameters. In practice we refer to the probabilities as likelihoods, and use log-likelihoods to avoid numerical problems arising from the product of small probabilities.</p>
</div>
</section>
<section id="maximum-a-posteriori-estimate-mape" class="slide level2">
<h2>Maximum a posteriori estimate (MAPE)</h2>
<p>The maximum a posteriori estimate of the parameters is</p>
<p><span class="math display">\[
\begin{align*}
\hat{\theta}_{\text{MAP}} &amp; =\arg\max_{\theta}\log\prod_{i=1}^{N}\pi_{\theta\vert\mathcal{D}}\left(\left. \theta \right|y_{i},x_{i}\right)\\
&amp; =\arg\max_{\theta}\sum_{i=1}^{N} \left(\log \pi\left(\left.y_{i}\right|x_{i},\theta\right)+\log\pi_\theta\left(\theta\right)\right)\\
&amp; =\arg\min_{\theta}-\sum_{i=1}^{N} \left(\log \pi\left(\left.y_{i}\right|x_{i},\theta\right)+\log\pi_\theta\left(\theta\right)\right)
\end{align*}
\]</span></p>
</section>
<section id="maximum-a-posteriori-estimate-mape-1" class="slide level2">
<h2>Maximum a posteriori estimate (MAPE)</h2>
<div style="font-size: x-large">
<p>If <span class="math inline">\(\theta\)</span> is not uncertain/random, then <span class="math inline">\(\pi(\theta)=1\rightarrow\log\pi(\theta)=0\)</span> and the MAPE is equal to the MLE.</p>
<p>In linear regression we assume <span class="math inline">\(\pi(\sigma^2) = 1\)</span>, so If <span class="math inline">\(\theta\)</span> is uncertain/random it remains to give a prior distribution to <span class="math inline">\(\beta\)</span> (as a vector of dimension <span class="math inline">\(D\)</span>, in general). Assume <span class="math inline">\(\beta=\mathscr{N}\left(0,\lambda^{-1}I\right)\)</span> (with a single scale constant <span class="math inline">\(\lambda\)</span>), then</p>
<p><span class="math display">\[
\pi_\theta(\beta) =  \frac{1}{\sqrt{(2\pi)^D \frac{1}{\lambda^D}}}exp(-\frac{1}{2}(\beta - 0)^\top (\frac{1}{\lambda} I)^{-1} (\beta - 0)) =
\frac{\lambda^{\frac{D}{2}}}{(2\pi)^{\frac{D}{2}}}exp(-\frac{\lambda}{2} \beta^\top \beta)
\]</span></p>
</div>
</section>
<section id="maximum-a-posteriori-estimate-mape-2" class="slide level2">
<h2>Maximum a posteriori estimate (MAPE)</h2>
<div style="font-size: x-large">
<p>With Gaussian <span class="math inline">\(\pi(\beta)\)</span> as in the last slide, and likelihood</p>
<p><span class="math display">\[
\pi(y_i \vert x_i, \beta) = \frac{1}{\sqrt{2\pi\sigma^2}}exp(-\frac{1}{2\sigma^2}(y_i- x_i^\top\beta)^2)
\]</span></p>
<p>we have, for linear regression</p>
<p><span class="math display">\[
\begin{align*}
\hat{\theta}_{\text{MAP}} &amp; =\arg\min_{\theta}-\sum_{i=1}^{N}\left(\log\pi\left(\left.y_{i}\right|x_{i},\theta\right)+\log\pi_\theta\left(\theta\right)\right)\\
&amp; =\arg\min_{\theta}\left(\frac{1}{2\sigma^{2}}\sum_{i=1}^{N}(y_i-x_i^{T}\beta)^{2}+\frac{\lambda}{2}\beta^\top\beta\right)
\end{align*}
\]</span></p>
<p>which turns out to be a linear interpolation between the prior mean and the sample mean weighted by their respective covariances.</p>
</div>
</section>
<section id="maximum-a-posteriori-estimate-mape-3" class="slide level2">
<h2>Maximum a posteriori estimate (MAPE)</h2>
<p>In this MAPE for linear regression, with Gaussian priors, the posterior is also a Gaussian, since the product of Gaussian distributions is proportional to a Gaussian distribution, and the denominator in Bayes rule reflects the proportionality.</p>
<p>However, this a special case where the likelihood and prior distributions are <u><strong>conjugate</strong></u>.</p>
</section>
<section id="conjugate-priors" class="slide level2">
<h2>Conjugate priors</h2>
<p>If the posterior distribution <span class="math inline">\(\pi_{\theta\vert\mathcal{D}}\)</span> is in the same probability distribution family as the prior probability distribution <span class="math inline">\(\pi_\theta\)</span> (generally this means they are the same to within a normalizing constant), the prior and posterior are then called conjugate distributions, and the prior is called a conjugate prior for the likelihood function <span class="math inline">\(\pi_{\mathcal{D}}\)</span>.</p>
<p>A conjugate prior is an algebraic convenience, giving a closed-form expression for the posterior.</p>
</section>
<section id="conjugate-priors-1" class="slide level2">
<h2>Conjugate priors</h2>
<h4 id="example-1">example 1</h4>
<p>Consider a random variable which consists of the number of successes <span class="math inline">\(s\)</span> in <span class="math inline">\(n\)</span> Bernoulli trials with unknown probability of success <span class="math inline">\(p\in[0,1]\)</span>. This random variable will follow the binomial distribution, with a probability mass function of the form</p>
<p><span class="math display">\[
\pi(s\vert p)={n \choose s}p^s(1-p)^{n-s}
\]</span></p>
</section>
<section id="conjugate-priors-2" class="slide level2">
<h2>Conjugate priors</h2>
<h4 id="example-1-1">example 1</h4>
<p>The usual conjugate prior for the Bernoulli is the beta distribution with parameters (<span class="math inline">\(\alpha, \beta\)</span>):</p>
<p><span class="math display">\[
\pi_\theta(p;\alpha,\beta) = \frac{p^{\alpha-1}(1-p)^{\beta-1}}{\mathrm{B}(\alpha,\beta)}
\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are chosen to reflect any existing belief or information (<span class="math inline">\(\alpha = 1\)</span> and <span class="math inline">\(\beta = 1\)</span> would give a uniform distribution) and <span class="math inline">\(\mathrm{B}(\alpha,\beta)\)</span> is the Beta function acting as a normalising constant.</p>
</section>
<section id="conjugate-priors-3" class="slide level2">
<h2>Conjugate priors</h2>
<h4 id="example-1-2">example 1</h4>
<p>If we sample this random variable and get <span class="math inline">\(s'\)</span> successes and <span class="math inline">\(f=n-s'\)</span> failures, then we have</p>
<p><span class="math display">\[
\begin{align*}
\pi_{\theta\vert\mathcal{D}}(p=x) &amp; \sim x^{s'}(1-x)^{n-s'}\times x^{\alpha-1}(1-x)^{\beta-1}\\
&amp; \sim x^{s'+\alpha+1}(1-x)^{(n-s')+\beta-1}\\
&amp; \sim\pi_{\theta\vert\mathcal{D}}(x;s'+\alpha+1,(n-s')+\beta-1)
\end{align*}
\]</span></p>
<p>And the posterior distribution <span class="math inline">\(\pi_{\theta\vert\mathcal{D}}\)</span> is in the same probability distribution family as the prior probability distribution <span class="math inline">\(\pi_\theta\)</span>.</p>
</section>
<section id="conjugate-priors-4" class="slide level2">
<h2>Conjugate priors</h2>
<h4 id="example-2">example 2</h4>
<div style="font-size: x-large">
<p>Suppose you’ve been asked to find the probability that you have exactly 5 outages at your website during any hour of the day. Your client has limited data, in fact they have just three data points <span class="math inline">\(y=[3,4,1]\)</span></p>
<p>If you assume that the data are generated by a Poisson distribution (which has a single parameter, the rate <span class="math inline">\(\lambda\)</span>), then the maximum likelihood estimate of <span class="math inline">\(\lambda\)</span> is <span class="math inline">\(\lambda=\frac{3+4+1}{3}\approx 2.67\)</span>, and you would estimate the probability as:</p>
<p><span class="math display">\[
\pi(n=5\vert\lambda\approx 2.67) = \frac{\lambda^n e^{-\lambda}}{n!}=\frac{2.67^5 e^{-2.67}}{5!}=0.078
\]</span></p>
</div>
</section>
<section id="conjugate-priors-5" class="slide level2">
<h2>Conjugate priors</h2>
<h4 id="example-2-1">example 2</h4>
<div style="font-size: x-large">
<p>We’ve assumed that the observed data <span class="math inline">\(y\)</span> is most likely to have been generated by a Poisson distribution with MLE for <span class="math inline">\(\lambda= 2.67\)</span>.</p>
<p>But the data could also have come from another Poisson distribution, e.g., one with <span class="math inline">\(\lambda =3\)</span>, or <span class="math inline">\(\lambda =2\)</span>, etc. In fact, there is an infinite number of Poisson distributions that could have generated the observed data.</p>
<p>With relatively few data points, we should be quite uncertain about which exact Poisson distribution generated this data. Intuitively we should instead take a weighted average of the probability of <span class="math inline">\(\pi(y\ge 0|\lambda )\)</span> for each of those Poisson distributions, weighted by how likely they each are, given the data we’ve observed.</p>
<p>This is exactly what Bayes’ Rule does.</p>
</div>
</section>
<section id="conjugate-priors-6" class="slide level2">
<h2>Conjugate priors</h2>
<h4 id="example-2-2">example 2</h4>
<div style="font-size: x-large">
<p>Luckily, the Poisson distribution has a conjugate, the Gamma distribution:</p>
<p><span class="math display">\[
\pi_\theta(x\lambda;\alpha,\beta)=\frac{x^{\alpha-1}e^{-\beta \lambda}\beta^\alpha}{\Gamma(\alpha)}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\begin{align*}
\pi\left(y\vert\lambda\right) &amp; =\prod_{i=1}^{n}\frac{\lambda^{y_{i}}e^{-\lambda}}{y_{i}!}\\
&amp; =\lambda^{n\bar{y}}e^{-n\lambda}\prod_{i=1}^{n}\frac{1}{y_{i}!}
\end{align*}
\]</span></p>
<p>so <span class="math inline">\(\pi\left(y\vert\lambda\right)\times \pi_\theta(x;\alpha,\beta)\sim \lambda^{n\bar{y}+\alpha-1}e^{-(n+\beta)\lambda}\sim\pi_\theta(\lambda;n\bar{y}+\alpha,(n+\beta))\)</span></p>
</div>
</section>
<section id="conjugate-priors-7" class="slide level2">
<h2>Conjugate priors</h2>
<h4 id="example-2-3">example 2</h4>
<div class="columns">
<div class="column" style="width:60%;">
<div style="font-size: large">
<p>Given our observations <span class="math inline">\(\lambda=\frac{3+4+1}{3}\approx 2.67\)</span>, we might arbitrarily take the prior as a Gamma with <span class="math inline">\(\alpha=9;\;\beta = 2\)</span> so that the prior and posterior look like this:</p>
<div class="cell" data-fig-aling="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>.shape <span class="ot">&lt;-</span> <span class="dv">9</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span><span class="fl">2.67</span>  ; .rate <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">+</span><span class="dv">2</span></span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">lambda =</span> <span class="fu">seq</span>(<span class="fl">0.04</span>,<span class="dv">15</span>,<span class="fl">0.02</span>), <span class="at">plambda =</span> <span class="fu">dgamma</span>(<span class="fu">seq</span>(<span class="fl">0.04</span>,<span class="dv">15</span>,<span class="fl">0.02</span>), <span class="at">shape=</span><span class="dv">9</span>, <span class="at">rate =</span> <span class="dv">2</span>), <span class="at">measure =</span> <span class="st">"prior"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb1-5"><a></a>    tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">lambda =</span> <span class="fu">seq</span>(<span class="fl">0.04</span>,<span class="dv">15</span>,<span class="fl">0.02</span>), <span class="at">plambda =</span> <span class="fu">dgamma</span>(<span class="fu">seq</span>(<span class="fl">0.04</span>,<span class="dv">15</span>,<span class="fl">0.02</span>), <span class="at">shape=</span>.shape, <span class="at">rate =</span> .rate), <span class="at">measure =</span> <span class="st">"posterior"</span>)</span>
<span id="cb1-6"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb1-7"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>lambda, <span class="at">y =</span> plambda, <span class="at">color =</span> measure)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb1-8"><a></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Probability distributions for Lambda"</span>, <span class="at">subtitle =</span> <span class="st">" prior and posterior predictive"</span>) <span class="sc">+</span></span>
<span id="cb1-9"><a></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-2-1.png" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<div style="font-size: large">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>.shape <span class="ot">&lt;-</span> <span class="dv">9</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span><span class="fl">2.67</span>  ; .rate <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">+</span><span class="dv">2</span></span>
<span id="cb2-2"><a></a>ci <span class="ot">&lt;-</span> <span class="fu">qgamma</span>(<span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>), <span class="at">shape=</span>.shape, <span class="at">rate =</span> .rate) <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a></a>  purrr<span class="sc">::</span><span class="fu">map_dbl</span>(<span class="cf">function</span>(x){<span class="fu">round</span>( x<span class="sc">^</span><span class="dv">5</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>x)<span class="sc">/</span><span class="fu">factorial</span>(<span class="dv">5</span>),<span class="at">digits=</span><span class="dv">3</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Given the posterior hyperparameters, we can finally compute the posterior predictive distribution and estimate the 90% confidence intervals for the probability as 0.046, 0.175. This much more conservative estimate reflects the uncertainty in the model parameters, which the posterior predictive takes into account.</p>
</div>
</div></div>
</section>
<section id="conjugate-priors-8" class="slide level2">
<h2>Conjugate priors</h2>
<ul>
<li><p>Conjugate priors offer ease of computation, efficiency in updates, and clear interpretation, making them suitable for simpler models or real-time applications.</p></li>
<li><p>However, they are often too restrictive for complex or non-standard models, where flexibility in capturing prior beliefs is crucial.</p></li>
</ul>
</section>
<section id="conjugate-priors-9" class="slide level2">
<h2>Conjugate priors</h2>
<div style="font-size: large">
<p>Limitations of Conjugate Priors</p>
<ul>
<li>Restrictive Choice of Priors: Conjugate priors limit the choice of prior distributions to a specific family. This restricts flexibility, especially if real-world data suggests a prior belief outside the conjugate family, which may not accurately capture prior knowledge or uncertainty.</li>
<li>Lack of Flexibility with Complex Models: Conjugate priors are often insufficient for complex models, such as hierarchical or multi-level models, where dependencies between variables require more flexible priors. Non-conjugate priors, despite being more computationally intensive, can better accommodate the complexity of these models.</li>
<li>Potential for Over-Simplification: Choosing a conjugate prior for convenience can sometimes lead to oversimplification, especially if it does not match the true prior knowledge. This can introduce bias and reduce the model’s accuracy in reflecting genuine prior beliefs.</li>
<li>Less Suitable for Non-Standard Likelihoods: Conjugate priors work best with specific likelihood functions, and many real-world problems don’t have standard likelihoods that match conjugate prior forms. In these cases, using a conjugate prior may be infeasible, forcing the use of non-conjugate methods.</li>
</ul>
</div>
</section>
<section id="generative-bayesian-modelling" class="slide level2">
<h2>Generative (bayesian) modelling</h2>
<ul>
<li><p>Generative Bayesian modeling is an approach in Bayesian statistics where we create models that describe how data is generated, often by specifying probability distributions for both observed and latent (unobserved) variables.</p></li>
<li><p>This process involves defining a generative process — a step-by-step probabilistic framework that models how data could have arisen.</p></li>
</ul>
</section>
<section id="generative-bayesian-modelling-1" class="slide level2">
<h2>Generative (bayesian) modelling</h2>
<p>Note the similarity to DAGs:</p>
<p>Given a DAG, we next assign probability distributions to each node, relate the nodes through the parameters of the distributions and finally assign priors for any remaining/undetermined parameters, including parameters used to define the relationships between variables.</p>
</section>
<section id="generative-bayesian-modelling-2" class="slide level2">
<h2>Generative (bayesian) modelling</h2>
<div style="font-size: x-large">
<p><strong>Key Components of Generative Bayesian Modeling</strong></p>
<ul>
<li>Defining Priors: Start by assigning prior distributions to parameters, reflecting prior beliefs about these parameters before observing data. Priors incorporate domain knowledge and regularize the model.</li>
<li>Likelihood Function: Specify the likelihood, which represents the probability of observing the data given the parameters. It describes how data is assumed to be generated given specific values of the model parameters.</li>
<li>Posterior Inference: Using Bayes’ theorem, combine priors and the likelihood to calculate the posterior distribution of the parameters. This posterior reflects updated beliefs after seeing the data.</li>
<li>Latent Variables and Hierarchies: Generative models can include latent variables, which represent unobserved or hidden factors, and hierarchical structures, which model data with multiple levels of variation (e.g., nested or grouped data).</li>
</ul>
</div>
</section>
<section id="generative-bayesian-modelling-3" class="slide level2">
<h2>Generative (bayesian) modelling</h2>
<div style="font-size: x-large">
<p><strong>Advantages of Generative Bayesian Models</strong></p>
<ul>
<li>Interpretability: Generative models explicitly describe the data-generating process, making them interpretable and suitable for understanding complex systems.</li>
<li>Predictive Power: By learning the underlying structure of the data, generative models can predict unseen outcomes and infer missing or latent data.</li>
<li>Uncertainty Quantification: Bayesian models naturally quantify uncertainty in parameter estimates and predictions, enhancing decision-making with probabilistic insights.</li>
</ul>
</div>
</section>
<section id="generative-bayesian-modelling-4" class="slide level2">
<h2>Generative (bayesian) modelling</h2>
<div style="font-size: x-large">
<p><strong>Limitations</strong></p>
<ul>
<li>Computational Complexity: Generative Bayesian models, especially those with complex hierarchical structures or latent variables, can be computationally demanding, often requiring methods like MCMC.</li>
<li>Model Specification: The accuracy of generative Bayesian models heavily depends on correctly specifying the generative process, which can be challenging with limited domain knowledge or complex data.</li>
</ul>
<p><strong>Applications</strong></p>
<p>Generative Bayesian modeling is widely used in areas requiring a deep understanding of data-generating processes, such as healthcare, natural language processing, finance, and other business applications. It enables tasks like anomaly detection, missing data imputation, and causal inference by modeling the probability structure of observed and unobserved variables.</p>
</div>
</section></section>
<section>
<section id="brms" class="title-slide slide level1 center">
<h1>BRMS</h1>

</section>
<section id="generative-modelling-with-brms" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<p><code>BRMS</code> (Bayesian Regression Models using Stan) is an R package for fitting complex Bayesian regression models using Stan, a powerful probabilistic programming language. BRMS provides a high-level, formula-based interface in R, making it easy to specify and fit Bayesian models.</p>
<p><code>BRMS</code> is useful for performing complex Bayesian analyses in R without diving into raw Stan code.</p>
</section>
<section id="generative-modelling-with-brms-1" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="brms-example">BRMS example</h4>
<div style="font-size: x-large">
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="co"># load data</span></span>
<span id="cb3-2"><a></a><span class="fu">data</span>(<span class="st">"epilepsy"</span>, <span class="at">package =</span> <span class="st">"brms"</span>)</span>
<span id="cb3-3"><a></a></span>
<span id="cb3-4"><a></a>epilepsy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    Age Base Trt patient visit count obs     zAge
1    31   11   0       1     1     5   1  0.42500
2    30   11   0       2     1     3   2  0.26528
3    25    6   0       3     1     2   3 -0.53327
4    36    8   0       4     1     4   4  1.22355
5    22   66   0       5     1     7   5 -1.01241
6    29   27   0       6     1     5   6  0.10557
7    31   12   0       7     1     6   7  0.42500
8    42   52   0       8     1    40   8  2.18182
9    37   23   0       9     1     5   9  1.38326
10   28   10   0      10     1    14  10 -0.05414
11   36   52   0      11     1    26  11  1.22355
12   24   33   0      12     1    12  12 -0.69299
13   23   18   0      13     1     4  13 -0.85270
14   36   42   0      14     1     7  14  1.22355
15   26   87   0      15     1    16  15 -0.37356
16   26   50   0      16     1    11  16 -0.37356
17   28   18   0      17     1     0  17 -0.05414
18   31  111   0      18     1    37  18  0.42500
19   32   18   0      19     1     3  19  0.58471
20   21   20   0      20     1     3  20 -1.17212
21   29   12   0      21     1     3  21  0.10557
22   21    9   0      22     1     3  22 -1.17212
23   32   17   0      23     1     2  23  0.58471
24   25   28   0      24     1     8  24 -0.53327
25   30   55   0      25     1    18  25  0.26528
26   40    9   0      26     1     2  26  1.86240
27   19   10   0      27     1     3  27 -1.49154
28   22   47   0      28     1    13  28 -1.01241
29   18   76   1      29     1    11  29 -1.65125
30   32   38   1      30     1     8  30  0.58471
31   20   19   1      31     1     0  31 -1.33183
32   30   10   1      32     1     3  32  0.26528
33   18   19   1      33     1     2  33 -1.65125
34   24   24   1      34     1     4  34 -0.69299
35   30   31   1      35     1    22  35  0.26528
36   35   14   1      36     1     5  36  1.06384
37   27   11   1      37     1     2  37 -0.21385
38   20   67   1      38     1     3  38 -1.33183
39   22   41   1      39     1     4  39 -1.01241
40   28    7   1      40     1     2  40 -0.05414
41   23   22   1      41     1     0  41 -0.85270
42   40   13   1      42     1     5  42  1.86240
43   33   46   1      43     1    11  43  0.74442
44   21   36   1      44     1    10  44 -1.17212
45   35   38   1      45     1    19  45  1.06384
46   25    7   1      46     1     1  46 -0.53327
47   26   36   1      47     1     6  47 -0.37356
48   25   11   1      48     1     2  48 -0.53327
49   22  151   1      49     1   102  49 -1.01241
50   32   22   1      50     1     4  50  0.58471
51   25   41   1      51     1     8  51 -0.53327
52   35   32   1      52     1     1  52  1.06384
53   21   56   1      53     1    18  53 -1.17212
54   41   24   1      54     1     6  54  2.02211
55   32   16   1      55     1     3  55  0.58471
56   26   22   1      56     1     1  56 -0.37356
57   21   25   1      57     1     2  57 -1.17212
58   36   13   1      58     1     0  58  1.22355
59   37   12   1      59     1     1  59  1.38326
60   31   11   0       1     2     3  60  0.42500
61   30   11   0       2     2     5  61  0.26528
62   25    6   0       3     2     4  62 -0.53327
63   36    8   0       4     2     4  63  1.22355
64   22   66   0       5     2    18  64 -1.01241
65   29   27   0       6     2     2  65  0.10557
66   31   12   0       7     2     4  66  0.42500
67   42   52   0       8     2    20  67  2.18182
68   37   23   0       9     2     6  68  1.38326
69   28   10   0      10     2    13  69 -0.05414
70   36   52   0      11     2    12  70  1.22355
71   24   33   0      12     2     6  71 -0.69299
72   23   18   0      13     2     4  72 -0.85270
73   36   42   0      14     2     9  73  1.22355
74   26   87   0      15     2    24  74 -0.37356
75   26   50   0      16     2     0  75 -0.37356
76   28   18   0      17     2     0  76 -0.05414
77   31  111   0      18     2    29  77  0.42500
78   32   18   0      19     2     5  78  0.58471
79   21   20   0      20     2     0  79 -1.17212
80   29   12   0      21     2     4  80  0.10557
81   21    9   0      22     2     4  81 -1.17212
82   32   17   0      23     2     3  82  0.58471
83   25   28   0      24     2    12  83 -0.53327
84   30   55   0      25     2    24  84  0.26528
85   40    9   0      26     2     1  85  1.86240
86   19   10   0      27     2     1  86 -1.49154
87   22   47   0      28     2    15  87 -1.01241
88   18   76   1      29     2    14  88 -1.65125
89   32   38   1      30     2     7  89  0.58471
90   20   19   1      31     2     4  90 -1.33183
91   30   10   1      32     2     6  91  0.26528
92   18   19   1      33     2     6  92 -1.65125
93   24   24   1      34     2     3  93 -0.69299
94   30   31   1      35     2    17  94  0.26528
95   35   14   1      36     2     4  95  1.06384
96   27   11   1      37     2     4  96 -0.21385
97   20   67   1      38     2     7  97 -1.33183
98   22   41   1      39     2    18  98 -1.01241
99   28    7   1      40     2     1  99 -0.05414
100  23   22   1      41     2     2 100 -0.85270
101  40   13   1      42     2     4 101  1.86240
102  33   46   1      43     2    14 102  0.74442
103  21   36   1      44     2     5 103 -1.17212
104  35   38   1      45     2     7 104  1.06384
105  25    7   1      46     2     1 105 -0.53327
106  26   36   1      47     2    10 106 -0.37356
107  25   11   1      48     2     1 107 -0.53327
108  22  151   1      49     2    65 108 -1.01241
109  32   22   1      50     2     3 109  0.58471
110  25   41   1      51     2     6 110 -0.53327
111  35   32   1      52     2     3 111  1.06384
112  21   56   1      53     2    11 112 -1.17212
113  41   24   1      54     2     3 113  2.02211
114  32   16   1      55     2     5 114  0.58471
115  26   22   1      56     2    23 115 -0.37356
116  21   25   1      57     2     3 116 -1.17212
117  36   13   1      58     2     0 117  1.22355
118  37   12   1      59     2     4 118  1.38326
119  31   11   0       1     3     3 119  0.42500
120  30   11   0       2     3     3 120  0.26528
121  25    6   0       3     3     0 121 -0.53327
122  36    8   0       4     3     1 122  1.22355
123  22   66   0       5     3     9 123 -1.01241
124  29   27   0       6     3     8 124  0.10557
125  31   12   0       7     3     0 125  0.42500
126  42   52   0       8     3    21 126  2.18182
127  37   23   0       9     3     6 127  1.38326
128  28   10   0      10     3     6 128 -0.05414
129  36   52   0      11     3     6 129  1.22355
130  24   33   0      12     3     8 130 -0.69299
131  23   18   0      13     3     6 131 -0.85270
132  36   42   0      14     3    12 132  1.22355
133  26   87   0      15     3    10 133 -0.37356
134  26   50   0      16     3     0 134 -0.37356
135  28   18   0      17     3     3 135 -0.05414
136  31  111   0      18     3    28 136  0.42500
137  32   18   0      19     3     2 137  0.58471
138  21   20   0      20     3     6 138 -1.17212
139  29   12   0      21     3     3 139  0.10557
140  21    9   0      22     3     3 140 -1.17212
141  32   17   0      23     3     3 141  0.58471
142  25   28   0      24     3     2 142 -0.53327
143  30   55   0      25     3    76 143  0.26528
144  40    9   0      26     3     2 144  1.86240
145  19   10   0      27     3     4 145 -1.49154
146  22   47   0      28     3    13 146 -1.01241
147  18   76   1      29     3     9 147 -1.65125
148  32   38   1      30     3     9 148  0.58471
149  20   19   1      31     3     3 149 -1.33183
150  30   10   1      32     3     1 150  0.26528
151  18   19   1      33     3     7 151 -1.65125
152  24   24   1      34     3     1 152 -0.69299
153  30   31   1      35     3    19 153  0.26528
154  35   14   1      36     3     7 154  1.06384
155  27   11   1      37     3     0 155 -0.21385
156  20   67   1      38     3     7 156 -1.33183
157  22   41   1      39     3     2 157 -1.01241
158  28    7   1      40     3     1 158 -0.05414
159  23   22   1      41     3     4 159 -0.85270
160  40   13   1      42     3     0 160  1.86240
161  33   46   1      43     3    25 161  0.74442
162  21   36   1      44     3     3 162 -1.17212
163  35   38   1      45     3     6 163  1.06384
164  25    7   1      46     3     2 164 -0.53327
165  26   36   1      47     3     8 165 -0.37356
166  25   11   1      48     3     0 166 -0.53327
167  22  151   1      49     3    72 167 -1.01241
168  32   22   1      50     3     2 168  0.58471
169  25   41   1      51     3     5 169 -0.53327
170  35   32   1      52     3     1 170  1.06384
171  21   56   1      53     3    28 171 -1.17212
172  41   24   1      54     3     4 172  2.02211
173  32   16   1      55     3     4 173  0.58471
174  26   22   1      56     3    19 174 -0.37356
175  21   25   1      57     3     0 175 -1.17212
176  36   13   1      58     3     0 176  1.22355
177  37   12   1      59     3     3 177  1.38326
178  31   11   0       1     4     3 178  0.42500
179  30   11   0       2     4     3 179  0.26528
180  25    6   0       3     4     5 180 -0.53327
181  36    8   0       4     4     4 181  1.22355
182  22   66   0       5     4    21 182 -1.01241
183  29   27   0       6     4     7 183  0.10557
184  31   12   0       7     4     2 184  0.42500
185  42   52   0       8     4    12 185  2.18182
186  37   23   0       9     4     5 186  1.38326
187  28   10   0      10     4     0 187 -0.05414
188  36   52   0      11     4    22 188  1.22355
189  24   33   0      12     4     4 189 -0.69299
190  23   18   0      13     4     2 190 -0.85270
191  36   42   0      14     4    14 191  1.22355
192  26   87   0      15     4     9 192 -0.37356
193  26   50   0      16     4     5 193 -0.37356
194  28   18   0      17     4     3 194 -0.05414
195  31  111   0      18     4    29 195  0.42500
196  32   18   0      19     4     5 196  0.58471
197  21   20   0      20     4     7 197 -1.17212
198  29   12   0      21     4     4 198  0.10557
199  21    9   0      22     4     4 199 -1.17212
200  32   17   0      23     4     5 200  0.58471
201  25   28   0      24     4     8 201 -0.53327
202  30   55   0      25     4    25 202  0.26528
203  40    9   0      26     4     1 203  1.86240
204  19   10   0      27     4     2 204 -1.49154
205  22   47   0      28     4    12 205 -1.01241
206  18   76   1      29     4     8 206 -1.65125
207  32   38   1      30     4     4 207  0.58471
208  20   19   1      31     4     0 208 -1.33183
209  30   10   1      32     4     3 209  0.26528
210  18   19   1      33     4     4 210 -1.65125
211  24   24   1      34     4     3 211 -0.69299
212  30   31   1      35     4    16 212  0.26528
213  35   14   1      36     4     4 213  1.06384
214  27   11   1      37     4     4 214 -0.21385
215  20   67   1      38     4     7 215 -1.33183
216  22   41   1      39     4     5 216 -1.01241
217  28    7   1      40     4     0 217 -0.05414
218  23   22   1      41     4     0 218 -0.85270
219  40   13   1      42     4     3 219  1.86240
220  33   46   1      43     4    15 220  0.74442
221  21   36   1      44     4     8 221 -1.17212
222  35   38   1      45     4     7 222  1.06384
223  25    7   1      46     4     3 223 -0.53327
224  26   36   1      47     4     8 224 -0.37356
225  25   11   1      48     4     0 225 -0.53327
226  22  151   1      49     4    63 226 -1.01241
227  32   22   1      50     4     4 227  0.58471
228  25   41   1      51     4     7 228 -0.53327
229  35   32   1      52     4     5 229  1.06384
230  21   56   1      53     4    13 230 -1.17212
231  41   24   1      54     4     0 231  2.02211
232  32   16   1      55     4     3 232  0.58471
233  26   22   1      56     4     8 233 -0.37356
234  21   25   1      57     4     1 234 -1.17212
235  36   13   1      58     4     0 235  1.22355
236  37   12   1      59     4     2 236  1.38326
        zBase
1   -0.757173
2   -0.757173
3   -0.944403
4   -0.869511
5    1.302363
6   -0.158035
7   -0.719727
8    0.778117
9   -0.307820
10  -0.794619
11   0.778117
12   0.066641
13  -0.495050
14   0.403656
15   2.088731
16   0.703225
17  -0.495050
18   2.987437
19  -0.495050
20  -0.420158
21  -0.719727
22  -0.832065
23  -0.532496
24  -0.120589
25   0.890456
26  -0.832065
27  -0.794619
28   0.590887
29   1.676824
30   0.253872
31  -0.457604
32  -0.794619
33  -0.457604
34  -0.270374
35  -0.008251
36  -0.644835
37  -0.757173
38   1.339809
39   0.366210
40  -0.906957
41  -0.345266
42  -0.682281
43   0.553441
44   0.178980
45   0.253872
46  -0.906957
47   0.178980
48  -0.757173
49   4.485281
50  -0.345266
51   0.366210
52   0.029195
53   0.927902
54  -0.270374
55  -0.569942
56  -0.345266
57  -0.232927
58  -0.682281
59  -0.719727
60  -0.757173
61  -0.757173
62  -0.944403
63  -0.869511
64   1.302363
65  -0.158035
66  -0.719727
67   0.778117
68  -0.307820
69  -0.794619
70   0.778117
71   0.066641
72  -0.495050
73   0.403656
74   2.088731
75   0.703225
76  -0.495050
77   2.987437
78  -0.495050
79  -0.420158
80  -0.719727
81  -0.832065
82  -0.532496
83  -0.120589
84   0.890456
85  -0.832065
86  -0.794619
87   0.590887
88   1.676824
89   0.253872
90  -0.457604
91  -0.794619
92  -0.457604
93  -0.270374
94  -0.008251
95  -0.644835
96  -0.757173
97   1.339809
98   0.366210
99  -0.906957
100 -0.345266
101 -0.682281
102  0.553441
103  0.178980
104  0.253872
105 -0.906957
106  0.178980
107 -0.757173
108  4.485281
109 -0.345266
110  0.366210
111  0.029195
112  0.927902
113 -0.270374
114 -0.569942
115 -0.345266
116 -0.232927
117 -0.682281
118 -0.719727
119 -0.757173
120 -0.757173
121 -0.944403
122 -0.869511
123  1.302363
124 -0.158035
125 -0.719727
126  0.778117
127 -0.307820
128 -0.794619
129  0.778117
130  0.066641
131 -0.495050
132  0.403656
133  2.088731
134  0.703225
135 -0.495050
136  2.987437
137 -0.495050
138 -0.420158
139 -0.719727
140 -0.832065
141 -0.532496
142 -0.120589
143  0.890456
144 -0.832065
145 -0.794619
146  0.590887
147  1.676824
148  0.253872
149 -0.457604
150 -0.794619
151 -0.457604
152 -0.270374
153 -0.008251
154 -0.644835
155 -0.757173
156  1.339809
157  0.366210
158 -0.906957
159 -0.345266
160 -0.682281
161  0.553441
162  0.178980
163  0.253872
164 -0.906957
165  0.178980
166 -0.757173
167  4.485281
168 -0.345266
169  0.366210
170  0.029195
171  0.927902
172 -0.270374
173 -0.569942
174 -0.345266
175 -0.232927
176 -0.682281
177 -0.719727
178 -0.757173
179 -0.757173
180 -0.944403
181 -0.869511
182  1.302363
183 -0.158035
184 -0.719727
185  0.778117
186 -0.307820
187 -0.794619
188  0.778117
189  0.066641
190 -0.495050
191  0.403656
192  2.088731
193  0.703225
194 -0.495050
195  2.987437
196 -0.495050
197 -0.420158
198 -0.719727
199 -0.832065
200 -0.532496
201 -0.120589
202  0.890456
203 -0.832065
204 -0.794619
205  0.590887
206  1.676824
207  0.253872
208 -0.457604
209 -0.794619
210 -0.457604
211 -0.270374
212 -0.008251
213 -0.644835
214 -0.757173
215  1.339809
216  0.366210
217 -0.906957
218 -0.345266
219 -0.682281
220  0.553441
221  0.178980
222  0.253872
223 -0.906957
224  0.178980
225 -0.757173
226  4.485281
227 -0.345266
228  0.366210
229  0.029195
230  0.927902
231 -0.270374
232 -0.569942
233 -0.345266
234 -0.232927
235 -0.682281
236 -0.719727</code></pre>
</div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>output <span class="ot">&lt;-</span> </span>
<span id="cb5-2"><a></a>  <span class="fu">capture.output</span>(</span>
<span id="cb5-3"><a></a>    fit_epi_gaussian1 <span class="ot">&lt;-</span> </span>
<span id="cb5-4"><a></a>      brms<span class="sc">::</span><span class="fu">brm</span>(count <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Trt, <span class="at">data =</span> epilepsy, <span class="at">silent =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">8740</span>)</span>
<span id="cb5-5"><a></a>  )</span>
<span id="cb5-6"><a></a>  </span>
<span id="cb5-7"><a></a>fit_epi_gaussian1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: count ~ 1 + Trt 
   Data: epilepsy (Number of observations: 236) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat
Intercept     8.42      1.18     6.04    10.70 1.00
Trt1         -0.58      1.64    -3.82     2.68 1.00
          Bulk_ESS Tail_ESS
Intercept     4046     2833
Trt1          4033     2967

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat
sigma    12.35      0.57    11.32    13.53 1.00
      Bulk_ESS Tail_ESS
sigma     3533     2402

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</div></div>
</div>
</section>
<section id="generative-modelling-with-brms-2" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>At the top of the output, we see the formula and dataset. Moving to the actual posterior results, brms shows two blocks of parameters here, namely <em>Regression Coefficients</em> and <em>Further Distributional Parameters</em>. The latter refers to additional parameters of the likelihood that we did not specify with our regression, i.e.&nbsp;the residual standard deviation (sigma).</p>
<p>For each of the displayed parameters, we see seven summary statistics. The Estimate column is simply the empirical mean of the posterior draws, which is a sampling-based estimate of the analytical posterior mean.</p>
<p>The Est.Error columns denotes (the empirical estimate of) the posterior standard deviation, while the lower and upper bounds of the 95% credible interval are computed as the 2.5% and 97.5% quantile of the posterior samples, respectively. The three remaining columns, Rhat, Bulk_ESS, and Tail_ESS give us information about convergence and sampling eﬀiciency, as also shortly explained at the bottom of the summary output.</p>
</div>
</section>
<section id="generative-modelling-with-brms-3" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>Here we see, for each parameter separately, traces of the four MCMC chains in different colors with post-warmup iterations on the x-axis and parameter values on the y-axis. These trace plots are showing ideal convergence: All chains are <strong>overlaying each other nicely</strong>, are <strong>stationary</strong> (horizontal on average), and show <strong>little autocorrelation</strong>.</p>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(fit_epi_gaussian1, <span class="at">type =</span> <span class="st">"trace"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-6-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="generative-modelling-with-brms-4" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>Having convinced us of convergence, at least graphically for now, we can move on to inspecting the posteriors. e.g., we can plot histograms of the posterior samples per parameter.</p>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>brms<span class="sc">::</span><span class="fu">mcmc_plot</span>(fit_epi_gaussian1, <span class="at">type =</span> <span class="st">"hist"</span>, <span class="at">bins=</span><span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-7-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="generative-modelling-with-brms-5" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>In R, we can easily perform data transformations by first extracting the posterior draws and then applying the transformation per draws in a vectorized manner. e.g., using the functionality from the posterior:: package</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>draws <span class="ot">&lt;-</span> </span>
<span id="cb9-2"><a></a>  posterior<span class="sc">::</span><span class="fu">as_draws_df</span>(fit_epi_gaussian1) <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a></a>  posterior<span class="sc">::</span><span class="fu">mutate_variables</span>(</span>
<span id="cb9-4"><a></a>    <span class="at">variance =</span> sigma<span class="sc">^</span><span class="dv">2</span>, <span class="at">mu_Trt =</span> b_Intercept <span class="sc">+</span> b_Trt1</span>
<span id="cb9-5"><a></a>  )</span>
<span id="cb9-6"><a></a></span>
<span id="cb9-7"><a></a>draws</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A draws_df: 1000 iterations, 4 chains, and 8 variables
   b_Intercept b_Trt1 sigma Intercept lprior lp__
1          7.0   2.04    12       8.1   -7.3 -934
2          9.1  -1.69    13       8.2   -7.4 -933
3          9.0  -0.77    12       8.6   -7.3 -933
4          7.5   1.15    12       8.1   -7.4 -933
5          8.5  -0.89    13       8.0   -7.4 -932
6          9.1  -2.18    12       8.0   -7.2 -933
7          8.1   0.81    13       8.5   -7.5 -933
8          8.3   1.19    12       8.9   -7.4 -934
9          7.1   1.16    12       7.7   -7.2 -933
10         9.7  -1.09    13       9.1   -7.8 -934
   variance mu_Trt
1       151    9.0
2       160    7.4
3       134    8.2
4       156    8.7
5       158    7.6
6       144    6.9
7       160    8.9
8       140    9.5
9       143    8.3
10      171    8.6
# ... with 3990 more draws
# ... hidden reserved variables {'.chain', '.iteration', '.draw'}</code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-6" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>With mu_Trt we computed the model-implied predictions of the mean for the treatment group. For the control group, it would just be mu_Ctrl = <span class="math inline">\(\beta_0\)</span> for this simple model.</p>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>bayesplot<span class="sc">::</span><span class="fu">mcmc_hist</span>(draws, <span class="fu">c</span>(<span class="st">"variance"</span>, <span class="st">"mu_Trt"</span>), <span class="at">bins =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-9-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="generative-modelling-with-brms-7" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>For more complex models, computing the predictions for different groups or, more generally, different predictor values manually becomes quite cumbersome. For this reason brms provides you with a convenient method to provide quick graphical summarizes of the model-implied predictions per predictor:</p>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a>ce <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">conditional_effects</span>(fit_epi_gaussian1)</span>
<span id="cb12-2"><a></a><span class="fu">plot</span>(ce)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-10-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="generative-modelling-with-brms-8" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>The error bars in the last slide are representing 95% credible intervals by default, but we can change that value if we like via the <code>prob</code> argument. Comparing the conditional_effects plot with our manually computed posterior of mu_Trt, we see that they actually are the same.</p>
<p>To put the mean predictions into the context of the observed data, we can also show the data as points in the plot:</p>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="fu">plot</span>(ce, <span class="at">points =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-11-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="generative-modelling-with-brms-9" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>What we do in <code>conditional_effects</code> by default, and have done above, is visualizing the expected value (mean parameter) of the likelihood distribution, conditional on certain predictor values. In brms, this is done via the <code>posterior_epred</code> (posterior expected predictions) method. For example, we can run the code below to create expected posterior predictions for both groups. The resulting object contains the posterior draws in the rows and the different conditions (here, treatment groups) in the columns.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>newdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Trt =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb14-2"><a></a>pe <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">posterior_epred</span>(fit_epi_gaussian1, <span class="at">newdata =</span> newdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We also can summarize the draws, for example, via</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>brms<span class="sc">::</span><span class="fu">posterior_summary</span>(pe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Estimate Est.Error  Q2.5 Q97.5
[1,]    8.416     1.179 6.035 10.70
[2,]    7.836     1.125 5.574 10.07</code></pre>
</div>
</div>
<p>In linear models, <code>posterior_epred</code> directly coincides with evaluating the linear predictor <span class="math inline">\(\mu\)</span> as exemplified above. What <code>posterior_epred</code> does not include is the residual uncertainty, which is represented by <span class="math inline">\(\sigma\)</span> in our linear models.</p>
</div>
</section>
<section id="generative-modelling-with-brms-10" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>Consider again the task of evaluating predictions for the treatment group. If we are only interested in (the posterior of) the likelihood’s mean parameter, we would compute <span class="math inline">\(\mu^{(s)}_{\mathrm{Trt}}=\beta_0^{(s)} + \beta_1^{(s)}\)</span>.</p>
<p>In contrast, if we are interested in prediction of hypothetical new data points <span class="math inline">\(y^{(s)}_{\mathrm{Trt}}\)</span> from the treatment group (i.e., actual posterior predictions), we would sample</p>
<p><span class="math display">\[
y^{(s)}_{\mathrm{Trt}}\sim\mathscr{N}\left(\mu^{(s)}_{\mathrm{Trt}}, \sigma^{(s)} \right)
\]</span></p>
<p>This is exactly what happens behind the scenes when we execute the code below:</p>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="fu">options</span>(<span class="at">brms.plot_points =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-2"><a></a>brms<span class="sc">::</span><span class="fu">conditional_effects</span>(fit_epi_gaussian1, <span class="at">method =</span> <span class="st">"posterior_predict"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-14-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="generative-modelling-with-brms-11" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>We could have also done this more manually via</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>newdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Trt =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb18-2"><a></a>pp <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">posterior_predict</span>(fit_epi_gaussian1, <span class="at">newdata =</span> newdata)</span>
<span id="cb18-3"><a></a></span>
<span id="cb18-4"><a></a>brms<span class="sc">::</span><span class="fu">posterior_summary</span>(pp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Estimate Est.Error   Q2.5 Q97.5
[1,]    8.151     12.63 -17.08 33.17
[2,]    7.780     12.52 -17.04 32.30</code></pre>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-12" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>We are already aware that linear regression model is not ideal for the epilepsy data. But how bad is it? As quick graphical method, we can use posterior predictive (PP) checks, where we compare the observed outcome data with the model predicted outcome data, that is, with the posterior predictions. In brms, we can perform PP-checks via:</p>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(fit_epi_gaussian1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-16-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="generative-modelling-with-brms-13" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: xx-large">
<p>We see that the model predictions can neither account for the strong spike of observed outcomes close to zero nor for their right-skewness. Instead, the the model also predicts a lot of negative outcomes, which is impossible in reality because we are predicting counts of epileptic seizures.</p>
<p>In the plot, it looks as if the observed data also had few negative values (the dark blue density going below zero) but this is just an artifact of estimating a continuous density from counts. While this PP-check type is definitely not ideal to illustrate count outcome data, it still very clearly points to the shortcomings of our linear model.</p>
</div>
</section>
<section id="generative-modelling-with-brms-14" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>While the default PP-check was already eye-opening, there are lot of types that can further our understanding of model appropriateness. For example, an often very useful check is obtained by comparing the residuals = observed outcomes - model predictions with the observed outcomes, also known as residual plot. In pp_check this check type is called error_scatter_avg:</p>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(fit_epi_gaussian1, <span class="at">type =</span> <span class="st">"error_scatter_avg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-17-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="generative-modelling-with-brms-15" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<p>Here there is a strongly almost perfectly linear relationship indicating strong problems with the independence assumption of the errors.</p>
<p>Essentially, both PP-checks have told us that our initial model is a very bad for the data at hand.</p>
<p>If you don’t know which check types are available, you can simply pass an arbitrary non-supported type name to get a list of all currently supported types:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(fit_epi_gaussian1, <span class="at">type =</span> <span class="st">"help_me"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generative-modelling-with-brms-16" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<div style="font-size: x-large">
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>output <span class="ot">&lt;-</span> </span>
<span id="cb23-2"><a></a>  <span class="fu">capture.output</span>(</span>
<span id="cb23-3"><a></a>    fit_epi_student1 <span class="ot">&lt;-</span> </span>
<span id="cb23-4"><a></a>      brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb23-5"><a></a>        count <span class="sc">~</span> Trt <span class="sc">*</span> Base,</span>
<span id="cb23-6"><a></a>        <span class="at">data =</span> epilepsy,</span>
<span id="cb23-7"><a></a>        <span class="at">family =</span> brms<span class="sc">::</span><span class="fu">student</span>()</span>
<span id="cb23-8"><a></a>        , <span class="at">silent =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">8740</span></span>
<span id="cb23-9"><a></a>      )</span>
<span id="cb23-10"><a></a>  )</span>
<span id="cb23-11"><a></a></span>
<span id="cb23-12"><a></a></span>
<span id="cb23-13"><a></a><span class="fu">summary</span>(fit_epi_student1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: student 
  Links: mu = identity; sigma = identity; nu = identity 
Formula: count ~ Trt * Base 
   Data: epilepsy (Number of observations: 236) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat
Intercept     0.01      0.37    -0.71     0.74 1.00
Trt1          0.42      0.63    -0.82     1.62 1.00
Base          0.26      0.01     0.23     0.28 1.00
Trt1:Base    -0.11      0.02    -0.16    -0.07 1.00
          Bulk_ESS Tail_ESS
Intercept     2992     3117
Trt1          2133     2665
Base          2672     2228
Trt1:Base     1920     2163

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat
sigma     2.10      0.21     1.71     2.54 1.00
nu        1.39      0.18     1.09     1.78 1.00
      Bulk_ESS Tail_ESS
sigma     2557     2421
nu        2246     1553

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(fit_epi_student1) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-20-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section>
<section id="generative-modelling-with-brms-17" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="absolute-predictive-performance">Absolute predictive performance</h4>
<div style="font-size: x-large">
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>output <span class="ot">&lt;-</span> </span>
<span id="cb26-2"><a></a>  <span class="fu">capture.output</span>(</span>
<span id="cb26-3"><a></a>    fit_epi_gaussian2 <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(count <span class="sc">~</span> Trt <span class="sc">+</span> Base, <span class="at">data =</span> epilepsy, <span class="at">silent =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">8740</span>)</span>
<span id="cb26-4"><a></a>  )</span>
<span id="cb26-5"><a></a><span class="co"># find a spot for this</span></span>
<span id="cb26-6"><a></a>output <span class="ot">&lt;-</span> </span>
<span id="cb26-7"><a></a>  <span class="fu">capture.output</span>(</span>
<span id="cb26-8"><a></a>    fit_epi_gaussian3 <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(count <span class="sc">~</span> Trt <span class="sc">*</span> Base, <span class="at">data =</span> epilepsy, <span class="at">silent =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">8740</span>)</span>
<span id="cb26-9"><a></a>  )</span>
<span id="cb26-10"><a></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(fit_epi_gaussian2) <span class="sc">+</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">18</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"side"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-21-1.png" width="960"></p>
<figcaption>Default posterior predictive check for model fit_epi_skew_normal1</figcaption>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(fit_epi_gaussian2, <span class="at">type =</span> <span class="st">"error_scatter_avg"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-22-1.png" width="960"></p>
<figcaption>Posterior predictive check comparing observed responses (y-axis) with the predictive residuals (x-axis) of model fit_epi_gaussian2</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section>
<section id="generative-modelling-with-brms-18" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="measures-of-explained-variance-r2">Measures of explained variance: <span class="math inline">\(R^2\)</span></h4>
<div style="font-size: x-large">
<p>The standard <span class="math inline">\(R^2\)</span> measure is defined only for Gaussian models and is often referred to as the percentage of explained variance. Note that in the Gaussian context we compute draws from the posterior <span class="math inline">\(R^2\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="co"># compute draws of the predictive errors based on posterior_epred</span></span>
<span id="cb28-2"><a></a>errors <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">predictive_error</span>(fit_epi_gaussian2, <span class="at">method =</span> <span class="st">"posterior_epred"</span>)</span>
<span id="cb28-3"><a></a><span class="fu">str</span>(errors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:4000, 1:236] 1.36 3.07 3.35 3.2 3.09 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a><span class="co"># sum errors over observations</span></span>
<span id="cb30-2"><a></a>error_variation <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(errors<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb30-3"><a></a><span class="fu">str</span>(error_variation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:4000] 15385 15225 15062 15072 15047 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a><span class="co"># compute R2_basic</span></span>
<span id="cb32-2"><a></a>overall_variation <span class="ot">&lt;-</span> <span class="fu">sum</span>((epilepsy<span class="sc">$</span>count <span class="sc">-</span> <span class="fu">mean</span>(epilepsy<span class="sc">$</span>count))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb32-3"><a></a>R2_basic_epi_gaussian2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> error_variation <span class="sc">/</span> overall_variation</span>
<span id="cb32-4"><a></a>brms<span class="sc">::</span><span class="fu">posterior_summary</span>(R2_basic_epi_gaussian2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Estimate Est.Error  Q2.5  Q97.5
[1,]   0.5765  0.004541 0.565 0.5816</code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-19" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="measures-of-explained-variance-r2-1">Measures of explained variance: <span class="math inline">\(R^2\)</span></h4>
<div style="font-size: x-large">
<p>The <span class="math inline">\(R^2_{\mathrm{basic}}\)</span>is a good starting point, but it doesn’t generalize to models that are more complicated than Gaussian linear models. In particular it doesn’t readily generalize to most other likelihood families.</p>
<p>We’ll use a more general form of <span class="math inline">\(R^2\)</span> that we can apply to (almost) all brms models, regardless of what likelihood families they have. The measure is based on the ratio of explained variance and the sum of explained and error variance:</p>
<p><span class="math display">\[
R^2_{\mathrm{general}} = \frac{\mathrm{Var}(\hat{y})}{\mathrm{Var}(\hat{y})+$\mathrm{Var}(\hat{e})}
\]</span></p>
<p>Where <span class="math inline">\(\mathrm{Var}(\hat{y})\)</span>) is the variance of the posterior predicted mean over observations (again <code>posterior_epred</code>) and <span class="math inline">\(\mathrm{Var}(\hat{e})\)</span>)) is the variance of the model-implied errors over observations, where <span class="math inline">\(\hat{e}=y_n-\hat{y}_n\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>brms<span class="sc">::</span><span class="fu">bayes_R2</span>(fit_epi_gaussian2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Estimate Est.Error Q2.5  Q97.5
R2   0.5795   0.02776 0.52 0.6274</code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-20" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="measures-of-squared-errors">Measures of Squared Errors</h4>
<div style="font-size: x-large">
<p><span class="math inline">\(\mathrm{RMSE}_{\mathrm{basic}}\)</span> computes a mean square error of observations <span class="math inline">\(n\)</span> for each posterior draw <span class="math inline">\(s\)</span>, and thus yields a posterior distribution over RMSE values</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a><span class="co"># compute draws of the predictive errors based on posterior_epred</span></span>
<span id="cb36-2"><a></a>errors_epi_gaussian3 <span class="ot">&lt;-</span></span>
<span id="cb36-3"><a></a>brms<span class="sc">::</span><span class="fu">predictive_error</span>(fit_epi_gaussian3, <span class="at">method =</span> <span class="st">"posterior_epred"</span>)</span>
<span id="cb36-4"><a></a><span class="fu">str</span>(errors_epi_gaussian3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:4000, 1:236] 1.15 1.67 1.53 2.42 2.19 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a><span class="co"># root mean of squared errors over observations</span></span>
<span id="cb38-2"><a></a>rmse_basic_epi_gaussian3 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowMeans</span>(errors_epi_gaussian3<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb38-3"><a></a><span class="fu">str</span>(rmse_basic_epi_gaussian3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:4000] 7.72 7.71 7.71 7.73 7.71 ...</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a>lattice<span class="sc">::</span><span class="fu">histogram</span>(rmse_basic_epi_gaussian3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-29-1.png" width="960"></p>
<figcaption>Posterior histogram of RMSE_basic for model fit_epi_gaussian3.</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</section>
<section id="generative-modelling-with-brms-21" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="measures-of-squared-errors-1">Measures of Squared Errors</h4>
<div style="font-size: x-large">
<p>We can also exchange the use of <span class="math inline">\(n\)</span> and <span class="math inline">\(s\)</span> and compute a mean square error over draws <span class="math inline">\(s\)</span> for each observation <span class="math inline">\(n\)</span>:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a>rmse_alt_epi_gaussian3 <span class="ot">&lt;-</span> </span>
<span id="cb41-2"><a></a>  <span class="fu">sqrt</span>(<span class="fu">colMeans</span>(errors_epi_gaussian3<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb41-3"><a></a><span class="fu">str</span>(rmse_alt_epi_gaussian3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:236] 1.96 0.961 1.014 1.813 10.987 ...</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a>lattice<span class="sc">::</span><span class="fu">histogram</span>(rmse_alt_epi_gaussian3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-31-1.png" width="960"></p>
<figcaption>Posterior histogram of RMSE_alt for model fit_epi_gaussian3.</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
<p>In this case, we get a distribution of RMSE over observations, where each individual RMSE value would be computed over the posterior predictive distribution of a single observation. Both of the above RMSE measures are fully Bayesian as they take into account the uncertainty in the posterior distribution, but in different ways.</p>
</div>
</section>
<section id="generative-modelling-with-brms-22" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="measures-of-squared-errors-2">Measures of Squared Errors</h4>
<div style="font-size: x-large">
<p>Typically see only a point estimate <span class="math inline">\(\hat{\bar{y}}_n\)</span> being used to represent the model-implied predictions, instead of a (posterior) distribution over such predictions for each <span class="math inline">\(n\)</span>. For example, for a Bayesian model this point estimate could simply be the posterior mean.</p>
<p>When using such a point prediction approach, our RMSE definition becomes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a></a><span class="co"># extract a point estimate of the predictions per observation</span></span>
<span id="cb44-2"><a></a>ppmean_epi_gaussian3 <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(brms<span class="sc">::</span><span class="fu">posterior_epred</span>(fit_epi_gaussian3))</span>
<span id="cb44-3"><a></a><span class="fu">str</span>(ppmean_epi_gaussian3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:236] 3.27 3.27 1.94 2.47 17.91 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a></a><span class="co"># compute RMSE based on the responses and point predictions</span></span>
<span id="cb46-2"><a></a>(rmse_point_epi_gaussian3 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((epilepsy<span class="sc">$</span>count <span class="sc">-</span> ppmean_epi_gaussian3)<span class="sc">^</span><span class="dv">2</span>)) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.698</code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-23" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="relative-predictive-performance">2.6 Relative predictive performance</h4>
<div style="font-size: x-large">
<p>In general, it is more common to compare multiple models against each other and thus investigating their relative predictive performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a></a>errors_epi_student1 <span class="ot">&lt;-</span></span>
<span id="cb48-2"><a></a>  brms<span class="sc">::</span><span class="fu">predictive_error</span>(fit_epi_student1, <span class="at">method =</span> <span class="st">"posterior_epred"</span>)</span>
<span id="cb48-3"><a></a>rmse_alt_epi_student1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">colMeans</span>(errors_epi_student1<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now even compute the pointwise (per-observation) difference in RMSE values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a>rmse_alt_diff <span class="ot">&lt;-</span> rmse_alt_epi_student1 <span class="sc">-</span> rmse_alt_epi_gaussian3</span>
<span id="cb49-2"><a></a><span class="fu">str</span>(rmse_alt_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:236] 0.219 -0.627 -0.462 0.144 -0.966 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a></a>se_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="fu">sd</span>(x) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(x))}</span>
<span id="cb51-2"><a></a></span>
<span id="cb51-3"><a></a>se_rmse_alt_diff <span class="ot">&lt;-</span> <span class="fu">se_mean</span>(rmse_alt_diff)</span>
<span id="cb51-4"><a></a>se_rmse_alt_diff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.367</code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-24" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="likelihood-density-scores">2.6.1 Likelihood Density Scores</h4>
<div style="font-size: xx-large">
<p>We have looked at variations of <span class="math inline">\(R^2\)</span> and RMSE metrics. Next we use the log-likelihood of models as predictive metric more generally.</p>
<p>The log-likelihood plays a pivotal role not only in to derive the posterior in Bayesian statistics but also to obtain maximum likelihood estimates in a frequentist framework. Intuitively, the higher the likelihood of the data given the model’s parameters estimates (represented as either posterior draws or point estimates), the better the fit of the model to the data. Many important predictive metrics, Bayesian or otherwise, are based on log-likelihood scores.</p>
</div>
</section>
<section id="generative-modelling-with-brms-25" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="likelihood-density-scores-1">2.6.1 Likelihood Density Scores</h4>
<div style="font-size: xx-large">
<p>Since log is a strictly monotonic transformation, we are not changing anything fundamental by looking at log likelihoods instead of likelihoods. However, we are making the math much simpler by working with sums instead of products. In particular, this concerns computing gradients because the gradient of a sum is just the sum of the individual (pointwise) gradients. Much of the modern statistics and ML relies on this property.</p>
<p><code>brms</code> comes with a dedicated <code>log_lik</code> method that does all the required math.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a>ll_epi_gaussian3 <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">log_lik</span>(fit_epi_gaussian3)</span>
<span id="cb53-2"><a></a><span class="fu">str</span>(ll_epi_gaussian3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> num [1:4000, 1:236] -3 -2.97 -2.95 -2.98 -3.02 ...
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : NULL</code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-26" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="likelihood-density-scores-2">2.6.1 Likelihood Density Scores</h4>
<div style="font-size: x-large">
<p>The output of <code>log_lik</code> has the same structure as <code>posterior_predict</code> and friends, that is, it has as many columns as we have observations and as many rows as we posterior draws.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a></a>lattice<span class="sc">::</span><span class="fu">histogram</span>(<span class="fu">colMeans</span>(ll_epi_gaussian3), <span class="at">nint=</span><span class="dv">30</span>, <span class="at">type =</span> <span class="st">"density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-36-1.png" width="960"></p>
<figcaption>Per-observation (pointwise) log-likelihoods of model fit_epi_gaussian3.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-27" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="likelihood-density-scores-3">2.6.1 Likelihood Density Scores</h4>
<div style="font-size: x-large">
<p>Similar to the RMSE_alt metric earlier, we average over posterior draws per observation such that we obtain one log-likelihood value per observation.</p>
<p>The mean of the log-likelihood differences is slightly positive which points to a slightly better fit of the Student-t model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a></a>llm_epi_student1  <span class="ot">&lt;-</span> <span class="fu">colMeans</span>( brms<span class="sc">::</span><span class="fu">log_lik</span>(fit_epi_student1) )</span>
<span id="cb56-2"><a></a>llm_epi_gaussian3 <span class="ot">&lt;-</span> <span class="fu">colMeans</span>( brms<span class="sc">::</span><span class="fu">log_lik</span>(fit_epi_gaussian3) )</span>
<span id="cb56-3"><a></a></span>
<span id="cb56-4"><a></a>llm_epi_diff <span class="ot">&lt;-</span> llm_epi_student1 <span class="sc">-</span> llm_epi_gaussian3</span>
<span id="cb56-5"><a></a><span class="fu">mean</span>(llm_epi_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5009</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-38-1.png" width="960"></p>
<figcaption>Pointwise log-likelihood values of model fit_epi_gaussian3 and fit_epi_student1 as well as their pointwise log-likelihood differences.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-28" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="likelihood-density-scores-4">2.6.1 Likelihood Density Scores</h4>
<div style="font-size: x-large">
<p>It is more typical to work with sums instead of means of log-likelihood values over observations, a quantity that we call LPD:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a></a>(lpd_epi_diff <span class="ot">&lt;-</span> <span class="fu">sum</span>(llm_epi_diff))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 118.2</code></pre>
</div>
</div>
<p>The corresponding standard error is also not particular difficult to obtain:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a></a>se_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="fu">sd</span>(x) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(x))}</span>
<span id="cb60-2"><a></a></span>
<span id="cb60-3"><a></a>(se_lpd_epi_diff <span class="ot">&lt;-</span> <span class="fu">se_sum</span>(llm_epi_diff))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31.02</code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-29" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="out-of-sample-predictions">2.7 Out-of-sample predictions</h4>
<div style="font-size: x-large">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a></a><span class="fu">set.seed</span>(<span class="dv">8973</span>)</span>
<span id="cb62-2"><a></a>splits <span class="ot">&lt;-</span> epilepsy <span class="sc">|&gt;</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(<span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb62-3"><a></a>epilepsy_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(splits)</span>
<span id="cb62-4"><a></a>epilepsy_test  <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(splits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a></a>output <span class="ot">&lt;-</span> </span>
<span id="cb63-2"><a></a>  <span class="fu">capture.output</span>(</span>
<span id="cb63-3"><a></a>    fit_student1_train <span class="ot">&lt;-</span> </span>
<span id="cb63-4"><a></a>      brms<span class="sc">::</span><span class="fu">brm</span>(count <span class="sc">~</span> Trt <span class="sc">*</span> Base, <span class="at">data =</span> epilepsy_train, <span class="at">family =</span> brms<span class="sc">::</span><span class="fu">student</span>(), <span class="at">silent =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">8740</span>)</span>
<span id="cb63-5"><a></a>  )</span>
<span id="cb63-6"><a></a>llm_epi_gaussian3_test <span class="ot">&lt;-</span>  brms<span class="sc">::</span><span class="fu">log_lik</span>(fit_student1_train, <span class="at">newdata =</span> epilepsy_test)</span>
<span id="cb63-7"><a></a></span>
<span id="cb63-8"><a></a>output <span class="ot">&lt;-</span> </span>
<span id="cb63-9"><a></a>  <span class="fu">capture.output</span>(</span>
<span id="cb63-10"><a></a>    fit_gaussian3_train <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(count <span class="sc">~</span> Trt <span class="sc">*</span> Base, <span class="at">data =</span> epilepsy_train, <span class="at">silent =</span> <span class="dv">2</span>, <span class="at">seed =</span> <span class="dv">8740</span>)</span>
<span id="cb63-11"><a></a>  )</span>
<span id="cb63-12"><a></a>llm_epi_student1_test <span class="ot">&lt;-</span> <span class="fu">colMeans</span>( brms<span class="sc">::</span><span class="fu">log_lik</span>(fit_gaussian3_train, <span class="at">newdata =</span> epilepsy_test) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-30" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="out-of-sample-predictions-1">2.7 Out-of-sample predictions</h4>
<div style="font-size: x-large">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a></a>llm_epi_diff_test <span class="ot">&lt;-</span> llm_epi_student1_test <span class="sc">-</span> llm_epi_gaussian3_test</span>
<span id="cb64-2"><a></a>lattice<span class="sc">::</span><span class="fu">histogram</span>(llm_epi_diff_test <span class="sc">|&gt;</span> <span class="fu">matrix</span>(), <span class="at">nint=</span><span class="dv">50</span>, <span class="at">type =</span> <span class="st">"density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-43-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] -49480</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a></a>(se_elpd_epi_diff_test <span class="ot">&lt;-</span> <span class="fu">se_sum</span>(llm_epi_diff_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 742.9</code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-31" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="out-of-sample-predictions-2">2.7 Out-of-sample predictions</h4>
<div style="font-size: x-large">
<p>In leave-one-out cross-validation (LOO-CV), we perform <span class="math inline">\(N\)</span> training-test splits, where each time we are leaving out a single observations, fitting the model on the remaining <span class="math inline">\(N-1\)</span> observations before evaluating model fit on that single left-out observation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a></a>loo_epi_gaussian3 <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">loo</span>(fit_epi_gaussian3)</span>
<span id="cb68-2"><a></a>loo_epi_gaussian3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 236 log-likelihood matrix.

         Estimate   SE
elpd_loo   -831.4 43.0
p_loo        21.5 12.5
looic      1662.8 86.1
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.6, 1.1]).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     234   99.2%   1310    
   (0.7, 1]   (bad)        0    0.0%   &lt;NA&gt;    
   (1, Inf)   (very bad)   2    0.8%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a></a>loo_epi_student1 <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">loo</span>(fit_epi_student1)</span>
<span id="cb70-2"><a></a>loo_epi_student1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 4000 by 236 log-likelihood matrix.

         Estimate   SE
elpd_loo   -704.5 23.5
p_loo         7.2  0.6
looic      1409.0 46.9
------
MCSE of elpd_loo is 0.1.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.5, 1.3]).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                  elpd_diff se_diff
fit_epi_student1     0.0       0.0 
fit_epi_gaussian3 -126.9      37.0 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Output of model 'fit_epi_gaussian3':

Computed from 4000 by 236 log-likelihood matrix.

         Estimate   SE
elpd_loo   -831.4 43.0
p_loo        21.5 12.5
looic      1662.8 86.1
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.6, 1.1]).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     234   99.2%   1310    
   (0.7, 1]   (bad)        0    0.0%   &lt;NA&gt;    
   (1, Inf)   (very bad)   2    0.8%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.

Output of model 'fit_epi_student1':

Computed from 4000 by 236 log-likelihood matrix.

         Estimate   SE
elpd_loo   -704.5 23.5
p_loo         7.2  0.6
looic      1409.0 46.9
------
MCSE of elpd_loo is 0.1.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.5, 1.3]).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.

Model comparisons:
                  elpd_diff se_diff
fit_epi_student1     0.0       0.0 
fit_epi_gaussian3 -126.9      37.0 </code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-32" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="prior-predictive-performance">2.8 Prior predictive performance</h4>
<div style="font-size: x-large">
<p>We will now take a fundamentally different approach by evaluating prior predictive distribution, that is, by looking at what predictions a model implies before seeing any data. The starting point to investigating prior predictive performance is to perform graphical prior predictive checks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a></a>prior_epi_gaussian6 <span class="ot">&lt;-</span></span>
<span id="cb74-2"><a></a>  brms<span class="sc">::</span><span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">6</span>, <span class="dv">3</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>) <span class="sc">+</span></span>
<span id="cb74-3"><a></a>  brms<span class="sc">::</span><span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"Trt1"</span>) <span class="sc">+</span></span>
<span id="cb74-4"><a></a>  brms<span class="sc">::</span><span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"Base"</span>) <span class="sc">+</span></span>
<span id="cb74-5"><a></a>  brms<span class="sc">::</span><span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"Trt1:Base"</span>) <span class="sc">+</span></span>
<span id="cb74-6"><a></a>  brms<span class="sc">::</span><span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">15</span>), <span class="at">class =</span> <span class="st">"sigma"</span>)</span>
<span id="cb74-7"><a></a>prior_epi_gaussian6 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         prior     class      coef group resp dpar
  normal(6, 3) Intercept                          
  normal(0, 5)         b      Trt1                
  normal(0, 1)         b      Base                
  normal(0, 1)         b Trt1:Base                
 normal(0, 15)     sigma                          
 nlpar   lb   ub source
       &lt;NA&gt; &lt;NA&gt;   user
       &lt;NA&gt; &lt;NA&gt;   user
       &lt;NA&gt; &lt;NA&gt;   user
       &lt;NA&gt; &lt;NA&gt;   user
       &lt;NA&gt; &lt;NA&gt;   user</code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-33" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="prior-predictive-performance-1">2.8 Prior predictive performance</h4>
<div style="font-size: x-large">
<p>Here we are “fitting” the model with the option sample_prior = “only”, which ensures that Stan ignores the likelihood contribution to the posterior, such that the posterior directly resembles the prior.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a></a>output <span class="ot">&lt;-</span> </span>
<span id="cb76-2"><a></a>  <span class="fu">capture.output</span>(</span>
<span id="cb76-3"><a></a>    fit_prior_epi_gaussian6 <span class="ot">&lt;-</span> </span>
<span id="cb76-4"><a></a>      brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb76-5"><a></a>        count <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Trt <span class="sc">*</span> Base,</span>
<span id="cb76-6"><a></a>        <span class="at">data =</span> epilepsy,</span>
<span id="cb76-7"><a></a>        <span class="at">prior =</span> prior_epi_gaussian6,</span>
<span id="cb76-8"><a></a>        <span class="at">sample_prior =</span> <span class="st">"only"</span></span>
<span id="cb76-9"><a></a>      )</span>
<span id="cb76-10"><a></a>  )</span>
<span id="cb76-11"><a></a><span class="fu">summary</span>(fit_prior_epi_gaussian6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: count ~ 1 + Trt * Base 
   Data: epilepsy (Number of observations: 236) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat
Intercept     5.18     35.86   -63.94    75.99 1.00
Trt1          0.03      4.98    -9.70     9.75 1.00
Base          0.02      1.00    -1.89     1.95 1.01
Trt1:Base     0.01      1.01    -1.94     2.02 1.00
          Bulk_ESS Tail_ESS
Intercept     3861     2564
Trt1          4088     2900
Base          3942     2807
Trt1:Base     3958     2791

Further Distributional Parameters:
      Estimate Est.Error l-95% CI u-95% CI Rhat
sigma    11.96      9.02     0.41    33.35 1.00
      Bulk_ESS Tail_ESS
sigma     2041     1127

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</div>
</section>
<section id="generative-modelling-with-brms-34" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="prior-predictive-performance-2">2.8 Prior predictive performance</h4>
<div style="font-size: x-large">
<p>For all practical purposes, our “prior-only” brms model can be post-processed as any other brms model.</p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a></a>brms<span class="sc">::</span><span class="fu">pp_check</span>(fit_prior_epi_gaussian6, <span class="at">ndraws =</span> <span class="dv">100</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">150</span>, <span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="CRAP_BSMM_8740_lec_10_files/figure-revealjs/unnamed-chunk-52-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="generative-modelling-with-brms-35" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="marginal-likelihood-based-metrics">2.8 Marginal likelihood-based metrics</h4>
<div style="font-size: x-large">
<p>To mathematically formalize the prior predictive performance of a model, consider the marginal likelihood that we find in the denominator of Bayes theorem (aka evidence): <span class="math display">\[
p(y)=\int p(y\vert\theta)p(\theta)d\theta
\]</span> We can write this as the likelihood of the data given the model and we can do inference about the models based on the marginal likelihood. <span class="math display">\[
p(y\vert M)=\int p(y\vert\theta,M)p(\theta\vert M)d\theta
\]</span> The absolute marginal likelihood values <span class="math inline">\(p(y\vert M)\)</span>are very hard to interpret. We only know that higher is better.</p>
</div>
</section>
<section id="generative-modelling-with-brms-36" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="marginal-likelihood-based-metrics-1">2.8 Marginal likelihood-based metrics</h4>
<div style="font-size: x-large">
<p>The most common such comparative metric is the Bayes factor, defined as the ratio of two models’ marginal likelihoods:</p>
<p><span class="math display">\[
\mathrm{BF}_{1,2}=\frac{p(y\vert M_{1})}{p(y\vert M_{2})}
\]</span> If the Bayes factor is greater than 1, the data <span class="math inline">\(y\)</span> have a higher likelihood given model <span class="math inline">\(M_1\)</span> compared to <span class="math inline">\(M_2\)</span>, and vice versa.</p>
</div>
</section>
<section id="generative-modelling-with-brms-37" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="marginal-likelihood-based-metrics-2">2.8 Marginal likelihood-based metrics</h4>
<div style="font-size: x-large">
<p>We can say “Given the data <span class="math inline">\(y\)</span>, model <span class="math inline">\(M_1\)</span> is more likely than model <span class="math inline">\(M_2\)</span>” if we use the posterior odds:</p>
<p><span class="math display">\[
\frac{p(M_{1}\vert y)}{p(M_{2}\vert y)}=\frac{p(y\vert M_{1})}{p(y\vert M_{2})}\frac{p(M_{1})}{p(M_{2})}=\mathrm{BF}_{1,2}\times\frac{p(M_{1})}{p(M_{2})}
\]</span> We often set the prior odds to 1 not actually because we really believe in models being equally likely a priori, but simply out of convenience; just as we often set wide or even completely flat priors on parameters.</p>
</div>
</section>
<section id="generative-modelling-with-brms-38" class="slide level2">
<h2>Generative modelling with BRMS</h2>
<h4 id="marginal-likelihood-based-metrics-3">2.8 Marginal likelihood-based metrics</h4>
<div style="font-size: x-large">
<p>Since the Bayes factor is based on marginal likelihoods, the computational challenges are substantial. Fortunately, there is one class of algorithms that enables reliable computation of (log) marginal likelihood on the basis of posterior draws. This class of algorithms is called bridge sampling.</p>
<p>Marginal likelihood estimation via bridge sampling usually requires several times more posterior draws than the estimation of posterior moments or quantiles (i.e., what we usually do with posterior draws).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a></a>output <span class="ot">&lt;-</span> </span>
<span id="cb79-2"><a></a>  <span class="fu">capture.output</span>(</span>
<span id="cb79-3"><a></a>    fit_epi_gaussian6 <span class="ot">&lt;-</span> </span>
<span id="cb79-4"><a></a>      brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb79-5"><a></a>        count <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Trt <span class="sc">*</span> Base, <span class="at">data =</span> epilepsy,</span>
<span id="cb79-6"><a></a>        <span class="at">prior =</span> prior_epi_gaussian6,</span>
<span id="cb79-7"><a></a>        <span class="at">save_pars =</span> brms<span class="sc">::</span><span class="fu">save_pars</span>(<span class="at">all =</span> <span class="cn">TRUE</span>),</span>
<span id="cb79-8"><a></a>        <span class="at">iter =</span> <span class="dv">5000</span>, <span class="at">warmup =</span> <span class="dv">1000</span></span>
<span id="cb79-9"><a></a>      )</span>
<span id="cb79-10"><a></a>  )</span>
<span id="cb79-11"><a></a>logml_epi_gaussian6 <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">bridge_sampler</span>(fit_epi_gaussian6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration: 1
Iteration: 2
Iteration: 3
Iteration: 4</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a></a><span class="fu">summary</span>(logml_epi_gaussian6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Bridge sampling log marginal likelihood estimate 
(method = "normal", repetitions = 1):

 -831.3

Error Measures:

 Relative Mean-Squared Error: 6.725e-07
 Coefficient of Variation: 0.0008201
 Percentage Error: 0%

Note:
All error measures are approximate.</code></pre>
</div>
</div>
</div>
</section>
<section id="more" class="slide level2">
<h2>More</h2>
<ul>
<li>Read <a href="https://www.bayesrulesbook.com/">Bayes Rules!</a></li>
<li>Read <a href="http://allendowney.github.io/ThinkBayes2/index.html">Think Bayes</a></li>
<li>Read <a href="https://github.com/rmcelreath/stat_rethinking_2022">Statistical Rethinking</a></li>
</ul>
</section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<ul>
<li>We’ve had the smallest possible taste of statistical programming using Bayes theorem and sampling methods, in the context of adressing the limitations of off-the-shelf implementations of statistical methods and algorithms.</li>
</ul>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="images/logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://bsmm-8740-fall-2024.github.io/osb/">bsmm-8740-fall-2024.github.io/osb</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="../site_libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true,"numbers":true},
'chalkboard': {"buttons":true},
'multiplex': {"secret":null,"id":"a7e5ef3fff2be494","url":"https://reveal-multiplex.glitch.me/"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 5.0e-2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/bsmm-8740-fall-2024\.github\.io\/osb\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>