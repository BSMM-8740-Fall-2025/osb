# Load required librarieslibrary(dplyr)library(ggplot2)# Set random seed for reproducibilityset.seed(123)# Generate synthetic datan <- 1000data <- data.frame(  customer_id = 1:n,  propensity_score = runif(n),  # Random propensity scores  treatment = rbinom(n, 1, 0.5),  # Random treatment assignment  baseline_response = rbinom(n, 1, 0.3)  # Baseline response rate)# Simulate treatment effect (higher effect for customers with higher propensity)data$outcome <- with(data,   ifelse(treatment == 1,    baseline_response + 0.2 * (propensity_score > 0.7),    baseline_response  ))# Function to calculate Qini curve pointscalculate_qini <- function(data, n_points = 10) {  # Sort by propensity score  data <- data[order(-data$propensity_score), ]    # Calculate incremental gains at different percentiles  percentiles <- seq(0, 1, length.out = n_points)  qini_points <- data.frame(    percentile = percentiles,    incremental_response = NA,    random_incremental_response = NA  )    for(i in 1:length(percentiles)) {    if(percentiles[i] == 0) {      qini_points$incremental_response[i] <- 0      qini_points$random_incremental_response[i] <- 0      next    }        # Select top k% of observations    k <- floor(nrow(data) * percentiles[i])    subset <- data[1:k, ]        # Calculate actual incremental response    treated <- subset[subset$treatment == 1, ]    control <- subset[subset$treatment == 0, ]        # Calculate treatment effect    treat_effect <- sum(treated$outcome) / nrow(treated) -                    sum(control$outcome) / nrow(control)        qini_points$incremental_response[i] <- treat_effect * k    qini_points$random_incremental_response[i] <- treat_effect * k * percentiles[i]  }    return(qini_points)}# Calculate Qini curve pointsqini_data <- calculate_qini(data)# Calculate Qini coefficientqini_coefficient <- with(qini_data, {  actual_area <- sum(diff(percentile) * (incremental_response[-1] + incremental_response[-length(incremental_response)]) / 2)  random_area <- sum(diff(percentile) * (random_incremental_response[-1] + random_incremental_response[-length(random_incremental_response)]) / 2)  actual_area - random_area})# Plot Qini curveggplot(qini_data, aes(x = percentile)) +  geom_line(aes(y = incremental_response, color = "Actual"), size = 1) +  geom_line(aes(y = random_incremental_response, color = "Random"),             linetype = "dashed", size = 1) +  labs(title = "Qini Curve",       x = "Percentage of population targeted",       y = "Cumulative incremental response",       color = "Model") +  theme_minimal() +  scale_color_manual(values = c("Actual" = "blue", "Random" = "red"))# Print Qini coefficientprint(paste("Qini Coefficient:", round(qini_coefficient, 4)))Last edited just now